!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="./",t(t.s=48)}([,function(e,t,n){var r,i;/*!
 * jQuery JavaScript Library v3.1.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2016-09-22T22:30Z
 */
!function(t,n){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,function(n,o){"use strict";function s(e,t){t=t||oe;var n=t.createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}function a(e){var t=!!e&&"length"in e&&e.length,n=ye.type(e);return"function"!==n&&!ye.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function u(e,t,n){return ye.isFunction(t)?ye.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?ye.grep(e,function(e){return e===t!==n}):"string"!=typeof t?ye.grep(e,function(e){return le.call(t,e)>-1!==n}):Re.test(t)?ye.filter(t,e,n):(t=ye.filter(t,e),ye.grep(e,function(e){return le.call(t,e)>-1!==n&&1===e.nodeType}))}function c(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function l(e){var t={};return ye.each(e.match(Pe)||[],function(e,n){t[n]=!0}),t}function d(e){return e}function f(e){throw e}function p(e,t,n){var r;try{e&&ye.isFunction(r=e.promise)?r.call(e).done(t).fail(n):e&&ye.isFunction(r=e.then)?r.call(e,t,n):t.call(void 0,e)}catch(e){n.call(void 0,e)}}function h(){oe.removeEventListener("DOMContentLoaded",h),n.removeEventListener("load",h),ye.ready()}function m(){this.expando=ye.expando+m.uid++}function v(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:$e.test(e)?JSON.parse(e):e)}function g(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Xe,"-$&").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n=v(n)}catch(e){}Fe.set(e,t,n)}else n=void 0;return n}function y(e,t,n,r){var i,o=1,s=20,a=r?function(){return r.cur()}:function(){return ye.css(e,t,"")},u=a(),c=n&&n[3]||(ye.cssNumber[t]?"":"px"),l=(ye.cssNumber[t]||"px"!==c&&+u)&&He.exec(ye.css(e,t));if(l&&l[3]!==c){c=c||l[3],n=n||[],l=+u||1;do o=o||".5",l/=o,ye.style(e,t,l+c);while(o!==(o=a()/u)&&1!==o&&--s)}return n&&(l=+l||+u||0,i=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=l,r.end=i)),i}function b(e){var t,n=e.ownerDocument,r=e.nodeName,i=Ge[r];return i?i:(t=n.body.appendChild(n.createElement(r)),i=ye.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),Ge[r]=i,i)}function _(e,t){for(var n,r,i=[],o=0,s=e.length;o<s;o++)r=e[o],r.style&&(n=r.style.display,t?("none"===n&&(i[o]=Le.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&Ve(r)&&(i[o]=b(r))):"none"!==n&&(i[o]="none",Le.set(r,"display",n)));for(o=0;o<s;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}function w(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&ye.nodeName(e,t)?ye.merge([e],n):n}function T(e,t){for(var n=0,r=e.length;n<r;n++)Le.set(e[n],"globalEval",!t||Le.get(t[n],"globalEval"))}function C(e,t,n,r,i){for(var o,s,a,u,c,l,d=t.createDocumentFragment(),f=[],p=0,h=e.length;p<h;p++)if(o=e[p],o||0===o)if("object"===ye.type(o))ye.merge(f,o.nodeType?[o]:o);else if(Qe.test(o)){for(s=s||d.appendChild(t.createElement("div")),a=(Ye.exec(o)||["",""])[1].toLowerCase(),u=Je[a]||Je._default,s.innerHTML=u[1]+ye.htmlPrefilter(o)+u[2],l=u[0];l--;)s=s.lastChild;ye.merge(f,s.childNodes),s=d.firstChild,s.textContent=""}else f.push(t.createTextNode(o));for(d.textContent="",p=0;o=f[p++];)if(r&&ye.inArray(o,r)>-1)i&&i.push(o);else if(c=ye.contains(o.ownerDocument,o),s=w(d.appendChild(o),"script"),c&&T(s),n)for(l=0;o=s[l++];)Ke.test(o.type||"")&&n.push(o);return d}function k(){return!0}function E(){return!1}function S(){try{return oe.activeElement}catch(e){}}function x(e,t,n,r,i,o){var s,a;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(a in t)x(e,a,n,r,t[a],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),i===!1)i=E;else if(!i)return e;return 1===o&&(s=i,i=function(e){return ye().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=ye.guid++)),e.each(function(){ye.event.add(this,t,i,r,n)})}function R(e,t){return ye.nodeName(e,"table")&&ye.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function A(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function I(e){var t=st.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function j(e,t){var n,r,i,o,s,a,u,c;if(1===t.nodeType){if(Le.hasData(e)&&(o=Le.access(e),s=Le.set(t,o),c=o.events)){delete s.handle,s.events={};for(i in c)for(n=0,r=c[i].length;n<r;n++)ye.event.add(t,i,c[i][n])}Fe.hasData(e)&&(a=Fe.access(e),u=ye.extend({},a),Fe.set(t,u))}}function O(e,t){var n=t.nodeName.toLowerCase();"input"===n&&ze.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function P(e,t,n,r){t=ue.apply([],t);var i,o,a,u,c,l,d=0,f=e.length,p=f-1,h=t[0],m=ye.isFunction(h);if(m||f>1&&"string"==typeof h&&!ve.checkClone&&ot.test(h))return e.each(function(i){var o=e.eq(i);m&&(t[0]=h.call(this,i,o.html())),P(o,t,n,r)});if(f&&(i=C(t,e[0].ownerDocument,!1,e,r),o=i.firstChild,1===i.childNodes.length&&(i=o),o||r)){for(a=ye.map(w(i,"script"),A),u=a.length;d<f;d++)c=i,d!==p&&(c=ye.clone(c,!0,!0),u&&ye.merge(a,w(c,"script"))),n.call(e[d],c,d);if(u)for(l=a[a.length-1].ownerDocument,ye.map(a,I),d=0;d<u;d++)c=a[d],Ke.test(c.type||"")&&!Le.access(c,"globalEval")&&ye.contains(l,c)&&(c.src?ye._evalUrl&&ye._evalUrl(c.src):s(c.textContent.replace(at,""),l))}return e}function N(e,t,n){for(var r,i=t?ye.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ye.cleanData(w(r)),r.parentNode&&(n&&ye.contains(r.ownerDocument,r)&&T(w(r,"script")),r.parentNode.removeChild(r));return e}function D(e,t,n){var r,i,o,s,a=e.style;return n=n||lt(e),n&&(s=n.getPropertyValue(t)||n[t],""!==s||ye.contains(e.ownerDocument,e)||(s=ye.style(e,t)),!ve.pixelMarginRight()&&ct.test(s)&&ut.test(t)&&(r=a.width,i=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=r,a.minWidth=i,a.maxWidth=o)),void 0!==s?s+"":s}function M(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function U(e){if(e in mt)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=ht.length;n--;)if(e=ht[n]+t,e in mt)return e}function L(e,t,n){var r=He.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function F(e,t,n,r,i){var o,s=0;for(o=n===(r?"border":"content")?4:"width"===t?1:0;o<4;o+=2)"margin"===n&&(s+=ye.css(e,n+Be[o],!0,i)),r?("content"===n&&(s-=ye.css(e,"padding"+Be[o],!0,i)),"margin"!==n&&(s-=ye.css(e,"border"+Be[o]+"Width",!0,i))):(s+=ye.css(e,"padding"+Be[o],!0,i),"padding"!==n&&(s+=ye.css(e,"border"+Be[o]+"Width",!0,i)));return s}function $(e,t,n){var r,i=!0,o=lt(e),s="border-box"===ye.css(e,"boxSizing",!1,o);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),r<=0||null==r){if(r=D(e,t,o),(r<0||null==r)&&(r=e.style[t]),ct.test(r))return r;i=s&&(ve.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+F(e,t,n||(s?"border":"content"),i,o)+"px"}function X(e,t,n,r,i){return new X.prototype.init(e,t,n,r,i)}function q(){gt&&(n.requestAnimationFrame(q),ye.fx.tick())}function H(){return n.setTimeout(function(){vt=void 0}),vt=ye.now()}function B(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)n=Be[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function V(e,t,n){for(var r,i=(z.tweeners[t]||[]).concat(z.tweeners["*"]),o=0,s=i.length;o<s;o++)if(r=i[o].call(n,t,e))return r}function W(e,t,n){var r,i,o,s,a,u,c,l,d="width"in t||"height"in t,f=this,p={},h=e.style,m=e.nodeType&&Ve(e),v=Le.get(e,"fxshow");n.queue||(s=ye._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,a=s.empty.fire,s.empty.fire=function(){s.unqueued||a()}),s.unqueued++,f.always(function(){f.always(function(){s.unqueued--,ye.queue(e,"fx").length||s.empty.fire()})}));for(r in t)if(i=t[r],yt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(m?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;m=!0}p[r]=v&&v[r]||ye.style(e,r)}if(u=!ye.isEmptyObject(t),u||!ye.isEmptyObject(p)){d&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],c=v&&v.display,null==c&&(c=Le.get(e,"display")),l=ye.css(e,"display"),"none"===l&&(c?l=c:(_([e],!0),c=e.style.display||c,l=ye.css(e,"display"),_([e]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===ye.css(e,"float")&&(u||(f.done(function(){h.display=c}),null==c&&(l=h.display,c="none"===l?"":l)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",f.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1;for(r in p)u||(v?"hidden"in v&&(m=v.hidden):v=Le.access(e,"fxshow",{display:c}),o&&(v.hidden=!m),m&&_([e],!0),f.done(function(){m||_([e]),Le.remove(e,"fxshow");for(r in p)ye.style(e,r,p[r])})),u=V(m?v[r]:0,r,f),r in v||(v[r]=u.start,m&&(u.end=u.start,u.start=0))}}function G(e,t){var n,r,i,o,s;for(n in e)if(r=ye.camelCase(n),i=t[r],o=e[n],ye.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),s=ye.cssHooks[r],s&&"expand"in s){o=s.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function z(e,t,n){var r,i,o=0,s=z.prefilters.length,a=ye.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=vt||H(),n=Math.max(0,c.startTime+c.duration-t),r=n/c.duration||0,o=1-r,s=0,u=c.tweens.length;s<u;s++)c.tweens[s].run(o);return a.notifyWith(e,[c,o,n]),o<1&&u?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:ye.extend({},t),opts:ye.extend(!0,{specialEasing:{},easing:ye.easing._default},n),originalProperties:t,originalOptions:n,startTime:vt||H(),duration:n.duration,tweens:[],createTween:function(t,n){var r=ye.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)c.tweens[n].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}}),l=c.props;for(G(l,c.opts.specialEasing);o<s;o++)if(r=z.prefilters[o].call(c,e,l,c.opts))return ye.isFunction(r.stop)&&(ye._queueHooks(c.elem,c.opts.queue).stop=ye.proxy(r.stop,r)),r;return ye.map(l,V,c),ye.isFunction(c.opts.start)&&c.opts.start.call(e,c),ye.fx.timer(ye.extend(u,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function Y(e){return(e.match(Pe)||[]).join(" ")}function K(e){return e.getAttribute&&e.getAttribute("class")||""}function J(e,t,n,r){var i;if(ye.isArray(t))ye.each(t,function(t,i){n||At.test(e)?r(e,i):J(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==ye.type(t))r(e,t);else for(i in t)J(e+"["+i+"]",t[i],n,r)}function Q(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(Pe)||[];if(ye.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Z(e,t,n,r){function i(a){var u;return o[a]=!0,ye.each(e[a]||[],function(e,a){var c=a(t,n,r);return"string"!=typeof c||s||o[c]?s?!(u=c):void 0:(t.dataTypes.unshift(c),i(c),!1)}),u}var o={},s=e===Xt;return i(t.dataTypes[0])||!o["*"]&&i("*")}function ee(e,t){var n,r,i=ye.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ye.extend(!0,e,r),e}function te(e,t,n){for(var r,i,o,s,a=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in a)if(a[i]&&a[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}s||(s=i)}o=o||s}if(o)return o!==u[0]&&u.unshift(o),n[o]}function ne(e,t,n,r){var i,o,s,a,u,c={},l=e.dataTypes.slice();if(l[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(o=l.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=l.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(s=c[u+" "+o]||c["* "+o],!s)for(i in c)if(a=i.split(" "),a[1]===o&&(s=c[u+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[i]:c[i]!==!0&&(o=a[0],l.unshift(a[1]));break}if(s!==!0)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}function re(e){return ye.isWindow(e)?e:9===e.nodeType&&e.defaultView}var ie=[],oe=n.document,se=Object.getPrototypeOf,ae=ie.slice,ue=ie.concat,ce=ie.push,le=ie.indexOf,de={},fe=de.toString,pe=de.hasOwnProperty,he=pe.toString,me=he.call(Object),ve={},ge="3.1.1",ye=function(e,t){return new ye.fn.init(e,t)},be=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,_e=/^-ms-/,we=/-([a-z])/g,Te=function(e,t){return t.toUpperCase()};ye.fn=ye.prototype={jquery:ge,constructor:ye,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ye.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ye.each(this,e)},map:function(e){return this.pushStack(ye.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:ce,sort:ie.sort,splice:ie.splice},ye.extend=ye.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||ye.isFunction(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(c&&r&&(ye.isPlainObject(r)||(i=ye.isArray(r)))?(i?(i=!1,o=n&&ye.isArray(n)?n:[]):o=n&&ye.isPlainObject(n)?n:{},s[t]=ye.extend(c,o,r)):void 0!==r&&(s[t]=r));return s},ye.extend({expando:"jQuery"+(ge+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ye.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=ye.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==fe.call(e))&&(!(t=se(e))||(n=pe.call(t,"constructor")&&t.constructor,"function"==typeof n&&he.call(n)===me))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?de[fe.call(e)]||"object":typeof e},globalEval:function(e){s(e)},camelCase:function(e){return e.replace(_e,"ms-").replace(we,Te)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,r=0;if(a(e))for(n=e.length;r<n&&t.call(e[r],r,e[r])!==!1;r++);else for(r in e)if(t.call(e[r],r,e[r])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(be,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(a(Object(e))?ye.merge(n,"string"==typeof e?[e]:e):ce.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:le.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,s=e.length,a=!n;o<s;o++)r=!t(e[o],o),r!==a&&i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(a(e))for(r=e.length;o<r;o++)i=t(e[o],o,n),null!=i&&s.push(i);else for(o in e)i=t(e[o],o,n),null!=i&&s.push(i);return ue.apply([],s)},guid:1,proxy:function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),ye.isFunction(e))return r=ae.call(arguments,2),i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))},i.guid=e.guid=e.guid||ye.guid++,i},now:Date.now,support:ve}),"function"==typeof Symbol&&(ye.fn[Symbol.iterator]=ie[Symbol.iterator]),ye.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){de["[object "+t+"]"]=t.toLowerCase()});var Ce=/*!
 * Sizzle CSS Selector Engine v2.3.3
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-08-08
 */
function(e){function t(e,t,n,r){var i,o,s,a,u,c,l,f=t&&t.ownerDocument,h=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==h&&9!==h&&11!==h)return n;if(!r&&((t?t.ownerDocument||t:X)!==P&&O(t),t=t||P,D)){if(11!==h&&(u=ge.exec(e)))if(i=u[1]){if(9===h){if(!(s=t.getElementById(i)))return n;if(s.id===i)return n.push(s),n}else if(f&&(s=f.getElementById(i))&&F(t,s)&&s.id===i)return n.push(s),n}else{if(u[2])return Q.apply(n,t.getElementsByTagName(e)),n;if((i=u[3])&&T.getElementsByClassName&&t.getElementsByClassName)return Q.apply(n,t.getElementsByClassName(i)),n}if(T.qsa&&!W[e+" "]&&(!M||!M.test(e))){if(1!==h)f=t,l=e;else if("object"!==t.nodeName.toLowerCase()){for((a=t.getAttribute("id"))?a=a.replace(we,Te):t.setAttribute("id",a=$),c=S(e),o=c.length;o--;)c[o]="#"+a+" "+p(c[o]);l=c.join(","),f=ye.test(e)&&d(t.parentNode)||t}if(l)try{return Q.apply(n,f.querySelectorAll(l)),n}catch(e){}finally{a===$&&t.removeAttribute("id")}}}return R(e.replace(ae,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>C.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[$]=!0,e}function i(e){var t=P.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),r=n.length;r--;)C.attrHandle[n[r]]=t}function s(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function u(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return function(t){return"form"in t?t.parentNode&&t.disabled===!1?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ke(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function l(e){return r(function(t){return t=+t,r(function(n,r){for(var i,o=e([],n.length,t),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}function d(e){return e&&void 0!==e.getElementsByTagName&&e}function f(){}function p(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function h(e,t,n){var r=t.dir,i=t.next,o=i||r,s=n&&"parentNode"===o,a=H++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||s)return e(t,n,i);return!1}:function(t,n,u){var c,l,d,f=[q,a];if(u){for(;t=t[r];)if((1===t.nodeType||s)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||s)if(d=t[$]||(t[$]={}),l=d[t.uniqueID]||(d[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=l[o])&&c[0]===q&&c[1]===a)return f[2]=c[2];if(l[o]=f,f[2]=e(t,n,u))return!0}return!1}}function m(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function v(e,n,r){for(var i=0,o=n.length;i<o;i++)t(e,n[i],r);return r}function g(e,t,n,r,i){for(var o,s=[],a=0,u=e.length,c=null!=t;a<u;a++)(o=e[a])&&(n&&!n(o,r,i)||(s.push(o),c&&t.push(a)));return s}function y(e,t,n,i,o,s){return i&&!i[$]&&(i=y(i)),o&&!o[$]&&(o=y(o,s)),r(function(r,s,a,u){var c,l,d,f=[],p=[],h=s.length,m=r||v(t||"*",a.nodeType?[a]:a,[]),y=!e||!r&&t?m:g(m,f,e,a,u),b=n?o||(r?e:h||i)?[]:s:y;if(n&&n(y,b,a,u),i)for(c=g(b,p),i(c,[],a,u),l=c.length;l--;)(d=c[l])&&(b[p[l]]=!(y[p[l]]=d));if(r){if(o||e){if(o){for(c=[],l=b.length;l--;)(d=b[l])&&c.push(y[l]=d);o(null,b=[],c,u)}for(l=b.length;l--;)(d=b[l])&&(c=o?ee(r,d):f[l])>-1&&(r[c]=!(s[c]=d))}}else b=g(b===s?b.splice(h,b.length):b),o?o(null,s,b,u):Q.apply(s,b)})}function b(e){for(var t,n,r,i=e.length,o=C.relative[e[0].type],s=o||C.relative[" "],a=o?1:0,u=h(function(e){return e===t},s,!0),c=h(function(e){return ee(t,e)>-1},s,!0),l=[function(e,n,r){var i=!o&&(r||n!==A)||((t=n).nodeType?u(e,n,r):c(e,n,r));return t=null,i}];a<i;a++)if(n=C.relative[e[a].type])l=[h(m(l),n)];else{if(n=C.filter[e[a].type].apply(null,e[a].matches),n[$]){for(r=++a;r<i&&!C.relative[e[r].type];r++);return y(a>1&&m(l),a>1&&p(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(ae,"$1"),n,a<r&&b(e.slice(a,r)),r<i&&b(e=e.slice(r)),r<i&&p(e))}l.push(n)}return m(l)}function _(e,n){var i=n.length>0,o=e.length>0,s=function(r,s,a,u,c){var l,d,f,p=0,h="0",m=r&&[],v=[],y=A,b=r||o&&C.find.TAG("*",c),_=q+=null==y?1:Math.random()||.1,w=b.length;for(c&&(A=s===P||s||c);h!==w&&null!=(l=b[h]);h++){if(o&&l){for(d=0,s||l.ownerDocument===P||(O(l),a=!D);f=e[d++];)if(f(l,s||P,a)){u.push(l);break}c&&(q=_)}i&&((l=!f&&l)&&p--,r&&m.push(l))}if(p+=h,i&&h!==p){for(d=0;f=n[d++];)f(m,v,s,a);if(r){if(p>0)for(;h--;)m[h]||v[h]||(v[h]=K.call(u));v=g(v)}Q.apply(u,v),c&&!r&&v.length>0&&p+n.length>1&&t.uniqueSort(u)}return c&&(q=_,A=y),m};return i?r(s):s}var w,T,C,k,E,S,x,R,A,I,j,O,P,N,D,M,U,L,F,$="sizzle"+1*new Date,X=e.document,q=0,H=0,B=n(),V=n(),W=n(),G=function(e,t){return e===t&&(j=!0),0},z={}.hasOwnProperty,Y=[],K=Y.pop,J=Y.push,Q=Y.push,Z=Y.slice,ee=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",re="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ie="\\["+ne+"*("+re+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ne+"*\\]",oe=":("+re+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ie+")*)|.*)\\)|)",se=new RegExp(ne+"+","g"),ae=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ue=new RegExp("^"+ne+"*,"+ne+"*"),ce=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),le=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),de=new RegExp(oe),fe=new RegExp("^"+re+"$"),pe={ID:new RegExp("^#("+re+")"),CLASS:new RegExp("^\\.("+re+")"),TAG:new RegExp("^("+re+"|[*])"),ATTR:new RegExp("^"+ie),PSEUDO:new RegExp("^"+oe),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,be=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),_e=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},we=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Te=function(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Ce=function(){O()},ke=h(function(e){return e.disabled===!0&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{Q.apply(Y=Z.call(X.childNodes),X.childNodes),Y[X.childNodes.length].nodeType}catch(e){Q={apply:Y.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}T=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},O=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:X;return r!==P&&9===r.nodeType&&r.documentElement?(P=r,N=P.documentElement,D=!E(P),X!==P&&(n=P.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",Ce,!1):n.attachEvent&&n.attachEvent("onunload",Ce)),T.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),T.getElementsByTagName=i(function(e){return e.appendChild(P.createComment("")),!e.getElementsByTagName("*").length}),T.getElementsByClassName=ve.test(P.getElementsByClassName),T.getById=i(function(e){return N.appendChild(e).id=$,!P.getElementsByName||!P.getElementsByName($).length}),T.getById?(C.filter.ID=function(e){var t=e.replace(be,_e);return function(e){return e.getAttribute("id")===t}},C.find.ID=function(e,t){if(void 0!==t.getElementById&&D){var n=t.getElementById(e);return n?[n]:[]}}):(C.filter.ID=function(e){var t=e.replace(be,_e);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},C.find.ID=function(e,t){if(void 0!==t.getElementById&&D){var n,r,i,o=t.getElementById(e);if(o){if(n=o.getAttributeNode("id"),n&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if(n=o.getAttributeNode("id"),n&&n.value===e)return[o]}return[]}}),C.find.TAG=T.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):T.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},C.find.CLASS=T.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&D)return t.getElementsByClassName(e)},U=[],M=[],(T.qsa=ve.test(P.querySelectorAll))&&(i(function(e){N.appendChild(e).innerHTML="<a id='"+$+"'></a><select id='"+$+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&M.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||M.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+$+"-]").length||M.push("~="),e.querySelectorAll(":checked").length||M.push(":checked"),e.querySelectorAll("a#"+$+"+*").length||M.push(".#.+[+~]")}),i(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=P.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&M.push("name"+ne+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&M.push(":enabled",":disabled"),N.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&M.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),M.push(",.*:")})),(T.matchesSelector=ve.test(L=N.matches||N.webkitMatchesSelector||N.mozMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&i(function(e){T.disconnectedMatch=L.call(e,"*"),L.call(e,"[s!='']:x"),U.push("!=",oe)}),M=M.length&&new RegExp(M.join("|")),U=U.length&&new RegExp(U.join("|")),t=ve.test(N.compareDocumentPosition),F=t||ve.test(N.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},G=t?function(e,t){if(e===t)return j=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n?n:(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!T.sortDetached&&t.compareDocumentPosition(e)===n?e===P||e.ownerDocument===X&&F(X,e)?-1:t===P||t.ownerDocument===X&&F(X,t)?1:I?ee(I,e)-ee(I,t):0:4&n?-1:1)}:function(e,t){if(e===t)return j=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],u=[t];if(!i||!o)return e===P?-1:t===P?1:i?-1:o?1:I?ee(I,e)-ee(I,t):0;if(i===o)return s(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;a[r]===u[r];)r++;return r?s(a[r],u[r]):a[r]===X?-1:u[r]===X?1:0},P):P},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==P&&O(e),n=n.replace(le,"='$1']"),T.matchesSelector&&D&&!W[n+" "]&&(!U||!U.test(n))&&(!M||!M.test(n)))try{var r=L.call(e,n);if(r||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(n,P,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==P&&O(e),F(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==P&&O(e);var n=C.attrHandle[t.toLowerCase()],r=n&&z.call(C.attrHandle,t.toLowerCase())?n(e,t,!D):void 0;return void 0!==r?r:T.attributes||!D?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.escape=function(e){return(e+"").replace(we,Te)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,i=0;if(j=!T.detectDuplicates,I=!T.sortStable&&e.slice(0),e.sort(G),j){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return I=null,e},k=t.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=k(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=k(t);return n},C=t.selectors={cacheLength:50,createPseudo:r,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,_e),e[3]=(e[3]||e[4]||e[5]||"").replace(be,_e),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return pe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&de.test(n)&&(t=S(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,_e).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=B[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&B(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(i){var o=t.attr(i,e);return null==o?"!="===n:!n||(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o.replace(se," ")+" ").indexOf(r)>-1:"|="===n&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var c,l,d,f,p,h,m=o!==s?"nextSibling":"previousSibling",v=t.parentNode,g=a&&t.nodeName.toLowerCase(),y=!u&&!a,b=!1;if(v){if(o){for(;m;){for(f=t;f=f[m];)if(a?f.nodeName.toLowerCase()===g:1===f.nodeType)return!1;h=m="only"===e&&!h&&"nextSibling"}return!0}if(h=[s?v.firstChild:v.lastChild],s&&y){for(f=v,d=f[$]||(f[$]={}),l=d[f.uniqueID]||(d[f.uniqueID]={}),c=l[e]||[],p=c[0]===q&&c[1],b=p&&c[2],f=p&&v.childNodes[p];f=++p&&f&&f[m]||(b=p=0)||h.pop();)if(1===f.nodeType&&++b&&f===t){l[e]=[q,p,b];break}}else if(y&&(f=t,d=f[$]||(f[$]={}),l=d[f.uniqueID]||(d[f.uniqueID]={}),c=l[e]||[],p=c[0]===q&&c[1],b=p),b===!1)for(;(f=++p&&f&&f[m]||(b=p=0)||h.pop())&&((a?f.nodeName.toLowerCase()!==g:1!==f.nodeType)||!++b||(y&&(d=f[$]||(f[$]={}),l=d[f.uniqueID]||(d[f.uniqueID]={}),l[e]=[q,b]),f!==t)););return b-=i,b===r||b%r===0&&b/r>=0}}},PSEUDO:function(e,n){var i,o=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[$]?o(n):o.length>1?(i=[e,e,"",n],C.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,i=o(e,n),s=i.length;s--;)r=ee(e,i[s]),e[r]=!(t[r]=i[s])}):function(e){return o(e,0,i)}):o}},pseudos:{not:r(function(e){var t=[],n=[],i=x(e.replace(ae,"$1"));return i[$]?r(function(e,t,n,r){for(var o,s=i(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(be,_e),function(t){return(t.textContent||t.innerText||k(t)).indexOf(e)>-1}}),lang:r(function(e){return fe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,_e).toLowerCase(),function(t){var n;do if(n=D?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===N},focus:function(e){return e===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:c(!1),disabled:c(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:l(function(){return[0]}),last:l(function(e,t){return[t-1]}),eq:l(function(e,t,n){return[n<0?n+t:n]}),even:l(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:l(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:l(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:l(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},C.pseudos.nth=C.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[w]=a(w);for(w in{submit:!0,reset:!0})C.pseudos[w]=u(w);return f.prototype=C.filters=C.pseudos,C.setFilters=new f,S=t.tokenize=function(e,n){var r,i,o,s,a,u,c,l=V[e+" "];if(l)return n?0:l.slice(0);for(a=e,u=[],c=C.preFilter;a;){r&&!(i=ue.exec(a))||(i&&(a=a.slice(i[0].length)||a),u.push(o=[])),r=!1,(i=ce.exec(a))&&(r=i.shift(),o.push({value:r,type:i[0].replace(ae," ")}),a=a.slice(r.length));for(s in C.filter)!(i=pe[s].exec(a))||c[s]&&!(i=c[s](i))||(r=i.shift(),o.push({value:r,type:s,matches:i}),a=a.slice(r.length));if(!r)break}return n?a.length:a?t.error(e):V(e,u).slice(0)},x=t.compile=function(e,t){var n,r=[],i=[],o=W[e+" "];if(!o){for(t||(t=S(e)),n=t.length;n--;)o=b(t[n]),o[$]?r.push(o):i.push(o);o=W(e,_(i,r)),o.selector=e}return o},R=t.select=function(e,t,n,r){var i,o,s,a,u,c="function"==typeof e&&e,l=!r&&S(e=c.selector||e);if(n=n||[],1===l.length){if(o=l[0]=l[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&9===t.nodeType&&D&&C.relative[o[1].type]){if(t=(C.find.ID(s.matches[0].replace(be,_e),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=pe.needsContext.test(e)?0:o.length;i--&&(s=o[i],!C.relative[a=s.type]);)if((u=C.find[a])&&(r=u(s.matches[0].replace(be,_e),ye.test(o[0].type)&&d(t.parentNode)||t))){if(o.splice(i,1),e=r.length&&p(o),!e)return Q.apply(n,r),n;break}}return(c||x(e,l))(r,t,!D,n,!t||ye.test(e)&&d(t.parentNode)||t),n},T.sortStable=$.split("").sort(G).join("")===$,T.detectDuplicates=!!j,O(),T.sortDetached=i(function(e){return 1&e.compareDocumentPosition(P.createElement("fieldset"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),T.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(n);ye.find=Ce,ye.expr=Ce.selectors,ye.expr[":"]=ye.expr.pseudos,ye.uniqueSort=ye.unique=Ce.uniqueSort,ye.text=Ce.getText,ye.isXMLDoc=Ce.isXML,ye.contains=Ce.contains,ye.escapeSelector=Ce.escape;var ke=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&ye(e).is(n))break;r.push(e)}return r},Ee=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},Se=ye.expr.match.needsContext,xe=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Re=/^.[^:#\[\.,]*$/;ye.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ye.find.matchesSelector(r,e)?[r]:[]:ye.find.matches(e,ye.grep(t,function(e){return 1===e.nodeType}))},ye.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(ye(e).filter(function(){for(t=0;t<r;t++)if(ye.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ye.find(e,i[t],n);return r>1?ye.uniqueSort(n):n},filter:function(e){return this.pushStack(u(this,e||[],!1))},not:function(e){return this.pushStack(u(this,e||[],!0))},is:function(e){return!!u(this,"string"==typeof e&&Se.test(e)?ye(e):e||[],!1).length}});var Ae,Ie=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ye.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||Ae,"string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Ie.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ye?t[0]:t,ye.merge(this,ye.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:oe,!0)),xe.test(r[1])&&ye.isPlainObject(t))for(r in t)ye.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=oe.getElementById(r[2]),i&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):ye.isFunction(e)?void 0!==n.ready?n.ready(e):e(ye):ye.makeArray(e,this)}).prototype=ye.fn,Ae=ye(oe);var je=/^(?:parents|prev(?:Until|All))/,Oe={children:!0,contents:!0,next:!0,prev:!0};ye.fn.extend({has:function(e){var t=ye(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ye.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],s="string"!=typeof e&&ye(e);if(!Se.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ye.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?ye.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?le.call(ye(e),this[0]):le.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ye.uniqueSort(ye.merge(this.get(),ye(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ye.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ke(e,"parentNode")},parentsUntil:function(e,t,n){return ke(e,"parentNode",n)},next:function(e){return c(e,"nextSibling")},prev:function(e){return c(e,"previousSibling")},nextAll:function(e){return ke(e,"nextSibling")},prevAll:function(e){return ke(e,"previousSibling")},nextUntil:function(e,t,n){return ke(e,"nextSibling",n)},prevUntil:function(e,t,n){return ke(e,"previousSibling",n)},siblings:function(e){return Ee((e.parentNode||{}).firstChild,e)},children:function(e){return Ee(e.firstChild)},contents:function(e){return e.contentDocument||ye.merge([],e.childNodes)}},function(e,t){ye.fn[e]=function(n,r){var i=ye.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=ye.filter(r,i)),this.length>1&&(Oe[e]||ye.uniqueSort(i),je.test(e)&&i.reverse()),this.pushStack(i)}});var Pe=/[^\x20\t\r\n\f]+/g;ye.Callbacks=function(e){e="string"==typeof e?l(e):ye.extend({},e);var t,n,r,i,o=[],s=[],a=-1,u=function(){for(i=e.once,r=t=!0;s.length;a=-1)for(n=s.shift();++a<o.length;)o[a].apply(n[0],n[1])===!1&&e.stopOnFalse&&(a=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},c={add:function(){return o&&(n&&!t&&(a=o.length-1,s.push(n)),function t(n){ye.each(n,function(n,r){ye.isFunction(r)?e.unique&&c.has(r)||o.push(r):r&&r.length&&"string"!==ye.type(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return ye.each(arguments,function(e,t){for(var n;(n=ye.inArray(t,o,n))>-1;)o.splice(n,1),n<=a&&a--}),this},has:function(e){return e?ye.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=s=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=s=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=n||[],n=[e,n.slice?n.slice():n],s.push(n),t||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},ye.extend({Deferred:function(e){var t=[["notify","progress",ye.Callbacks("memory"),ye.Callbacks("memory"),2],["resolve","done",ye.Callbacks("once memory"),ye.Callbacks("once memory"),0,"resolved"],["reject","fail",ye.Callbacks("once memory"),ye.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return ye.Deferred(function(n){ye.each(t,function(t,r){var i=ye.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&ye.isFunction(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(e,r,i){function o(e,t,r,i){return function(){var a=this,u=arguments,c=function(){var n,c;if(!(e<s)){if(n=r.apply(a,u),n===t.promise())throw new TypeError("Thenable self-resolution");c=n&&("object"==typeof n||"function"==typeof n)&&n.then,ye.isFunction(c)?i?c.call(n,o(s,t,d,i),o(s,t,f,i)):(s++,c.call(n,o(s,t,d,i),o(s,t,f,i),o(s,t,d,t.notifyWith))):(r!==d&&(a=void 0,u=[n]),(i||t.resolveWith)(a,u))}},l=i?c:function(){try{c()}catch(n){ye.Deferred.exceptionHook&&ye.Deferred.exceptionHook(n,l.stackTrace),e+1>=s&&(r!==f&&(a=void 0,u=[n]),t.rejectWith(a,u))}};e?l():(ye.Deferred.getStackHook&&(l.stackTrace=ye.Deferred.getStackHook()),n.setTimeout(l))}}var s=0;return ye.Deferred(function(n){t[0][3].add(o(0,n,ye.isFunction(i)?i:d,n.notifyWith)),t[1][3].add(o(0,n,ye.isFunction(e)?e:d)),t[2][3].add(o(0,n,ye.isFunction(r)?r:f))}).promise()},promise:function(e){return null!=e?ye.extend(e,i):i}},o={};return ye.each(t,function(e,n){var s=n[2],a=n[5];i[n[1]]=s.add,a&&s.add(function(){r=a},t[3-e][2].disable,t[0][2].lock),s.add(n[3].fire),o[n[0]]=function(){return o[n[0]+"With"](this===o?void 0:this,arguments),this},o[n[0]+"With"]=s.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=ae.call(arguments),o=ye.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?ae.call(arguments):n,--t||o.resolveWith(r,i)}};if(t<=1&&(p(e,o.done(s(n)).resolve,o.reject),"pending"===o.state()||ye.isFunction(i[n]&&i[n].then)))return o.then();for(;n--;)p(i[n],s(n),o.reject);return o.promise()}});var Ne=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ye.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&Ne.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},ye.readyException=function(e){n.setTimeout(function(){throw e})};var De=ye.Deferred();ye.fn.ready=function(e){return De.then(e).catch(function(e){ye.readyException(e)}),this},ye.extend({isReady:!1,readyWait:1,holdReady:function(e){e?ye.readyWait++:ye.ready(!0)},ready:function(e){(e===!0?--ye.readyWait:ye.isReady)||(ye.isReady=!0,e!==!0&&--ye.readyWait>0||De.resolveWith(oe,[ye]))}}),ye.ready.then=De.then,"complete"===oe.readyState||"loading"!==oe.readyState&&!oe.documentElement.doScroll?n.setTimeout(ye.ready):(oe.addEventListener("DOMContentLoaded",h),n.addEventListener("load",h));var Me=function(e,t,n,r,i,o,s){var a=0,u=e.length,c=null==n;if("object"===ye.type(n)){i=!0;for(a in n)Me(e,t,a,n[a],!0,o,s)}else if(void 0!==r&&(i=!0,ye.isFunction(r)||(s=!0),c&&(s?(t.call(e,r),t=null):(c=t,t=function(e,t,n){return c.call(ye(e),n)})),t))for(;a<u;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:c?t.call(e):u?t(e[0],n):o},Ue=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};m.uid=1,m.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Ue(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[ye.camelCase(t)]=n;else for(r in t)i[ye.camelCase(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][ye.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){ye.isArray(t)?t=t.map(ye.camelCase):(t=ye.camelCase(t),t=t in r?[t]:t.match(Pe)||[]),n=t.length;for(;n--;)delete r[t[n]]}(void 0===t||ye.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ye.isEmptyObject(t)}};var Le=new m,Fe=new m,$e=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Xe=/[A-Z]/g;ye.extend({hasData:function(e){return Fe.hasData(e)||Le.hasData(e)},data:function(e,t,n){return Fe.access(e,t,n)},removeData:function(e,t){Fe.remove(e,t)},_data:function(e,t,n){return Le.access(e,t,n)},_removeData:function(e,t){Le.remove(e,t)}}),ye.fn.extend({data:function(e,t){var n,r,i,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(i=Fe.get(o),1===o.nodeType&&!Le.get(o,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(r=s[n].name,0===r.indexOf("data-")&&(r=ye.camelCase(r.slice(5)),g(o,r,i[r])));Le.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){Fe.set(this,e)}):Me(this,function(t){var n;if(o&&void 0===t){if(n=Fe.get(o,e),void 0!==n)return n;if(n=g(o,e),void 0!==n)return n}else this.each(function(){Fe.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Fe.remove(this,e)})}}),ye.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Le.get(e,t),n&&(!r||ye.isArray(n)?r=Le.access(e,t,ye.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ye.queue(e,t),r=n.length,i=n.shift(),o=ye._queueHooks(e,t),s=function(){ye.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Le.get(e,n)||Le.access(e,n,{empty:ye.Callbacks("once memory").add(function(){Le.remove(e,[t+"queue",n])})})}}),ye.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?ye.queue(this[0],e):void 0===t?this:this.each(function(){var n=ye.queue(this,e,t);ye._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&ye.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ye.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ye.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=Le.get(o[s],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var qe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,He=new RegExp("^(?:([+-])=|)("+qe+")([a-z%]*)$","i"),Be=["Top","Right","Bottom","Left"],Ve=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&ye.contains(e.ownerDocument,e)&&"none"===ye.css(e,"display")},We=function(e,t,n,r){var i,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=s[o];return i},Ge={};ye.fn.extend({show:function(){return _(this,!0)},hide:function(){return _(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ve(this)?ye(this).show():ye(this).hide()})}});var ze=/^(?:checkbox|radio)$/i,Ye=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Ke=/^$|\/(?:java|ecma)script/i,Je={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Je.optgroup=Je.option,Je.tbody=Je.tfoot=Je.colgroup=Je.caption=Je.thead,Je.th=Je.td;var Qe=/<|&#?\w+;/;!function(){var e=oe.createDocumentFragment(),t=e.appendChild(oe.createElement("div")),n=oe.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),ve.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",ve.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ze=oe.documentElement,et=/^key/,tt=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,nt=/^([^.]*)(?:\.(.+)|)/;ye.event={global:{},add:function(e,t,n,r,i){var o,s,a,u,c,l,d,f,p,h,m,v=Le.get(e);if(v)for(n.handler&&(o=n,n=o.handler,i=o.selector),i&&ye.find.matchesSelector(Ze,i),n.guid||(n.guid=ye.guid++),(u=v.events)||(u=v.events={}),(s=v.handle)||(s=v.handle=function(t){return void 0!==ye&&ye.event.triggered!==t.type?ye.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Pe)||[""],c=t.length;c--;)a=nt.exec(t[c])||[],p=m=a[1],h=(a[2]||"").split(".").sort(),p&&(d=ye.event.special[p]||{},p=(i?d.delegateType:d.bindType)||p,d=ye.event.special[p]||{},l=ye.extend({type:p,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ye.expr.match.needsContext.test(i),namespace:h.join(".")},o),(f=u[p])||(f=u[p]=[],f.delegateCount=0,d.setup&&d.setup.call(e,r,h,s)!==!1||e.addEventListener&&e.addEventListener(p,s)),d.add&&(d.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?f.splice(f.delegateCount++,0,l):f.push(l),ye.event.global[p]=!0)},remove:function(e,t,n,r,i){var o,s,a,u,c,l,d,f,p,h,m,v=Le.hasData(e)&&Le.get(e);if(v&&(u=v.events)){for(t=(t||"").match(Pe)||[""],c=t.length;c--;)if(a=nt.exec(t[c])||[],p=m=a[1],h=(a[2]||"").split(".").sort(),p){for(d=ye.event.special[p]||{},p=(r?d.delegateType:d.bindType)||p,f=u[p]||[],a=a[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=f.length;o--;)l=f[o],!i&&m!==l.origType||n&&n.guid!==l.guid||a&&!a.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(f.splice(o,1),l.selector&&f.delegateCount--,d.remove&&d.remove.call(e,l));s&&!f.length&&(d.teardown&&d.teardown.call(e,h,v.handle)!==!1||ye.removeEvent(e,p,v.handle),delete u[p])}else for(p in u)ye.event.remove(e,p+t[c],n,r,!0);ye.isEmptyObject(u)&&Le.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,s,a=ye.event.fix(e),u=new Array(arguments.length),c=(Le.get(this,"events")||{})[a.type]||[],l=ye.event.special[a.type]||{};for(u[0]=a,t=1;t<arguments.length;t++)u[t]=arguments[t];if(a.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,a)!==!1){for(s=ye.event.handlers.call(this,a,c),t=0;(i=s[t++])&&!a.isPropagationStopped();)for(a.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(o.namespace)||(a.handleObj=o,a.data=o.data,r=((ye.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u),void 0!==r&&(a.result=r)===!1&&(a.preventDefault(),a.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,a),a.result}},handlers:function(e,t){var n,r,i,o,s,a=[],u=t.delegateCount,c=e.target;if(u&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||c.disabled!==!0)){for(o=[],s={},n=0;n<u;n++)r=t[n],i=r.selector+" ",void 0===s[i]&&(s[i]=r.needsContext?ye(i,this).index(c)>-1:ye.find(i,this,null,[c]).length),s[i]&&o.push(r);o.length&&a.push({elem:c,handlers:o})}return c=this,u<t.length&&a.push({elem:c,handlers:t.slice(u)}),a},addProp:function(e,t){Object.defineProperty(ye.Event.prototype,e,{enumerable:!0,configurable:!0,get:ye.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[ye.expando]?e:new ye.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==S()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===S()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&ye.nodeName(this,"input"))return this.click(),!1},_default:function(e){return ye.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ye.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ye.Event=function(e,t){if(!(this instanceof ye.Event))return new ye.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?k:E,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ye.extend(this,t),this.timeStamp=e&&e.timeStamp||ye.now(),this[ye.expando]=!0},ye.Event.prototype={constructor:ye.Event,isDefaultPrevented:E,isPropagationStopped:E,isImmediatePropagationStopped:E,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=k,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=k,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=k,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ye.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&et.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&tt.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},ye.event.addProp),ye.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ye.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||ye.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),ye.fn.extend({on:function(e,t,n,r){return x(this,e,t,n,r)},one:function(e,t,n,r){return x(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ye(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return t!==!1&&"function"!=typeof t||(n=t,t=void 0),n===!1&&(n=E),this.each(function(){ye.event.remove(this,e,n,t)})}});var rt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,it=/<script|<style|<link/i,ot=/checked\s*(?:[^=]|=\s*.checked.)/i,st=/^true\/(.*)/,at=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ye.extend({htmlPrefilter:function(e){return e.replace(rt,"<$1></$2>")},clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),u=ye.contains(e.ownerDocument,e);if(!(ve.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ye.isXMLDoc(e)))for(s=w(a),o=w(e),r=0,i=o.length;r<i;r++)O(o[r],s[r]);if(t)if(n)for(o=o||w(e),s=s||w(a),r=0,i=o.length;r<i;r++)j(o[r],s[r]);else j(e,a);return s=w(a,"script"),s.length>0&&T(s,!u&&w(e,"script")),a},cleanData:function(e){for(var t,n,r,i=ye.event.special,o=0;void 0!==(n=e[o]);o++)if(Ue(n)){if(t=n[Le.expando]){if(t.events)for(r in t.events)i[r]?ye.event.remove(n,r):ye.removeEvent(n,r,t.handle);n[Le.expando]=void 0}n[Fe.expando]&&(n[Fe.expando]=void 0)}}}),ye.fn.extend({detach:function(e){return N(this,e,!0)},remove:function(e){return N(this,e)},text:function(e){return Me(this,function(e){return void 0===e?ye.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return P(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){R(this,e).appendChild(e)}})},prepend:function(){return P(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=R(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return P(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return P(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ye.cleanData(w(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ye.clone(this,e,t)})},html:function(e){return Me(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!it.test(e)&&!Je[(Ye.exec(e)||["",""])[1].toLowerCase()]){e=ye.htmlPrefilter(e);try{for(;n<r;n++)t=this[n]||{},1===t.nodeType&&(ye.cleanData(w(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return P(this,arguments,function(t){var n=this.parentNode;ye.inArray(this,e)<0&&(ye.cleanData(w(this)),n&&n.replaceChild(t,this))},e)}}),ye.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ye.fn[e]=function(e){for(var n,r=[],i=ye(e),o=i.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),ye(i[s])[t](n),ce.apply(r,n.get());return this.pushStack(r)}});var ut=/^margin/,ct=new RegExp("^("+qe+")(?!px)[a-z%]+$","i"),lt=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)};!function(){function e(){if(a){a.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Ze.appendChild(s);var e=n.getComputedStyle(a);t="1%"!==e.top,o="2px"===e.marginLeft,r="4px"===e.width,a.style.marginRight="50%",i="4px"===e.marginRight,Ze.removeChild(s),a=null}}var t,r,i,o,s=oe.createElement("div"),a=oe.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",ve.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),ye.extend(ve,{pixelPosition:function(){return e(),t},boxSizingReliable:function(){return e(),r},pixelMarginRight:function(){return e(),i},reliableMarginLeft:function(){return e(),o}}))}();var dt=/^(none|table(?!-c[ea]).+)/,ft={position:"absolute",visibility:"hidden",display:"block"},pt={letterSpacing:"0",fontWeight:"400"},ht=["Webkit","Moz","ms"],mt=oe.createElement("div").style;ye.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=D(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=ye.camelCase(t),u=e.style;if(t=ye.cssProps[a]||(ye.cssProps[a]=U(a)||a),s=ye.cssHooks[t]||ye.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(e,!1,r))?i:u[t];o=typeof n,"string"===o&&(i=He.exec(n))&&i[1]&&(n=y(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(ye.cssNumber[a]?"":"px")),ve.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,r))||(u[t]=n))}},css:function(e,t,n,r){var i,o,s,a=ye.camelCase(t);return t=ye.cssProps[a]||(ye.cssProps[a]=U(a)||a),s=ye.cssHooks[t]||ye.cssHooks[a],s&&"get"in s&&(i=s.get(e,!0,n)),void 0===i&&(i=D(e,t,r)),"normal"===i&&t in pt&&(i=pt[t]),""===n||n?(o=parseFloat(i),n===!0||isFinite(o)?o||0:i):i}}),ye.each(["height","width"],function(e,t){ye.cssHooks[t]={get:function(e,n,r){if(n)return!dt.test(ye.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?$(e,t,r):We(e,ft,function(){return $(e,t,r)})},set:function(e,n,r){var i,o=r&&lt(e),s=r&&F(e,t,r,"border-box"===ye.css(e,"boxSizing",!1,o),o);return s&&(i=He.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=ye.css(e,t)),L(e,n,s)}}}),ye.cssHooks.marginLeft=M(ve.reliableMarginLeft,function(e,t){if(t)return(parseFloat(D(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ye.each({margin:"",padding:"",border:"Width"},function(e,t){ye.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+Be[r]+t]=o[r]||o[r-2]||o[0];return i}},ut.test(e)||(ye.cssHooks[e+t].set=L)}),ye.fn.extend({css:function(e,t){return Me(this,function(e,t,n){var r,i,o={},s=0;if(ye.isArray(t)){for(r=lt(e),i=t.length;s<i;s++)o[t[s]]=ye.css(e,t[s],!1,r);return o}return void 0!==n?ye.style(e,t,n):ye.css(e,t)},e,t,arguments.length>1)}}),ye.Tween=X,X.prototype={constructor:X,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ye.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ye.cssNumber[n]?"":"px")},cur:function(){var e=X.propHooks[this.prop];return e&&e.get?e.get(this):X.propHooks._default.get(this)},run:function(e){var t,n=X.propHooks[this.prop];return this.options.duration?this.pos=t=ye.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):X.propHooks._default.set(this),this}},X.prototype.init.prototype=X.prototype,X.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ye.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){ye.fx.step[e.prop]?ye.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[ye.cssProps[e.prop]]&&!ye.cssHooks[e.prop]?e.elem[e.prop]=e.now:ye.style(e.elem,e.prop,e.now+e.unit)}}},X.propHooks.scrollTop=X.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ye.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ye.fx=X.prototype.init,ye.fx.step={};var vt,gt,yt=/^(?:toggle|show|hide)$/,bt=/queueHooks$/;ye.Animation=ye.extend(z,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return y(n.elem,e,He.exec(t),n),n}]},tweener:function(e,t){ye.isFunction(e)?(t=e,e=["*"]):e=e.match(Pe);for(var n,r=0,i=e.length;r<i;r++)n=e[r],z.tweeners[n]=z.tweeners[n]||[],z.tweeners[n].unshift(t)},prefilters:[W],prefilter:function(e,t){t?z.prefilters.unshift(e):z.prefilters.push(e)}}),ye.speed=function(e,t,n){var r=e&&"object"==typeof e?ye.extend({},e):{complete:n||!n&&t||ye.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ye.isFunction(t)&&t};return ye.fx.off||oe.hidden?r.duration=0:"number"!=typeof r.duration&&(r.duration in ye.fx.speeds?r.duration=ye.fx.speeds[r.duration]:r.duration=ye.fx.speeds._default),null!=r.queue&&r.queue!==!0||(r.queue="fx"),r.old=r.complete,r.complete=function(){ye.isFunction(r.old)&&r.old.call(this),r.queue&&ye.dequeue(this,r.queue)},r},ye.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Ve).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=ye.isEmptyObject(e),o=ye.speed(t,n,r),s=function(){var t=z(this,ye.extend({},e),o);(i||Le.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=ye.timers,s=Le.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&bt.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||ye.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=Le.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=ye.timers,s=r?r.length:0;for(n.finish=!0,ye.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),ye.each(["toggle","show","hide"],function(e,t){var n=ye.fn[t];ye.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(B(t,!0),e,r,i)}}),ye.each({slideDown:B("show"),slideUp:B("hide"),slideToggle:B("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ye.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),ye.timers=[],ye.fx.tick=function(){var e,t=0,n=ye.timers;for(vt=ye.now();t<n.length;t++)e=n[t],e()||n[t]!==e||n.splice(t--,1);n.length||ye.fx.stop(),vt=void 0},ye.fx.timer=function(e){ye.timers.push(e),e()?ye.fx.start():ye.timers.pop()},ye.fx.interval=13,ye.fx.start=function(){gt||(gt=n.requestAnimationFrame?n.requestAnimationFrame(q):n.setInterval(ye.fx.tick,ye.fx.interval))},ye.fx.stop=function(){n.cancelAnimationFrame?n.cancelAnimationFrame(gt):n.clearInterval(gt),gt=null},ye.fx.speeds={slow:600,fast:200,_default:400},ye.fn.delay=function(e,t){return e=ye.fx?ye.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var i=n.setTimeout(t,e);r.stop=function(){n.clearTimeout(i)}})},function(){var e=oe.createElement("input"),t=oe.createElement("select"),n=t.appendChild(oe.createElement("option"));e.type="checkbox",ve.checkOn=""!==e.value,ve.optSelected=n.selected,e=oe.createElement("input"),e.value="t",e.type="radio",ve.radioValue="t"===e.value}();var _t,wt=ye.expr.attrHandle;ye.fn.extend({attr:function(e,t){return Me(this,ye.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ye.removeAttr(this,e)})}}),ye.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?ye.prop(e,t,n):(1===o&&ye.isXMLDoc(e)||(i=ye.attrHooks[t.toLowerCase()]||(ye.expr.match.bool.test(t)?_t:void 0)),void 0!==n?null===n?void ye.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=ye.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!ve.radioValue&&"radio"===t&&ye.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(Pe);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),_t={set:function(e,t,n){return t===!1?ye.removeAttr(e,n):e.setAttribute(n,n),n}},ye.each(ye.expr.match.bool.source.match(/\w+/g),function(e,t){var n=wt[t]||ye.find.attr;wt[t]=function(e,t,r){var i,o,s=t.toLowerCase();return r||(o=wt[s],wt[s]=i,i=null!=n(e,t,r)?s:null,wt[s]=o),i}});var Tt=/^(?:input|select|textarea|button)$/i,Ct=/^(?:a|area)$/i;ye.fn.extend({prop:function(e,t){return Me(this,ye.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ye.propFix[e]||e]})}}),ye.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ye.isXMLDoc(e)||(t=ye.propFix[t]||t,i=ye.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ye.find.attr(e,"tabindex");return t?parseInt(t,10):Tt.test(e.nodeName)||Ct.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ve.optSelected||(ye.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ye.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ye.propFix[this.toLowerCase()]=this}),ye.fn.extend({addClass:function(e){var t,n,r,i,o,s,a,u=0;if(ye.isFunction(e))return this.each(function(t){ye(this).addClass(e.call(this,t,K(this)))});if("string"==typeof e&&e)for(t=e.match(Pe)||[];n=this[u++];)if(i=K(n),r=1===n.nodeType&&" "+Y(i)+" "){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");a=Y(r),i!==a&&n.setAttribute("class",a)}return this},removeClass:function(e){var t,n,r,i,o,s,a,u=0;if(ye.isFunction(e))return this.each(function(t){ye(this).removeClass(e.call(this,t,K(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Pe)||[];n=this[u++];)if(i=K(n),r=1===n.nodeType&&" "+Y(i)+" "){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");a=Y(r),i!==a&&n.setAttribute("class",a)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):ye.isFunction(e)?this.each(function(n){ye(this).toggleClass(e.call(this,n,K(this),t),t)}):this.each(function(){var t,r,i,o;if("string"===n)for(r=0,i=ye(this),o=e.match(Pe)||[];t=o[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||(t=K(this),t&&Le.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Le.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+Y(K(n))+" ").indexOf(t)>-1)return!0;return!1}});var kt=/\r/g;ye.fn.extend({val:function(e){var t,n,r,i=this[0];{if(arguments.length)return r=ye.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,ye(this).val()):e,null==i?i="":"number"==typeof i?i+="":ye.isArray(i)&&(i=ye.map(i,function(e){return null==e?"":e+""})),t=ye.valHooks[this.type]||ye.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))});if(i)return t=ye.valHooks[i.type]||ye.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(kt,""):null==n?"":n)}}}),ye.extend({valHooks:{option:{get:function(e){var t=ye.find.attr(e,"value");return null!=t?t:Y(ye.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,s="select-one"===e.type,a=s?null:[],u=s?o+1:i.length;for(r=o<0?u:s?o:0;r<u;r++)if(n=i[r],(n.selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!ye.nodeName(n.parentNode,"optgroup"))){if(t=ye(n).val(),s)return t;a.push(t)}return a},set:function(e,t){for(var n,r,i=e.options,o=ye.makeArray(t),s=i.length;s--;)r=i[s],(r.selected=ye.inArray(ye.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ye.each(["radio","checkbox"],function(){ye.valHooks[this]={set:function(e,t){if(ye.isArray(t))return e.checked=ye.inArray(ye(e).val(),t)>-1}},ve.checkOn||(ye.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=/^(?:focusinfocus|focusoutblur)$/;ye.extend(ye.event,{trigger:function(e,t,r,i){var o,s,a,u,c,l,d,f=[r||oe],p=pe.call(e,"type")?e.type:e,h=pe.call(e,"namespace")?e.namespace.split("."):[];if(s=a=r=r||oe,3!==r.nodeType&&8!==r.nodeType&&!Et.test(p+ye.event.triggered)&&(p.indexOf(".")>-1&&(h=p.split("."),p=h.shift(),h.sort()),c=p.indexOf(":")<0&&"on"+p,e=e[ye.expando]?e:new ye.Event(p,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:ye.makeArray(t,[e]),d=ye.event.special[p]||{},i||!d.trigger||d.trigger.apply(r,t)!==!1)){if(!i&&!d.noBubble&&!ye.isWindow(r)){for(u=d.delegateType||p,Et.test(u+p)||(s=s.parentNode);s;s=s.parentNode)f.push(s),a=s;a===(r.ownerDocument||oe)&&f.push(a.defaultView||a.parentWindow||n)}for(o=0;(s=f[o++])&&!e.isPropagationStopped();)e.type=o>1?u:d.bindType||p,l=(Le.get(s,"events")||{})[e.type]&&Le.get(s,"handle"),l&&l.apply(s,t),l=c&&s[c],l&&l.apply&&Ue(s)&&(e.result=l.apply(s,t),e.result===!1&&e.preventDefault());return e.type=p,i||e.isDefaultPrevented()||d._default&&d._default.apply(f.pop(),t)!==!1||!Ue(r)||c&&ye.isFunction(r[p])&&!ye.isWindow(r)&&(a=r[c],a&&(r[c]=null),ye.event.triggered=p,r[p](),ye.event.triggered=void 0,a&&(r[c]=a)),e.result}},simulate:function(e,t,n){var r=ye.extend(new ye.Event,n,{type:e,isSimulated:!0});ye.event.trigger(r,null,t)}}),ye.fn.extend({trigger:function(e,t){return this.each(function(){ye.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ye.event.trigger(e,t,n,!0)}}),ye.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){ye.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ye.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),ve.focusin="onfocusin"in n,ve.focusin||ye.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){ye.event.simulate(t,e.target,ye.event.fix(e))};ye.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=Le.access(r,t);i||r.addEventListener(e,n,!0),Le.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=Le.access(r,t)-1;i?Le.access(r,t,i):(r.removeEventListener(e,n,!0),Le.remove(r,t))}}});var St=n.location,xt=ye.now(),Rt=/\?/;ye.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||ye.error("Invalid XML: "+e),t};var At=/\[\]$/,It=/\r?\n/g,jt=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;ye.param=function(e,t){var n,r=[],i=function(e,t){var n=ye.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(ye.isArray(e)||e.jquery&&!ye.isPlainObject(e))ye.each(e,function(){i(this.name,this.value)});else for(n in e)J(n,e[n],t,i);return r.join("&")},ye.fn.extend({serialize:function(){return ye.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ye.prop(this,"elements");return e?ye.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ye(this).is(":disabled")&&Ot.test(this.nodeName)&&!jt.test(e)&&(this.checked||!ze.test(e))}).map(function(e,t){var n=ye(this).val();return null==n?null:ye.isArray(n)?ye.map(n,function(e){return{name:t.name,value:e.replace(It,"\r\n")}}):{name:t.name,value:n.replace(It,"\r\n")}}).get()}});var Pt=/%20/g,Nt=/#.*$/,Dt=/([?&])_=[^&]*/,Mt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ut=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lt=/^(?:GET|HEAD)$/,Ft=/^\/\//,$t={},Xt={},qt="*/".concat("*"),Ht=oe.createElement("a");Ht.href=St.href,ye.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:St.href,type:"GET",isLocal:Ut.test(St.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":qt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ye.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ee(ee(e,ye.ajaxSettings),t):ee(ye.ajaxSettings,e)},ajaxPrefilter:Q($t),ajaxTransport:Q(Xt),ajax:function(e,t){function r(e,t,r,a){var c,f,p,_,w,T=t;l||(l=!0,u&&n.clearTimeout(u),i=void 0,s=a||"",C.readyState=e>0?4:0,c=e>=200&&e<300||304===e,r&&(_=te(h,C,r)),_=ne(h,_,C,c),c?(h.ifModified&&(w=C.getResponseHeader("Last-Modified"),w&&(ye.lastModified[o]=w),w=C.getResponseHeader("etag"),w&&(ye.etag[o]=w)),204===e||"HEAD"===h.type?T="nocontent":304===e?T="notmodified":(T=_.state,f=_.data,p=_.error,c=!p)):(p=T,!e&&T||(T="error",e<0&&(e=0))),C.status=e,C.statusText=(t||T)+"",c?g.resolveWith(m,[f,T,C]):g.rejectWith(m,[C,T,p]),C.statusCode(b),b=void 0,d&&v.trigger(c?"ajaxSuccess":"ajaxError",[C,h,c?f:p]),y.fireWith(m,[C,T]),d&&(v.trigger("ajaxComplete",[C,h]),--ye.active||ye.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,o,s,a,u,c,l,d,f,p,h=ye.ajaxSetup({},t),m=h.context||h,v=h.context&&(m.nodeType||m.jquery)?ye(m):ye.event,g=ye.Deferred(),y=ye.Callbacks("once memory"),b=h.statusCode||{},_={},w={},T="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(l){if(!a)for(a={};t=Mt.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return l?s:null},setRequestHeader:function(e,t){return null==l&&(e=w[e.toLowerCase()]=w[e.toLowerCase()]||e,_[e]=t),this},overrideMimeType:function(e){return null==l&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)C.always(e[C.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||T;return i&&i.abort(t),r(0,t),this}};if(g.promise(C),h.url=((e||h.url||St.href)+"").replace(Ft,St.protocol+"//"),h.type=t.method||t.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(Pe)||[""],null==h.crossDomain){c=oe.createElement("a");try{c.href=h.url,c.href=c.href,h.crossDomain=Ht.protocol+"//"+Ht.host!=c.protocol+"//"+c.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=ye.param(h.data,h.traditional)),Z($t,h,t,C),l)return C;d=ye.event&&h.global,d&&0===ye.active++&&ye.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Lt.test(h.type),o=h.url.replace(Nt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(Pt,"+")):(p=h.url.slice(o.length),h.data&&(o+=(Rt.test(o)?"&":"?")+h.data,delete h.data),h.cache===!1&&(o=o.replace(Dt,"$1"),p=(Rt.test(o)?"&":"?")+"_="+xt+++p),h.url=o+p),h.ifModified&&(ye.lastModified[o]&&C.setRequestHeader("If-Modified-Since",ye.lastModified[o]),ye.etag[o]&&C.setRequestHeader("If-None-Match",ye.etag[o])),(h.data&&h.hasContent&&h.contentType!==!1||t.contentType)&&C.setRequestHeader("Content-Type",h.contentType),C.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+qt+"; q=0.01":""):h.accepts["*"]);for(f in h.headers)C.setRequestHeader(f,h.headers[f]);if(h.beforeSend&&(h.beforeSend.call(m,C,h)===!1||l))return C.abort();if(T="abort",y.add(h.complete),C.done(h.success),C.fail(h.error),i=Z(Xt,h,t,C)){if(C.readyState=1,d&&v.trigger("ajaxSend",[C,h]),l)return C;h.async&&h.timeout>0&&(u=n.setTimeout(function(){C.abort("timeout")},h.timeout));try{l=!1,i.send(_,r)}catch(e){if(l)throw e;r(-1,e)}}else r(-1,"No Transport");return C},getJSON:function(e,t,n){return ye.get(e,t,n,"json")},getScript:function(e,t){return ye.get(e,void 0,t,"script")}}),ye.each(["get","post"],function(e,t){ye[t]=function(e,n,r,i){return ye.isFunction(n)&&(i=i||r,r=n,n=void 0),ye.ajax(ye.extend({url:e,type:t,dataType:i,data:n,success:r},ye.isPlainObject(e)&&e))}}),ye._evalUrl=function(e){return ye.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},ye.fn.extend({wrapAll:function(e){var t;return this[0]&&(ye.isFunction(e)&&(e=e.call(this[0])),t=ye(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return ye.isFunction(e)?this.each(function(t){ye(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ye(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ye.isFunction(e);return this.each(function(n){ye(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ye(this).replaceWith(this.childNodes)}),this}}),ye.expr.pseudos.hidden=function(e){return!ye.expr.pseudos.visible(e)},ye.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ye.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var Bt={0:200,1223:204},Vt=ye.ajaxSettings.xhr();ve.cors=!!Vt&&"withCredentials"in Vt,ve.ajax=Vt=!!Vt,ye.ajaxTransport(function(e){var t,r;if(ve.cors||Vt&&!e.crossDomain)return{send:function(i,o){var s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(s in e.xhrFields)a[s]=e.xhrFields[s];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(s in i)a.setRequestHeader(s,i[s]);t=function(e){return function(){t&&(t=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Bt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),r=a.onerror=t("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&n.setTimeout(function(){t&&r()})},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),ye.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ye.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ye.globalEval(e),e}}}),ye.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ye.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=ye("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),oe.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Wt=[],Gt=/(=)\?(?=&|$)|\?\?/;ye.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Wt.pop()||ye.expando+"_"+xt++;return this[e]=!0,e}}),ye.ajaxPrefilter("json jsonp",function(e,t,r){var i,o,s,a=e.jsonp!==!1&&(Gt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=ye.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Gt,"$1"+i):e.jsonp!==!1&&(e.url+=(Rt.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return s||ye.error(i+" was not called"),s[0]},e.dataTypes[0]="json",o=n[i],n[i]=function(){s=arguments},r.always(function(){void 0===o?ye(n).removeProp(i):n[i]=o,e[i]&&(e.jsonpCallback=t.jsonpCallback,Wt.push(i)),s&&ye.isFunction(o)&&o(s[0]),s=o=void 0}),"script"}),ve.createHTMLDocument=function(){var e=oe.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),ye.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var r,i,o;return t||(ve.createHTMLDocument?(t=oe.implementation.createHTMLDocument(""),r=t.createElement("base"),r.href=oe.location.href,t.head.appendChild(r)):t=oe),i=xe.exec(e),o=!n&&[],i?[t.createElement(i[1])]:(i=C([e],t,o),o&&o.length&&ye(o).remove(),ye.merge([],i.childNodes))},ye.fn.load=function(e,t,n){var r,i,o,s=this,a=e.indexOf(" ");return a>-1&&(r=Y(e.slice(a)),e=e.slice(0,a)),ye.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),s.length>0&&ye.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?ye("<div>").append(ye.parseHTML(e)).find(r):e)}).always(n&&function(e,t){s.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ye.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ye.fn[t]=function(e){return this.on(t,e)}}),ye.expr.pseudos.animated=function(e){return ye.grep(ye.timers,function(t){return e===t.elem}).length},ye.offset={setOffset:function(e,t,n){var r,i,o,s,a,u,c,l=ye.css(e,"position"),d=ye(e),f={};"static"===l&&(e.style.position="relative"),a=d.offset(),o=ye.css(e,"top"),u=ye.css(e,"left"),c=("absolute"===l||"fixed"===l)&&(o+u).indexOf("auto")>-1,c?(r=d.position(),s=r.top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(u)||0),ye.isFunction(t)&&(t=t.call(e,n,ye.extend({},a))),null!=t.top&&(f.top=t.top-a.top+s),null!=t.left&&(f.left=t.left-a.left+i),"using"in t?t.using.call(e,f):d.css(f)}},ye.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ye.offset.setOffset(this,e,t)});var t,n,r,i,o=this[0];if(o)return o.getClientRects().length?(r=o.getBoundingClientRect(),r.width||r.height?(i=o.ownerDocument,n=re(i),t=i.documentElement,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r):{top:0,left:0}},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===ye.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ye.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+ye.css(e[0],"borderTopWidth",!0),left:r.left+ye.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-ye.css(n,"marginTop",!0),left:t.left-r.left-ye.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===ye.css(e,"position");)e=e.offsetParent;return e||Ze})}}),ye.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;ye.fn[e]=function(r){return Me(this,function(e,r,i){var o=re(e);if(void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),ye.each(["top","left"],function(e,t){ye.cssHooks[t]=M(ve.pixelPosition,function(e,n){if(n)return n=D(e,t),ct.test(n)?ye(e).position()[t]+"px":n})}),ye.each({Height:"height",Width:"width"},function(e,t){ye.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){ye.fn[r]=function(i,o){var s=arguments.length&&(n||"boolean"!=typeof i),a=n||(i===!0||o===!0?"margin":"border");return Me(this,function(t,n,i){var o;return ye.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?ye.css(t,n,a):ye.style(t,n,i,a)},t,s?i:void 0,s)}})}),ye.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),ye.parseJSON=JSON.parse,r=[],i=function(){return ye}.apply(t,r),void 0!==i&&(e.exports=i);var zt=n.jQuery,Yt=n.$;return ye.noConflict=function(e){return n.$===ye&&(n.$=Yt),e&&n.jQuery===ye&&(n.jQuery=zt),ye},o||(n.jQuery=n.$=ye),ye})},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},,function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){m&&p&&(m=!1,p.length?h=p.concat(h):v=-1,h.length&&a())}function a(){if(!m){var e=i(s);m=!0;for(var t=h.length;t;){for(p=h,h=[];++v<t;)p&&p[v].run();v=-1,t=h.length}p=null,m=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l,d,f=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var p,h=[],m=!1,v=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new u(e,t)),1!==h.length||m||i(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(35),s=n(34),a=n(43),u=function(){function t(e){r(this,t),this.baseUrl="http://healthkon-video-api.dev",this.identity=e.identity,this.room=e.room,this.localVideoContainer=document.getElementById(e.localVideoContainer),this.remoteVideoContainer=document.getElementById(e.remoteVideoContainer),this.presenterIdentity=e.presenterIdentity,this.presenterVideoContainer=document.getElementById(e.presenterVideoContainer),this.checkBrowserSupport()}return i(t,[{key:"authorize",value:function(t){var n=this;return e.ajax({method:"POST",url:this.baseUrl+"/api/conference/authenticate",data:{identity:this.identity},dataType:"json",error:function(e){alert("Error: Check your API key.")},success:function(e){n.videoJwt=e.video_jwt,n.chatJwt=e.chat_jwt,n.userId=e.user_id,n.client=new o.Client(n.videoJwt),n.localMedia=new o.LocalMedia,o.getUserMedia().then(function(e){n.localMedia.addStream(e),n.attachLocalVideo(n.localMedia)})},beforeSend:function(e,n){e.setRequestHeader("Authorization","Bearer: "+t)}})}},{key:"presenterInitiation",value:function(e){this.presenterInitiation=e}},{key:"connect",value:function(){return this.checkBrowserSupport(),this.client.connect({to:this.room,localMedia:this.localMedia})}},{key:"attachLocalVideo",value:function(t){var n=this,r=e(this.localVideoContainer);t.tracks.forEach(function(e){var t=document.createElement("div"),i=document.createElement("video");if("video"==e.kind){t.appendChild(i),i.setAttribute("controls",!0),i.setAttribute("autoplay",!0),i.setAttribute("muted",!0),i.setAttribute("id",e.id),i.srcObject=e.mediaStream,r.html(t);var o=n.localPlayerControls();a.setup(i,{html:o,audio:!1})}})}},{key:"joinRoom",value:function(e){var t=this,n=e.localParticipant;if(this.presenterInitiation&&this.identity!=this.presenterIdentity){var r=!1;if(e.participants.forEach(function(e){e.identity==t.presenterIdentity&&(r=!0)}),!r)return e.disconnect(),{status:!1,message:"Waiting for presenter!"}}return this.logConnection(e,n),e.participants.forEach(function(n){n.on("trackAdded",function(r){t.addVideo(n,r,e)})}),e.on("participantConnected",function(n){n.on("trackAdded",function(r){t.addVideo(n,r,e)})}),e.on("participantDisconnected",function(e){t.removeVideo(e)}),{status:!0,message:"Room connected."}}},{key:"setConferenceTimeout",value:function(e){this.timeout=e}},{key:"addVideo",value:function(e,t,n){var r=this.timeout?this.timeout:0;if("video"==t.kind){var i="";i=e.identity==this.presenterIdentity?this.presenterVideoContainer:this.remoteVideoContainer;var o=document.createElement("div");o.setAttribute("id",e.sid);var s=document.createElement("video");s.setAttribute("class","remote-video"),o.appendChild(s),s.setAttribute("controls",!0),s.setAttribute("autoplay",!0),s.setAttribute("id",t.id),s.srcObject=t.mediaStream,i.appendChild(o);var u="";u=e.identity==this.presenterIdentity?this.presenterPlayerControls():this.remotePlayerControls(),a.setup(s,{html:u,duration:r});var c=this;s.addEventListener("timeupdate",function(){this._startTime||(this._startTime=this.currentTime);var t=this.currentTime-this._startTime,i=document.querySelector("#player__time");if(i){var o=Math.floor(t);o=("0"+o).slice(-2);var s=Math.floor(t/60);s=("0"+s).slice(-2);var a=Math.floor(t/3600);a=("0"+a).slice(-2);var u=s+":"+o;a>0&&(u=a+":"+u),i.innerHTML=u}r>0&&t>=r&&(n.disconnect(),c.removeVideo(e))})}}},{key:"localPlayerControls",value:function(){return"<div class='plyr__controls'>\n\t\t\t    <button type='button' data-plyr='play'>\n\t\t\t        <svg><use xlink:href='#plyr-play'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Play</span>\n\t\t\t    </button>\n\t\t\t    <button type='button' data-plyr='pause'>\n\t\t\t        <svg><use xlink:href='#plyr-pause'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Pause</span>\n\t\t\t    </button>\n\t\t\t    <button type='button' data-plyr='fullscreen'>\n\t\t\t        <svg class='icon--exit-fullscreen'><use xlink:href='#plyr-exit-fullscreen'></use></svg>\n\t\t\t        <svg><use xlink:href='#plyr-enter-fullscreen'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Toggle Fullscreen</span>\n\t\t\t    </button>\n\t\t\t</div>"}},{key:"remotePlayerControls",value:function(){return"<div class='plyr__controls'>\n\t\t\t    <button type='button' data-plyr='play'>\n\t\t\t        <svg><use xlink:href='#plyr-play'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Play</span>\n\t\t\t    </button>\n\t\t\t    <button type='button' data-plyr='pause'>\n\t\t\t        <svg><use xlink:href='#plyr-pause'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Pause</span>\n\t\t\t    </button>\n\t\t\t    <span class='plyr__time'>\n\t\t\t        <span class='plyr__sr-only'>Current time</span>\n\t\t\t        <span class='plyr__time' id='player__time'>00:00</span>\n\t\t\t    </span>\n\t\t\t    <span class='plyr__time'>\n\t\t\t        <span class='plyr__sr-only'>Duration</span>\n\t\t\t        <span class='plyr__time--duration'>00:00</span>\n\t\t\t    </span>\n\t\t\t    <button type='button' data-plyr='mute'>\n\t\t\t        <svg class='icon--muted'><use xlink:href='#plyr-muted'></use></svg>\n\t\t\t        <svg><use xlink:href='#plyr-volume'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Toggle Mute</span>\n\t\t\t    </button>\n\t\t\t    <span class='plyr__volume'>\n\t\t\t        <label for='volume{id}' class='plyr__sr-only'>Volume</label>\n\t\t\t        <input id='volume{id}' class='plyr__volume--input' type='range' min='0' max='10' value='5' data-plyr='volume'>\n\t\t\t        <progress class='plyr__volume--display' max='10' value='0' role='presentation'></progress>\n\t\t\t    </span>\n\t\t\t    <button type='button' data-plyr='fullscreen'>\n\t\t\t        <svg class='icon--exit-fullscreen'><use xlink:href='#plyr-exit-fullscreen'></use></svg>\n\t\t\t        <svg><use xlink:href='#plyr-enter-fullscreen'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Toggle Fullscreen</span>\n\t\t\t    </button>\n\t\t\t</div>"}},{key:"presenterPlayerControls",value:function(){return"<div class='plyr__controls'>\n\t\t\t    <button type='button' data-plyr='play'>\n\t\t\t        <svg><use xlink:href='#plyr-play'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Play</span>\n\t\t\t    </button>\n\t\t\t    <button type='button' data-plyr='pause'>\n\t\t\t        <svg><use xlink:href='#plyr-pause'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Pause</span>\n\t\t\t    </button>\n\t\t\t    <span class='plyr__time'>\n\t\t\t        <span class='plyr__sr-only'>Current time</span>\n\t\t\t        <span class='plyr__time' id='player__time'>00:00</span>\n\t\t\t    </span>\n\t\t\t    <span class='plyr__time'>\n\t\t\t        <span class='plyr__sr-only'>Duration</span>\n\t\t\t        <span class='plyr__time--duration'>00:00</span>\n\t\t\t    </span>\n\t\t\t    <button type='button' data-plyr='mute'>\n\t\t\t        <svg class='icon--muted'><use xlink:href='#plyr-muted'></use></svg>\n\t\t\t        <svg><use xlink:href='#plyr-volume'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Toggle Mute</span>\n\t\t\t    </button>\n\t\t\t    <span class='plyr__volume'>\n\t\t\t        <label for='volume{id}' class='plyr__sr-only'>Volume</label>\n\t\t\t        <input id='volume{id}' class='plyr__volume--input' type='range' min='0' max='10' value='5' data-plyr='volume'>\n\t\t\t        <progress class='plyr__volume--display' max='10' value='0' role='presentation'></progress>\n\t\t\t    </span>\n\t\t\t    <button type='button' data-plyr='fullscreen'>\n\t\t\t        <svg class='icon--exit-fullscreen'><use xlink:href='#plyr-exit-fullscreen'></use></svg>\n\t\t\t        <svg><use xlink:href='#plyr-enter-fullscreen'></use></svg>\n\t\t\t        <span class='plyr__sr-only'>Toggle Fullscreen</span>\n\t\t\t    </button>\n\t\t\t</div>"}},{key:"removeVideo",value:function(t){this.logDisconnection(t),e("#"+t.sid).remove()}},{key:"withChat",value:function(e){var t=this;this.chatConfig=e;var n=s.Client;n=new s(this.chatJwt),n.initialize().then(function(e){t.chatConnected(e)})}},{key:"chatConnected",value:function(e){var t=this,n=e.getChannelByUniqueName(this.room);this.pushChatInfo("Connecting.."),n.then(function(e){t.pushChatInfo("Connected"),t.setupChatConversation(e)},function(n){404==n.status&&e.createChannel({uniqueName:t.room,friendlyName:"General Channel"}).then(function(e){t.pushChatInfo("Connected"),t.setupChatConversation(e)})})}},{key:"setupChatConversation",value:function(t){var n=this;t.join().then(function(e){n.pushChatInfo("Joined as "+n.identity)}),t.on("messageAdded",function(e){n.pushChatMessage(e.author,e.body)});var r=e("#"+this.chatConfig.messageInput);r.on("keydown",function(e){13==e.keyCode&&(t.sendMessage(r.val()),r.val(""))})}},{key:"pushChatMessage",value:function(t,n){var r=e("#"+this.chatConfig.messagesContainer),i='<div class="video-chat-message-block">\n\t\t\t\t<div class="video-chat-user"> '+t+': </div>\n\t\t\t\t<div class="video-chat-message"> '+n+" </div>\n\t\t</div>";r.append(i)}},{key:"pushChatInfo",value:function(t){var n=e("#"+this.chatConfig.messagesContainer),r='<div class="video-chat-message-info">'+t+"</div>";n.append(r)}},{key:"logConnection",value:function(t,n){return e.ajax({method:"POST",url:this.baseUrl+"/api/conference/connect",data:{user_id:this.userId,room_sid:t.sid,room_name:t.name,participant:n.identity,participant_sid:n.sid},success:function(e){},error:function(e){}})}},{key:"logDisconnection",value:function(t){return e.ajax({method:"POST",url:this.baseUrl+"/api/conference/disconnect",data:{participant_sid:t.sid},success:function(e){},error:function(e){}})}},{key:"checkBrowserSupport",value:function(){navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||alert("Video conference is not available in your browser. Kindly use Chrome / Firefox / Opera")}}]),t}();t.default=u}).call(t,n(1))},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);window.Video=r.default},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){(function(n,r){var i,o,s,a,a,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){if("object"===u(t)&&void 0!==e)e.exports=n();else{o=[],i=n,s="function"==typeof i?i.apply(t,o):i,void 0!==s&&(e.exports=s)}}(function(){var e,t,i;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var c="function"==typeof a&&a;if(!u&&c)return a(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return i(n?n:e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof a&&a,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":41}],2:[function(e,t,n){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":42}],3:[function(e,t,n){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":43}],4:[function(e,t,n){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":44}],5:[function(e,t,n){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":45}],6:[function(e,t,n){t.exports={default:e("core-js/library/fn/number/is-integer"),__esModule:!0}},{"core-js/library/fn/number/is-integer":46}],7:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":47}],8:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":48}],9:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":49}],10:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":50}],11:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":51}],12:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":52}],13:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":53}],14:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":54}],15:[function(e,t,n){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":55}],16:[function(e,t,n){t.exports={default:e("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":56}],17:[function(e,t,n){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":57}],18:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":58}],19:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":59}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/promise"),o=r(i);n.default=function(e){return function(){var t=e.apply(this,arguments);return new o.default(function(e,n){function r(i,s){try{var a=t[i](s),u=a.value}catch(e){return void n(e)}if(!a.done)return o.default.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}return r("next")})}}},{"../core-js/promise":15}],21:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/define-property"),o=r(i);n.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":10}],23:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/assign"),o=r(i);n.default=o.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},{"../core-js/object/assign":7}],24:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/object/set-prototype-of"),o=r(i),s=e("../core-js/object/create"),a=r(s),u=e("../helpers/typeof"),c=r(u);n.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,c.default)(t)));e.prototype=(0,a.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(o.default?(0,o.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":8,"../core-js/object/set-prototype-of":14,"../helpers/typeof":27}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../helpers/typeof"),o=r(i);n.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":27}],26:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/is-iterable"),o=r(i),s=e("../core-js/get-iterator"),a=r(s);n.default=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,u=(0,a.default)(e);!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,o.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":2,"../core-js/is-iterable":3}],27:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n.__esModule=!0;var i=e("../core-js/symbol/iterator"),o=r(i),s=e("../core-js/symbol"),a=r(s),c="function"==typeof a.default&&"symbol"===u(o.default)?function(e){return void 0===e?"undefined":u(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":u(e)};n.default="function"==typeof a.default&&"symbol"===c(o.default)?function(e){return void 0===e?"undefined":c(e)}:function(e){return e&&"function"==typeof a.default&&e.constructor===a.default&&e!==a.default.prototype?"symbol":void 0===e?"undefined":c(e)}},{"../core-js/symbol":18,"../core-js/symbol/iterator":19}],28:[function(e,t,n){t.exports=e("regenerator-runtime")},{"regenerator-runtime":179}],29:[function(e,t,n){var r=e("./lib/backoff"),i=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),s=e("./lib/function_call.js");t.exports.Backoff=r,t.exports.FunctionCall=s,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new r(new o(e))},t.exports.exponential=function(e){return new r(new i(e))},t.exports.call=function(e,t,n){var r=Array.prototype.slice.call(arguments);return e=r[0],t=r.slice(1,r.length-1),n=r[r.length-1],new s(e,t,n)}},{"./lib/backoff":30,"./lib/function_call.js":31,"./lib/strategy/exponential":32,"./lib/strategy/fibonacci":33}],30:[function(e,t,n){function r(e){i.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}var i=e("events"),o=e("precond");e("util").inherits(r,i.EventEmitter),r.prototype.failAfter=function(e){o.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},r.prototype.backoff=function(e){o.checkState(this.timeoutID_===-1,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},r.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},r.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=r},{events:169,precond:175,util:223}],31:[function(e,t,n){function r(e,t,n){i.EventEmitter.call(this),o.checkIsFunction(e,"Expected fn to be a function."),o.checkIsArray(t,"Expected args to be an array."),o.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=r.DEFAULT_RETRY_PREDICATE_,this.state_=r.State_.PENDING}var i=e("events"),o=e("precond"),s=e("util"),a=e("./backoff"),u=e("./strategy/fibonacci");s.inherits(r,i.EventEmitter),r.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},r.DEFAULT_RETRY_PREDICATE_=function(e){return!0},r.prototype.isPending=function(){return this.state_==r.State_.PENDING},r.prototype.isRunning=function(){return this.state_==r.State_.RUNNING},r.prototype.isCompleted=function(){return this.state_==r.State_.COMPLETED},r.prototype.isAborted=function(){return this.state_==r.State_.ABORTED},r.prototype.setStrategy=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},r.prototype.retryIf=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},r.prototype.getLastResult=function(){return this.lastResult_.concat()},r.prototype.getNumRetries=function(){return this.numRetries_},r.prototype.failAfter=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},r.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=r.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},r.prototype.start=function(e){o.checkState(!this.isAborted(),"FunctionCall is aborted."),o.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new u;this.backoff_=e?e(t):new a(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=r.State_.RUNNING,this.doCall_(!1)},r.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);i.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},r.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},r.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,i.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=r.State_.COMPLETED,this.doCallback_())}},r.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},t.exports=r},{"./backoff":30,"./strategy/fibonacci":33,events:169,precond:175,util:223}],32:[function(e,t,n){function r(e){s.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=r.DEFAULT_FACTOR,e&&void 0!==e.factor&&(o.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}var i=e("util"),o=e("precond"),s=e("./strategy");i.inherits(r,s),r.DEFAULT_FACTOR=2,r.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},r.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=r},{"./strategy":34,precond:175,util:223}],33:[function(e,t,n){function r(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}var i=e("util"),o=e("./strategy");i.inherits(r,o),r.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},r.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=r},{"./strategy":34,util:223}],34:[function(e,t,n){function r(e){return void 0!==e&&null!==e}function i(e){if(e=e||{},r(e.initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(r(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(r(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}e("events"),e("util");i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:169,util:223}],35:[function(t,i,o){(function(n,s){/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2015 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(t){if("object"==(void 0===o?"undefined":u(o))&&void 0!==i)i.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var n;"undefined"!=typeof window?n=window:void 0!==s?n=s:"undefined"!=typeof self&&(n=self),n.Promise=t()}}(function(){var e,i,o;return function e(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[a]={exports:{}};n[a][0].call(d.exports,function(e){var t=n[a][1][e];return o(t?t:e)},d,d.exports,e,n,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=c}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function s(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var u;try{throw new Error}catch(e){u=e}var c=e("./schedule"),l=e("./queue"),d=e("./util");i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,t){t?(n.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),n.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?s.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=s,i.prototype.settlePromises=a),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},t.exports=i,t.exports.firstLineError=u},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0===(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var c=n(o),l=new e(t);l._propagateFrom(this,1);var d=this._target();if(l._setBoundTo(c),c instanceof e){var f={promiseRejectionQueued:!1,promise:l,target:d,bindingPromise:c};d._then(t,s,void 0,l,f),c._then(a,u,void 0,l,f),l._setOnCancel(c)}else l._resolveCallback(d);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=this._bitField&-2097153},e.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+a.classString(e)+" has no method '"+a.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s,a=e("./util"),u=a.canEvaluate;a.isIdentifier;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t,n="number"==typeof e;if(n)t=o;else if(u){var r=s(e);t=null!==r?r:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,u=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=s(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),u.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){function n(e,n,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var d=e[l];if(d===Error||null!=d&&d.prototype instanceof Error){if(u instanceof d)return o(n).call(c,u)}else if("function"==typeof d){var f=o(d).call(c,u);if(f===s)return f;if(f)return o(n).call(c,u)}else if(r.isObject(u)){for(var p=i(d),h=0;h<p.length;++h){var m=p[h];if(d[m]!=u[m])continue e}return o(n).call(c,u)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,s=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r){function i(e,t){return{promise:t}}function o(){return!1}function s(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+$.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function a(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?$.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function c(){return this._onCancelField}function l(e){this._onCancelField=e}function d(){this._cancellationParent=void 0,this._onCancelField=void 0}function f(e,t){if(0!==(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function p(e,t){0!==(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function m(){this._trace=new P(this._peekContext())}function v(e,t){if(X(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=E(e);$.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),$.notEnumerableProp(e,"__stackCleaned__",!0)}}}function g(e,t,n,r,i){if(void 0===e&&null!==t&&J){if(void 0!==i&&i._returnedNonUndefined())return;if(0===(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),u=C(a),c=u.length-1;c>=0;--c){var l=u[c];if(!H.test(l)){var d=l.match(B);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(u.length>0)for(var f=u[0],c=0;c<a.length;++c)if(a[c]===f){c>0&&(s="\n"+a[c-1]);break}}var p="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(p,!0,t)}}function y(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),b(n)}function b(e,n,r){if(ae.warnings){var i,o=new F(e);if(n)r._attachExtraTrace(o);else if(ae.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var s=E(o);o.stack=s.message+"\n"+s.stack.join("\n")}ne("warning",o)||S(o,"",!0)}}function _(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function w(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function T(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(var a=s;a>=0;--a){var u=r[a];if(t[i]!==u)break;t.pop(),i--}t=r}}function C(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||V.test(r),o=i&&ie(r);i&&!o&&(G&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function k(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||V.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function E(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?k(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:C(t)}}function S(e,t,n){if("undefined"!=typeof console){var r;if($.isObject(e)){r=t+W(e.stack,e)}else r=t+String(e);"function"==typeof M?M(r,n):"function"==typeof console.log||u(console.log)}}function x(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){L.throwLater(e)}"unhandledRejection"===e?ne(e,n,r)||i||S(n,"Unhandled rejection "):ne(e,r)}function R(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?e.toString():$.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+A(t)+">, no stack trace)"}function A(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function I(){return"function"==typeof se}function j(e){var t=e.match(oe);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function O(e,t){if(I()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,u=0;u<i.length;++u){var c=j(i[u]);if(c){n=c.fileName,s=c.line;break}}for(var u=0;u<o.length;++u){var c=j(o[u]);if(c){r=c.fileName,a=c.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(ie=function(e){if(q.test(e))return!0;var t=j(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}}function P(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);se(this,P),t>32&&this.uncycle()}var N,D,M,U=t._getDomain,L=t._async,F=e("./errors").Warning,$=e("./util"),X=$.canAttachTrace,q=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,H=/\((?:timers\.js):\d+:\d+\)/,B=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,V=null,W=null,G=!1,z=!(0==$.env("BLUEBIRD_DEBUG")),Y=!(0==$.env("BLUEBIRD_WARNINGS")||!z&&!$.env("BLUEBIRD_WARNINGS")),K=!(0==$.env("BLUEBIRD_LONG_STACK_TRACES")||!z&&!$.env("BLUEBIRD_LONG_STACK_TRACES")),J=0!=$.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(Y||!!$.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=e._bitField&-1048577|524288},t.prototype._ensurePossibleRejectionHandled=function(){0===(524288&this._bitField)&&(this._setRejectionIsUnhandled(),L.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){x("rejectionHandled",N,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),x("unhandledRejection",D,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return b(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=U();D="function"==typeof e?null===t?e:$.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=U();N="function"==typeof e?null===t?e:$.domainBind(t,e):void 0};var Q=function(){};t.longStackTraces=function(){if(L.haveItemsQueued()&&!ae.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ae.longStackTraces&&I()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;ae.longStackTraces=!0,Q=function(){if(L.haveItemsQueued()&&!ae.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),L.enableTrampoline(),ae.longStackTraces=!1},t.prototype._captureStackTrace=m,t.prototype._attachExtraTrace=v,r.activateLongStackTraces(),L.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return ae.longStackTraces&&I()};var Z=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return $.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!$.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return $.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!$.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),$.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!$.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),ee=function(){return $.isNode?function(){return n.emit.apply(n,arguments)}:$.global?function(e){var t="on"+e.toLowerCase(),n=$.global[t];return!!n&&(n.apply($.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),te={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},ne=function(e){var t=!1;try{t=ee.apply(null,arguments)}catch(e){L.throwLater(e),t=!0}var n=!1;try{n=Z(e,te[e].apply(null,arguments))}catch(e){L.throwLater(e),n=!0}return n||t};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Q()),"warnings"in e){var n=e.warnings;ae.warnings=!!n,J=ae.warnings,$.isObject(n)&&"wForgottenReturn"in n&&(J=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!ae.cancellation){if(L.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=d,t.prototype._propagateFrom=f,t.prototype._onCancel=c,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=a,t.prototype._execute=s,re=f,ae.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!ae.monitoring?(ae.monitoring=!0,t.prototype._fireEvent=ne):!e.monitoring&&ae.monitoring&&(ae.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var re=p,ie=function(){return!1},oe=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;$.inherits(P,Error),r.CapturedTrace=P,P.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<e;++r){var s=t[r].stack,a=n[s];if(void 0!==a&&a!==r){a>0&&(t[a-1]._parent=void 0,t[a-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var u=r>0?t[r-1]:this;a<e-1?(u._parent=t[a+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var c=u._length+1,l=r-2;l>=0;--l)t[l]._length=c,c++;return}}}},P.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=E(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(C(i.stack.split("\n"))),i=i._parent;T(r),w(r),$.notEnumerableProp(e,"stack",_(n,r)),$.notEnumerableProp(e,"__stackCleaned__",!0)}};var se=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():R(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,V=e,W=t;var n=Error.captureStackTrace;return ie=function(e){return q.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return V=/@/,W=t,G=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(W=function(e,t){return"string"==typeof e?e:"object"!==(void 0===t?"undefined":u(t))&&"function"!=typeof t||void 0===t.name||void 0===t.message?R(t):t.toString()},null):(V=e,W=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(M=function(e){},$.isNode&&n.stderr.isTTY?M=function(e,t){}:$.isNode||"string"!=typeof(new Error).stack||(M=function(e,t){}));var ae={warnings:Y,longStackTraces:!1,cancellation:!1,monitoring:!1};return K&&t.longStackTraces(),{longStackTraces:function(){return ae.longStackTraces},warnings:function(){return ae.warnings},cancellation:function(){return ae.cancellation},monitoring:function(){return ae.monitoring},propagateFromFunction:function(){return re},boundValueFunction:function(){return h},checkForgottenReturns:g,setBounds:O,warn:b,deprecated:y,CapturedTrace:P,fireDomEvent:Z,fireGlobalEvent:ee}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){if(!(this instanceof n))return new n(r);d(this,"message","string"==typeof r?r:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,s,a=e("./es5"),u=a.freeze,c=e("./util"),l=c.inherits,d=c.notEnumerableProp,f=r("Warning","warning"),p=r("CancellationError","cancellation error"),h=r("TimeoutError","timeout error"),m=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<v.length;++g)"function"==typeof Array.prototype[v[g]]&&(m.prototype[v[g]]=Array.prototype[v[g]]);a.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var y=0;m.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];r=i.join("\n"),t+=r+"\n"}return y--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=u({CancellationError:p,TimeoutError:h,OperationalError:i,RejectionError:i,AggregateError:m}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},u=function(e,t){return{value:e[t]}},c=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},d=function(e){try{return Object(e).constructor.prototype}catch(e){return s}},f=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:f,keys:a,names:a,defineProperty:c,getDescriptor:u,freeze:l,getPrototypeOf:d,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function i(e){this.finallyHandler=e}function o(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function a(e){if(!o(this,e))return d.e=e,d}function u(e){var r=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(r._boundValue()):u.call(r._boundValue(),e);if(void 0!==c){r._setReturnedNonUndefined();var f=n(c,r);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var p=new l("late cancellation observer");return r._attachExtraTrace(p),d.e=p,d}f.isPending()&&f._attachCancellationCallback(new i(this))}return f._then(s,a,void 0,this,void 0)}}}return r.isRejected()?(o(this),d.e=e,d):(o(this),e)}var c=e("./util"),l=t.CancellationError,d=c.errorObj;return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,i){return"function"!=typeof e?this.then():this._then(n,i,void 0,new r(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},r}},{"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=p(n[o])(e);if(r._popContext(),s===f){r._pushContext();var a=t.reject(f.e);return r._popContext(),a}var u=i(s,r);if(u instanceof t)return u}return null}function u(e,n,i,o){if(s.cancellation()){var a=new t(r),u=this._finallyPromise=new t(r);this._promise=a.lastly(function(){return u}),a._captureStackTrace(),a._setOnCancel(this)}else{(this._promise=new t(r))._captureStackTrace()}this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}var c=e("./errors"),l=c.TypeError,d=e("./util"),f=d.errorObj,p=d.tryCatch,h=[];d.inherits(u,o),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,n=void 0!==this._generator.return;if(n)this._promise._pushContext(),e=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var r=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),e=p(this._generator.throw).call(this._generator,r),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=p(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=p(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var n=this._promise;if(e===f)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(e.done===!0)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof t)&&(o=a(o,this._yieldHandlers,this._promise),null===o))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var s=o._bitField;0===(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!==(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!==(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=u,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+d.classString(e));h.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new u(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util");a.canEvaluate,a.tryCatch,a.errorObj;t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var r}var i=[].slice.call(arguments);e&&i.pop();var r=new n(i).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=l();this._callback=null===i?t:d.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function c(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+d.classString(n));var s=0;if(void 0!==i){if("object"!==(void 0===i?"undefined":u(i))||null===i)return t.reject(new TypeError("options argument must be an object but it is "+d.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+d.classString(i.concurrency)));s=i.concurrency}return s="number"==typeof s&&isFinite(s)&&s>=1?s:0,new a(e,n,s,o).promise()}var l=t._getDomain,d=e("./util"),f=d.tryCatch,p=d.errorObj,h=t._async;d.inherits(a,n),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),a=this._preservedValues,u=this._limit;if(n<0){if(n=n*-1-1,r[n]=e,u>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(u>=1&&this._inFlight>=u)return r[n]=e,this._queue.push(n),!1;null!==a&&(a[n]=e);var c=this._promise,l=this._callback,d=c._boundValue();c._pushContext();var h=f(l).call(d,e,n,o),m=c._popContext();if(s.checkForgottenReturns(h,m,null!==a?"Promise.filter":"Promise.map",c),h===p)return this._reject(h.e),!0;var v=i(h,this._promise);if(v instanceof t){v=v._target();var g=v._bitField;if(0===(50397184&g))return u>=1&&this._inFlight++,r[n]=v,v._proxy(this,(n+1)*-1),!1;if(0===(33554432&g))return 0!==(16777216&g)?(this._reject(v._reason()),!0):(this._cancel(),!0);h=v._value()}r[n]=h}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return c(this,e,t,null)},t.map=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=a(e).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var u;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];u=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else u=a(e)();var d=r._popContext();return o.checkForgottenReturns(u,d,"Promise.try",r),r._resolveFromSyncValue(u),r},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){t=new c(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=l.keys(e),i=0;i<n.length;++i){var o=n[i];d.test(o)||(t[o]=e[o])}return t}return s.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(a(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(r);e=null}}}var s=e("./util"),a=s.maybeWrapAsError,u=e("./errors"),c=u.OperationalError,l=e("./es5"),d=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=a(t).apply(n._boundValue(),[null].concat(e));i===u&&s.throwLater(i.e)}function r(e,t){var n=this,r=n._boundValue(),i=void 0===e?a(t).call(r,null):a(t).call(r,null,e);i===u&&s.throwLater(i.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=a(t).call(n._boundValue(),e);i===u&&s.throwLater(i.e)}var o=e("./util"),s=t._async,a=o.tryCatch,u=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){function r(){}function i(e,t){if("function"!=typeof t)throw new b("expecting a function but got "+h.classString(t));if(e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}function o(e){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,e!==w&&(i(this,e),this._resolveFromExecutor(e)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function s(e){this.promise._resolveCallback(e)}function a(e){this.promise._rejectCallback(e,!1)}function u(e){var t=new o(w);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var c,l=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},d=function(){return new o.PromiseInspection(this._target())},f=function(e){return o.reject(new b(e))},p={},h=e("./util");c=h.isNode?function(){var e=n.domain;return void 0===e&&(e=null),e}:function(){return null},h.notEnumerableProp(o,"_getDomain",c);var m=e("./es5"),v=e("./async"),g=new v;m.defineProperty(o,"_async",{value:g});var y=e("./errors"),b=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var _=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var w=function(){},T={},C={},k=e("./thenables")(o,w),E=e("./promise_array")(o,w,k,f,r),S=e("./context")(o),x=S.create,R=e("./debuggability")(o,S),A=(R.CapturedTrace,e("./finally")(o,k)),I=e("./catch_filter")(C),j=e("./nodeback"),O=h.errorObj,P=h.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!h.isObject(o))return f("expecting an object but got A catch statement predicate "+h.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,I(r,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(d,d,void 0,this,void 0)},o.prototype.then=function(e,t){if(R.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+h.classString(e);arguments.length>1&&(n+=", "+h.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?f("expecting a function but got "+h.classString(e)):this.all()._then(e,void 0,void 0,T,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new E(this).promise()},o.prototype.error=function(e){return this.caught(h.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(w);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=P(e)(j(t,n));return r===O&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new E(e).promise()},o.cast=function(e){var t=k(e);return t instanceof o||(t=new o(w),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(w);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+h.classString(e));return g.setScheduler(e)},o.prototype._then=function(e,t,n,r,i){var s=void 0!==i,a=s?i:new o(w),u=this._target(),l=u._bitField;s||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===r&&0!==(2097152&this._bitField)&&(r=0!==(50397184&l)?this._boundValue():u===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var d=c();if(0!==(50397184&l)){var f,p,m=u._settlePromiseCtx;0!==(33554432&l)?(p=u._rejectionHandler0,f=e):0!==(16777216&l)?(p=u._fulfillmentHandler0,f=t,u._unsetRejectionIsUnhandled()):(m=u._settlePromiseLateCancellationObserver,p=new _("late cancellation observer"),u._attachExtraTrace(p),f=t),g.invoke(m,u,{handler:null===d?f:"function"==typeof f&&h.domainBind(d,f),promise:a,receiver:r,value:p})}else u._addCallbacks(e,t,a,r,d);return a},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=this._bitField&-65536|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==p)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=p),this._addCallbacks(t,n,r,i,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=p),this._addCallbacks(n,r,i,o,null)},o.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:h.domainBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:h.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0===(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=k(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(l());var i=r._bitField;if(0===(50397184&i)){var s=this._length();s>0&&r._migrateCallback0(this);for(var a=1;a<s;++a)r._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!==(33554432&i))this._fulfill(r._value());else if(0!==(16777216&i))this._reject(r._reason());else{var u=new _("late cancellation observer");r._attachExtraTrace(u),this._reject(u)}}},o.prototype._rejectCallback=function(e,t,n){var r=h.ensureErrorObject(e),i=r===e;if(!i&&!n&&R.warnings()){var o="a promise was rejected with a non-error: "+h.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)},o.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0===(65536&i)){r._pushContext();var o;t===T?n&&"number"==typeof n.length?o=P(e).apply(this._boundValue(),n):(o=O,o.e=new b("cannot .spread() a non-array: "+h.classString(n))):o=P(e).call(t,n);var s=r._popContext();i=r._bitField,0===(65536&i)&&(o===C?r._reject(n):o===O?r._rejectCallback(o.e,!1):(R.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,i){var s=e instanceof o,a=this._bitField,u=0!==(134217728&a);0!==(65536&a)?(s&&e._invokeInternalOnCancel(),n instanceof A&&n.isFinallyHandler()?(n.cancelPromise=e,P(t).call(n,i)===O&&e._reject(O.e)):t===d?e._fulfill(d.call(n)):n instanceof r?n._promiseCancelled(e):s||e instanceof E?e._cancel():n.cancel()):"function"==typeof t?s?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,i,e)):t.call(n,i,e):n instanceof r?n._isResolved()||(0!==(33554432&a)?n._promiseFulfilled(i,e):n._promiseRejected(i,e)):s&&(u&&e._setAsyncGuaranteed(),0!==(33554432&a)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof o&&n._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!==(134217728&t)?this._settlePromises():g.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return g.fatalError(e,h.isNode);(65535&t)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!==(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!==(33554432&e)?this._rejectionHandler0:0!==(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return R.deprecated("Promise.defer","new Promise"),{promise:new o(w),resolve:s,reject:a}},h.notEnumerableProp(o,"_makeSelfResolutionError",l),e("./method")(o,w,k,f,R),e("./bind")(o,w,k,R),e("./cancel")(o,E,f,R),e("./direct_resolve")(o),e("./synchronous_inspection")(o),e("./join")(o,E,k,w,g,c),o.Promise=o,o.version="3.4.7",e("./map.js")(o,E,f,k,w,R),e("./call_get.js")(o),e("./using.js")(o,f,k,x,w,R),e("./timers.js")(o,w,R),e("./generators.js")(o,f,w,k,r,R),e("./nodeify.js")(o),e("./promisify.js")(o,w),e("./props.js")(o,E,k,f),e("./race.js")(o,w,k,f),e("./reduce.js")(o,E,f,k,w,R),e("./settle.js")(o,E,R),e("./some.js")(o,E,f),e("./filter.js")(o,w),e("./each.js")(o,w),e("./any.js")(o),h.toFastProperties(o),h.toFastProperties(o.prototype),u({a:1}),u({b:2}),u({c:3}),u(1),u(function(){}),u(void 0),u(!1),u(new o(w)),R.setBounds(v.firstLineError,h.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function s(e){switch(e){case-2:return[];case-3:return{}}}function a(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e("./util");u.isArray;return u.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(n,o){var a=r(this._values,this._promise);if(a instanceof t){a=a._target();var c=a._bitField;if(this._values=a,0===(50397184&c))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0===(33554432&c))return 0!==(16777216&c)?this._reject(a._reason()):this._cancel();a=a._value()}if(a=u.asArray(a),null===a){var l=i("expecting an array or an iterable object but got "+u.classString(a)).reason();return void this._promise._rejectCallback(l,!1)}if(0===a.length)return void(o===-5?this._resolveEmptyArray():this._resolve(s(o)));this._iterate(a)},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var u=r(e[a],i);u instanceof t?(u=u._target(),s=u._bitField):s=null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0===(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!==(33554432&s)?this._promiseFulfilled(u._value(),a):0!==(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!C.test(e)}function i(e){try{return e.__isPromisified__===!0}catch(e){return!1}}function o(e,t,n){var r=h.getDataPropertyOrDefault(e,t+n,w);return!!r&&i(r)}function s(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new b("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function a(e,t,n,r){for(var a=h.inheritedDataKeys(e),u=[],c=0;c<a.length;++c){var l=a[c],d=e[l],f=r===k||k(l,d,e);"function"!=typeof d||i(d)||o(e,l,t)||!r(l,d,e,f)||u.push(l,d)}return s(u,t,n),u}function c(e,r,i,o,s,a){function u(){var i=r;r===p&&(i=this);var o=new t(n);o._captureStackTrace();var s="string"==typeof l&&this!==c?this[l]:e,u=m(o,a);try{s.apply(i,v(arguments,u))}catch(e){o._rejectCallback(g(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var c=function(){return this}(),l=e;return"string"==typeof l&&(e=o),h.notEnumerableProp(u,"__isPromisified__",!0),u}function l(e,t,n,r,i){for(var o=new RegExp(E(t)+"$"),s=a(e,t,o,n),u=0,c=s.length;u<c;u+=2){var l=s[u],d=s[u+1],f=l+t;if(r===S)e[f]=S(l,p,l,d,t,i);else{var m=r(d,function(){return S(l,p,l,d,t,i)});h.notEnumerableProp(m,"__isPromisified__",!0),e[f]=m}}return h.toFastProperties(e),e}function d(e,t,n){return S(e,t,void 0,e,null,n)}var f,p={},h=e("./util"),m=e("./nodeback"),v=h.withAppended,g=h.maybeWrapAsError,y=h.canEvaluate,b=e("./errors").TypeError,_="Async",w={__isPromisified__:!0},T=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],C=new RegExp("^(?:"+T.join("|")+")$"),k=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},E=function(e){return e.replace(/([$])/,"\\$")},S=y?f:c;t.promisify=function(e,t){if("function"!=typeof e)throw new b("expecting a function but got "+h.classString(e));if(i(e))return e;t=Object(t);var n=void 0===t.context?p:t.context,o=!!t.multiArgs,s=d(e,n,o);return h.copyDescriptors(e,s,r),s},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!==(void 0===e?"undefined":u(e)))throw new b("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,r=t.suffix;"string"!=typeof r&&(r=_);var i=t.filter;"function"!=typeof i&&(i=k);var o=t.promisifier;if("function"!=typeof o&&(o=S),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=h.inheritedDataKeys(e),a=0;a<s.length;++a){var c=e[s[a]];"constructor"!==s[a]&&h.isClass(c)&&(l(c.prototype,r,i,o,n),l(c,r,i,o,n))}return l(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==a&&e instanceof a)t=d(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=n,this._init$(void 0,-3)}function s(e){var n,s=r(e);return c(s)?(n=s instanceof t?s._then(t.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof t&&n._propagateFrom(s,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,u=e("./util"),c=u.isObject,l=e("./es5");"function"==typeof Map&&(a=Map);var d=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),f=function(e){for(var t=new a,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};u.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=f(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return s(this)},t.props=function(e){return s(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var u=r(e);if(u instanceof t)return a(u);if(e=s.asArray(e),null===e)return i("expecting an array or an iterable object but got "+s.classString(e));var c=new t(n);void 0!==o&&c._propagateFrom(o,3);for(var l=c._fulfill,d=c._reject,f=0,p=e.length;f<p;++f){var h=e[f];(void 0!==h||f in e)&&t.cast(h)._then(l,d,void 0,c,null)}return c}var s=e("./util"),a=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e,n,r,i){this.constructor$(e);var s=f();this._fn=null===s?n:p.domainBind(s,n),void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+p.classString(t)):new a(e,t,n,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n=this.array,r=n._promise,i=h(n._fn);r._pushContext();var o;o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length),o instanceof t&&(n._currentCancellable=o);var a=r._popContext();return s.checkForgottenReturns(o,a,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var f=t._getDomain,p=e("./util"),h=p.tryCatch;p.inherits(a,n),a.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},a.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},a.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},a.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(u,u,void 0,n,this)},t.prototype.reduce=function(e,t){return c(this,e,t,null)},t.reduce=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],29:[function(e,t,i){"use strict";var o,a=e("./util"),u=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},c=a.getNativePromise();if(a.isNode&&"undefined"==typeof MutationObserver){var l=s.setImmediate,d=n.nextTick;o=a.isRecentNode?function(e){l.call(s,e)}:function(e){d.call(n,e)}}else if("function"==typeof c&&"function"==typeof c.resolve){var f=c.resolve();o=function(e){f.then(e)}}else o="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(e){r(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:u:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=o},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var s=e("./util"),a=e("./errors").RangeError,u=e("./errors").AggregateError,c=s.isArray,l={};s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=c(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new u,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){return new a("Input array must contain at least "+this._howMany+" items but contains only "+e+" items")},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===c){r&&r._pushContext();var u=t.reject(i.e);return r&&r._popContext(),u}if("function"==typeof i){if(s(e)){var u=new t(n);return e._then(u._fulfill,u._reject,void 0,u,null),u}return a(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return c.e=e,c}}function s(e){try{return d.call(e,"_promise0")}catch(e){return!1}}function a(e,r,i){function o(e){a&&(a._resolveCallback(e),a=null)}function s(e){a&&(a._rejectCallback(e,d,!0),a=null)}var a=new t(n),l=a;i&&i._pushContext(),a._captureStackTrace(),i&&i._popContext();var d=!0,f=u.tryCatch(r).call(e,o,s);return d=!1,a&&f===c&&(a._rejectCallback(f.e,!0,!0),a=null),l}var u=e("./util"),c=u.errorObj,l=u.isObject,d={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function s(e){throw clearTimeout(this.handle),e}var a=e("./util"),u=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var c=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var s,a;return void 0!==o?(s=t.resolve(o)._then(c,null,null,e,void 0),r.cancellation()&&o instanceof t&&s._setOnCancel(o)):(s=new t(n),a=setTimeout(function(){s._fulfill()},+e),r.cancellation()&&s._setOnCancel(new i(a)),s._captureStackTrace()),s._setAsyncGuaranteed(),s};t.prototype.delay=function(e){return l(e,this)};var d=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new u("operation timed out"):new u(t),a.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,a,u=new i(setTimeout(function(){n.isPending()&&d(n,t,a)},e));return r.cancellation()?(a=this.then(),n=a._then(o,s,void 0,u,void 0),n._setOnCancel(u)):n=this._then(o,s,void 0,u,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){function a(e){setTimeout(function(){throw e},0)}function u(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function c(e,n){function i(){if(s>=c)return l._fulfill();var o=u(e[s++]);if(o instanceof t&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),e.promise)}catch(e){return a(e)}if(o instanceof t)return o._then(i,a,null,null,null)}i()}var s=0,c=e.length,l=new t(o);return i(),l}function l(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function f(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function p(e){this.length=e,this.promise=null,this[e-1]=null}var h=e("./util"),m=e("./errors").TypeError,v=e("./util").inherits,g=h.errorObj,y=h.tryCatch,b={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},l.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==b?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(d,l),d.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},p.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+h.classString(i));var o,a=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,a=!1):(o=arguments,e--);for(var u=new p(e),d=0;d<e;++d){var m=o[d];if(l.isDisposer(m)){var v=m;m=m.promise(),m._setDisposable(v)}else{var b=r(m);b instanceof t&&(m=b._then(f,null,null,{resources:u,index:d},void 0))}u[d]=m}for(var _=new Array(u.length),d=0;d<_.length;++d)_[d]=t.resolve(u[d]).reflect();var w=t.all(_).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return g.e=n.error(),g;if(!n.isFulfilled())return void w.cancel();e[t]=n.value()}T._pushContext(),i=y(i);var r=a?i.apply(void 0,e):i(e),o=T._popContext();return s.checkForgottenReturns(r,o,"Promise.using",T),r}),T=w.lastly(function(){return c(u,new t.PromiseInspection(w))});return u.promise=T,T._setOnCancel(u),T},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,i());throw new m}}},{"./errors":12,"./util":36}],36:[function(e,t,r){"use strict";function i(){try{var e=O;return O=null,e.apply(this,arguments)}catch(e){return j.e=e,j}}function o(e){return O=e,i}function a(e){return null==e||e===!0||e===!1||"string"==typeof e||"number"==typeof e}function c(e){return"function"==typeof e||"object"===(void 0===e?"undefined":u(e))&&null!==e}function l(e){return a(e)?new Error(b(e)):e}function d(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function f(e,t,n){if(!A.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function p(e,t,n){if(a(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(e,t,r),e}function h(e){throw e}function m(e){try{if("function"==typeof e){var t=A.names(e.prototype),n=A.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=M.test(e+"")&&A.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function v(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function g(e){return U.test(e)}function y(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function b(e){try{return e+""}catch(e){return"[no string representation]"}}function _(e){return null!==e&&"object"===(void 0===e?"undefined":u(e))&&"string"==typeof e.message&&"string"==typeof e.name}function w(e){try{p(e,"isOperational",!0)}catch(e){}}function T(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0)}function C(e){return _(e)&&A.propertyIsWritable(e,"stack")}function k(e){return{}.toString.call(e)}function E(e,t,n){for(var r=A.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{A.defineProperty(t,o,A.getDescriptor(e,o))}catch(e){}}}function S(e){return q?n.env[e]:void 0}function x(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function R(e,t){return e.bind(t)}var A=e("./es5"),I="undefined"==typeof navigator,j={e:{}},O,P="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s?s:void 0!==this?this:null,N=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},D=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(A.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var u=Object.getOwnPropertyDescriptor(e,a);null!=u&&null==u.get&&null==u.set&&r.push(a)}}e=A.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<e.length;++s)if(r.call(e[s],o))continue e;i.push(o)}return i}}(),M=/this\s*\.\s*\S+\s*=/,U=/^[a-z$_][a-z$_0-9]*$/i,L=function(){return"stack"in new Error?function(e){return C(e)?e:new Error(b(e))}:function(e){if(C(e))return e;try{throw new Error(b(e))}catch(e){return e}}}(),F=function(e){return A.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var $="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};F=function(e){return A.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?$(e):null}}var X=void 0!==n&&"[object process]"===k(n).toLowerCase(),q=void 0!==n&&void 0!==n.env,H={isClass:m,isIdentifier:g,inheritedDataKeys:D,getDataPropertyOrDefault:f,thrower:h,isArray:A.isArray,asArray:F,notEnumerableProp:p,isPrimitive:a,isObject:c,isError:_,canEvaluate:I,errorObj:j,tryCatch:o,inherits:N,withAppended:d,maybeWrapAsError:l,toFastProperties:v,filledRange:y,toString:b,canAttachTrace:C,ensureErrorObject:L,originatesFromRejection:T,markAsOriginatingFromRejection:w,classString:k,copyDescriptors:E,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:X,hasEnvVariables:q,env:S,global:P,getNativePromise:x,domainBind:R};H.isRecentNode=H.isNode&&function(){var e=n.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),H.isNode&&H.toFastProperties(n);try{throw new Error}catch(e){H.lastLineError=e}t.exports=H},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,t("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:178}],36:[function(e,t,n){(function(){var n,r,i,o=function(e,t){return function(){return e.apply(t,arguments)}},s=[].slice;i=10,r=5,n=function(){function t(e,n,r,i,s){this.maxNb=null!=e?e:0,this.minTime=null!=n?n:0,this.highWater=null!=r?r:-1,this.strategy=null!=i?i:t.prototype.strategy.LEAK,this.rejectOnDrop=null!=s&&s,this.schedulePriority=o(this.schedulePriority,this),this.submitPriority=o(this.submitPriority,this),this.submit=o(this.submit,this),this._nextRequest=Date.now(),this._nbRunning=0,this._queues=this._makeQueues(),this._running={},this._nextIndex=0,this._unblockTime=0,this.penalty=15*this.minTime||5e3,this.interrupt=!1,this.reservoir=null,this.limiter=null,this.events={}}var n;return t.strategy=t.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3},t.Cluster=t.prototype.Cluster=e("./Cluster"),t.DLList=t.prototype.DLList=e("./DLList"),t.Promise=t.prototype.Promise=function(){try{return e("bluebird")}catch(e){return n=e,"undefined"!=typeof Promise&&null!==Promise?Promise:function(){throw new Error("Bottleneck: install 'bluebird' or use Node 0.12 or higher for Promise support")}}}(),t.prototype._trigger=function(e,t){return this.rejectOnDrop&&"dropped"===e&&t[0].cb.apply({},[new Error("This job has been dropped by Bottleneck")]),setTimeout(function(n){return function(){var r;return null!=(r=n.events[e])?r.forEach(function(e){return e.apply({},t)}):void 0}}(this),0)},t.prototype._makeQueues=function(){var e,n,r;for(r=[],e=1,n=i;1<=n?e<=n:e>=n;1<=n?++e:--e)r.push(new t.prototype.DLList);return r},t.prototype.chain=function(e){return this.limiter=e,this},t.prototype.isBlocked=function(){return this._unblockTime>=Date.now()},t.prototype._sanitizePriority=function(e){var t;return t=~~e!==e?r:e,t<0?0:t>i-1?i-1:t},t.prototype._find=function(e,t){var n,r,i,o;for(n=r=0,i=e.length;r<i;n=++r)if(o=e[n],t(o))return o;return[]},t.prototype.nbQueued=function(e){return null!=e?this._queues[this._sanitizePriority(e)].length:this._queues.reduce(function(e,t){return e+t.length},0)},t.prototype.nbRunning=function(){return this._nbRunning},t.prototype._getFirst=function(e){return this._find(e,function(e){return e.length>0})},t.prototype._conditionsCheck=function(){return(this.nbRunning()<this.maxNb||this.maxNb<=0)&&(null==this.reservoir||this.reservoir>0)},t.prototype.check=function(){return this._conditionsCheck()&&this._nextRequest-Date.now()<=0},t.prototype._tryToRun=function(){var e,t,n,r,i;return!!(this._conditionsCheck()&&(r=this.nbQueued())>0)&&(this._nbRunning++,null!=this.reservoir&&this.reservoir--,i=Math.max(this._nextRequest-Date.now(),0),this._nextRequest=Date.now()+i+this.minTime,n=this._getFirst(this._queues).shift(),1===r&&this._trigger("empty",[]),e=!1,t=this._nextIndex++,this._running[t]={timeout:setTimeout(function(r){return function(){var i;return i=function(){var i;if(!e&&(e=!0,delete r._running[t],r._nbRunning--,r._tryToRun(),0===r.nbRunning()&&0===r.nbQueued()&&r._trigger("idle",[]),!r.interrupt))return null!=(i=n.cb)?i.apply({},Array.prototype.slice.call(arguments,0)):void 0},null!=r.limiter?r.limiter.submit.apply(r.limiter,Array.prototype.concat(n.task,n.args,i)):n.task.apply({},n.args.concat(i))}}(this),i),job:n},!0)},t.prototype.submit=function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],this.submitPriority.apply({},Array.prototype.concat(r,e))},t.prototype.submitPriority=function(){var e,n,r,i,o,a,u,c;return o=arguments[0],c=arguments[1],e=4<=arguments.length?s.call(arguments,2,r=arguments.length-1):(r=2,[]),n=arguments[r++],i={task:c,args:e,cb:n},o=this._sanitizePriority(o),a=this.highWater>=0&&this.nbQueued()===this.highWater&&!this.check(),this.strategy===t.prototype.strategy.BLOCK&&(a||this.isBlocked())?(this._unblockTime=Date.now()+this.penalty,this._nextRequest=this._unblockTime+this.minTime,this._queues=this._makeQueues(),this._trigger("dropped",[i]),!0):a&&(u=this.strategy===t.prototype.strategy.LEAK?this._getFirst(this._queues.slice(o).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW_PRIORITY?this._getFirst(this._queues.slice(o+1).reverse()).shift():this.strategy===t.prototype.strategy.OVERFLOW?i:void 0,null!=u&&this._trigger("dropped",[u]),null==u||this.strategy===t.prototype.strategy.OVERFLOW)?a:(this._queues[o].push(i),this._tryToRun(),a)},t.prototype.schedule=function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],this.schedulePriority.apply({},Array.prototype.concat(r,e))},t.prototype.schedulePriority=function(){var e,n,r,i;return n=arguments[0],r=arguments[1],e=3<=arguments.length?s.call(arguments,2):[],i=function(){var e,t,n;return e=2<=arguments.length?s.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],r.apply({},e).then(function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],t.apply({},Array.prototype.concat(null,e))}).catch(function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],t.apply({},e)})},new t.prototype.Promise(function(t){return function(r,o){return t.submitPriority.apply({},Array.prototype.concat(n,i,e,function(){var e;return e=1<=arguments.length?s.call(arguments,0):[],(null!=e[0]?o:(e.shift(),r)).apply({},e)}))}}(this))},t.prototype.changeSettings=function(e,t,n,r,i){for(this.maxNb=null!=e?e:this.maxNb,this.minTime=null!=t?t:this.minTime,this.highWater=null!=n?n:this.highWater,this.strategy=null!=r?r:this.strategy,this.rejectOnDrop=null!=i?i:this.rejectOnDrop;this._tryToRun(););return this},t.prototype.changePenalty=function(e){return this.penalty=null!=e?e:this.penalty,this},t.prototype.changeReservoir=function(e){for(this.reservoir=e;this._tryToRun(););return this},t.prototype.incrementReservoir=function(e){return null==e&&(e=0),this.changeReservoir(this.reservoir+e),this},t.prototype.on=function(e,t){return null!=this.events[e]?this.events[e].push(t):this.events[e]=[t],this},t.prototype.removeAllListeners=function(e){return null==e&&(e=null),null!=e?delete this.events[e]:this.events={},this},t.prototype.stopAll=function(e){var t,n,r,i,o,a,u;for(this.interrupt=null!=e?e:this.interrupt,i=Object.keys(this._running),t=0,a=i.length;t<a;t++)r=i[t],clearTimeout(this._running[r].timeout);if(this._tryToRun=function(){},this.check=function(){return!1},this.submit=this.submitPriority=function(){var e;return 2<=arguments.length?s.call(arguments,0,e=arguments.length-1):(e=0,[]),arguments[e++](new Error("This limiter is stopped"))},this.schedule=this.schedulePriority=function(){return Promise.reject(new Error("This limiter is stopped"))},this.interrupt)for(o=0,u=i.length;o<u;o++)r=i[o],this._trigger("dropped",[this._running[r].job]);for(;n=this._getFirst(this._queues).shift();)this._trigger("dropped",[n]);return this._trigger("empty",[]),0===this.nbRunning()&&this._trigger("idle",[]),this},t}(),t.exports=n}).call(this)},{"./Cluster":37,"./DLList":38,bluebird:35}],37:[function(e,t,n){(function(){var n,r={}.hasOwnProperty;n=function(){function t(t,n,r,i,o){this.maxNb=t,this.minTime=n,this.highWater=r,this.strategy=i,this.rejectOnDrop=o,this.limiters={},this.Bottleneck=e("./Bottleneck"),this.startAutoCleanup()}return t.prototype.key=function(e){var t;return null==e&&(e=""),null!=(t=this.limiters[e])?t:this.limiters[e]=new this.Bottleneck(this.maxNb,this.minTime,this.highWater,this.strategy,this.rejectOnDrop)},t.prototype.deleteKey=function(e){return null==e&&(e=""),delete this.limiters[e]},t.prototype.all=function(e){var t,n,i,o;n=this.limiters,i=[];for(t in n)r.call(n,t)&&(o=n[t],i.push(e(o)));return i},t.prototype.keys=function(){return Object.keys(this.limiters)},t.prototype.startAutoCleanup=function(){var e;return this.stopAutoCleanup(),"function"==typeof(e=this.interval=setInterval(function(e){return function(){var t,n,r,i,o;i=Date.now(),n=e.limiters,r=[];for(t in n)o=n[t],o._nextRequest+3e5<i?r.push(e.deleteKey(t)):r.push(void 0);return r}}(this),3e4)).unref?e.unref():void 0},t.prototype.stopAutoCleanup=function(){return clearInterval(this.interval)},t}(),t.exports=n}).call(this)},{"./Bottleneck":36}],38:[function(e,t,n){(function(){var e;e=function(){function e(){this._first=null,this._last=null,this.length=0}return e.prototype.push=function(e){var t;this.length++,t={value:e,next:null},null!=this._last?(this._last.next=t,this._last=t):this._first=this._last=t},e.prototype.shift=function(){var e,t;if(null!=this._first)return this.length--,t=this._first.value,this._first=null!=(e=this._first.next)?e:this._last=null,t},e.prototype.getArray=function(){var e,t,n;for(e=this._first,n=[];null!=e;)n.push((t=e,e=e.next,t.value));return n},e}(),t.exports=e}).call(this)},{}],39:[function(e,t,r){(function(n){(function(){t.exports=e("./Bottleneck"),null!=n.window&&(n.window.Bottleneck=t.exports)}).call(this)}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Bottleneck":36}],40:[function(e,t,n){},{}],41:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":75,"../../modules/es6.array.from":144,"../../modules/es6.string.iterator":160}],42:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":142,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],43:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":143,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],44:[function(e,t,n){var r=e("../../modules/_core"),i=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(e){return i.stringify.apply(i,arguments)}},{"../../modules/_core":75}],45:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),t.exports=e("../modules/_core").Map},{"../modules/_core":75,"../modules/es6.map":146,"../modules/es6.object.to-string":156,"../modules/es6.string.iterator":160,"../modules/es7.map.to-json":162,"../modules/web.dom.iterable":166}],46:[function(e,t,n){e("../../modules/es6.number.is-integer"),t.exports=e("../../modules/_core").Number.isInteger},{"../../modules/_core":75,"../../modules/es6.number.is-integer":147}],47:[function(e,t,n){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":75,"../../modules/es6.object.assign":148}],48:[function(e,t,n){e("../../modules/es6.object.create");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.create(e,t)}},{"../../modules/_core":75,"../../modules/es6.object.create":149}],49:[function(e,t,n){e("../../modules/es6.object.define-properties");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.defineProperties(e,t)}},{"../../modules/_core":75,"../../modules/es6.object.define-properties":150}],50:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":75,"../../modules/es6.object.define-property":151}],51:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":75,"../../modules/es6.object.freeze":152}],52:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":75,"../../modules/es6.object.get-prototype-of":153}],53:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":75,"../../modules/es6.object.keys":154}],54:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":75,"../../modules/es6.object.set-prototype-of":155}],55:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),t.exports=e("../modules/_core").Promise},{"../modules/_core":75,"../modules/es6.object.to-string":156,"../modules/es6.promise":157,"../modules/es6.string.iterator":160,"../modules/web.dom.iterable":166}],56:[function(e,t,n){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":75,"../../modules/es6.reflect.construct":158}],57:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),t.exports=e("../modules/_core").Set},{"../modules/_core":75,"../modules/es6.object.to-string":156,"../modules/es6.set":159,"../modules/es6.string.iterator":160,"../modules/es7.set.to-json":163,"../modules/web.dom.iterable":166}],58:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":75,"../../modules/es6.object.to-string":156,"../../modules/es6.symbol":161,"../../modules/es7.symbol.async-iterator":164,"../../modules/es7.symbol.observable":165}],59:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":139,"../../modules/es6.string.iterator":160,"../../modules/web.dom.iterable":166}],60:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],61:[function(e,t,n){t.exports=function(){}},{}],62:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],63:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":96}],64:[function(e,t,n){var r=e("./_for-of");t.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},{"./_for-of":85}],65:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-index");t.exports=function(e){return function(t,n,s){var a,u=r(t),c=i(u.length),l=o(s,c);if(e&&n!=n){for(;c>l;)if(a=u[l++],a!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-index":131,"./_to-iobject":133,"./_to-length":134}],66:[function(e,t,n){var r=e("./_ctx"),i=e("./_iobject"),o=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,f=5==e||d,p=t||a;return function(t,a,h){for(var m,v,g=o(t),y=i(g),b=r(a,h,3),_=s(y.length),w=0,T=n?p(t,_):u?p(t,0):void 0;_>w;w++)if((f||w in y)&&(m=y[w],v=b(m,w,g),e))if(n)T[w]=v;else if(v)switch(e){case 3:return!0;case 5:return m;case 6:return w;case 2:T.push(m)}else if(l)return!1;return d?-1:c||l?l:T}}},{"./_array-species-create":68,"./_ctx":77,"./_iobject":92,"./_to-length":134,"./_to-object":135}],67:[function(e,t,n){var r=e("./_is-object"),i=e("./_is-array"),o=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&(t=t[o],null===t&&(t=void 0))),void 0===t?Array:t}},{"./_is-array":94,"./_is-object":96,"./_wks":140}],68:[function(e,t,n){var r=e("./_array-species-constructor");t.exports=function(e,t){return new(r(e))(t)}},{"./_array-species-constructor":67}],69:[function(e,t,n){"use strict";var r=e("./_a-function"),i=e("./_is-object"),o=e("./_invoke"),s=[].slice,a={},u=function(e,t,n){if(!(t in a)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";a[t]=Function("F,a","return new F("+r.join(",")+")")}return a[t](e,n)};t.exports=Function.bind||function(e){var t=r(this),n=s.call(arguments,1),a=function r(){var i=n.concat(s.call(arguments));return this instanceof r?u(t,i.length,i):o(t,i,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},{"./_a-function":60,"./_invoke":91,"./_is-object":96}],70:[function(e,t,n){var r=e("./_cof"),i=e("./_wks")("toStringTag"),o="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};t.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),i))?n:o?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},{"./_cof":71,"./_wks":140}],71:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],72:[function(e,t,n){"use strict";var r=e("./_object-dp").f,i=e("./_object-create"),o=e("./_redefine-all"),s=e("./_ctx"),a=e("./_an-instance"),u=e("./_defined"),c=e("./_for-of"),l=e("./_iter-define"),d=e("./_iter-step"),f=e("./_set-species"),p=e("./_descriptors"),h=e("./_meta").fastKey,m=p?"_s":"size",v=function(e,t){var n,r=h(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={getConstructor:function(e,t,n,l){var d=e(function(e,r){a(e,d,t,"_i"),e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,void 0!=r&&c(r,n,e[l],e)});return o(d.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var t=this,n=v(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[m]--}return!!n},forEach:function(e){a(this,d,"forEach");for(var t,n=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!v(this,e)}}),p&&r(d.prototype,"size",{get:function(){return u(this[m])}}),d},def:function(e,t,n){var r,i,o=v(e,t);return o?o.v=n:(e._l=o={i:i=h(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=o),r&&(r.n=o),e[m]++,"F"!==i&&(e._i[i]=o)),e},getEntry:v,setStrong:function(e,t,n){l(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?d(0,n.k):"values"==t?d(0,n.v):d(0,[n.k,n.v]):(e._t=void 0,d(1))},n?"entries":"values",!n,!0),f(t)}}},{"./_an-instance":62,"./_ctx":77,"./_defined":78,"./_descriptors":79,"./_for-of":85,"./_iter-define":99,"./_iter-step":101,"./_meta":105,"./_object-create":108,"./_object-dp":109,"./_redefine-all":121,"./_set-species":124}],73:[function(e,t,n){var r=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":64,"./_classof":70}],74:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_export"),o=e("./_meta"),s=e("./_fails"),a=e("./_hide"),u=e("./_redefine-all"),c=e("./_for-of"),l=e("./_an-instance"),d=e("./_is-object"),f=e("./_set-to-string-tag"),p=e("./_object-dp").f,h=e("./_array-methods")(0),m=e("./_descriptors");t.exports=function(e,t,n,v,g,y){var b=r[e],_=b,w=g?"set":"add",T=_&&_.prototype,C={};return m&&"function"==typeof _&&(y||T.forEach&&!s(function(){(new _).entries().next()}))?(_=t(function(t,n){l(t,_,e,"_c"),t._c=new b,void 0!=n&&c(n,g,t[w],t)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in T&&(!y||"clear"!=e)&&a(_.prototype,e,function(n,r){if(l(this,_,e),!t&&y&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in T&&p(_.prototype,"size",{get:function(){return this._c.size}})):(_=v.getConstructor(t,e,g,w),u(_.prototype,n),o.NEED=!0),f(_,e),C[e]=_,i(i.G+i.W+i.F,C),y||v.setStrong(_,e,g),_}},{"./_an-instance":62,"./_array-methods":66,"./_descriptors":79,"./_export":83,"./_fails":84,"./_for-of":85,"./_global":86,"./_hide":88,"./_is-object":96,"./_meta":105,"./_object-dp":109,"./_redefine-all":121,"./_set-to-string-tag":125}],75:[function(e,t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},{}],76:[function(e,t,n){"use strict";var r=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},{"./_object-dp":109,"./_property-desc":120}],77:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":60}],78:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],79:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":84}],80:[function(e,t,n){var r=e("./_is-object"),i=e("./_global").document,o=r(i)&&r(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":86,"./_is-object":96}],81:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],82:[function(e,t,n){var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),u=o.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":114,"./_object-keys":117,"./_object-pie":118}],83:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_ctx"),s=e("./_hide"),a="prototype",u=function e(t,n,u){var c,l,d,f=t&e.F,p=t&e.G,h=t&e.S,m=t&e.P,v=t&e.B,g=t&e.W,y=p?i:i[n]||(i[n]={}),b=y[a],_=p?r:h?r[n]:(r[n]||{})[a];p&&(u=n);for(c in u)l=!f&&_&&void 0!==_[c],l&&c in y||(d=l?_[c]:u[c],y[c]=p&&"function"!=typeof _[c]?u[c]:v&&l?o(d,r):g&&_[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(d):m&&"function"==typeof d?o(Function.call,d):d,m&&((y.virtual||(y.virtual={}))[c]=d,t&e.R&&b&&!b[c]&&s(b,c,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":75,"./_ctx":77,"./_global":86,"./_hide":88}],84:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],85:[function(e,t,n){var r=e("./_ctx"),i=e("./_iter-call"),o=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={},n=t.exports=function(e,t,n,d,f){var p,h,m,v,g=f?function(){return e}:u(e),y=r(n,d,t?2:1),b=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(p=a(e.length);p>b;b++)if(v=t?y(s(h=e[b])[0],h[1]):y(e[b]),v===c||v===l)return v}else for(m=g.call(e);!(h=m.next()).done;)if(v=i(m,y,h.value,t),v===c||v===l)return v};n.BREAK=c,n.RETURN=l},{"./_an-object":63,"./_ctx":77,"./_is-array-iter":93,"./_iter-call":97,"./_to-length":134,"./core.get-iterator-method":141}],86:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],87:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],88:[function(e,t,n){var r=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":79,"./_object-dp":109,"./_property-desc":120}],89:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":86}],90:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":79,"./_dom-create":80,"./_fails":84}],91:[function(e,t,n){t.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],92:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":71}],93:[function(e,t,n){var r=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},{"./_iterators":102,"./_wks":140}],94:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":71}],95:[function(e,t,n){var r=e("./_is-object"),i=Math.floor;t.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},{"./_is-object":96}],96:[function(e,t,n){t.exports=function(e){return"object"===(void 0===e?"undefined":u(e))?null!==e:"function"==typeof e}},{}],97:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},{"./_an-object":63}],98:[function(e,t,n){"use strict";var r=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},{"./_hide":88,"./_object-create":108,"./_property-desc":120,"./_set-to-string-tag":125,"./_wks":140}],99:[function(e,t,n){"use strict";var r=e("./_library"),i=e("./_export"),o=e("./_redefine"),s=e("./_hide"),a=e("./_has"),u=e("./_iterators"),c=e("./_iter-create"),l=e("./_set-to-string-tag"),d=e("./_object-gpo"),f=e("./_wks")("iterator"),p=!([].keys&&"next"in[].keys()),h="keys",m="values",v=function(){return this};t.exports=function(e,t,n,g,y,b,_){c(n,t,g);var w,T,C,k=function(e){if(!p&&e in R)return R[e];switch(e){case h:return function(){return new n(this,e)};case m:return function(){return new n(this,e)}}return function(){return new n(this,e)}},E=t+" Iterator",S=y==m,x=!1,R=e.prototype,A=R[f]||R["@@iterator"]||y&&R[y],I=A||k(y),j=y?S?k("entries"):I:void 0,O="Array"==t?R.entries||A:A;if(O&&(C=d(O.call(new e)),C!==Object.prototype&&(l(C,E,!0),r||a(C,f)||s(C,f,v))),S&&A&&A.name!==m&&(x=!0,I=function(){return A.call(this)}),r&&!_||!p&&!x&&R[f]||s(R,f,I),u[t]=I,u[E]=v,y)if(w={values:S?I:k(m),keys:b?I:k(h),entries:j},_)for(T in w)T in R||o(R,T,w[T]);else i(i.P+i.F*(p||x),t,w);return w}},{"./_export":83,"./_has":87,"./_hide":88,"./_iter-create":98,"./_iterators":102,"./_library":104,"./_object-gpo":115,"./_redefine":122,"./_set-to-string-tag":125,"./_wks":140}],100:[function(e,t,n){var r=e("./_wks")("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(e){}return n}},{"./_wks":140}],101:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],102:[function(e,t,n){t.exports={}},{}],103:[function(e,t,n){var r=e("./_object-keys"),i=e("./_to-iobject");t.exports=function(e,t){for(var n,o=i(e),s=r(o),a=s.length,u=0;a>u;)if(o[n=s[u++]]===t)return n}},{"./_object-keys":117,"./_to-iobject":133}],104:[function(e,t,n){t.exports=!0},{}],105:[function(e,t,n){var r=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),s=e("./_object-dp").f,a=0,c=Object.isExtensible||function(){return!0},l=!e("./_fails")(function(){return c(Object.preventExtensions({}))}),d=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=function(e,t){if(!i(e))return"symbol"==(void 0===e?"undefined":u(e))?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[r].i},p=function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[r].w},h=function(e){return l&&m.NEED&&c(e)&&!o(e,r)&&d(e),e},m=t.exports={KEY:r,NEED:!1,fastKey:f,getWeak:p,onFreeze:h}},{"./_fails":84,"./_has":87,"./_is-object":96,"./_object-dp":109,"./_uid":137}],106:[function(e,t,n){var r=e("./_global"),i=e("./_task").set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,u="process"==e("./_cof")(s);t.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){s.nextTick(c)};else if(o){var l=!0,d=document.createTextNode("");new o(c).observe(d,{characterData:!0}),n=function(){d.data=l=!l}}else if(a&&a.resolve){var f=a.resolve();n=function(){f.then(c)}}else n=function(){i.call(r,c)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},{"./_cof":71,"./_global":86,"./_task":130}],107:[function(e,t,n){"use strict";var r=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=s(e),u=arguments.length,c=1,l=i.f,d=o.f;u>c;)for(var f,p=a(arguments[c++]),h=l?r(p).concat(l(p)):r(p),m=h.length,v=0;m>v;)d.call(p,f=h[v++])&&(n[f]=p[f]);return n}:u},{"./_fails":84,"./_iobject":92,"./_object-gops":114,"./_object-keys":117,"./_object-pie":118,"./_to-object":135}],108:[function(e,t,n){var r=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u="prototype",c=function(){var t,n=e("./_dom-create")("iframe"),r=o.length,i="<",s=">";for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write(i+"script"+s+"document.F=Object"+i+"/script"+s),t.close(),c=t.F;r--;)delete c[u][o[r]];return c()};t.exports=Object.create||function(e,t){var n;return null!==e?(a[u]=r(e),n=new a,a[u]=null,n[s]=e):n=c(),void 0===t?n:i(n,t)}},{"./_an-object":63,"./_dom-create":80,"./_enum-bug-keys":81,"./_html":89,"./_object-dps":110,"./_shared-key":126}],109:[function(e,t,n){var r=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":63,"./_descriptors":79,"./_ie8-dom-define":90,"./_to-primitive":136}],110:[function(e,t,n){var r=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,u=0;a>u;)r.f(e,n=s[u++],t[n]);return e}},{"./_an-object":63,"./_descriptors":79,"./_object-dp":109,"./_object-keys":117}],111:[function(e,t,n){var r=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?c:function(e,t){if(e=o(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},{"./_descriptors":79,"./_has":87,"./_ie8-dom-define":90,"./_object-pie":118,"./_property-desc":120,"./_to-iobject":133,"./_to-primitive":136}],112:[function(e,t,n){var r=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,s="object"==("undefined"==typeof window?"undefined":u(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return i(e)}catch(e){return s.slice()}};t.exports.f=function(e){return s&&"[object Window]"==o.call(e)?a(e):i(r(e))}},{"./_object-gopn":113,"./_to-iobject":133}],113:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},{"./_enum-bug-keys":81,"./_object-keys-internal":116}],114:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],115:[function(e,t,n){var r=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":87,"./_shared-key":126,"./_to-object":135}],116:[function(e,t,n){var r=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,a=i(e),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~o(c,n)||c.push(n));return c}},{"./_array-includes":65,"./_has":87,"./_shared-key":126,"./_to-iobject":133}],117:[function(e,t,n){var r=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,i)}},{"./_enum-bug-keys":81,"./_object-keys-internal":116}],118:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],119:[function(e,t,n){var r=e("./_export"),i=e("./_core"),o=e("./_fails");t.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o(function(){n(1)}),"Object",s)}},{"./_core":75,"./_export":83,"./_fails":84}],120:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],121:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},{"./_hide":88}],122:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":88}],123:[function(e,t,n){var r=e("./_is-object"),i=e("./_an-object"),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{r=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2),r(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return o(e,t),n?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:o}},{"./_an-object":63,"./_ctx":77,"./_is-object":96,"./_object-gopd":111}],124:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_core"),o=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":75,"./_descriptors":79,"./_global":86,"./_object-dp":109,"./_wks":140}],125:[function(e,t,n){var r=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},{"./_has":87,"./_object-dp":109,"./_wks":140}],126:[function(e,t,n){var r=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return r[e]||(r[e]=i(e))}},{"./_shared":127,"./_uid":137}],127:[function(e,t,n){var r=e("./_global"),i="__core-js_shared__",o=r[i]||(r[i]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./_global":86}],128:[function(e,t,n){var r=e("./_an-object"),i=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[o])?t:i(n)}},{"./_a-function":60,"./_an-object":63,"./_wks":140}],129:[function(e,t,n){var r=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,n){var o,s,a=String(i(t)),u=r(n),c=a.length;return u<0||u>=c?e?"":void 0:(o=a.charCodeAt(u),o<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):(o-55296<<10)+(s-56320)+65536)}}},{"./_defined":78,"./_to-integer":132}],130:[function(e,t,n){var r,i,o,s=e("./_ctx"),a=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),d=l.process,f=l.setImmediate,p=l.clearImmediate,h=l.MessageChannel,m=0,v={},g="onreadystatechange",y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};f&&p||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},r(m),m},p=function(e){delete v[e]},"process"==e("./_cof")(d)?r=function(e){d.nextTick(s(y,e,1))}:h?(i=new h,o=i.port2,i.port1.onmessage=b,r=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r=g in c("script")?function(e){u.appendChild(c("script"))[g]=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),t.exports={set:f,clear:p}},{"./_cof":71,"./_ctx":77,"./_dom-create":80,"./_global":86,"./_html":89,"./_invoke":91}],131:[function(e,t,n){var r=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return e=r(e),e<0?i(e+t,0):o(e,t)}},{"./_to-integer":132}],132:[function(e,t,n){var r=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},{}],133:[function(e,t,n){var r=e("./_iobject"),i=e("./_defined");t.exports=function(e){return r(i(e))}},{"./_defined":78,"./_iobject":92}],134:[function(e,t,n){var r=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}},{"./_to-integer":132}],135:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":78}],136:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":96}],137:[function(e,t,n){var r=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},{}],138:[function(e,t,n){var r=e("./_global"),i=e("./_core"),o=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":75,"./_global":86,"./_library":104,"./_object-dp":109,"./_wks-ext":139}],139:[function(e,t,n){n.f=e("./_wks")},{"./_wks":140}],140:[function(e,t,n){var r=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,s="function"==typeof o;(t.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=r},{"./_global":86,"./_shared":127,"./_uid":137}],141:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||o[r(e)]}},{"./_classof":70,"./_core":75,"./_iterators":102,"./_wks":140}],142:[function(e,t,n){var r=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":63,"./_core":75,"./core.get-iterator-method":141}],143:[function(e,t,n){var r=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(r(t))}},{"./_classof":70,"./_core":75,"./_iterators":102,"./_wks":140}],144:[function(e,t,n){"use strict";var r=e("./_ctx"),i=e("./_export"),o=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,d,f=o(e),p="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,v=void 0!==m,g=0,y=l(f);if(v&&(m=r(m,h>2?arguments[2]:void 0,2)),void 0==y||p==Array&&a(y))for(t=u(f.length),n=new p(t);t>g;g++)c(n,g,v?m(f[g],g):f[g]);else for(d=y.call(f),n=new p;!(i=d.next()).done;g++)c(n,g,v?s(d,m,[i.value,g],!0):i.value);return n.length=g,n}})},{"./_create-property":76,"./_ctx":77,"./_export":83,"./_is-array-iter":93,"./_iter-call":97,"./_iter-detect":100,"./_to-length":134,"./_to-object":135,"./core.get-iterator-method":141}],145:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":61,"./_iter-define":99,"./_iter-step":101,"./_iterators":102,"./_to-iobject":133}],146:[function(e,t,n){"use strict";var r=e("./_collection-strong");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},{"./_collection":74,"./_collection-strong":72}],147:[function(e,t,n){var r=e("./_export");r(r.S,"Number",{isInteger:e("./_is-integer")})},{"./_export":83,"./_is-integer":95}],148:[function(e,t,n){var r=e("./_export");r(r.S+r.F,"Object",{assign:e("./_object-assign")})},{"./_export":83,"./_object-assign":107}],149:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{create:e("./_object-create")})},{"./_export":83,"./_object-create":108}],150:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":79,"./_export":83,"./_object-dps":110}],151:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":79,"./_export":83,"./_object-dp":109}],152:[function(e,t,n){var r=e("./_is-object"),i=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},{"./_is-object":96,"./_meta":105,"./_object-sap":119}],153:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(r(e))}})},{"./_object-gpo":115,"./_object-sap":119,"./_to-object":135}],154:[function(e,t,n){var r=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(r(e))}})},{"./_object-keys":117,"./_object-sap":119,"./_to-object":135}],155:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":83,"./_set-proto":123}],156:[function(e,t,n){arguments[4][40][0].apply(n,arguments)},{dup:40}],157:[function(e,t,n){"use strict";var r,i,o,s=e("./_library"),a=e("./_global"),u=e("./_ctx"),c=e("./_classof"),l=e("./_export"),d=e("./_is-object"),f=e("./_a-function"),p=e("./_an-instance"),h=e("./_for-of"),m=e("./_species-constructor"),v=e("./_task").set,g=e("./_microtask")(),y="Promise",b=a.TypeError,_=a.process,w=a[y],_=a.process,T="process"==c(_),C=function(){},k=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[e("./_wks")("species")]=function(e){e(C,C)};return(T||"function"==typeof PromiseRejectionEvent)&&t.then(C)instanceof n}catch(e){}}(),E=function(e,t){return e===t||e===w&&t===o},S=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},x=function(e){return E(w,e)?new R(e):new i(e)},R=i=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw b("Bad Promise constructor");t=e,n=r}),this.resolve=f(t),this.reject=f(n)},A=function(e){try{e()}catch(e){return{error:e}}},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,i=1==e._s,o=0,s=function(t){var n,o,s=i?t.ok:t.fail,a=t.resolve,u=t.reject,c=t.domain;try{s?(i||(2==e._h&&P(e),e._h=1),s===!0?n=r:(c&&c.enter(),n=s(r),c&&c.exit()),n===t.promise?u(b("Promise-chain cycle")):(o=S(n))?o.call(n,a,u):a(n)):u(r)}catch(e){u(e)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&j(e)})}},j=function(e){v.call(a,function(){var t,n,r,i=e._v;if(O(e)&&(t=A(function(){T?_.emit("unhandledRejection",i,e):(n=a.onunhandledrejection)?n({promise:e,reason:i}):(r=a.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=T||O(e)?2:1),e._a=void 0,t)throw t.error})},O=function e(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,i=0;r.length>i;)if(n=r[i++],n.fail||!e(n.promise))return!1;return!0},P=function(e){v.call(a,function(){var t;T?_.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},D=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw b("Promise can't be resolved itself");(n=S(t))?g(function(){var i={_w:r,_d:!1};try{n.call(t,u(e,i,1),u(N,i,1))}catch(e){N.call(i,e)}}):(r._v=t,r._s=1,I(r,!1))}catch(e){N.call({_w:r,_d:!1},e)}}};k||(w=function(e){p(this,w,y,"_h"),f(e),r.call(this);try{e(u(D,this,1),u(N,this,1))}catch(e){N.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=e("./_redefine-all")(w.prototype,{then:function(e,t){var n=x(m(this,w));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?_.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),R=function(){var e=new r;this.promise=e,this.resolve=u(D,e,1),this.reject=u(N,e,1)}),l(l.G+l.W+l.F*!k,{Promise:w}),e("./_set-to-string-tag")(w,y),e("./_set-species")(y),o=e("./_core")[y],l(l.S+l.F*!k,y,{reject:function(e){var t=x(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(s||!k),y,{resolve:function(e){if(e instanceof w&&E(e.constructor,this))return e;var t=x(this);return(0,t.resolve)(e),t.promise}}),l(l.S+l.F*!(k&&e("./_iter-detect")(function(e){w.all(e).catch(C)})),y,{all:function(e){var t=this,n=x(t),r=n.resolve,i=n.reject,o=A(function(){var n=[],o=0,s=1;h(e,!1,function(e){var a=o++,u=!1;n.push(void 0),s++,t.resolve(e).then(function(e){u||(u=!0,n[a]=e,--s||r(n))},i)}),--s||r(n)});return o&&i(o.error),n.promise},race:function(e){var t=this,n=x(t),r=n.reject,i=A(function(){h(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i&&r(i.error),n.promise}})},{"./_a-function":60,"./_an-instance":62,"./_classof":70,"./_core":75,"./_ctx":77,"./_export":83,"./_for-of":85,"./_global":86,"./_is-object":96,"./_iter-detect":100,"./_library":104,"./_microtask":106,"./_redefine-all":121,"./_set-species":124,"./_set-to-string-tag":125,"./_species-constructor":128,"./_task":130,"./_wks":140}],158:[function(e,t,n){var r=e("./_export"),i=e("./_object-create"),o=e("./_a-function"),s=e("./_an-object"),a=e("./_is-object"),u=e("./_fails"),c=e("./_bind"),l=(e("./_global").Reflect||{}).construct,d=u(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),f=!u(function(){l(function(){})});r(r.S+r.F*(d||f),"Reflect",{construct:function(e,t){o(e),s(t);var n=arguments.length<3?e:o(arguments[2]);if(f&&!d)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,p=i(a(u)?u:Object.prototype),h=Function.apply.call(e,p,t);return a(h)?h:p}})},{"./_a-function":60,"./_an-object":63,"./_bind":69,"./_export":83,"./_fails":84,"./_global":86,"./_is-object":96,"./_object-create":108}],159:[function(e,t,n){"use strict";var r=e("./_collection-strong");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(this,e=0===e?0:e,e)}},r)},{"./_collection":74,"./_collection-strong":72}],160:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":99,"./_string-at":129}],161:[function(e,t,n){"use strict";var r=e("./_global"),i=e("./_has"),o=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),c=e("./_meta").KEY,l=e("./_fails"),d=e("./_shared"),f=e("./_set-to-string-tag"),p=e("./_uid"),h=e("./_wks"),m=e("./_wks-ext"),v=e("./_wks-define"),g=e("./_keyof"),y=e("./_enum-keys"),b=e("./_is-array"),_=e("./_an-object"),w=e("./_to-iobject"),T=e("./_to-primitive"),C=e("./_property-desc"),k=e("./_object-create"),E=e("./_object-gopn-ext"),S=e("./_object-gopd"),x=e("./_object-dp"),R=e("./_object-keys"),A=S.f,I=x.f,j=E.f,O=r.Symbol,P=r.JSON,N=P&&P.stringify,D="prototype",M=h("_hidden"),U=h("toPrimitive"),L={}.propertyIsEnumerable,F=d("symbol-registry"),$=d("symbols"),X=d("op-symbols"),q=Object[D],H="function"==typeof O,B=r.QObject,V=!B||!B[D]||!B[D].findChild,W=o&&l(function(){return 7!=k(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=A(q,t);r&&delete q[t],I(e,t,n),r&&e!==q&&I(q,t,r)}:I,G=function(e){var t=$[e]=k(O[D]);return t._k=e,t},z=H&&"symbol"==u(O.iterator)?function(e){return"symbol"==(void 0===e?"undefined":u(e))}:function(e){return e instanceof O},Y=function(e,t,n){return e===q&&Y(X,t,n),_(e),t=T(t,!0),_(n),i($,t)?(n.enumerable?(i(e,M)&&e[M][t]&&(e[M][t]=!1),n=k(n,{enumerable:C(0,!1)})):(i(e,M)||I(e,M,C(1,{})),e[M][t]=!0),W(e,t,n)):I(e,t,n)},K=function(e,t){_(e);for(var n,r=y(t=w(t)),i=0,o=r.length;o>i;)Y(e,n=r[i++],t[n]);return e},J=function(e,t){return void 0===t?k(e):K(k(e),t)},Q=function(e){var t=L.call(this,e=T(e,!0));return!(this===q&&i($,e)&&!i(X,e))&&(!(t||!i(this,e)||!i($,e)||i(this,M)&&this[M][e])||t)},Z=function(e,t){if(e=w(e),t=T(t,!0),e!==q||!i($,t)||i(X,t)){var n=A(e,t);return!n||!i($,t)||i(e,M)&&e[M][t]||(n.enumerable=!0),n}},ee=function(e){for(var t,n=j(w(e)),r=[],o=0;n.length>o;)i($,t=n[o++])||t==M||t==c||r.push(t);return r},te=function(e){for(var t,n=e===q,r=j(n?X:w(e)),o=[],s=0;r.length>s;)!i($,t=r[s++])||n&&!i(q,t)||o.push($[t]);return o};H||(O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function t(n){this===q&&t.call(X,n),i(this,M)&&i(this[M],e)&&(this[M][e]=!1),W(this,e,C(1,n))};return o&&V&&W(q,e,{configurable:!0,set:t}),G(e)},a(O[D],"toString",function(){return this._k}),S.f=Z,x.f=Y,e("./_object-gopn").f=E.f=ee,e("./_object-pie").f=Q,e("./_object-gops").f=te,o&&!e("./_library")&&a(q,"propertyIsEnumerable",Q,!0),m.f=function(e){return G(h(e))}),s(s.G+s.W+s.F*!H,{Symbol:O});for(var ne="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;ne.length>re;)h(ne[re++]);for(var ne=R(h.store),re=0;ne.length>re;)v(ne[re++]);s(s.S+s.F*!H,"Symbol",{for:function(e){return i(F,e+="")?F[e]:F[e]=O(e)},keyFor:function(e){if(z(e))return g(F,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),s(s.S+s.F*!H,"Object",{create:J,defineProperty:Y,defineProperties:K,getOwnPropertyDescriptor:Z,getOwnPropertyNames:ee,getOwnPropertySymbols:te}),P&&s(s.S+s.F*(!H||l(function(){var e=O();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!z(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&b(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!z(t))return t}),r[1]=t,N.apply(P,r)}}}),O[D][U]||e("./_hide")(O[D],U,O[D].valueOf),f(O,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},{"./_an-object":63,"./_descriptors":79,"./_enum-keys":82,"./_export":83,"./_fails":84,"./_global":86,"./_has":87,"./_hide":88,"./_is-array":94,"./_keyof":103,"./_library":104,"./_meta":105,"./_object-create":108,"./_object-dp":109,"./_object-gopd":111,"./_object-gopn":113,"./_object-gopn-ext":112,"./_object-gops":114,"./_object-keys":117,"./_object-pie":118,"./_property-desc":120,"./_redefine":122,"./_set-to-string-tag":125,"./_shared":127,"./_to-iobject":133,"./_to-primitive":136,"./_uid":137,"./_wks":140,"./_wks-define":138,"./_wks-ext":139}],162:[function(e,t,n){var r=e("./_export");r(r.P+r.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":73,"./_export":83}],163:[function(e,t,n){var r=e("./_export");r(r.P+r.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":73,"./_export":83}],164:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":138}],165:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":138}],166:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),i=e("./_hide"),o=e("./_iterators"),s=e("./_wks")("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var c=a[u],l=r[c],d=l&&l.prototype;d&&!d[s]&&i(d,s,c),o[c]=o.Array}},{"./_global":86,"./_hide":88,"./_iterators":102,"./_wks":140,"./es6.array.iterator":145}],167:[function(e,t,n){t.exports=e("./lib")},{"./lib":168}],168:[function(e,t,n){function r(e){return void 0===e?0:parseInt(e,10)}var i=/^PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?$/;n.fromSeconds=function(e){if("number"!=typeof e)throw new TypeError("Argument `seconds` must be a number");var t=e%60,n=(e-t)%3600;return{hours:(e-t-n)/3600,minutes:n/60,seconds:t}},n.fromString=function(e){if("string"!=typeof e)throw new TypeError("Argument `string` must be a string");var t=e.match(i);if(null===t||void 0===t[1]&&void 0===t[2]&&void 0===t[3])throw new Error('Could not parse "'+e+'" as a duration.');return{hours:r(t[1]),minutes:r(t[2]),seconds:r(t[3])}},n.toString=function(e){"number"==typeof e&&(e=n.fromSeconds(e));var t="PT";return e.hours>0&&(t+=e.hours+"H"),e.minutes>0&&(t+=e.minutes+"M"),e.seconds>0&&(t+=e.seconds+"S"),"PT"===t&&(t+="0S"),t},n.toSeconds=function(e){var t=e;return"string"==typeof e&&(t=n.fromString(e)),3600*t.hours+60*t.minutes+t.seconds}},{}],169:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"===(void 0===e?"undefined":u(e))&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(s(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,u=0;u<r;u++)c[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.trace)),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],170:[function(t,n,r){!function(){var t={VERSION:"2.4.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(e,n){var r="string"==typeof e.initial?{state:e.initial}:e.initial,i=e.terminal||e.final,o=n||e.target||{},s=e.events||[],a=e.callbacks||{},u={},c={},l=function(e){var n=Array.isArray(e.from)?e.from:e.from?[e.from]:[t.WILDCARD];u[e.name]=u[e.name]||{};for(var r=0;r<n.length;r++)c[n[r]]=c[n[r]]||[],c[n[r]].push(e.name),u[e.name][n[r]]=e.to||n[r];e.to&&(c[e.to]=c[e.to]||[])};r&&(r.event=r.event||"startup",l({name:r.event,from:"none",to:r.state}));for(var d=0;d<s.length;d++)l(s[d]);for(var f in u)u.hasOwnProperty(f)&&(o[f]=t.buildEvent(f,u[f]));for(var f in a)a.hasOwnProperty(f)&&(o[f]=a[f]);return o.current="none",o.is=function(e){return Array.isArray(e)?e.indexOf(this.current)>=0:this.current===e},o.can=function(e){return!this.transition&&void 0!==u[e]&&(u[e].hasOwnProperty(this.current)||u[e].hasOwnProperty(t.WILDCARD))},o.cannot=function(e){return!this.can(e)},o.transitions=function(){return(c[this.current]||[]).concat(c[t.WILDCARD]||[])},o.isFinished=function(){return this.is(i)},o.error=e.error||function(e,t,n,r,i,o,s){throw s||o},o.states=function(){return Object.keys(c).sort()},r&&!r.defer&&o[r.event](),o},doCallback:function(e,n,r,i,o,s){if(n)try{return n.apply(e,[r,i,o].concat(s))}catch(n){return e.error(r,i,o,s,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",n)}},beforeAnyEvent:function(e,n,r,i,o){return t.doCallback(e,e.onbeforeevent,n,r,i,o)},afterAnyEvent:function(e,n,r,i,o){return t.doCallback(e,e.onafterevent||e.onevent,n,r,i,o)},leaveAnyState:function(e,n,r,i,o){return t.doCallback(e,e.onleavestate,n,r,i,o)},enterAnyState:function(e,n,r,i,o){return t.doCallback(e,e.onenterstate||e.onstate,n,r,i,o)},changeState:function(e,n,r,i,o){return t.doCallback(e,e.onchangestate,n,r,i,o)},beforeThisEvent:function(e,n,r,i,o){return t.doCallback(e,e["onbefore"+n],n,r,i,o)},afterThisEvent:function(e,n,r,i,o){return t.doCallback(e,e["onafter"+n]||e["on"+n],n,r,i,o)},leaveThisState:function(e,n,r,i,o){return t.doCallback(e,e["onleave"+r],n,r,i,o)},enterThisState:function(e,n,r,i,o){return t.doCallback(e,e["onenter"+i]||e["on"+i],n,r,i,o)},beforeEvent:function(e,n,r,i,o){if(!1===t.beforeThisEvent(e,n,r,i,o)||!1===t.beforeAnyEvent(e,n,r,i,o))return!1},afterEvent:function(e,n,r,i,o){t.afterThisEvent(e,n,r,i,o),t.afterAnyEvent(e,n,r,i,o)},leaveState:function(e,n,r,i,o){var s=t.leaveThisState(e,n,r,i,o),a=t.leaveAnyState(e,n,r,i,o);return!1!==s&&!1!==a&&(t.ASYNC===s||t.ASYNC===a?t.ASYNC:void 0)},enterState:function(e,n,r,i,o){t.enterThisState(e,n,r,i,o),t.enterAnyState(e,n,r,i,o)},buildEvent:function(e,n){return function(){var r=this.current,i=n[r]||(n[t.WILDCARD]!=t.WILDCARD?n[t.WILDCARD]:r)||r,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(e,r,i,o,t.Error.PENDING_TRANSITION,"event "+e+" inappropriate because previous transition did not complete");if(this.cannot(e))return this.error(e,r,i,o,t.Error.INVALID_TRANSITION,"event "+e+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,e,r,i,o))return t.Result.CANCELLED;if(r===i)return t.afterEvent(this,e,r,i,o),t.Result.NOTRANSITION;var s=this;this.transition=function(){return s.transition=null,s.current=i,t.enterState(s,e,r,i,o),t.changeState(s,e,r,i,o),t.afterEvent(s,e,r,i,o),t.Result.SUCCEEDED},this.transition.cancel=function(){s.transition=null,t.afterEvent(s,e,r,i,o)};var a=t.leaveState(this,e,r,i,o);return!1===a?(this.transition=null,t.Result.CANCELLED):t.ASYNC===a?t.Result.PENDING:this.transition?this.transition():void 0}}};void 0!==r?(void 0!==n&&n.exports&&(r=n.exports=t),r.StateMachine=t):"function"==typeof e&&e.amd?e(function(e){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}()},{}],171:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/core-js/symbol/iterator"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=function(){function e(t,n){(0,c.default)(this,e),this.balanceFactor=0,this.key=t,this.value=n,this.parent=null,this.left=null,this.right=null}return(0,d.default)(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),p=function(){function e(t,n){(0,c.default)(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=n||function(e,t){return e===t},this.root=null,this.count=null}return(0,d.default)(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var n=this.getNode(e);n?n.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var n=new f(e,t);if(this.count++,!this.root)return void(this.root=n);for(var r=this.root;;)if(this.isLessThan(e,r.key)){if(!r.left){r.left=n;break}r=r.left}else{if(!r.right){r.right=n;break}r=r.right}for(n.parent=r,r=n;r.parent;){var i=r.parent,o=i.balanceFactor;if(r.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}r=i}}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){var o=r||i;n||o?n&&!o?this.root=o:(n.replace(t,null),this.rebalance(n)):this.root=null}else{for(var s=t.left;s.right;)s=s.right;if(t.left===s)t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!0};else{var a=s.parent,u=s.left;a.right=u,u&&(u.parent=a),t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.left=t.left,s.left.parent=s,s.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:a.default,value:o.default.mark(function e(){var t,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.root){e.next=2;break}return e.abrupt("return",null);case 2:for(t=!0,n=this.root;n.left;)n=n.left;case 5:if(!t){e.next=23;break}return e.next=8,[n.key,n.value];case 8:if(t=!1,!n.right){e.next=15;break}for(n=n.right;n.left;)n=n.left;t=!0,e.next=21;break;case 15:if(!n.parent){e.next=20;break}t=n.parent.left===n,n=n.parent,e.next=21;break;case 20:return e.abrupt("break",31);case 21:e.next=29;break;case 23:if(!n.parent){e.next=28;break}t=n.parent.left===n,n=n.parent,e.next=29;break;case 28:return e.abrupt("break",31);case 29:e.next=5;break;case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}},e,this)})},{key:"getIterator",value:o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.root;case 1:if(!n){e.next=7;break}if(!this.isEqual(t,n.key)){e.next=4;break}return e.abrupt("break",7);case 4:n=this.isLessThan(t,n.key)?n.left:n.right,e.next=1;break;case 7:r=!0;case 8:if(!r){e.next=26;break}return e.next=11,[n.key,n.value];case 11:if(r=!1,!n.right){e.next=18;break}for(n=n.right;n.left;)n=n.left;r=!0,e.next=24;break;case 18:if(!n.parent){e.next=23;break}r=n.parent.left===n,n=n.parent,e.next=24;break;case 23:return e.abrupt("break",34);case 24:e.next=32;break;case 26:if(!n.parent){e.next=31;break}r=n.parent.left===n,n=n.parent,e.next=32;break;case 31:return e.abrupt("break",34);case 32:e.next=8;break;case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:o.default.mark(function e(t){var n,r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.root;case 1:if(!n){e.next=7;break}if(!this.isEqual(t,n.key)){e.next=4;break}return e.abrupt("break",7);case 4:n=this.isLessThan(t,n.key)?n.right:n.left,e.next=1;break;case 7:r=!0;case 8:if(!r){e.next=26;break}return e.next=11,[n.key,n.value];case 11:if(r=!1,!n.left){e.next=18;break}for(n=n.left;n.right;)n=n.right;r=!0,e.next=24;break;case 18:if(!n.parent){e.next=23;break}r=n.parent.right===n,n=n.parent,e.next=24;break;case 23:return e.abrupt("break",34);case 24:e.next=32;break;case 26:if(!n.parent){e.next=31;break}r=n.parent.right===n,n=n.parent,e.next=32;break;case 31:return e.abrupt("break",34);case 32:e.next=8;break;case 34:return e.abrupt("return",null);case 35:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),e}();n.TreeMap=p},{"babel-runtime/core-js/symbol/iterator":19,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],172:[function(t,n,r){!function(t,r){"use strict";"function"==typeof e&&e.amd?e(r):"object"===(void 0===n?"undefined":u(n))&&n.exports?n.exports=r():t.log=r()}(this,function(){"use strict";function e(e){return("undefined"==typeof console?"undefined":u(console))!==a&&(void 0!==console[e]?t(console,e):void 0!==console.log?t(console,"log"):s)}function t(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function n(e,t,n){return function(){("undefined"==typeof console?"undefined":u(console))!==a&&(r.call(this,t,n),this[e].apply(this,arguments))}}function r(e,t){for(var n=0;n<c.length;n++){var r=c[n];this[r]=n<e?s:this.methodFactory(r,e,t)}}function i(t,r,i){return e(t)||n.apply(this,arguments)}function o(e,t,n){function o(e){var t=(c[e]||"silent").toUpperCase();try{return void(window.localStorage[f]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(f)+"="+t+";"}catch(e){}}function s(){var e;try{e=window.localStorage[f]}catch(e){}if((void 0===e?"undefined":u(e))===a)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(f)+"=");n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===d.levels[e]&&(e=void 0),e}var l,d=this,f="loglevel";e&&(f+=":"+e),d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=n||i,d.getLevel=function(){return l},d.setLevel=function(t,n){if("string"==typeof t&&void 0!==d.levels[t.toUpperCase()]&&(t=d.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=d.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(l=t,n!==!1&&o(t),r.call(d,t,e),("undefined"==typeof console?"undefined":u(console))===a&&t<d.levels.SILENT)return"No console available for logging"},d.setDefaultLevel=function(e){s()||d.setLevel(e,!1)},d.enableAll=function(e){d.setLevel(d.levels.TRACE,e)},d.disableAll=function(e){d.setLevel(d.levels.SILENT,e)};var p=s();null==p&&(p=null==t?"WARN":t),d.setLevel(p,!1)}var s=function(){},a="undefined",c=["trace","debug","info","warn","error"],l=new o,d={};l.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new o(e,l.getLevel(),l.methodFactory)),t};var f=("undefined"==typeof window?"undefined":u(window))!==a?window.log:void 0;return l.noConflict=function(){return("undefined"==typeof window?"undefined":u(window))!==a&&window.log===l&&(window.log=f),l},l})},{}],173:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("events"),o=function(e){function t(t){var n=e.call(this)||this;return n.minDelay=t.min,n.maxDelay=t.max,n.initialDelay=t.initial||0,n.maxAttemptsCount=t.maxAttemptsCount||0,n.maxAttemptsTime=t.maxAttemptsTime||0,n.inProgress=!1,n.attemptNum=0,n.prevDelay=0,n.currDelay=0,n}return r(t,e),t.prototype.attempt=function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt")},t.prototype.nextDelay=function(){if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var e=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=e,e},t.prototype.scheduleAttempt=function(){var e=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var t=this.nextDelay();this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+t&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return e.attempt()},t)},t.prototype.cleanup=function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0},t.prototype.start=function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise(function(t,n){e.resolve=t,e.reject=n,e.startTimestamp=Date.now(),e.scheduleAttempt()})},t.prototype.cancel=function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))},t.prototype.succeeded=function(e){this.emit("succeeded",e),this.resolve(e)},t.prototype.failed=function(e){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt()},t.prototype.run=function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()},t}(i.EventEmitter);Object.defineProperty(n,"__esModule",{value:!0}),n.default=o},{events:169}],174:[function(t,r,i){(function(t){(function(){"use strict";function n(e){return e=String(e),e.charAt(0).toUpperCase()+e.slice(1)}function o(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=a(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function s(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=T)for(;++n<r;)t(e[n],n,e);else c(e,t)}function a(e){return e=h(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:n(e)}function c(e,t){for(var n in e)S.call(e,n)&&t(e[n],n,e)}function l(e){return null==e?n(e):x.call(e).slice(8,-1)}function d(e,t){var n=null!=e?u(e[t]):"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function f(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function p(e,t){var n=null;return s(e,function(r,i){n=t(n,r,i,e)}),n}function h(e){return String(e).replace(/^ +| +$/g,"")}function m(e){function t(t){return p(t,function(t,n){return t||RegExp("\\b"+(n.pattern||f(n))+"\\b","i").exec(e)&&(n.label||n)})}function n(t){return p(t,function(t,n,r){return t||(n[K]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(K)]||RegExp("\\b"+f(r)+"(?:\\b|\\w*\\d)","i").exec(e))&&r})}function r(t){return p(t,function(t,n){return t||RegExp("\\b"+(n.pattern||f(n))+"\\b","i").exec(e)&&(n.label||n)})}function i(t){return p(t,function(t,n){var r=n.pattern||f(n);return!t&&(t=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(e))&&(t=o(t,r,n.label||n)),t})}function s(t){return p(t,function(t,n){var r=n.pattern||f(n);return!t&&(t=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(e)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(e))&&((t=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:t).split("/"))[1]&&!/[\d.]+/.test(t[0])&&(t[0]+=" "+t[1]),n=n.label||n,t=a(t[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),t})}function v(t){return p(t,function(t,n){return t||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(e)||0)[1]||null})}function b(){return this.description||""}var _=g,w=e&&"object"==(void 0===e?"undefined":u(e))&&"String"!=l(e);w&&(_=e,e=null);var T=_.navigator||{},E=T.userAgent||"";e||(e=E);var S,R,A=w||k==y,I=w?!!T.likeChrome:/\bChrome\b/.test(e)&&!/internal|\n/i.test(x.toString()),j="Object",O=w?j:"ScriptBridgingProxyObject",P=w?j:"Environment",N=w&&_.java?"JavaPackage":l(_.java),D=w?j:"RuntimeObject",M=/\bJava/.test(N)&&_.java,U=M&&l(_.environment)==P,L=M?"a":"Î±",F=M?"b":"Î²",$=_.document||{},X=_.operamini||_.opera,q=C.test(q=w&&X?X["[[Class]]"]:l(X))?q:X=null,H=e,B=[],V=null,W=e==E,G=W&&X&&"function"==typeof X.version&&X.version(),z=t([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),Y=r(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),K=s([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation 3","PlayStation 4","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),J=n({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),Q=i(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(z&&(z=[z]),J&&!K&&(K=s([J])),(S=/\bGoogle TV\b/.exec(K))&&(K=S[0]),/\bSimulator\b/i.test(e)&&(K=(K?K+" ":"")+"Simulator"),"Opera Mini"==Y&&/\bOPiOS\b/.test(e)&&B.push("running in Turbo/Uncompressed mode"),"IE"==Y&&/\blike iPhone OS\b/.test(e)?(S=m(e.replace(/like iPhone OS/,"")),J=S.manufacturer,K=S.product):/^iP/.test(K)?(Y||(Y="Safari"),Q="iOS"+((S=/ OS ([\d_]+)/i.exec(e))?" "+S[1].replace(/_/g,"."):"")):"Konqueror"!=Y||/buntu/i.test(Q)?J&&"Google"!=J&&(/Chrome/.test(Y)&&!/\bMobile Safari\b/i.test(e)||/\bVita\b/.test(K))||/\bAndroid\b/.test(Q)&&/^Chrome/.test(Y)&&/\bVersion\//i.test(e)?(Y="Android Browser",Q=/\bAndroid\b/.test(Q)?Q:"Android"):"Silk"==Y?(/\bMobi/i.test(e)||(Q="Android",B.unshift("desktop mode")),/Accelerated *= *true/i.test(e)&&B.unshift("accelerated")):"PaleMoon"==Y&&(S=/\bFirefox\/([\d.]+)\b/.exec(e))?B.push("identifying as Firefox "+S[1]):"Firefox"==Y&&(S=/\b(Mobile|Tablet|TV)\b/i.exec(e))?(Q||(Q="Firefox OS"),K||(K=S[1])):Y&&!(S=!/\bMinefield\b/i.test(e)&&/\b(?:Firefox|Safari)\b/.exec(Y))||(Y&&!K&&/[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(S+"/")+8))&&(Y=null),(S=K||J||Q)&&(K||J||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(Q))&&(Y=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(Q)?Q:S)+" Browser")):Q="Kubuntu",G||(G=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|Silk(?!/[\\d.]+$))","Version",f(Y),"(?:Firefox|Minefield|NetFront)"])),(S="iCab"==z&&parseFloat(G)>3&&"WebKit"||/\bOpera\b/.test(Y)&&(/\bOPR\b/.test(e)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(e)&&!/^(?:Trident|EdgeHTML)$/.test(z)&&"WebKit"||!z&&/\bMSIE\b/i.test(e)&&("Mac OS"==Q?"Tasman":"Trident")||"WebKit"==z&&/\bPlayStation\b(?! Vita\b)/i.test(Y)&&"NetFront")&&(z=[S]),"IE"==Y&&(S=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e)||0)[1])?(Y+=" Mobile",Q="Windows Phone "+(/\+$/.test(S)?S:S+".x"),B.unshift("desktop mode")):/\bWPDesktop\b/i.test(e)?(Y="IE Mobile",Q="Windows Phone 8.x",B.unshift("desktop mode"),G||(G=(/\brv:([\d.]+)/.exec(e)||0)[1])):"IE"!=Y&&"Trident"==z&&(S=/\brv:([\d.]+)/.exec(e))&&(Y&&B.push("identifying as "+Y+(G?" "+G:"")),Y="IE",G=S[1]),W){if(d(_,"global"))if(M&&(S=M.lang.System,H=S.getProperty("os.arch"),Q=Q||S.getProperty("os.name")+" "+S.getProperty("os.version")),A&&d(_,"system")&&(S=[_.system])[0]){Q||(Q=S[0].os||null);try{S[1]=_.require("ringo/engine").version,G=S[1].join("."),Y="RingoJS"}catch(e){S[0].global.system==_.system&&(Y="Narwhal")}}else"object"==u(_.process)&&!_.process.browser&&(S=_.process)?(Y="Node.js",H=S.arch,Q=S.platform,G=/[\d.]+/.exec(S.version)[0]):U&&(Y="Rhino");else l(S=_.runtime)==O?(Y="Adobe AIR",Q=S.flash.system.Capabilities.os):l(S=_.phantom)==D?(Y="PhantomJS",G=(S=S.version||null)&&S.major+"."+S.minor+"."+S.patch):"number"==typeof $.documentMode&&(S=/\bTrident\/(\d+)/i.exec(e))&&(G=[G,$.documentMode],(S=+S[1]+4)!=G[1]&&(B.push("IE "+G[1]+" mode"),z&&(z[1]=""),G[1]=S),G="IE"==Y?String(G[1].toFixed(1)):G[0]);Q=Q&&a(Q)}G&&(S=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(G)||/(?:alpha|beta)(?: ?\d)?/i.exec(e+";"+(W&&T.appMinorVersion))||/\bMinefield\b/i.test(e)&&"a")&&(V=/b/i.test(S)?"beta":"alpha",G=G.replace(RegExp(S+"\\+?$"),"")+("beta"==V?F:L)+(/\d+\+?/.exec(S)||"")),"Fennec"==Y||"Firefox"==Y&&/\b(?:Android|Firefox OS)\b/.test(Q)?Y="Firefox Mobile":"Maxthon"==Y&&G?G=G.replace(/\.[\d.]+/,".x"):/\bXbox\b/i.test(K)?(Q=null,"Xbox 360"==K&&/\bIEMobile\b/.test(e)&&B.unshift("mobile mode")):!/^(?:Chrome|IE|Opera)$/.test(Y)&&(!Y||K||/Browser|Mobi/.test(Y))||"Windows CE"!=Q&&!/Mobi/i.test(e)?"IE"==Y&&W&&null===_.external?B.unshift("platform preview"):(/\bBlackBerry\b/.test(K)||/\bBB10\b/.test(e))&&(S=(RegExp(K.replace(/ +/g," *")+"/([.\\d]+)","i").exec(e)||0)[1]||G)?(S=[S,/BB10/.test(e)],Q=(S[1]?(K=null,J="BlackBerry"):"Device Software")+" "+S[0],G=null):this!=c&&"Wii"!=K&&(W&&X||/Opera/.test(Y)&&/\b(?:MSIE|Firefox)\b/i.test(e)||"Firefox"==Y&&/\bOS X (?:\d+\.){2,}/.test(Q)||"IE"==Y&&(Q&&!/^Win/.test(Q)&&G>5.5||/\bWindows XP\b/.test(Q)&&G>8||8==G&&!/\bTrident\b/.test(e)))&&!C.test(S=m.call(c,e.replace(C,"")+";"))&&S.name&&(S="ing as "+S.name+((S=S.version)?" "+S:""),C.test(Y)?(/\bIE\b/.test(S)&&"Mac OS"==Q&&(Q=null),S="identify"+S):(S="mask"+S,Y=q?a(q.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(S)&&(Q=null),W||(G=null)),z=["Presto"],B.push(S)):Y+=" Mobile",(S=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(e)||0)[1])&&(S=[parseFloat(S.replace(/\.(\d)$/,".0$1")),S],"Safari"==Y&&"+"==S[1].slice(-1)?(Y="WebKit Nightly",V="alpha",G=S[1].slice(0,-1)):G!=S[1]&&G!=(S[2]=(/\bSafari\/([\d.]+\+?)/i.exec(e)||0)[1])||(G=null),S[1]=(/\bChrome\/([\d.]+)/i.exec(e)||0)[1],537.36==S[0]&&537.36==S[2]&&parseFloat(S[1])>=28&&"WebKit"==z&&(z=["Blink"]),W&&(I||S[1])?(z&&(z[1]="like Chrome"),S=S[1]||(S=S[0],S<530?1:S<532?2:S<532.05?3:S<533?4:S<534.03?5:S<534.07?6:S<534.1?7:S<534.13?8:S<534.16?9:S<534.24?10:S<534.3?11:S<535.01?12:S<535.02?"13+":S<535.07?15:S<535.11?16:S<535.19?17:S<536.05?18:S<536.1?19:S<537.01?20:S<537.11?"21+":S<537.13?23:S<537.18?24:S<537.24?25:S<537.36?26:"Blink"!=z?"27":"28")):(z&&(z[1]="like Safari"),S=S[0],S=S<400?1:S<500?2:S<526?3:S<533?4:S<534?"4+":S<535?5:S<537?6:S<538?7:S<601?8:"8"),z&&(z[1]+=" "+(S+="number"==typeof S?".x":/[.+]/.test(S)?"":"+")),"Safari"==Y&&(!G||parseInt(G)>45)&&(G=S)),"Opera"==Y&&(S=/\bzbov|zvav$/.exec(Q))?(Y+=" ",B.unshift("desktop mode"),"zvav"==S?(Y+="Mini",G=null):Y+="Mobile",Q=Q.replace(RegExp(" *"+S+"$"),"")):"Safari"==Y&&/\bChrome\b/.exec(z&&z[1])&&(B.unshift("desktop mode"),Y="Chrome Mobile",G=null,/\bOS X\b/.test(Q)?(J="Apple",Q="iOS 4.3+"):Q=null),G&&0==G.indexOf(S=/[\d.]+$/.exec(Q))&&e.indexOf("/"+S+"-")>-1&&(Q=h(Q.replace(S,""))),z&&!/\b(?:Avant|Nook)\b/.test(Y)&&(/Browser|Lunascape|Maxthon/.test(Y)||"Safari"!=Y&&/^iOS/.test(Q)&&/\bSafari\b/.test(z[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(Y)&&z[1])&&(S=z[z.length-1])&&B.push(S),B.length&&(B=["("+B.join("; ")+")"]),J&&K&&K.indexOf(J)<0&&B.push("on "+J),K&&B.push((/^on /.test(B[B.length-1])?"":"on ")+K),Q&&(S=/ ([\d.+]+)$/.exec(Q),R=S&&"/"==Q.charAt(Q.length-S[0].length-1),Q={architecture:32,family:S&&!R?Q.replace(S[0],""):Q,version:S?S[1]:null,toString:function(){var e=this.version;return this.family+(e&&!R?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(S=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(H))&&!/\bi686\b/i.test(H)?(Q&&(Q.architecture=64,Q.family=Q.family.replace(RegExp(" *"+S),"")),Y&&(/\bWOW64\b/i.test(e)||W&&/\w(?:86|32)$/.test(T.cpuClass||T.platform)&&!/\bWin64; x64\b/i.test(e))&&B.unshift("32-bit")):Q&&/^OS X/.test(Q.family)&&"Chrome"==Y&&parseFloat(G)>=39&&(Q.architecture=64),e||(e=null);var Z={};return Z.description=e,Z.layout=z&&z[0],Z.manufacturer=J,Z.name=Y,Z.prerelease=V,Z.product=K,Z.ua=e,Z.version=Y&&G,Z.os=Q||{architecture:null,family:null,version:null,toString:function(){return"null"}},Z.parse=m,Z.toString=b,Z.version&&B.unshift(G),Z.name&&B.unshift(Y),Q&&Y&&(Q!=String(Q).split(" ")[0]||Q!=Y.split(" ")[0]&&!K)&&B.push(K?"("+Q+")":"on "+Q),B.length&&(Z.description=B.join(" ")),Z}var v={function:!0,object:!0},g=v["undefined"==typeof window?"undefined":u(window)]&&window||this,y=g,b=v[void 0===i?"undefined":u(i)]&&i,_=v[void 0===r?"undefined":u(r)]&&r&&!r.nodeType&&r,w=b&&_&&"object"==(void 0===t?"undefined":u(t))&&t;!w||w.global!==w&&w.window!==w&&w.self!==w||(g=w);var T=Math.pow(2,53)-1,C=/\bOpera/,k=this,E=Object.prototype,S=E.hasOwnProperty,x=E.toString,R=m();"function"==typeof e&&"object"==u(e.amd)&&e.amd?(g.platform=R,e(function(){return R})):b&&_?c(R,function(e,t){b[t]=e}):g.platform=R}).call(this)}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],175:[function(e,t,n){t.exports=e("./lib/checks")},{"./lib/checks":176}],176:[function(e,t,n){function r(e,t,n,r){n=n||"";var i=c.format.apply(this,[n].concat(r)),o=new e(i);throw Error.captureStackTrace(o,t),o}function i(e,t,n){r(l.IllegalArgumentError,e,t,n)}function o(e,t,n){r(l.IllegalStateError,e,t,n)}function s(e){var t=void 0===e?"undefined":u(e);if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function a(e){return function(t,n){var r=s(t);if(r==e)return t;i(arguments.callee,n||'Expected "'+e+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}var c=e("util"),l=t.exports=e("./errors");t.exports.checkArgument=function(e,t){e||i(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||o(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;i(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;i(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=a("string"),t.exports.checkIsArray=a("array"),t.exports.checkIsNumber=a("number"),t.exports.checkIsBoolean=a("boolean"),t.exports.checkIsFunction=a("function"),t.exports.checkIsObject=a("object")},{"./errors":177,util:223}],177:[function(e,t,n){function r(e){Error.call(this,e),this.message=e}function i(e){Error.call(this,e),this.message=e}var o=e("util");o.inherits(r,Error),r.prototype.name="IllegalArgumentError",o.inherits(i,Error),i.prototype.name="IllegalStateError",t.exports.IllegalStateError=i,t.exports.IllegalArgumentError=r},{util:223}],178:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===r||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function s(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){v&&h&&(v=!1,h.length?m=h.concat(m):g=-1,m.length&&u())}function u(){if(!v){var e=o(a);v=!0;for(var t=m.length;t;){for(h=m,m=[];++g<t;)h&&h[g].run();g=-1,t=m.length}h=null,v=!1,s(e)}}function c(e,t){this.fun=e,this.array=t}function l(){}var d,f,p=t.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:r}catch(e){d=r}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var h,m=[],v=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];m.push(new c(e,t)),1!==m.length||v||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],179:[function(e,t,r){(function(n){var r="object"===(void 0===n?"undefined":u(n))?n:"object"===("undefined"==typeof window?"undefined":u(window))?window:"object"===("undefined"==typeof self?"undefined":u(self))?self:this,i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,o=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)r.regeneratorRuntime=o;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./runtime":180}],180:[function(e,t,r){(function(e,n){!function(n){"use strict";function r(e,t,n,r){var i=t&&t.prototype instanceof o?t:o,s=Object.create(i.prototype),a=new m(r||[]);return s._invoke=d(e,n,a),s}function i(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function o(){}function s(){}function a(){}function c(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(t){function n(e,r,o,s){var a=i(t[e],t,r);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"===(void 0===l?"undefined":u(l))&&_.call(l,"__await")?Promise.resolve(l.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):Promise.resolve(l).then(function(e){c.value=e,o(c)},s)}s(a.arg)}function r(e,t){function r(){return new Promise(function(r,i){n(e,t,r,i)})}return o=o?o.then(r,r):r()}"object"===(void 0===e?"undefined":u(e))&&e.domain&&(n=e.domain.bind(n));var o;this._invoke=r}function d(e,t,n){var r=S;return function(o,s){if(r===R)throw new Error("Generator is already running");if(r===A){if("throw"===o)throw s;return g()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var u=f(a,n);if(u){if(u===I)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===S)throw r=A,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=R;var c=i(e,t,n);if("normal"===c.type){if(r=n.done?A:x,c.arg===I)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=A,n.method="throw",n.arg=c.arg)}}}function f(e,t){var n=e.iterator[t.method];if(n===y){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=y,f(e,t),"throw"===t.method))return I;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return I}var r=i(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,I;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=y),t.delegate=null,I):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,I)}function p(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function h(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function m(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(p,this),this.reset(!0)}function v(e){if(e){var t=e[T];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(_.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=y,t.done=!0,t};return r.next=r}}return{next:g}}function g(){return{value:y,done:!0}}var y,b=Object.prototype,_=b.hasOwnProperty,w="function"==typeof Symbol?Symbol:{},T=w.iterator||"@@iterator",C=w.toStringTag||"@@toStringTag",k="object"===(void 0===t?"undefined":u(t)),E=n.regeneratorRuntime;if(E)return void(k&&(t.exports=E));E=n.regeneratorRuntime=k?t.exports:{},E.wrap=r;var S="suspendedStart",x="suspendedYield",R="executing",A="completed",I={},j={};j[T]=function(){return this};var O=Object.getPrototypeOf,P=O&&O(O(v([])));P&&P!==b&&_.call(P,T)&&(j=P);var N=a.prototype=o.prototype=Object.create(j);s.prototype=N.constructor=a,a.constructor=s,a[C]=s.displayName="GeneratorFunction",E.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===s||"GeneratorFunction"===(t.displayName||t.name))},E.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,C in e||(e[C]="GeneratorFunction")),e.prototype=Object.create(N),e},E.awrap=function(e){return{__await:e}},c(l.prototype),E.AsyncIterator=l,E.async=function(e,t,n,i){var o=new l(r(e,t,n,i));return E.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},c(N),N[C]="Generator",N.toString=function(){return"[object Generator]"},E.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},E.values=v,m.prototype={constructor:m,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=y,this.done=!1,this.delegate=null,this.method="next",this.arg=y,this.tryEntries.forEach(h),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=y)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=y),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=_.call(i,"catchLoc"),a=_.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&_.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,I):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),I},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),h(n),I}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;h(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:v(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=y),I}}}("object"===(void 0===n?"undefined":u(n))?n:"object"===("undefined"==typeof window?"undefined":u(window))?window:"object"===("undefined"==typeof self?"undefined":u(self))?self:this)}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:178}],181:[function(t,r,i){(function(n){!function(t){if("object"===(void 0===i?"undefined":u(i))&&void 0!==r)r.exports=t();else if("function"==typeof e&&e.amd)e([],t);else{var o;o="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:this,o.rfc6902=t()}}(function(){return function e(n,r,i){function o(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[a]={exports:{}};n[a][0].call(d.exports,function(e){var t=n[a][1][e];return o(t?t:e)},d,d.exports,e,n,r,i)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";function r(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t}function i(e,t){var n={};for(var r in e)n[r]=1;for(var i in t)delete n[i];return Object.keys(n)}function o(e){var t={};e.forEach(function(e){for(var n in e)t[n]=(t[n]||0)+1});var n=e.length;for(var r in t)t[r]<n&&delete t[r];return Object.keys(t)}function s(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":void 0===e?"undefined":u(e)}function a(e){return"add"===e.op}function c(e){return"remove"===e.op}function l(e,t,n){function r(n,o){var s=i[n+","+o];if(void 0===s){if(v(e[n-1],t[o-1]))s=r(n-1,o-1);else{var a=[];if(n>0){var u=r(n-1,o);a.push({operations:u.operations.concat({op:"remove",index:n-1}),cost:u.cost+1})}if(o>0){var c=r(n,o-1);a.push({operations:c.operations.concat({op:"add",index:n-1,value:t[o-1]}),cost:c.cost+1})}if(n>0&&o>0){var l=r(n-1,o-1);a.push({operations:l.operations.concat({op:"replace",index:n-1,original:e[n-1],value:t[o-1]}),cost:l.cost+1})}s=a.sort(function(e,t){return e.cost-t.cost})[0]}i[n+","+o]=s}return s}var i={"0,0":{operations:[],cost:0}},o=isNaN(e.length)||e.length<=0?0:e.length,s=isNaN(t.length)||t.length<=0?0:t.length,u=r(o,s).operations,l=u.reduce(function(e,t){var r=h(e,2),i=r[0],s=r[1];if(a(t)){var u=t.index+1+s,l=u<o+s?String(u):"-",d={op:t.op,path:n.add(l).toString(),value:t.value};return[i.concat(d),s+1]}if(c(t)){var d={op:t.op,path:n.add(String(t.index+s)).toString()};return[i.concat(d),s-1]}var f=n.add(String(t.index+s)),v=p(t.original,t.value,f);return[i.concat.apply(i,m(v)),s]},[[],0]),d=h(l,2),f=d[0];d[1];return f}function d(e,t,n){var r=[];return i(e,t).forEach(function(e){r.push({op:"remove",path:n.add(e).toString()})}),i(t,e).forEach(function(e){r.push({op:"add",path:n.add(e).toString(),value:t[e]})}),o([e,t]).forEach(function(i){r.push.apply(r,m(p(e[i],t[i],n.add(i))))}),r}function f(e,t,n){return v(e,t)?[]:[{op:"replace",path:n.toString(),value:t}]}function p(e,t,n){var r=s(e),i=s(t);return"array"==r&&"array"==i?l(e,t,n):"object"==r&&"object"==i?d(e,t,n):f(e,t,n)}var h=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var n,r=[],i=e[Symbol.iterator]();!(n=i.next()).done&&(r.push(n.value),!t||r.length!==t););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},m=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)};n.isDestructive=r,n.subtract=i,n.intersection=o,n.objectType=s,n.diffArrays=l,n.diffObjects=d,n.diffValues=f,n.diffAny=p,Object.defineProperty(n,"__esModule",{value:!0});var v=e("./equal").compare},{"./equal":2}],2:[function(e,t,n){"use strict";function r(e,t){for(var n=[],r=0,i=e.length;r<i;r++)n.push([e[r],t[r]]);return n}function i(e,t){return e.length===t.length&&r(e,t).every(function(e){return s(e[0],e[1])})}function o(e,t){var n=Object.keys(e);return!!i(n,Object.keys(t))&&n.every(function(n){return s(e[n],t[n])})}function s(e,t){return e===t||(Array.isArray(e)&&Array.isArray(t)?i(e,t):Object(e)===e&&Object(t)===t&&o(e,t))}n.compare=s,Object.defineProperty(n,"__esModule",{value:!0})},{}],3:[function(e,t,n){"use strict";var r=function e(t,n,r){var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i&&i.writable)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":u(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(n,"__esModule",{value:!0});n.MissingError=function(e){function t(e){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Value required at path: "+e),this.path=e,this.name=this.constructor.name}return i(t,e),t}(Error),n.InvalidOperationError=function(e){function t(e){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Invalid operation: "+e),this.op=e,this.name=this.constructor.name}return i(t,e),t}(Error),n.TestError=function(e){function t(e,n){o(this,t),r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"Test failed: "+e+" != "+n),this.actual=e,this.expected=n,this.name=this.constructor.name,this.actual=e,this.expected=n}return i(t,e),t}(Error)},{}],4:[function(e,t,n){"use strict";function r(e,t){return t.map(function(t){var n=l[t.op];return void 0===n?new u(t.op):n(e,t)})}function i(e,t){return f(e,t,new c)}function o(e,t){var n=c.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}function s(e,t){var n=new Array;return t.filter(p).forEach(function(t){var r=o(e,t.path);if(r&&n.push(r),"from"in t){var i=o(e,t.from);i&&n.push(i)}}),n}var a=function(e){return e&&e.__esModule?e:{default:e}};n.applyPatch=r,n.createPatch=i,n.createTests=s,Object.defineProperty(n,"__esModule",{value:!0});var u=e("./errors").InvalidOperationError,c=e("./pointer").Pointer,l=a(e("./patch")),d=e("./diff"),f=d.diffAny,p=d.isDestructive},{"./diff":1,"./errors":3,"./patch":5,"./pointer":6}],5:[function(e,t,n){"use strict";function r(e,t,n){Array.isArray(e)?"-"==t?e.push(n):e.splice(t,0,n):e[t]=n}function i(e,t){Array.isArray(e)?e.splice(t,1):delete e[t]}function o(e,t){var n=d.fromJSON(t.path).evaluate(e);return void 0===n.parent?new h(t.path):(r(n.parent,n.key,t.value),null)}function s(e,t){var n=d.fromJSON(t.path).evaluate(e);return void 0===n.value?new h(t.path):(i(n.parent,n.key),null)}function a(e,t){var n=d.fromJSON(t.path).evaluate(e);return void 0===n.value?new h(t.path):(n.parent[n.key]=t.value,null)}function u(e,t){var n=d.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new h(t.from);var o=d.fromJSON(t.path).evaluate(e);return void 0===o.parent?new h(t.path):(i(n.parent,n.key),r(o.parent,o.key,n.value),null)}function c(e,t){var n=d.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new h(t.from);var o=d.fromJSON(t.path).evaluate(e);return void 0===o.parent?new h(t.path):(i(n.parent,n.key),r(o.parent,o.key,n.value),null)}function l(e,t){var n=d.fromJSON(t.path).evaluate(e);return f(n.value,t.value)?null:new m(n.value,t.value)}n.add=o,n.remove=s,n.replace=a,n.move=u,n.copy=c,n.test=l,Object.defineProperty(n,"__esModule",{value:!0});var d=e("./pointer").Pointer,f=e("./equal").compare,p=e("./errors"),h=p.MissingError,m=p.TestError},{"./equal":2,"./errors":3,"./pointer":6}],6:[function(e,t,n){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}var o=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};Object.defineProperty(n,"__esModule",{value:!0});n.Pointer=function(){function e(){var t=void 0===arguments[0]?[""]:arguments[0];s(this,e),this.tokens=t}return o(e,{toString:{value:function(){return this.tokens.map(i).join("/")}},evaluate:{value:function(e){for(var t=null,n=null,r=1,i=this.tokens.length;r<i;r++)t=e,n=this.tokens[r],e=(t||{})[n];return{parent:t,key:n,value:e}}},push:{value:function(e){this.tokens.push(e)}},add:{value:function(t){return new e(this.tokens.concat(String(t)))}}},{fromJSON:{value:function(t){var n=t.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)}}}),e}()},{}]},{},[4])(4)})}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],182:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/core-js/object/get-prototype-of"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),d=r(l),f=e("babel-runtime/helpers/inherits"),p=r(f),h=e("babel-runtime/helpers/classCallCheck"),m=r(h),v=e("babel-runtime/core-js/promise"),g=r(v),y=function(e,t,n,r){return new(n||(n=g.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},b=e("events"),_=e("operation-retrier"),w=e("./configuration"),T=e("./logger"),C=e("twilio-transport"),k="Twilio::RTD::EndpointId",E=function e(){(0,m.default)(this,e)},S=function(e){function t(e){(0,m.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.myInstanceNumber=t.instancesCounter++,e=e||{},e.transport=e.transport||new C.Transport(e.twilsockClient||null),n.config=new w.default(e),n.twilsock=e.twilsockClient,n.transport=e.transport,n.cachedContinuationToken=null,n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"setToken",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.currentFpaToken!==e&&(this.currentFpaToken=e,n=this.currentTokenRequest,this.currentTokenRequest=this.establishToken(e),this.notifyRejected(n)),t.abrupt("return",this.currentTokenRequest.promise);case 2:case"end":return t.stop()}},t,this)}))}},{key:"notifyRejected",value:function(e){e&&setTimeout(function(){return e.reject(new Error("Operation has been cancelled by next token"))},0)}},{key:"establishToken",value:function(e){var t=this,n=new E,r=new g.default(function(r,i){t.establishTokenImpl(e).then(r).catch(i),n.resolve=r,n.reject=i});return n.promise=r,n}},{key:"establishTokenImpl",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var n=this;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new _.default({min:500,max:2e3}).run(function(){return n.requestRtdToken(e)}).then(function(t){if("ok"!=t.status)throw t.exception;if(n.currentFpaToken===e){n.continuationToken=t.response.continuation_token;var r=t.response.twilio_rtd_token;return"NEW"===t.response.status.status?n.emit("tokenCreated",r):n.emit("tokenUpdated",r),n.emit("token",r),{token:t.response.twilio_rtd_token,ttl:t.response.ttl,status:t.response.status.status,reason:t.response.status.reason||null,identity:t.response.identity||null,accountSid:t.response.account_sid,serviceSids:t.response.instance_sids}}}).catch(function(e){throw T.default.error(e),e}));case 1:case"end":return t.stop()}},t,this)}))}},{key:"requestRtdToken",value:function(e){return y(this,void 0,void 0,o.default.mark(function t(){var n,r,i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={"Content-Type":"application/json"},r={fpa_token:e,continuation_token:this.continuationToken},T.default.debug("Token request",r),t.prev=3,t.next=6,this.transport.post(this.config.url,n,r);case 6:return i=t.sent,T.default.debug("Token response:",i),t.abrupt("return",{status:"ok",token:e,response:i.body});case 11:if(t.prev=11,t.t0=t.catch(3),401!==t.t0.status&&403!==t.t0.status){t.next=15;break}return t.abrupt("return",{status:"denied",exeception:t.t0,token:null,response:null});case 15:throw t.t0;case 16:case"end":return t.stop()}},t,this,[[3,11]])}))}},{key:"shouldUsePersistentToken",get:function(){return 0===this.myInstanceNumber}},{key:"continuationToken",get:function(){if(this.cachedContinuationToken)return this.cachedContinuationToken;try{if(this.shouldUsePersistentToken&&sessionStorage)return this.cachedContinuationToken=sessionStorage.getItem(k),this.cachedContinuationToken}catch(e){T.default.warn("Can't access persistent storage",e)}return null},set:function(e){this.cachedContinuationToken=e;try{this.shouldUsePersistentToken&&sessionStorage&&sessionStorage.setItem(k,e)}catch(e){T.default.warn("Can't access persistent storage",e)}}}]),t}(b.EventEmitter);S.instancesCounter=0,n.EmsClient=S;var x=S;n.EMSClient=x,Object.defineProperty(n,"__esModule",{value:!0}),n.default=x},{"./configuration":183,"./logger":184,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169,"operation-retrier":173,"twilio-transport":214}],183:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s="https://ems.us1.twilio.com",a="/v1/token",u=function e(t){(0,o.default)(this,e);var n=t.host||s;this.url=n+a};Object.defineProperty(n,"__esModule",{value:!0}),n.default=u},{"babel-runtime/helpers/classCallCheck":21}],184:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}var o=e("babel-runtime/core-js/array/from"),s=r(o),a=e("loglevel");Object.defineProperty(n,"__esModule",{value:!0}),n.default={setLevel:function(e){a.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.trace.apply(null,i("EMS T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,i("EMS D:",t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,i("EMS I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,i("EMS W:",t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,i("EMS E:",t))}}},{"babel-runtime/core-js/array/from":1,loglevel:172}],185:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){var r=new S.default(t,n,1,S.default.strategy.LEAK);return function(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(e),r.schedule.apply(r,t)}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/promise"),s=r(o),a=e("babel-runtime/core-js/object/define-properties"),u=r(a),c=e("babel-runtime/core-js/object/get-prototype-of"),l=r(c),d=e("babel-runtime/helpers/classCallCheck"),f=r(d),p=e("babel-runtime/helpers/createClass"),h=r(p),m=e("babel-runtime/helpers/possibleConstructorReturn"),v=r(m),g=e("babel-runtime/helpers/inherits"),y=r(g),b=e("./configuration"),_=r(b),w=e("events"),T=r(w),C=e("./logger"),k=r(C),E=e("bottleneck"),S=r(E),x=e("./registrar"),R=r(x),A=e("twilsock"),I=r(A),j=e("twilio-transport"),O=r(j),P=e("twilio-ems-client"),N=function(e){function t(e,n){(0,f.default)(this,t);var r=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this));if(!e)throw new Error("Token is required for Notifications client");n=n||{},n.logLevel=n.logLevel||"error",k.default.setLevel(n.logLevel);var o=n.minTokenRefreshInterval||1e4,s=n.productId||"notifications";n.twilsockClient=n.twilsockClient||new I.default(e,n),n.transport=n.transport||new O.default(n.twilsockClient),n.emsClient=n.emsClient||new P.EMSClient(n);var a=n.twilsockClient,c=n.transport,d={overall:!1,transport:!1,registration:!1},p=new _.default(null,n);return(0,u.default)(r,{_config:{value:p},_emsClient:{value:n.emsClient},_registrar:{value:new R.default(s,c,a,p)},_twilsock:{value:a},_reliableTransportState:{value:d},updateToken:{value:i(r._updateToken.bind(r),1,o),enumerable:!0},connectionState:{get:function(){return"disconnected"===r._twilsock.state?"disconnected":"disconnecting"===r._twilsock.state?"disconnecting":"connected"===r._twilsock.state&&r._reliableTransportState.registration?"connected":"rejected"===r._twilsock.state?"denied":"connecting"}}}),r._emsClient.setToken(e).then(function(e){return e.token}).then(function(e){r._config.updateToken(e),r._registrar.updateToken()}),r._onTransportStateChange(r._twilsock.connected),r._registrar.on("transportReady",function(e){r._onRegistrationStateChange(e?"registered":"")}),r._registrar.on("stateChanged",function(e){r._onRegistrationStateChange(e)}),r._registrar.on("needReliableTransport",r._onNeedReliableTransport.bind(r)),r._twilsock.on("message",function(e,t){return r._routeMessage(e,t)}),r._twilsock.on("connected",function(e){r._onTransportStateChange(!0),r._registrar.setNotificationId("twilsock",e)}),r._twilsock.on("disconnected",function(){r._onTransportStateChange(!1)}),r}return(0,y.default)(t,e),(0,h.default)(t,[{key:"_routeMessage",value:function(e,t){k.default.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this._twilsock.connect():this._twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this._reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this._reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this._reliableTransportState.transport&&this._reliableTransportState.registration;this._reliableTransportState.overall!==e&&(this._reliableTransportState.overall=e,k.default.info("Transport ready "+e),this.emit("transportReady",e),this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e,t){return t=t||"twilsock",k.default.trace("Add subscriptions for message type: ",e,t),this._registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e,t){return t=t||"twilsock",k.default.trace("Remove subscriptions for message type: ",e,t),this._registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){k.default.warn("Push message passed, but no functionality implemented yet: "+e)}},{key:"setPushRegistrationId",value:function(e,t){this._registrar.setNotificationId(t||"gcm",e)}},{key:"_updateToken",value:function(e){var t=this;return k.default.info("authTokenUpdated"),this._fpaToken===e?s.default.resolve():(this._twilsock.updateToken(e),this._emsClient.setToken(e).then(function(e){return e.token}).then(function(e){t._config.updateToken(e),t._registrar.updateToken()}))}}]),t}(T.default);n.default=N,t.exports=n.default},{"./configuration":186,"./logger":188,"./registrar":190,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,bottleneck:39,events:169,"twilio-ems-client":182,"twilio-transport":214,twilsock:217}],186:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l="https://ers.twilio.com",d="/v1/registrations",f=function(){function e(t,n){var r=this;(0,a.default)(this,e),n=(n||{}).Notification||{};var i=n.ersUri||l;(0,o.default)(this,{_registrarUri:{value:i+d},_token:{value:t,writable:!0},registrarUri:{get:function(){return r._registrarUri}},token:{get:function(){return r._token}}})}return(0,c.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();n.default=f,t.exports=n.default},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],187:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./client"),o=r(i);n.default=o.default,t.exports=n.default},{"./client":185}],188:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/array/from"),s=r(o),a=e("loglevel"),u=r(a);n.default={setLevel:function(e){u.default.setLevel(e)},trace:function(){u.default.trace.apply(null,i("Notify T:",arguments))},debug:function(){u.default.debug.apply(null,i("Notify D:",arguments))},info:function(){u.default.info.apply(null,i("Notify I:",arguments))},warn:function(){u.default.warn.apply(null,i("Notify W:",arguments))},error:function(){u.default.error.apply(null,i("Notify E:",arguments))}},t.exports=n.default},{"babel-runtime/core-js/array/from":1,loglevel:172}],189:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),s=r(o),a=e("babel-runtime/core-js/promise"),u=r(a),c=e("babel-runtime/core-js/set"),l=r(c),d=e("babel-runtime/core-js/object/define-properties"),f=r(d),p=e("babel-runtime/core-js/object/get-prototype-of"),h=r(p),m=e("babel-runtime/helpers/classCallCheck"),v=r(m),g=e("babel-runtime/helpers/createClass"),y=r(g),b=e("babel-runtime/helpers/possibleConstructorReturn"),_=r(b),w=e("babel-runtime/helpers/inherits"),T=r(w),C=e("events"),k=r(C),E=e("./logger"),S=r(E),x=e("javascript-state-machine"),R=r(x),A=e("backoff"),I=r(A),j=function(e){function t(e,n,r,i){(0,v.default)(this,t);var o=(0,_.default)(this,(t.__proto__||(0,h.default)(t)).call(this)),s=R.default.create({initial:{state:"unregistered",event:"init",defer:!0},events:[{name:"userUpdate",from:["unregistered"],to:"registering"},{name:"userUpdate",from:["registered"],to:"unregistering"},{name:"registered",from:["registering","retrying"],to:"registered"},{name:"unregistered",from:["unregistering"],to:"unregistered"},{name:"retry",from:["retrying"],to:"retrying"},{name:"failure",from:["registering"],to:"retrying"},{name:"failure",from:["retrying"],to:"retrying"},{name:"failure",from:["unregistering"],to:"unregistered"}],callbacks:{onregistering:function(e,t,n,r){return o._register(r)},onunregistering:function(){return o._unregister()},onregistered:function(){return o._onRegistered()},onunregistered:function(){return o._onUnregistered()},onretrying:function(e,t,n,r){return o._initRetry(r)},onfailure:function(e,t,n,r){"retrying"===t&&o._initRetry(r)}}}),a=I.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return a.on("ready",function(){o._retry()}),(0,f.default)(o,{_transport:{value:n},_context:{value:e},_url:{value:r.registrarUri,writable:!1},_config:{value:r},_fsm:{value:s},_backoff:{value:a},_channelType:{value:i},_registrationId:{value:!1,writable:!0},_notificationId:{value:!1,writable:!0},_messageTypes:{value:new l.default,writable:!0},_pendingUpdate:{value:null,writable:!0}}),s.init(),o}return(0,T.default)(t,e),(0,y.default)(t,[{key:"setNotificationId",value:function(e){this._notificationId!==e&&(this._notificationId=e,this._updateRegistration())}},{key:"updateToken",value:function(){return this._updateRegistration()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(S.default.debug("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateRegistration(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateRegistration():this._removeRegistration(),!0)}},{key:"_updateRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_removeRegistration",value:function(){this._notificationId&&this._update(this._notificationId,i(this._messageTypes))}},{key:"_update",value:function(e,t){var n={notificationId:e,messageTypes:t};this._fsm.is("unregistered")?n.notificationId&&n.messageTypes.length>0&&this._fsm.userUpdate(n):this._fsm.is("registered")?(this._fsm.userUpdate(n),this._setPendingUpdate(n)):this._setPendingUpdate(n)}},{key:"_setPendingUpdate",value:function(e){this._pendingUpdate=e}},{key:"_checkPendingUpdate",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._updateRegistration(e.notificationId,e.messageTypes)}}},{key:"_initRetry",value:function(e){this._pendingUpdate||this._setPendingUpdate(e),this._backoff.backoff()}},{key:"_retry",value:function(){if(this._pendingUpdate){var e=this._pendingUpdate;this._pendingUpdate=null,this._register(e)}}},{key:"_onRegistered",value:function(){this._backoff.reset(),this.emit("stateChanged","registered"),this._checkPendingUpdate()}},{key:"_onUnregistered",value:function(){this._backoff.reset(),this.emit("stateChanged","unregistered"),this._checkPendingUpdate()}},{key:"_register",value:function(e){var t=this,n={endpoint_platform:this._context.platform,channel_type:this._channelType,version:"2",message_types:e.messageTypes,data:{},ttl:"PT24H"};"twilsock"===this._channelType?n.data.url=e.notificationId:n.data.registration_id=e.notificationId;var r=this._url+"?productId="+this._context.productId,i={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return S.default.trace("Creating registration for channel ",this._channelType),this._transport.post(r,i,n).then(function(n){t._registrationId=n.body.id,t._registrationData=e,S.default.debug("Registration created: ",n),t._fsm.registered()}).catch(function(n){return S.default.error("Registration failed: ",n),t._fsm.failure(e),n})}},{key:"_unregister",value:function(){var e=this;if(!this._registrationId)return u.default.resolve();var t=this._url+"/"+this._registrationId+"?productId="+this._context.productId,n={"Content-Type":"application/json","X-Twilio-Token":this._config.token};return S.default.trace("Removing registration for ",this._channelType),this._transport.delete(t,n).then(function(){S.default.debug("Registration removed for ",e._channelType),e._registrationId=!1,e._fsm.unregistered()}).catch(function(t){return S.default.error("Failed to remove of registration ",e.channelType,t),e._fsm.failure(),t})}}]),t}(k.default);n.default=j,(0,s.default)(j),t.exports=n.default},{"./logger":188,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,backoff:29,events:169,"javascript-state-machine":170}],190:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=r(i),s=e("babel-runtime/core-js/map"),a=r(s),u=e("babel-runtime/core-js/object/define-properties"),c=r(u),l=e("babel-runtime/core-js/object/get-prototype-of"),d=r(l),f=e("babel-runtime/helpers/classCallCheck"),p=r(f),h=e("babel-runtime/helpers/createClass"),m=r(h),v=e("babel-runtime/helpers/possibleConstructorReturn"),g=r(v),y=e("babel-runtime/helpers/inherits"),b=r(y),_=e("events"),w=r(_),T=e("./registrar.connector"),C=r(T),k=e("./twilsock.connector"),E=r(k),S=function(e){function t(e,n,r,i){(0,p.default)(this,t);var o=(0,g.default)(this,(t.__proto__||(0,d.default)(t)).call(this));(0,c.default)(o,{_conf:{value:i},_connectors:{value:new a.default}});var s=("undefined"!=typeof navigator?navigator.userAgent:"web").substring(0,128);return o._connectors.set("twilsock",new E.default({productId:e,platform:s},r,i)),o._connectors.set("gcm",new C.default({productId:e,platform:s},n,i,"gcm")),o._connectors.set("fcm",new C.default({productId:e,platform:s},n,i,"fcm")),o._connectors.set("apn",new C.default({productId:e,platform:s},n,i,"apn")),o._connectors.get("twilsock").on("transportReady",function(e){return o.emit("transportReady",e)}),o}return(0,b.default)(t,e),(0,m.default)(t,[{key:"setNotificationId",value:function(e,t){this._connector(e).setNotificationId(t)}},{key:"hasSubscription",value:function(e,t){this._connector(t).has(e)}},{key:"subscribe",value:function(e,t){this._connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){this._connector(t).unsubscribe(e)}},{key:"updateToken",value:function(){this._connectors.forEach(function(e){return e.updateToken()})}},{key:"_connector",value:function(e){var t=this._connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}}]),t}(w.default);n.default=S,(0,o.default)(S),t.exports=n.default},{"./registrar.connector":189,"./twilsock.connector":191,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],191:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),s=r(o),a=e("babel-runtime/core-js/set"),u=r(a),c=e("babel-runtime/core-js/object/define-properties"),l=r(c),d=e("babel-runtime/core-js/object/get-prototype-of"),f=r(d),p=e("babel-runtime/helpers/classCallCheck"),h=r(p),m=e("babel-runtime/helpers/createClass"),v=r(m),g=e("babel-runtime/helpers/possibleConstructorReturn"),y=r(g),b=e("babel-runtime/helpers/inherits"),_=r(b),w=e("uuid"),T=r(w),C=e("./logger"),k=r(C),E=e("events"),S=r(E),x=172800,R=function(e){function t(e,n,r){(0,h.default)(this,t);var i=(0,y.default)(this,(t.__proto__||(0,f.default)(t)).call(this));return e.id=T.default.v4(),(0,l.default)(i,{_twilsock:{value:n},_messageTypes:{value:new u.default},config:{value:r},context:{value:e}}),n.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),n.on("registered",function(t){e&&t===e.id&&"connected"===n.state&&i.emit("transportReady",!0)}),i}return(0,_.default)(t,e),(0,v.default)(t,[{key:"setNotificationId",value:function(){return!1}},{key:"updateToken",value:function(){this._twilsock.removeNotificationsContext(this.context.id),this.context.id=T.default.v4(),this._updateContext()}},{key:"has",value:function(e){return this._messageTypes.has(e)}},{key:"subscribe",value:function(e){return this._messageTypes.has(e)?(k.default.trace("Message type already registered ",e),!1):(this._messageTypes.add(e),this._updateContext(),!0)}},{key:"unsubscribe",value:function(e){return!!this._messageTypes.has(e)&&(this._messageTypes.delete(e),this._messageTypes.size>0?this._updateContext():this._twilsock.removeNotificationsContext(this.context.id),!0)}},{key:"_updateContext",value:function(){if(this.config.token){var e=i(this._messageTypes),t={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,ttl:x,token:this.config.token,message_types:e};this.emit("transportReady",!1),this._twilsock.setNotificationsContext(this.context.id,t)}}}]),t}(S.default);n.default=R,(0,s.default)(R),t.exports=n.default},{"./logger":188,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,uuid:224}],192:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("karibu"),c=function(){function e(t,n){(0,o.default)(this,e),this.value=t,this.revision=n}return(0,a.default)(e,[{key:"isValid",get:function(){return!0}}]),e}(),l=function(){function e(t){(0,o.default)(this,e),this.revision=t}return(0,a.default)(e,[{key:"isValid",get:function(){return!1}}]),e}(),d=function(){function e(){(0,o.default)(this,e),this.items=new u.TreeMap}return(0,a.default)(e,[{key:"store",value:function(e,t,n){var r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new c(t,n)),t)}},{key:"delete",value:function(e,t){var n=this.items.get(e);(!n||n.revision<t)&&this.items.set(e,new l(t))}},{key:"isKnown",value:function(e,t){var n=this.items.get(e);return n&&n.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();n.Cache=d,Object.defineProperty(n,"__esModule",{value:!0}),n.default=d},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,karibu:171}],193:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e._subscribe(),e}function o(e,t,n,r){return{unique_name:e,purpose:t,context:n,data:r}}function s(e){return e?"string"==typeof e?{id:e,purpose:null,data:null,context:null,mode:null}:{id:e.uniqueName||e.sid||e.id,purpose:e.purpose,data:e.data,context:e.context,mode:e.mode}:{id:null,purpose:null,data:null,context:null,mode:null}}var a=e("babel-runtime/regenerator"),u=r(a),c=e("babel-runtime/core-js/object/get-prototype-of"),l=r(c),d=e("babel-runtime/helpers/classCallCheck"),f=r(d),p=e("babel-runtime/helpers/createClass"),h=r(p),m=e("babel-runtime/helpers/possibleConstructorReturn"),v=r(m),g=e("babel-runtime/helpers/inherits"),y=r(g),b=e("babel-runtime/core-js/promise"),_=r(b),w=function(e,t,n,r){return new(n||(n=_.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},T=e("events"),C=e("twilsock"),k=e("twilio-transport"),E=e("twilio-ems-client"),S=e("twilio-notifications"),x=e("./utils"),R=e("./logger"),A=e("./configuration"),I=e("./subscriptions"),j=e("./router"),O=e("./network"),P=e("./syncdocument"),N=e("./synclist"),D=e("./syncmap"),M=e("./clientInfo"),U=e("./entitiesCache"),L=e("./syncerror"),F="data_sync",$=e("../package.json").version,X=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,f.default)(this,t);var r=(0,v.default)(this,(t.__proto__||(0,l.default)(t)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");n.hasOwnProperty("logLevel")&&R.default.setLevel(n.logLevel);var i=n.productId=n.productId||F,o=n.twilsockClient=n.twilsockClient||new C(e,n),s=n.transport=n.transport||new k.Transport(n.twilsockClient),a=n.emsClient=n.emsClient||new E.EmsClient(n),u=n.notificationsClient=n.notificationsClient||new S(e,n),c=new A.Configuration(null,n),d=new O.Network(i,new M.ClientInfo($),c,s);r.fpaToken=e,a.setToken(e).then(function(e){return r.services.config.updateToken(e.token)}),o.connect(),r.services={config:c,twilsock:o,notifications:u,network:d,emsClient:a,router:null,subscriptions:null};var p=new I.Subscriptions(r.services),h=new j.Router({config:c,subscriptions:p,notifications:u});return r.services.router=h,r.services.subscriptions=p,r.entities=new U.EntitiesCache,u.on("connectionStateChanged",function(){r.emit("connectionStateChanged",r.services.notifications.connectionState)}),r}return(0,y.default)(t,e),(0,h.default)(t,[{key:"ensureReady",value:function(){var e=this;return this.services.config.token?_.default.resolve(this.services.config.token):new _.default(function(t,n){e.services.emsClient.once("token",function(e){setTimeout(function(){return t(e)},0)})})}},{key:"_get",value:function(e,t){return w(this,void 0,void 0,u.default.mark(function n(){var r,i,o;return u.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return",null);case 2:return r=new x.UriBuilder(e).arg("Deep",!0).arg("Id",t).build(),n.next=5,this.services.network.get(r);case 5:return i=n.sent,o=i.body.documents||i.body.lists||i.body.maps||[],n.abrupt("return",0===o.length?null:o[0]);case 8:case"end":return n.stop()}},n,this)}))}},{key:"_createDocument",value:function(e,t,n){var r=o(e,t,null,n);return this.services.network.post(this.services.config.documentsUri,r).then(function(e){return e.body})}},{key:"_getDocument",value:function(e){return this._get(this.services.config.documentsUri,e)}},{key:"_createList",value:function(e,t,n){var r=o(e,t,n);return this.services.network.post(this.services.config.listsUri,r).then(function(e){return e.body})}},{key:"_getList",value:function(e){return this._get(this.services.config.listsUri,e)}},{key:"_createMap",value:function(e,t,n){var r=o(e,t,n);return this.services.network.post(this.services.config.mapsUri,r).then(function(e){return e.body})}},{key:"_getMap",value:function(e){return this._get(this.services.config.mapsUri,e)}},{key:"getCached",value:function(e,t){return this.entities.get(e,t)||null}},{key:"removeFromCache",value:function(e){this.entities.remove(e)}},{key:"document",value:function(e){return w(this,void 0,void 0,u.default.mark(function t(){var n,r,o,a,c,l=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,a=n.data,c=n.mode,t.abrupt("return",this.getCached(r,"document")||this._getDocument(r).then(function(e){if(e)return e;if("open"!==c)return l._createDocument(r,o,a);throw new L.default("Not found",404)}).then(function(e){return new P.SyncDocument(l.services,e,function(e){return l.removeFromCache(e)})}).then(function(e){return l.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"map",value:function(e){return w(this,void 0,void 0,u.default.mark(function t(){var n,r,o,a,c,l=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,a=n.context,c=n.mode,t.abrupt("return",this.getCached(r,"map")||this._getMap(r).then(function(e){if(e)return e;if("open"!==c)return l._createMap(r,o,a);throw new L.default("Not found",404)}).then(function(e){return new D.SyncMap(l.services,e,function(e){return l.removeFromCache(e)})}).then(function(e){return l.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"list",value:function(e){return w(this,void 0,void 0,u.default.mark(function t(){var n,r,o,a,c,l=this;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ensureReady();case 2:return n=s(e),r=n.id,o=n.purpose,a=n.context,c=n.mode,t.abrupt("return",this.getCached(r,"list")||this._getList(r).then(function(e){if(e)return e;if("open"!==c)return l._createList(r,o,a);throw new L.default("Not found",404)}).then(function(e){return new N.SyncList(l.services,e,function(e){return l.removeFromCache(e)})}).then(function(e){return l.entities.store(e)}).then(i));case 4:case"end":return t.stop()}},t,this)}))}},{key:"shutdown",value:function(){return w(this,void 0,void 0,u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateToken",value:function(e){return w(this,void 0,void 0,u.default.mark(function t(){var n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.emsClient.setToken(e);case 2:return n=t.sent,this.services.config.updateToken(n.token),t.next=6,_.default.all([this.services.notifications.updateToken(e),this.services.twilsock.updateToken(e)]);case 6:this.fpaToken=e;case 7:case"end":return t.stop()}},t,this)}))}},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return $}}]),t}(T.EventEmitter);n.SyncClient=X,n.Client=X,Object.defineProperty(n,"__esModule",{value:!0}),n.default=X},{"../package.json":212,"./clientInfo":194,"./configuration":195,"./entitiesCache":196,"./logger":200,"./network":202,"./router":205,"./subscriptions":206,"./syncdocument":207,"./syncerror":208,"./synclist":209,"./syncmap":210,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169,"twilio-ems-client":182,"twilio-notifications":187,"twilio-transport":214,twilsock:217}],194:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s=e("platform"),a=function e(t){(0,o.default)(this,e),this.sdk="js",this.sdkVer=t,this.os=s.os.family,this.osVer=s.os.version,this.pl=s.name,this.plVer=s.version};n.ClientInfo=a,Object.defineProperty(n,"__esModule",{value:!0}),n.default=a},{"babel-runtime/helpers/classCallCheck":21,platform:174}],195:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s=e("babel-runtime/helpers/createClass"),a=r(s),u="https://cds.twilio.com",c="/v4/Subscriptions",l="/v3/Maps",d="/v3/Lists",f="/v3/Documents",p=function(){function e(t,n){(0,o.default)(this,e),n=(n||{}).DataSync||{};var r=n.cdsUri||u;this._token=t,this.settings={subscriptionsUri:r+c,documentsUri:r+f,listsUri:r+d,mapsUri:r+l}}return(0,a.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}},{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}}]),e}();n.Configuration=p},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],196:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/map"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=function(){function e(){(0,a.default)(this,e),this.names=new o.default,this.entities=new o.default}return(0,c.default)(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t?t:(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();n.EntitiesCache=l},{"babel-runtime/core-js/map":5,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],197:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),d=r(l),f=e("babel-runtime/helpers/inherits"),p=r(f),h=e("events"),m=function(e){function t(e){(0,a.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return n.services=e,n}return(0,p.default)(t,e),(0,c.default)(t,[{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid,this),this}},{key:"close",value:function(){this._unsubscribe()}}]),t}(h.EventEmitter);n.SyncEntity=m,Object.defineProperty(n,"__esModule",{value:!0}),n.default=m},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],198:[function(e,t,n){"use strict";var r=e("./client");n.SyncClient=r.SyncClient,Object.defineProperty(n,"__esModule",{value:!0}),n.default=r.SyncClient},{"./client":193}],199:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t){(0,o.default)(this,e),this.data=t}return(0,a.default)(e,[{key:"update",value:function(e,t,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();n.ListItem=u,Object.defineProperty(n,"__esModule",{value:!0}),n.default=u},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],200:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}var o=e("babel-runtime/core-js/array/from"),s=r(o),a=e("loglevel");Object.defineProperty(n,"__esModule",{value:!0}),n.default={setLevel:function(e){a.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.trace.apply(null,i("Sync T:",t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.debug.apply(null,i("Sync D:",t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.info.apply(null,i("Sync I:",t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.warn.apply(null,i("Sync W:",t))},error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];a.error.apply(null,i("Sync E:",t))}}},{"babel-runtime/core-js/array/from":1,loglevel:172}],201:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/classCallCheck"),o=r(i),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t){(0,o.default)(this,e),this.data=t}return(0,a.default)(e,[{key:"update",value:function(e,t,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"key",get:function(){return this.data.key}},{key:"value",get:function(){return this.data.value}}]),e}();n.MapItem=u,Object.defineProperty(n,"__esModule",{value:!0}),n.default=u},{"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],202:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){throw 429===e.status?new p.SyncError(e.body.message,429):e}var o=e("babel-runtime/core-js/json/stringify"),s=r(o),a=e("babel-runtime/helpers/classCallCheck"),u=r(a),c=e("babel-runtime/helpers/createClass"),l=r(c),d=e("uuid"),f=e("./logger"),p=e("./syncerror"),h=function(){function e(t,n,r,i){(0,u.default)(this,e),this.productId=t,this.clientInfo=n,this.config=r,this.transport=i}return(0,l.default)(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,s.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+d.v4().replace(/-/g,""),"X-Twilio-Product-Id":this.productId,"X-Twilio-Token":this.config.token}}},{key:"get",value:function(e){var t=this.createHeaders();return f.default.debug("GET",e,"ID:",t["Twilio-Request-Id"]),this.transport.get(e,t).catch(i)}},{key:"post",value:function(e,t,n,r){var o=this.createHeaders();return void 0!==n&&(o["If-Match"]=n),f.default.debug("POST",e,"ID:",o["Twilio-Request-Id"]),this.transport.post(e,o,t,r).catch(i)}},{key:"put",value:function(e,t,n){var r=this.createHeaders();return void 0!==n&&(r["If-Match"]=n),f.default.debug("PUT",e,"ID:",r["Twilio-Request-Id"]),this.transport.put(e,r,t).catch(i)}},{key:"delete",value:function(e){var t=this.createHeaders();return f.default.debug("DELETE",e,"ID:",t["Twilio-Request-Id"]),this.transport.delete(e,t).catch(i)}}]),e}();n.Network=h,Object.defineProperty(n,"__esModule",{value:!0}),n.default=h},{"./logger":200,"./syncerror":208,"babel-runtime/core-js/json/stringify":4,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,uuid:224}],203:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/core-js/promise"),d=r(l),f=function(e,t,n,r){return new(n||(n=d.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},p=function(){function e(t,n,r,i){(0,a.default)(this,e),this.prevToken=r,this.nextToken=i,this.items=t,this.source=n}return(0,c.default)(e,[{key:"nextPage",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"prevPage",value:function(){return f(this,void 0,void 0,o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}))}},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();n.Paginator=p,Object.defineProperty(n,"__esModule",{value:!0}),n.default=p},{"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],204:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/freeze"),o=r(i),s=e("babel-runtime/core-js/promise"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=function(){function e(){(0,c.default)(this,e),this.queue=new Array,this.isActive=!1}return(0,d.default)(e,[{key:"wakeupQueue",value:function(){var e=this;!this.isActive&&this.queue.length>0&&(this.isActive=!0,setTimeout(function(){return e.executeTask(e.queue[0])},0))}},{key:"pickNext",value:function(){var e=this;if(this.queue.shift(),0===this.queue.length)return void(this.isActive=!1);setTimeout(function(){return e.executeTask(e.queue[0])},0)}},{key:"pickSame",value:function(e){var t=this;this.queue[0].arg=e,setTimeout(function(){return t.executeTask(t.queue[0])},0)}},{key:"executeTask",value:function(e){var t=this;e.task(e.context,e.arg).then(function(n){t.pickNext(),e.resolve(n)}).catch(function(n){try{if(!e.handle)throw n;e.handle(n).then(function(e){return t.pickSame(e)}).catch(e.reject)}catch(t){e.reject(n)}})}},{key:"add",value:function(e,t,n,r){var i=this;return new a.default(function(o,s){i.queue.push({task:e,context:t,arg:n,handle:r,resolve:o,reject:s}),i.wakeupQueue()})}}]),e}();n.RetryingQueue=f,(0,o.default)(f),Object.defineProperty(n,"__esModule",{value:!0}),n.default=f},{"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],205:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/core-js/promise"),d=r(l),f=function(e,t,n,r){return new(n||(n=d.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},p=e("./logger"),h="com.twilio.rtd.cds.document",m="com.twilio.rtd.cds.list",v="com.twilio.rtd.cds.map",g="twilio.sync.event",y=function(){function e(t){var n=this;(0,a.default)(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(g),this.notifications.subscribe(h),this.notifications.subscribe(m),this.notifications.subscribe(v),this.notifications.on("message",function(e,t){return n.onMessage(e,t)}),this.notifications.on("transportReady",function(e){e&&n.onConnected()})}return(0,c.default)(e,[{key:"onMessage",value:function(e,t){switch(e){case h:case m:case v:case g:p.default.trace("Notification type:",e,"content:",t),this.subscriptions.acceptMessage(t)}}},{key:"subscribe",value:function(e,t){return f(this,void 0,void 0,o.default.mark(function n(){return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.subscriptions.add(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"unsubscribe",value:function(e,t){return f(this,void 0,void 0,o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.subscriptions.remove(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"onConnected",value:function(){this.subscriptions.poke()}}]),e}();n.Router=y,Object.defineProperty(n,"__esModule",{value:!0}),n.default=y},{"./logger":200,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/regenerator":28}],206:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/helpers/slicedToArray"),a=r(s),u=e("babel-runtime/core-js/get-iterator"),c=r(u),l=e("babel-runtime/helpers/extends"),d=r(l),f=e("babel-runtime/core-js/map"),p=r(f),h=e("babel-runtime/helpers/classCallCheck"),m=r(h),v=e("babel-runtime/helpers/createClass"),g=r(v),y=e("babel-runtime/core-js/promise"),b=r(y),_=function(e,t,n,r){return new(n||(n=b.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},w=e("backoff"),T=e("./logger"),C=e("./syncerror"),k=e("twilio-transport"),E=1e3,S=function(){function e(t){(0,m.default)(this,e),this.localObject=t,this.correlationId=null}return(0,g.default)(e,[{key:"markAsFailed",value:function(e){this.pendingPokeTimer&&clearTimeout(this.pendingPokeTimer),this.rejectedWithError=e}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"isInTransition",get:function(){return null!==this.correlationId}}]),e}(),x=function(){function e(t){var n=this;(0,m.default)(this,e),this.services=t,this.subscriptions=new p.default,this.persisted=new p.default;var r={randomisationFactor:.2,initialDelay:100,maxDelay:12e4};this.backoff=w.exponential((0,d.default)(r,this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=n.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?n.applyNewSubscriptionUpdateBatch(t,r):(n.backoff.reset(),T.default.info("All subscriptions resolved."))})}return(0,g.default)(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,n,r){var i=[],o=!0,s=!1,u=void 0;try{for(var l,d=(0,c.default)(e);!(o=(l=d.next()).done);o=!0){var f=(0,a.default)(l.value,2),p=f[0],h=f[1];if(!t.get(p)&&(n||!h.isInTransition)&&!h.rejectedWithError&&(i.push(h),r&&i.length>=r))break}}catch(e){s=!0,u=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw u}}return i}var t=e(this.subscriptions,this.persisted,!1,E).map(function(e){return new S(e)});if(t.length>0)return{action:"establish",subscriptions:t};var n=e(this.persisted,this.subscriptions,!0,E);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(e,t){return _(this,void 0,void 0,o.default.mark(function n(){var r,i,s,a,u,l,d,f,p,h,m,v,g,y,b,_,w,C,E,S;return o.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:for(t=this.processLocalActions(e,t),r=(new Date).getTime(),i=!0,s=!1,a=void 0,n.prev=5,u=(0,c.default)(t);!(i=(l=u.next()).done);i=!0)d=l.value,this.recordActionAttemptOn(d,e,r);n.next=13;break;case 9:n.prev=9,n.t0=n.catch(5),s=!0,a=n.t0;case 13:n.prev=13,n.prev=14,!i&&u.return&&u.return();case 16:if(n.prev=16,!s){n.next=19;break}throw a;case 19:return n.finish(16);case 20:return n.finish(13);case 21:return n.prev=21,n.next=24,this.request(e,r,t.map(function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0}}));case 24:if(f=n.sent,"establish"!==e){n.next=45;break}for(p=!0,h=!1,m=void 0,n.prev=29,v=(0,c.default)(t);!(p=(g=v.next()).done);p=!0)y=g.value,y.correlationId===r&&this.beginReplayTimeout(f.body.estimated_delivery_in_ms,y,e,r);n.next=37;break;case 33:n.prev=33,n.t1=n.catch(29),h=!0,m=n.t1;case 37:n.prev=37,n.prev=38,!p&&v.return&&v.return();case 40:if(n.prev=40,!h){n.next=43;break}throw m;case 43:return n.finish(40);case 44:return n.finish(37);case 45:this.backoff.reset(),n.next=70;break;case 48:for(n.prev=48,n.t2=n.catch(21),b=!0,_=!1,w=void 0,n.prev=53,C=(0,c.default)(t);!(b=(E=C.next()).done);b=!0)S=E.value,this.recordActionFailureOn(S,e);n.next=61;break;case 57:n.prev=57,n.t3=n.catch(53),_=!0,w=n.t3;case 61:n.prev=61,n.prev=62,!b&&C.return&&C.return();case 64:if(n.prev=64,!_){n.next=67;break}throw w;case 67:return n.finish(64);case 68:return n.finish(61);case 69:n.t2 instanceof k.TwilsockUnavailableError?(T.default.debug("Twilsock connection (required for subscription) not ready (c:"+r+"); waitingâ¦"),this.backoff.reset()):(T.default.debug("Failed an attempt to "+e+" subscriptions (c:"+r+"); retrying",n.t2),this.persist());case 70:case"end":return n.stop()}},n,this,[[5,9,13,21],[14,,16,20],[21,48],[29,33,37,45],[38,,40,44],[53,57,61,69],[62,,64,68]])}))}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,n){if("establish"===t)this.persisted.set(e.sid,e),e.correlationId=n;else{var r=this.persisted.get(e.sid);r&&(r.correlationId=n)}}},{key:"recordActionFailureOn",value:function(e,t){e.correlationId=null,"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,n){T.default.debug("Attempting '"+e+"' request (c:"+t+"):",n);var r={event_protocol_version:3,action:e,correlation_id:t,requests:n};return this.services.network.post(this.services.config.subscriptionsUri,r,null,!0)}},{key:"beginReplayTimeout",value:function(e,t,n,r){var i=this;!isNaN(parseFloat(e))&&isFinite(e)&&e>0&&(t.pendingPokeTimer=setTimeout(function(){t.correlationId===r&&(T.default.debug("Attempt to "+n+" "+t.sid+" (c:"+r+") timed out without confirmation; trying again."),t.correlationId=null,i.persisted.delete(t.sid),i.persist())},e))}},{key:"add",value:function(e,t){T.default.debug("Establishing intent to subscribe to "+e);var n=this.subscriptions.get(e);n&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,t),this.persist())}},{key:"remove",value:function(e){T.default.debug("Establishing intent to unsubscribe from "+e),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e){switch(T.default.trace("Subscriptions received",e),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document)_/)||{}).input:var t=function(){return e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:void 0};this.applyEventToSubscribedEntity(t(),e);break;default:T.default.debug("Dropping unknown message type "+e.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var n=e.object_sid,r=this.persisted.get(e.object_sid);r&&r.correlationId===t?"interrupted"===e.replay_status?(T.default.debug("Event Replay for subscription to "+n+" (c:"+t+") interrupted; continuing eagerly."),clearTimeout(r.pendingPokeTimer),r.pendingPokeTimer=null,r.correlationId=null,this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(T.default.debug("Event Replay for subscription to "+n+" (c:"+t+") completed. Subscription is ready."),clearTimeout(r.pendingPokeTimer),r.pendingPokeTimer=null,r.correlationId=null,this.persisted.set(e.object_sid,r),this.backoff.reset()):T.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var n=this.persisted.get(e.object_sid);n&&n.correlationId===t?(clearTimeout(n.pendingPokeTimer),n.pendingPokeTimer=null,n.correlationId=null,this.persisted.delete(e.object_sid)):T.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var n=e.object_sid,r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.correlationId===t&&(i.markAsFailed(e.error),T.default.error("Failed to subscribe on "+i.sid,e.error),r.reportFailure(new C.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status))):!r&&i&&this.persisted.delete(n),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t){var n=e?this.subscriptions.get(e):null;n?(t.event.type=t.event_type,n._update(t.event)):T.default.debug("Message dropped for SID '"+e+"', for which there is no subscription.")}},{key:"poke",value:function(){T.default.info("Triggering event replay for all subscriptions.");var e=[],t=!0,n=!1,r=void 0;try{for(var i,o=(0,c.default)(this.persisted);!(t=(i=o.next()).done);t=!0){var s=(0,a.default)(i.value,2),u=(s[0],s[1]);clearTimeout(u.pendingPokeTimer),u.pendingPokeTimer=null,u.correlationId=null,u.rejectedWithError&&e.push(u)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.persisted.clear();var l=!0,d=!1,f=void 0;try{for(var p,h=(0,c.default)(e);!(l=(p=h.next()).done);l=!0){var u=p.value;this.persisted.set(u.sid,u)}}catch(e){d=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw f}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();n.Subscriptions=x,Object.defineProperty(n,"__esModule",{value:!0}),n.default=x},{"./logger":200,"./syncerror":208,"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/map":5,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/slicedToArray":26,"babel-runtime/regenerator":28,backoff:29,"twilio-transport":214}],207:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=r(i),s=e("babel-runtime/regenerator"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("babel-runtime/helpers/possibleConstructorReturn"),m=r(h),v=e("babel-runtime/helpers/inherits"),g=r(v),y=e("babel-runtime/core-js/promise"),b=r(y),_=function(e,t,n,r){return new(n||(n=b.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},w=e("./logger"),T=e("./entity"),C=e("rfc6902"),k=e("./retryingqueue"),E=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return i.actionQueue=new k.RetryingQueue,i.descriptor=n,i.onRemoveDocument=r,i}return(0,g.default)(t,e),(0,p.default)(t,[{key:"_update",value:function(e){switch(e.type){case"document_updated":if(e.id>this.lastEventId){var t=this.descriptor.data;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.data=e.document_data,this.traverse(t,e.document_data,!1),this.emit("updated",e.document_data,!1),this.emit("updatedRemotely",e.document_data)}break;case"document_removed":this.onRemoved(!1)}}},{key:"traverse",value:function(e,t,n){var r=this;C.createPatch(e,t).forEach(function(e){"add"===e.op?(r.emit("keyAdded",e.path,e.value,n),n||r.emit("keyAddedRemotely",e.path,e.value)):"replace"===e.op?(r.emit("keyUpdated",e.path,e.value,n),n||r.emit("keyUpdatedRemotely",e.path,e.value)):"remove"===e.op&&(r.emit("keyRemoved",e.path,n),n||r.emit("keyRemovedRemotely",e.path))})}},{key:"get",value:function(e){return this.value}},{key:"set",value:function(e,t){return this._actualSet(e,t?function(){throw new Error("Revision mismatch")}:null)}},{key:"_actualSet",value:function(e,t){var n=this,r=void 0,i={data:e,revision:t?this.revision:void 0};return t&&(r=function(r){return _(n,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(412!==r.status){n.next=4;break}return n.next=3,this.softSync();case 3:return n.abrupt("return",{revision:this.revision,data:t(this.value,e)});case 4:throw r;case 5:case"end":return n.stop()}},n,this)}))}),this.actionQueue.add(this._set.bind(this),this.uri,i,r).then(function(e){return n.descriptor.revision=e.revision,n.descriptor.data=e.data,n.emit("updated",n.value,!0),n.value})}},{key:"mutate",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._actualSet(e(this.value),e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"update",value:function(e){return this.mutate(function(t){return(0,o.default)(t,e)})}},{key:"_set",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function e(){var n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.post(this.uri,{data:t.data},t.revision);case 2:return n=e.sent,e.abrupt("return",{revision:n.body.revision,data:t.data});case 4:case"end":return e.stop()}},e,this)}))}},{key:"softSync",value:function(){var e=this;return this.services.network.get(this.uri).then(function(t){return e._update({type:"document_updated",id:t.body.last_event_id,document_revision:t.body.revision,document_data:t.body.data}),e}).catch(function(t){404===t.status?e.onRemoved(!1):w.default.error("Can't get updates for "+e.sid+":",t)})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.emit("removed",e),e||this.emit("removedRemotely")}},{key:"removeDocument",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.onRemoveDocument(this.sid),e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"document"}}],[{key:"type",get:function(){return"document"}}]),t}(T.SyncEntity);n.SyncDocument=E,Object.defineProperty(n,"__esModule",{value:!0}),n.default=E},{"./entity":197,"./logger":200,"./retryingqueue":204,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,rfc6902:181}],208:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/possibleConstructorReturn"),c=r(u),l=e("babel-runtime/helpers/inherits"),d=r(l),f=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,a.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.status=n,r}return(0,d.default)(t,e),t}(Error);n.SyncError=f,Object.defineProperty(n,"__esModule",{value:!0}),n.default=f},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25}],209:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=r(i),s=e("babel-runtime/regenerator"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("babel-runtime/helpers/possibleConstructorReturn"),m=r(h),v=e("babel-runtime/helpers/inherits"),g=r(v),y=e("babel-runtime/core-js/promise"),b=r(y),_=function(e,t,n,r){return new(n||(n=b.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},w=e("./utils"),T=e("./logger"),C=e("./entity"),k=e("./retryingqueue"),E=e("./listitem"),S=e("./paginator"),x=e("./cache"),R=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return i.actionQueue=new k.RetryingQueue,i.cache=new x.Cache,i.descriptor=n,i.onRemoveList=r,i}return(0,g.default)(t,e),(0,p.default)(t,[{key:"__set",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function n(){var r;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.services.network.post(e,{data:t.data},t.revision);case 2:return r=n.sent,r.body.data=t.data,n.abrupt("return",r.body);case 5:case"end":return n.stop()}},n,this)}))}},{key:"_set",value:function(e,t,n){return _(this,void 0,void 0,a.default.mark(function r(){var i,o,s=this;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=5;break}return r.next=3,this.services.network.post(e.uri,{data:t});case 3:return i=r.sent,r.abrupt("return",e.update(i.body.last_event_id,i.body.revision,t));case 5:return o=function(r){if(412===r.status)return s.queryEvents().then(function(){return s.get(e.index)}).then(function(e){return{revision:e.revision,data:n(e.value,t)}});throw r},r.abrupt("return",this.actionQueue.add(this.__set.bind(this),e.uri,{revision:e.revision,data:t},o).then(function(t){return e.update(t.last_event_id,t.revision,t.data)}));case 7:case"end":return r.stop()}},r,this)}))}},{key:"push",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n,r,i;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.network.post(this.links.items,{data:e});case 2:return n=t.sent,r=Number(n.body.index),i=this.cache.store(r,new E.ListItem({index:r,revision:n.body.revision,lastEventId:n.body.last_event_id,uri:n.body.url,value:e}),n.body.last_event_id),this.emit("itemAdded",i,!0),t.abrupt("return",i);case 7:case"end":return t.stop()}},t,this)}))}},{key:"set",value:function(e,t){return this._actualSet(e,t)}},{key:"_actualSet",value:function(e,t,n){return _(this,void 0,void 0,a.default.mark(function r(){var i;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get(e);case 2:return i=r.sent,r.next=5,this._set(i,t,n);case 5:return i=r.sent,this.emit("itemUpdated",i,!0),r.abrupt("return",i);case 8:case"end":return r.stop()}},r,this)}))}},{key:"mutate",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function n(){var r;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e);case 2:return r=n.sent,n.abrupt("return",this._actualSet(e,t(r.value),t));case 4:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,o.default)(e,t)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return n=t.sent,t.next=5,this.services.network.delete(n.uri);case 5:this.cache.delete(e,n.lastEventId),this.emit("itemRemoved",e,!0);case 7:case"end":return t.stop()}},t,this)}))}},{key:"get",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n,r;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.cache.get(e),!n){t.next=3;break}return t.abrupt("return",n);case 3:return t.next=5,this.queryItems({index:e});case 5:if(r=t.sent,!(r.items.length<1)){t.next=8;break}throw new Error("No item with index "+e+" found");case 8:return t.abrupt("return",this.cache.store(e,r.items[0],r.items[0].lastEventId));case 9:case"end":return t.stop()}},t,this)}))}},{key:"queryEvents",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){var t,n,r=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=3,this.services.network.get(t);case 3:n=e.sent,n.body.events.forEach(function(e){return r._update(e)});case 5:case"end":return e.stop()}},e,this)}))}},{key:"queryItems",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n,r,i,o,s=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new w.UriBuilder(this.links.items).arg("From",e.from).arg("PageSize",e.limit).arg("Index",e.index).arg("PageToken",e.pageToken).arg("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return r=t.sent,i=r.body.items.map(function(e){return s.cache.store(Number(e.index),new E.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,value:e.data}),e.last_event_id)}),o=r.body.meta,t.abrupt("return",new S.Paginator(i,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 4:case"end":return t.stop()}},t,this)}))}},{key:"getContext",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.context){e.next=2;break}return e.abrupt("return",this.context);case 2:return e.next=4,this.services.network.get(this.links.context);case 4:return t=e.sent,this.context=t.body.data,e.abrupt("return",this.context);case 7:case"end":return e.stop()}},e,this)}))}},{key:"updateContext",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.services.network.post(this.links.context,{data:e});case 3:return this.context=e,this.emit("contextUpdated",e,!0),t.abrupt("return",this);case 8:throw t.prev=8,t.t0=t.catch(0),T.default.error("Failed to update context",t.t0),t.t0;case 12:case"end":return t.stop()}},t,this,[[0,8]])}))}},{key:"removeList",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.onRemoveList(this.sid),e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.emit("collectionRemoved",e),e||this.emit("collectionRemovedRemotely")}},{key:"softSync",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.queryEvents();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),404===e.t0.status?this.onRemoved(!1):T.default.error("Can't get updates for "+this.sid+":",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}))}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e){var t=Number(e.item_index);switch(e.type){case"list_item_added":this._handleItemAdded(t,e.item_url,e.id,e.item_revision,e.item_data);break;case"list_item_updated":this._handleItemUpdated(t,e.item_url,e.id,e.item_revision,e.item_data);break;case"list_item_removed":this._handleItemRemoved(t,e.id);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id);break;case"list_removed":this.onRemoved(!1)}this.lastEventId<e.id&&(this.descriptor.revision=e.list_revision,this.descriptor.last_event_id=e.id)}},{key:"_handleItemAdded",value:function(e,t,n,r,i){if(!this.cache.isKnown(e,n)){var o=new E.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i});this.cache.store(e,o,n),this.emit("itemAdded",o,!1),this.emit("itemAddedRemotely",o)}}},{key:"_handleItemUpdated",value:function(e,t,n,r,i){var o=this.cache.get(e);o||this.shouldIgnoreEvent(e,n)?o&&n>o.lastEventId&&(o.update(n,r,i),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o)):(o=this.cache.store(e,new E.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i}),n),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o))}},{key:"_handleItemRemoved",value:function(e,t){this.cache.delete(e,t),this.emit("itemRemoved",e,!1),this.emit("itemRemovedRemotely",e)}},{key:"_handleContextUpdate",value:function(e,t){this.lastEventId<t&&(this.context=e,this.emit("contextUpdated",e,!1),this.emit("contextUpdatedRemotely",e))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"list"}}],[{key:"type",get:function(){return"list"}}]),t}(C.SyncEntity);n.SyncList=R,Object.defineProperty(n,"__esModule",{value:!0}),n.default=R},{"./cache":192,"./entity":197,"./listitem":199,"./logger":200,"./paginator":203,"./retryingqueue":204,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28}],210:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/helpers/extends"),o=r(i),s=e("babel-runtime/regenerator"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("babel-runtime/helpers/possibleConstructorReturn"),m=r(h),v=e("babel-runtime/helpers/inherits"),g=r(v),y=e("babel-runtime/core-js/promise"),b=r(y),_=function(e,t,n,r){return new(n||(n=b.default))(function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}u((r=r.apply(e,t||[])).next())})},w=e("./utils"),T=e("./logger"),C=e("./entity"),k=e("./retryingqueue"),E=e("./mapitem"),S=e("./paginator"),x=e("./cache"),R=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e));return i.actionQueue=new k.RetryingQueue,i.cache=new x.Cache,i.descriptor=n,i.onRemoveMap=r,i}return(0,g.default)(t,e),(0,p.default)(t,[{key:"_get",value:function(e){return this.queryItems({key:e}).then(function(t){if(t.items.length<1)throw new Error("No item with key "+e+" found");return t.items[0]})}},{key:"__set",value:function(e,t){return this.services.network.post(e,{data:t.data},t.revision).then(function(e){return e=e.body,e.data=t.data,e})}},{key:"_set",value:function(e,t,n){return _(this,void 0,void 0,a.default.mark(function r(){var i,o=this;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n){r.next=2;break}return r.abrupt("return",this.__set(e,{data:t.data}));case 2:return i=function(e){return _(o,void 0,void 0,a.default.mark(function r(){var i;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(412!==e.status){r.next=7;break}return r.next=3,this.queryEvents();case 3:return r.next=5,this.get(t.key);case 5:return i=r.sent,r.abrupt("return",{revision:i.revision,data:n(i.value,t.data)});case 7:throw e;case 8:case"end":return r.stop()}},r,this)}))},r.abrupt("return",this.actionQueue.add(this.__set.bind(this),e,{revision:t.revision,data:t.data},i));case 4:case"end":return r.stop()}},r,this)}))}},{key:"_tryAddOrUpdate",value:function(e,t,n){return _(this,void 0,void 0,a.default.mark(function r(){var i,o,s,u,c;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.services.network.post(e,t);case 3:return i=r.sent,i.body.data=t.data,r.abrupt("return",{added:!0,value:i.body});case 8:if(r.prev=8,r.t0=r.catch(0),409===r.t0.status){r.next=12;break}throw r.t0;case 12:if(o=r.t0.body.links.item,n){r.next=20;break}return r.next=16,this._set(o,t,n);case 16:return s=r.sent,r.abrupt("return",{added:!1,value:s});case 20:return r.next=22,this.services.network.get(o);case 22:return u=r.sent,r.next=25,this._set(o,{key:u.key,revision:u.revision,data:t},n);case 25:return c=r.sent,r.abrupt("return",{added:!1,value:c});case 27:case"end":return r.stop()}},r,this,[[0,8]])}))}},{key:"queryEvents",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){var t,n,r=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.descriptor.links.events+"?From="+(this.lastEventId+1)+"&PageSize=100",e.next=4,this.services.network.get(t);case 4:n=e.sent,n.body.events.forEach(function(e){return r._update(e)}),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),T.default.error("Failed to fetch events:",e.t0),e.t0;case 12:case 13:case"end":return e.stop()}},e,this,[[0,8]])}))}},{key:"getContext",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){var t;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.context){e.next=2;break}return e.abrupt("return",this.context);case 2:return e.next=4,this.services.network.get(this.links.context);case 4:return t=e.sent,this.context=t.body.data,e.abrupt("return",this.context);case 7:case"end":return e.stop()}},e,this)}))}},{key:"updateContext",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.services.network.post(this.links.context,{data:e});case 2:this.context=e,this.emit("contextUpdated",e,!0);case 4:case"end":return t.stop()}},t,this)}))}},{key:"set",value:function(e,t){return this._actualSet(e,t)}},{key:"_actualSet",value:function(e,t,n){return _(this,void 0,void 0,a.default.mark(function r(){var i,o,s,u,c,l,d;return a.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.cache.get(e),!i){r.next=9;break}return o={key:e,data:t,revision:i.revision||void 0},r.next=5,this._set(i.uri,o,n);case 5:return s=r.sent,i.update(s.last_event_id,s.revision,s.data),this.emit("itemUpdated",i,!0),r.abrupt("return",i);case 9:return r.next=11,this._tryAddOrUpdate(this.links.items,{key:e,data:t},n);case 11:return u=r.sent,c=u.added,l=u.value,d={key:l.key,revision:l.revision,lastEventId:l.last_event_id,uri:l.url,value:l.data},r.next=17,this.cache.get(e);case 17:return i=r.sent,i&&d.lastEventId>i.lastEventId?i.update(d.lastEventId,d.revision,d.value):i||(i=this.cache.store(e,new E.MapItem(d),d.lastEventId),c?this.emit("itemAdded",i,!0):this.emit("itemUpdated",i,!0)),r.abrupt("return",i);case 20:case"end":return r.stop()}},r,this)}))}},{key:"get",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cache.has(e)){t.next=2;break}return t.abrupt("return",this.cache.get(e));case 2:return t.next=4,this.queryItems({key:e});case 4:if(n=t.sent,!(n.items.length<1)){t.next=7;break}throw new Error("No item with key "+e+" found");case 7:return t.abrupt("return",n.items[0]);case 8:case"end":return t.stop()}},t,this)}))}},{key:"mutate",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function n(){var r;return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get(e).then(function(e){return e.value}).catch(function(){return{}});case 2:return r=n.sent,n.abrupt("return",this._actualSet(e,t(r),t));case 4:case"end":return n.stop()}},n,this)}))}},{key:"update",value:function(e,t){return _(this,void 0,void 0,a.default.mark(function n(){return a.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.mutate(e,function(e){return(0,o.default)(e,t)}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"remove",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=2;break}throw new Error("Key argument is invalid");case 2:return t.next=4,this.get(e);case 4:return n=t.sent,t.next=7,this.services.network.delete(n.uri);case 7:this.cache.delete(e,n.lastEventId),this.emit("itemRemoved",e,!0);case 9:case"end":return t.stop()}},t,this)}))}},{key:"queryItems",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){var n,r,i,o,s=this;return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},n=new w.UriBuilder(this.links.items).arg("From",e.from).arg("PageSize",e.limit).arg("Key",e.key).arg("PageToken",e.pageToken).arg("Order",e.order).build(),t.next=4,this.services.network.get(n);case 4:return r=t.sent,i=r.body.items.map(function(e){return s.cache.store(e.key,new E.MapItem({key:e.key,uri:e.url,revision:e.revision,lastEventId:e.last_event_id,value:e.data}),e.last_event_id)}),o=r.body.meta,t.abrupt("return",new S.Paginator(i,function(e){return s.queryItems({pageToken:e})},o.previous_token,o.next_token));case 8:case"end":return t.stop()}},t,this)}))}},{key:"getItems",value:function(e){return _(this,void 0,void 0,a.default.mark(function t(){return a.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=e||{},e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",t.abrupt("return",this.queryItems(e));case 4:case"end":return t.stop()}},t,this)}))}},{key:"softSync",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.queryEvents();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),404===e.t0.status?this.onRemoved(!1):T.default.error("Can't get updates for "+this.sid+":",e.t0);case 8:case"end":return e.stop()}},e,this,[[0,5]])}))}},{key:"forEach",value:function(e){var t=this;return new b.default(function(n,r){function i(t){t.items.forEach(function(t){return e(t)}),t.hasNextPage?t.nextPage().then(i).catch(r):n()}t.queryItems().then(i).catch(r)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e){switch(e.type){case"map_item_added":this._handleItemAdded(e.item_key,e.item_url,e.id,e.item_revision,e.item_data);break;case"map_item_updated":this._handleItemUpdated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id);break;case"map_context_updated":this._handleContextUpdate(e.context_data,e.id);break;case"map_removed":this.onRemoved(!1)}this.lastEventId<e.id&&(this.descriptor.revision=e.map_revision,this.descriptor.last_event_id=e.id)}},{key:"_handleItemAdded",value:function(e,t,n,r,i){if(!this.cache.has(e)&&!this.shouldIgnoreEvent(e,n)){var o=new E.MapItem({key:e,uri:t,lastEventId:n,revision:r,value:i});this.cache.store(e,o,n),this.emit("itemAdded",o,!1),this.emit("itemAddedRemotely",o)}}},{key:"_handleItemUpdated",value:function(e,t,n,r,i){var o=this.cache.get(e);o||this.shouldIgnoreEvent(e,n)?o&&n>o.lastEventId&&(o.update(n,r,i),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o)):(o=new E.MapItem({key:e,uri:t,lastEventId:n,revision:r,value:i}),this.cache.store(e,o,n),this.emit("itemUpdated",o,!1),this.emit("itemUpdatedRemotely",o))}},{key:"_handleItemRemoved",value:function(e,t){this.cache.delete(e,t),this.emit("itemRemoved",e,!1),this.emit("itemRemovedRemotely",e,!1)}},{key:"_handleContextUpdate",value:function(e,t){this.lastEventId<t&&(this.context=e,this.emit("contextUpdated",e,!1),this.emit("contextUpdatedRemotely",e))}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.emit("collectionRemoved",e),e||this.emit("collectionRemovedRemotely")}},{key:"removeMap",value:function(){return _(this,void 0,void 0,a.default.mark(function e(){return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.onRemoveMap(this.sid),e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"type",get:function(){return"map"}}],[{key:"type",get:function(){return"map"}}]),t}(C.SyncEntity);n.SyncMap=R,Object.defineProperty(n,"__esModule",{value:!0}),n.default=R},{"./cache":192,"./entity":197,"./logger":200,"./mapitem":201,"./paginator":203,"./retryingqueue":204,"./utils":211,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/extends":23,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28}],211:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return JSON.parse((0,l.default)(e))}var o=e("babel-runtime/helpers/classCallCheck"),s=r(o),a=e("babel-runtime/helpers/createClass"),u=r(a),c=e("babel-runtime/core-js/json/stringify"),l=r(c);n.deepClone=i;var d=function(){function e(t){(0,s.default)(this,e),this.base=t,this.args=new Array,this.paths=new Array}return(0,u.default)(e,[{key:"path",value:function(e){return this.paths.push(e),this}},{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(e+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();n.UriBuilder=d},{"babel-runtime/core-js/json/stringify":4,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],212:[function(e,t,n){t.exports={_args:[[{raw:"twilio-sync@^0.4.2",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.4.2",spec:">=0.4.2 <0.5.0",type:"range"},"/Users/schertkov/workspace/twilio/rtd/js/ipmessaging-js-lib"]],_from:"twilio-sync@>=0.4.2 <0.5.0",_id:"twilio-sync@0.4.2",_inCache:!0,_location:"/twilio-sync",_nodeVersion:"7.5.0",_npmOperationalInternal:{host:"packages-18-east.internal.npmjs.com",tmp:"tmp/twilio-sync-0.4.2.tgz_1487671857135_0.2178721190430224"},_npmUser:{name:"schertkov",email:"schertkov@twilio.com"},_npmVersion:"4.1.2",_phantomChildren:{},_requested:{raw:"twilio-sync@^0.4.2",scope:null,escapedName:"twilio-sync",name:"twilio-sync",rawSpec:"^0.4.2",spec:">=0.4.2 <0.5.0",type:"range"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.4.2.tgz",_shasum:"ef4f1137fa5f1575a4f090a4469498d2fa204856",_shrinkwrap:null,_spec:"twilio-sync@^0.4.2",_where:"/Users/schertkov/workspace/twilio/rtd/js/ipmessaging-js-lib",author:{name:"Twilio"},browser:"browser/index.js",dependencies:{"babel-runtime":"^6.23.0",karibu:"^1.0.1",loglevel:"^1.4.1",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.1.5","twilio-notifications":"^0.3.0","twilio-transport":"^0.1.1",twilsock:"^0.2.2",uuid:"^3.0.1"},description:"Twilio Sync client library",devDependencies:{"@types/chai":"^3.4.34","@types/chai-as-promised":"0.0.29","@types/loglevel":"^1.4.29","@types/mocha":"^2.2.39","@types/node":"^7.0.5","@types/sinon":"^1.16.35","@types/sinon-as-promised":"^4.0.5","@types/sinon-chai":"^2.7.27","async-test-tools":"^1.0.6","babel-cli":"^6.23.0","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0",backoff:"^2.5.0",browserify:"^14.1.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2","event-to-promise":"^0.7.0",gulp:"^3.9.1","gulp-babel":"^6.1.2","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^3.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-tslint":"^7.1.0","gulp-typescript":"^3.1.4","gulp-uglify":"^2.0.1","gulp-util":"^3.0.8","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3",jsonwebtoken:"^7.3.0",karma:"^1.4.1","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0","ts-node":"^2.1.0",tslint:"^4.4.2",twilio:"^3.3.0-edge",typescript:"^2.1.6",underscore:"^1.8.3","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},directories:{},dist:{shasum:"ef4f1137fa5f1575a4f090a4469498d2fa204856",tarball:"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.4.2.tgz"},gitHead:"894388524f3fd61ed39162b4ceae3c8100348f1d",license:"MIT",main:"lib/index.js",maintainers:[{name:"schertkov",email:"schertkov@twilio.com"},{name:"twilio-ci",email:"mroberts+twilio-ci@twilio.com"}],name:"twilio-sync",optionalDependencies:{},readme:"ERROR: No README data found!",scripts:{prepublish:"gulp build",test:"gulp unit-test"},version:"0.4.2"}},{}],213:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e.split("\r\n").map(function(e){return e.split(": ")}).filter(function(e){return 2===e.length&&e[1].length>0}).reduce(function(e,t){return e[t[0]]=t[1],e},{})}function s(e){var t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(t){return e.responseText}}var a=e("babel-runtime/core-js/json/stringify"),u=r(a),c=e("babel-runtime/core-js/promise"),l=r(c),d=e("babel-runtime/core-js/object/define-property"),f=r(d);Object.defineProperty(n,"__esModule",{value:!0});var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,f.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h="undefined"==typeof XMLHttpRequest?e("xmlhttprequest").XMLHttpRequest:XMLHttpRequest,m=function(){function e(){i(this,e)}return p(e,null,[{key:"request",value:function(e,t){return new l.default(function(n,r){var i=new h;i.open(e,t.url,!0),i.onreadystatechange=function(){if(4===i.readyState){var e=o(i.getAllResponseHeaders()),t=s(i);200<=i.status&&i.status<300?n({status:i.status,headers:e,body:t}):r({status:i.status,description:i.statusText,headers:e,body:t})}};for(var a in t.headers)i.setRequestHeader(a,t.headers[a]),"Content-Type"===a&&"application/json"===t.headers[a]&&(t.body=(0,u.default)(t.body));i.send(t.body)})}},{key:"get",value:function(e){return this.request("GET",e)}},{key:"post",value:function(e){return this.request("POST",e)}},{key:"put",value:function(e){return this.request("PUT",e)}},{key:"delete",value:function(e){return this.request("DELETE",e)}}]),e}();n.default=m,t.exports=m,t.exports=n.default},{"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-property":10,"babel-runtime/core-js/promise":15,xmlhttprequest:40}],214:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,D.default)(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,D.default)(t)));e.prototype=(0,P.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(j.default?(0,j.default)(e,t):e.__proto__=t)}function u(e){function t(){var t=(0,A.default)(e,(0,x.default)(arguments));return(0,j.default)(t,(0,E.default)(this)),t}return t.prototype=(0,P.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),j.default?(0,j.default)(t,e):t.__proto__=e,t}function c(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var n={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7]};if(n.search.length>0){var r=n.search.substring(1);n.params=r.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return n}throw new Error("Incorrect URI: "+e)}function l(e,t){var n=c(t),r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}function d(e,t,n,r){return{to:l(e,t),headers:n,body:r}}function f(e){return{status:e.status,headers:e.header.http_headers,body:e.body}}function p(e,t,n){return{url:e,headers:t,body:n}}function h(e){try{e.body=JSON.parse(e.body)}catch(e){}return e}function m(e){for(var t=(0,C.default)(e.headers),n=t.length,r={};n--;){var i=t[n];r[i.toLowerCase()]=e.headers[i]}return e.headers=r,e}var v=e("babel-runtime/core-js/promise"),g=r(v),y=e("babel-runtime/core-js/map"),b=r(y),_=e("babel-runtime/core-js/object/define-properties"),w=r(_),T=e("babel-runtime/core-js/object/keys"),C=r(T),k=e("babel-runtime/core-js/object/get-prototype-of"),E=r(k),S=e("babel-runtime/core-js/array/from"),x=r(S),R=e("babel-runtime/core-js/reflect/construct"),A=r(R),I=e("babel-runtime/core-js/object/set-prototype-of"),j=r(I),O=e("babel-runtime/core-js/object/create"),P=r(O),N=e("babel-runtime/helpers/typeof"),D=r(N),M=e("babel-runtime/core-js/object/define-property"),U=r(M);Object.defineProperty(n,"__esModule",{value:!0}),n.TwilsockUnavailableError=n.Transport=void 0;var L=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,U.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),F=e("./httprequest"),$=i(F),X=function(e){function t(){return o(this,t),s(this,(t.__proto__||(0,E.default)(t)).call(this))}return a(t,e),t}(u(Error)),q=function(){function e(t){var n=this;o(this,e),(0,w.default)(this,{_activeGetRequests:{value:new b.default},_twilsock:{value:t},_http:{value:$.default},_twilsockIsAvailable:{get:function(){return n._twilsock&&n._twilsock.isConnected}}}),t&&t.connect()}return L(e,[{key:"get",value:function(e,t,n){var r=this;if(this._activeGetRequests.has(e))return this._activeGetRequests.get(e);var i=this._get(e,t,n).then(function(t){return r._activeGetRequests.delete(e),t}).catch(function(t){throw r._activeGetRequests.delete(e),t});return this._activeGetRequests.set(e,i),i}},{key:"_oneOfBasedOnChannelAvailability",value:function(e,t){var n=this;return function(e){var r=e.sendViaTwilsock,i=e.sendDirectHttp;return n._twilsockIsAvailable?r():t?g.default.reject(new X):i()}(e).then(m)}},{key:"_get",value:function(e,t,n){var r=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return r._twilsock.send(d("GET",e,t)).then(f)},sendDirectHttp:function(){return r._http.get(p(e,t)).then(h)}},n)}},{key:"post",value:function(e,t,n,r){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(d("POST",e,t,n)).then(f)},sendDirectHttp:function(){return i._http.post(p(e,t,n)).then(h)}},r)}},{key:"put",value:function(e,t,n,r){var i=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return i._twilsock.send(d("PUT",e,t,n)).then(f)},sendDirectHttp:function(){return i._http.put(p(e,t,n)).then(h)}},r)}},{key:"delete",value:function(e,t,n){var r=this;return this._oneOfBasedOnChannelAvailability({sendViaTwilsock:function(){return r._twilsock.send(d("DELETE",e,t)).then(f)},sendDirectHttp:function(){return r._http.delete(p(e,t)).then(h)}},n)}}]),e}();n.default=q,n.Transport=q,n.TwilsockUnavailableError=X},{"./httprequest":213,"babel-runtime/core-js/array/from":1,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/create":8,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/define-property":10,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/object/keys":13,"babel-runtime/core-js/object/set-prototype-of":14,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/reflect/construct":16,"babel-runtime/helpers/typeof":27}],215:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/freeze"),o=r(i),s=e("babel-runtime/core-js/set"),a=r(s),u=e("babel-runtime/core-js/promise"),c=r(u),l=e("babel-runtime/core-js/map"),d=r(l),f=e("babel-runtime/core-js/object/define-properties"),p=r(f),h=e("babel-runtime/core-js/object/get-prototype-of"),m=r(h),v=e("babel-runtime/helpers/classCallCheck"),g=r(v),y=e("babel-runtime/helpers/createClass"),b=r(y),_=e("babel-runtime/helpers/possibleConstructorReturn"),w=r(_),T=e("babel-runtime/helpers/inherits"),C=r(T),k=e("events"),E=r(k),S=e("./logger"),x=r(S),R=e("uuid"),A=r(R),I=e("./configuration"),j=r(I),O=e("./twilsock"),P=r(O),N=e("./packetinterface"),D=r(N),M=function(e){function t(e,n){(0,g.default)(this,t);var r=(0,w.default)(this,(t.__proto__||(0,m.default)(t)).call(this));n=n||{},n.logLevel=n.logLevel||"error",x.default.setLevel(n.logLevel);var i=new j.default(e,n),o=new P.default(i),s=new D.default(o);return(0,p.default)(r,{_config:{value:i},_socket:{value:o},_packet:{value:s},_registrations:{value:new d.default},_registrationsInProgress:{value:new d.default},isConnected:{get:function(){return r._socket.isConnected}},connected:{get:function(){return r._socket.isConnected}},state:{get:function(){return r._socket.state}}}),r._socket.on("message",function(e,t){return setTimeout(function(){r.emit("message",e,t)},0)}),r._socket.on("connected",function(){return r._updateRegistrations()}),r._socket.on("connected",function(e){return r.emit("connected",e)}),r._socket.on("disconnected",function(){return r.emit("disconnected")}),r._socket.on("stateChanged",function(e){return r.emit("stateChanged",e)}),r}return(0,C.default)(t,e),(0,b.default)(t,[{key:"send",value:function(e){return this._packet.send(e.to,e.headers,e.body)}},{key:"updateToken",value:function(e){var t=this;return x.default.info("updateToken"),this._config.token===e?c.default.resolve():(this._config.updateToken(e),this._socket.disconnect().then(function(){return t._socket.connect()}),c.default.resolve())}},{key:"_updateRegistration",value:function(e,t){var n=this;x.default.info("update registration for context",e);var r=this._registrationsInProgress.get(e);r||(r=new a.default,this._registrationsInProgress.set(e,r));var i=A.default.v4();return r.add(i),this._packet.putNotificationContext(e,t).then(function(){x.default.info("registration attempt succeeded for context",t),r.delete(i),0===r.size&&(n._registrationsInProgress.delete(e),n.emit("registered",e))}).catch(function(o){x.default.info("registration attempt failed for context",t),x.default.debug(o),r.delete(i),0===r.size&&(n._registrationsInProgress.delete(e),n.emit("registrationFailed",e,o))})}},{key:"_updateRegistrations",value:function(){var e=this;x.default.info("refreshing all registrations"),this._registrations.forEach(function(t,n){e._updateRegistration(n,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new Error("Invalid arguments provided");this._registrations.set(e,t),this._socket.isConnected&&this._updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(e){this._registrations.has(e)&&(this._registrations.delete(e),this._socket.isConnected&&this._packet.deleteNotificationContext(e))}},{key:"connect",value:function(){return this._socket.connect()}},{key:"disconnect",value:function(){return this._socket.disconnect()}}]),t}(E.default);n.default=M,(0,o.default)(M),t.exports=n.default},{"./configuration":216,"./logger":218,"./packetinterface":219,"./twilsock":220,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/core-js/set":17,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,uuid:224}],216:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l="wss://tsock.twilio.com",d="/v2/wsconnect",f=function(){function e(t,n){var r=this;(0,a.default)(this,e),n=n||{};var i=n.Twilsock||{},s=i.uri||n.wsServer||l;(0,o.default)(this,{_twilsockWsHost:{value:s+d},_token:{value:t,writable:!0},twilsockUri:{get:function(){return r._twilsockWsHost}},token:{get:function(){return r._token}}})}return(0,c.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();n.default=f,t.exports=n.default},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],217:[function(e,t,n){arguments[4][187][0].apply(n,arguments)},{"./client":215,dup:187}],218:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,s.default)(t))}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/array/from"),s=r(o),a=e("loglevel"),u=r(a);n.default={setLevel:function(e){u.default.setLevel(e)},trace:function(){u.default.trace.apply(null,i("Twilsock T:",arguments))},debug:function(){u.default.debug.apply(null,i("Twilsock D:",arguments))},info:function(){u.default.info.apply(null,i("Twilsock I:",arguments))},warn:function(){u.default.warn.apply(null,i("Twilsock W:",arguments))},error:function(){u.default.error.apply(null,i("Twilsock E:",arguments))}},t.exports=n.default},{"babel-runtime/core-js/array/from":1,loglevel:172}],219:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return e>=200&&e<300}function o(e){return e&&e.header&&e.header.http_status}Object.defineProperty(n,"__esModule",{value:!0});var s=e("babel-runtime/core-js/promise"),a=r(s),u=e("babel-runtime/core-js/map"),c=r(u),l=e("babel-runtime/core-js/object/define-properties"),d=r(l),f=e("babel-runtime/helpers/classCallCheck"),p=r(f),h=e("babel-runtime/helpers/createClass"),m=r(h),v=e("./logger"),g=r(v),y=3e4,b=function(){function e(t){var n=this;(0,p.default)(this,e),(0,d.default)(this,{_activeRequests:{value:new c.default},_socket:{value:t}}),this._socket.on("reply",this._processReply.bind(this)),this._socket.on("disconnected",function(){n._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock disconnected"))}),n._activeRequests.clear()})}return(0,m.default)(e,[{key:"_processReply",value:function(e){var t=this._activeRequests.get(e.id);t&&(clearTimeout(t.timeout),this._activeRequests.delete(e.id),setTimeout(function(){i(e.status.code)?o(e)&&!i(e.header.http_status.code)?t.reject({status:e.header.http_status.code,description:e.header.http_status.status,body:e.body}):t.resolve(e):t.reject(new Error("Transport failure: "+e.status.status))},0))}},{key:"_storeRequest",value:function(e,t,n){var r={resolve:t,reject:n,timeout:setTimeout(function(){g.default.debug("request",e,"is timed out"),n(new Error("Twilsock: request timeout: "+e))},y)};this._activeRequests.set(e,r)}},{key:"send",value:function(e,t,n){var r=this;return new a.default(function(i,o){var s=r._socket.sendUpstreamMessage(e,t,n);g.default.trace("message sent: ",{id:s,address:e,headers:t,body:n}),r._storeRequest(s,i,o)})}},{key:"putNotificationContext",value:function(e,t){var n=this;return new a.default(function(r,i){var o={method:"put_notification_ctx",notification_ctx_id:e},s=n._socket.send(o,t);n._storeRequest(s,r,i)})}},{key:"deleteNotificationContext",value:function(e){var t=this;return new a.default(function(n,r){var i={method:"delete_notification_ctx",notification_ctx_id:e},o=t._socket.send(i);t._storeRequest(o,n,r)})}},{key:"shutdown",value:function(){this._activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new Error("Twilsock: request cancelled by user"))}),this._activeRequests.clear()}}]),e}();n.default=b,t.exports=n.default},{"./logger":218,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],220:[function(e,t,r){(function(n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function s(e){var t=encodeURIComponent(e),n=t.replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),r=new Uint8Array(n.length);return Array.prototype.forEach.call(n,function(e,t){r[t]=e.charCodeAt(0)}),r}function a(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join(""),n=t.replace(/(.)/g,function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(n)}function u(e){for(var t="",n=0;n<e.length;++n){var r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}var i=t.split(" ");return{size:n,protocol:i[0],version:i[1],headerSize:Number(i[2])}}function c(e){switch(void 0===e?"undefined":(0,I.default)(e)){case"undefined":return"";case"object":return(0,R.default)(e);default:return e}}function l(e){var t=a(e);try{return JSON.parse(t)}catch(e){throw N.default.error("failed to parse input: ",t),e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("babel-runtime/core-js/object/freeze"),f=i(d),p=e("babel-runtime/core-js/promise"),h=i(p),m=e("babel-runtime/core-js/object/define-properties"),v=i(m),g=e("babel-runtime/core-js/object/get-prototype-of"),y=i(g),b=e("babel-runtime/helpers/classCallCheck"),_=i(b),w=e("babel-runtime/helpers/createClass"),T=i(w),C=e("babel-runtime/helpers/possibleConstructorReturn"),k=i(C),E=e("babel-runtime/helpers/inherits"),S=i(E),x=e("babel-runtime/core-js/json/stringify"),R=i(x),A=e("babel-runtime/helpers/typeof"),I=i(A),j=e("events"),O=i(j),P=e("./logger"),N=i(P),D=e("uuid"),M=i(D),U=e("backoff"),L=i(U),F=e("javascript-state-machine"),$=i(F),X=n.WebSocket||n.MozWebSocket||e("ws"),q=5e3,H=43e3,B=function(e){function t(e){var n=arguments;(0,_.default)(this,t);var r=(0,k.default)(this,(t.__proto__||(0,y.default)(t)).call(this)),i=L.default.exponential({randomisationFactor:.2,initialDelay:2e3,maxDelay:12e4});return i.on("ready",function(){r._retry()}),(0,v.default)(r,{_config:{value:e},_transportReady:{value:!1,writable:!0},_disconnectedPromiseResolve:{value:null,writable:!0},_backoff:{value:i},_fsm:{value:null,writable:!0},_watchTimer:{value:null,writable:!0},_timestamp:{value:0,writable:!0},_socket:{value:null,writable:!0},_activeToken:{value:null,writable:!0},activeToken:{enumerable:!0,get:function(){return r._activeToken}},state:{enumberable:!0,get:function(){return r._getState()}},isConnected:{enumberable:!0,get:function(){return r._isConnected()}}}),r._fsm=$.default.create({initial:"disconnected",events:[{name:"userConnect",from:["error","disconnected"],to:"connecting"},{name:"userDisconnect",from:["connecting","connected","retrying"],to:"disconnecting"},{name:"userDisconnect",from:["rejected"],to:"disconnected"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"connected"},{name:"socketClosed",from:["connecting","connected","error"],to:"retrying"},{name:"socketError",from:["connected"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketRejected",from:["connecting","connected"],to:"disconnecting"},{name:"tokenRejected",from:["connecting","connected"],to:"rejected"},{name:"evUnsupported",from:["connecting"],to:"unsupported"},{name:"evUnsupported",from:["connected"],to:"error"},{name:"protocolError",from:["connecting","connected"],to:"error"}],callbacks:{onconnecting:function(){r._startWatchdogTimer(),r._setupSocket(),r.emit("connecting")},onretrying:function(){r._initRetry(),r.emit("connecting")},onenterconnected:r._onConnected.bind(r),onuserDisconnect:function(){r._closeSocket()},ondisconnected:function(){return r._finalizeSocket()},onsocketRejected:function(){var e=Array.prototype.slice.call(n,3,n.length);r._onSocketRejected(e)},onunsupported:function(){r._closeSocket(),r._finalizeSocket()},onrejected:function(){r._closeSocket(),r._finalizeSocket()},onerror:function(){r._closeSocket(),r._finalizeSocket()},onenterstate:function(){r.emit("stateChanged",r.state)}},error:function(){N.default.trace("FSM: unexpected transition",arguments)}}),r}return(0,S.default)(t,e),(0,T.default)(t,[{key:"_isConnected",value:function(){return this.state===t.state.CONNECTED&&this._socket&&1===this._socket.readyState}},{key:"_getState",value:function(){if(!this._fsm)return t.state.DISCONNECTED;switch(this._fsm.current){case"connecting":case"retrying":return t.state.CONNECTING;case"connected":return t.state.CONNECTED;case"rejected":return t.state.REJECTED;case"disconnecting":return t.state.DISCONNECTING;case"disconnected":case"error":default:return t.state.DISCONNECTED}}},{key:"_initRetry",value:function(){this._backoff.backoff()}},{key:"_retry",value:function(){this._socket=null,this._activeToken=null,this._fsm.userRetry()}},{key:"_onConnected",value:function(){this._backoff.reset(),this.emit("connected",this._wschannelUrl)}},{key:"_finalizeSocket",value:function(){if(this._stopWatchdogTimer(),this._onDisconnected(),this._disconnectedPromiseResolve){var e=this._disconnectedPromiseResolve;this._disconnectedPromiseResolve=null,e()}}},{key:"_onDisconnected",value:function(){this._backoff.reset(),this._wschannelUrl=null,this._socket=null,this._activeToken=null,this.emit("disconnected")}},{key:"_setupSocket",value:function(){var e=this,t=this._config.token,n=this._config.twilsockUri+"?token="+encodeURIComponent(t),r=new X(n);r.binaryType="arraybuffer",r.onopen=function(){N.default.info("socket opened")},r.onclose=function(t){N.default.info("socket closed",t),e._fsm.socketClosed()},r.onerror=function(e){N.default.error("error: ",e)},r.onmessage=function(t){N.default.trace("data: ",t.data);var n=2,r=new Uint8Array(t.data),i=u(r);if("TWILSOCK"!==i.protocol||"V1.0"!==i.version)return N.default.error("unsupported protocol: "+i.protocol+" ver "+i.version),void e._fsm.evUnsupported("Unsupported protocol");var o=null;try{o=l(r.subarray(i.size,i.size+i.headerSize))}catch(n){return N.default.error("failed to parse message header",n,t),void e._fsm.protocolError()}N.default.trace("message received: ",o);var s=null;if(o.payload_size>0){var c=n+i.size+i.headerSize,d=o.payload_size;if(o.hasOwnProperty("payload_type")&&0!==o.payload_type.indexOf("application/json"))0===o.payload_type.indexOf("text/plain")&&(s=a(r.subarray(c,c+d)));else try{s=l(r.subarray(c,c+d))}catch(n){return N.default.error("failed to parse message body",n,t),void e._fsm.protocolError()}}e._updateActivityTimestamp(),"ready"===o.method?(N.default.trace("ready",s),e._wschannelUrl=s.wschannel_url,e._confirmReceiving(o),e._fsm.socketConnected()):"notification"===o.method?(e._confirmReceiving(o),e.emit("message",o.message_type,s)):"reply"===o.method?e.emit("reply",{id:o.id,status:o.status,header:o,body:s}):"ping"===o.method?e._confirmReceiving(o):"close"===o.method&&(N.default.trace("connection close initated by server"),e._confirmReceiving(o),!s||401!==s.code&&410!==s.code?e._fsm.socketRejected(s):e._fsm.tokenRejected(s))},this._activeToken=t,this._socket=r}},{key:"_confirmReceiving",value:function(e){var t={method:"reply",id:e.id,payload_type:"application/json",status:{code:200,status:"OK"}};try{this._sendPacket(t)}catch(e){N.default.debug("failed to confirm packet receiving",e)}}},{key:"_sendPacket",value:function(e,t){var n=c(t);e.payload_size=o(n);var r=(0,R.default)(e)+"\r\n",i="TWILSOCK V1.0 "+(o(r)-2)+"\r\n",a=s(i+r+n);try{this._socket.send(a.buffer)}catch(t){throw N.default.info("failed to send ",e,t),N.default.info(t.stack),t}}},{key:"_cancelRetryAttempt",value:function(){this._backoff.reset()}},{key:"_closeSocket",value:function(){this._cancelRetryAttempt(),this._socket&&(this._socket.onopen=null,this._socket.onclose=null,this._socket.onerror=null,this._socket.onmessage=null,this._socket.close()),this._fsm.socketClosed()}},{key:"connect",value:function(){this._fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return this._fsm.is("disconnected")?h.default.resolve():new h.default(function(t){e._disconnectedPromiseResolve=t,e._fsm.userDisconnect()})}},{key:"sendUpstreamMessage",value:function(e,t,n){var r=M.default.v4(),i={host:e.host,path:e.path,method:e.method};e.hasOwnProperty("params")&&(i.params=e.params);var o={method:"message",id:r,http_header:i};return t&&(o.http_header.headers=t),t&&t.hasOwnProperty("Content-Type")&&(o.payload_type=t["Content-Type"]),this._sendPacket(o,n),r}},{key:"send",value:function(e,t){return e.id=e.id||M.default.v4(),this._sendPacket(e,t),e.id}},{key:"_onSocketRejected",value:function(e){N.default.error("connection closed by server",e),this._closeSocket()}},{key:"_startWatchdogTimer",value:function(){var e=this;this._timestamp=Date.now(),this._watchTimer=setInterval(function(){Date.now()-e._timestamp>H&&e._socket&&e._socket.close()},q)}},{key:"_stopWatchdogTimer",value:function(){clearInterval(this._watchTimer)}},{key:"_updateActivityTimestamp",value:function(){this._timestamp=Date.now()}}]),t}(O.default);r.default=B,B.state={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",ERROR:"error",REJECTED:"rejected"},(0,f.default)(B.state),(0,f.default)(B),t.exports=r.default}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":218,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/helpers/typeof":27,backoff:29,events:169,"javascript-state-machine":170,uuid:224,ws:40}],221:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],222:[function(e,t,n){t.exports=function(e){return e&&"object"===(void 0===e?"undefined":u(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],223:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(t)?n.showHidden=t:t&&r._extend(n,t),T(n.showHidden)&&(n.showHidden=!1),T(n.depth)&&(n.depth=2),T(n.colors)&&(n.colors=!1),T(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),c(n,e,n.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,t,n){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return _(i)||(i=c(e,i,n)),i}var o=l(e,t);if(o)return o;var s=Object.keys(t),u=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),S(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(x(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(C(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return d(t)}var g="",y=!1,b=["{","}"];if(m(t)&&(y=!0,b=["[","]"]),x(t)){g=" [Function"+(t.name?": "+t.name:"")+"]"}if(C(t)&&(g=" "+RegExp.prototype.toString.call(t)),E(t)&&(g=" "+Date.prototype.toUTCString.call(t)),S(t)&&(g=" "+d(t)),0===s.length&&(!y||0==t.length))return b[0]+g+b[1];if(n<0)return C(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=y?f(e,t,n,u,s):s.map(function(r){return p(e,t,n,u,r,y)}),e.seen.pop(),h(w,g,b)}function l(e,t){if(T(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return b(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)I(t,String(s))?o.push(p(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))}),o}function p(e,t,n,r,i,o){var s,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=g(n)?c(e,u.value,null):c(e,u.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),T(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function m(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function g(e){return null===e}function y(e){return null==e}function b(e){return"number"==typeof e}function _(e){return"string"==typeof e}function w(e){return"symbol"===(void 0===e?"undefined":u(e))}function T(e){return void 0===e}function C(e){return k(e)&&"[object RegExp]"===A(e)}function k(e){return"object"===(void 0===e?"undefined":u(e))&&null!==e}function E(e){return k(e)&&"[object Date]"===A(e)}function S(e){return k(e)&&("[object Error]"===A(e)||e instanceof Error)}function x(e){return"function"==typeof e}function R(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":u(e))||void 0===e}function A(e){return Object.prototype.toString.call(e)}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var j=/%[sdj%]/g;r.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(j,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])s+=g(a)||!k(a)?" "+a:" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation,s=!0}return e.apply(this,arguments)}if(T(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var O,P={};r.debuglog=function(e){if(T(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!P[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){t.pid;P[e]=function(){r.format.apply(r,arguments)}}else P[e]=function(){};return P[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=m,r.isBoolean=v,r.isNull=g,r.isNullOrUndefined=y,r.isNumber=b,r.isString=_,r.isSymbol=w,r.isUndefined=T,r.isRegExp=C,r.isObject=k,r.isDate=E,r.isError=S,r.isFunction=x,r.isPrimitive=R,r.isBuffer=e("./support/isBuffer");r.log=function(){},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!k(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":222,_process:178,inherits:221}],224:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":227,"./v4":228}],225:[function(e,t,n){function r(e,t){var n=t||0,r=i;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}for(var i=[],o=0;o<256;++o)i[o]=(o+256).toString(16).substr(1);t.exports=r},{}],226:[function(e,t,r){(function(e){var n,r=e.crypto||e.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var o=new Array(16);n=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=n}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],227:[function(e,t,n){function r(e,t,n){var r=t&&n||0,i=t||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:u,d=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:l+1,p=d-c+(f-l)/1e4;if(p<0&&void 0===e.clockseq&&(s=s+1&16383),(p<0||d>c)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=d,l=f,u=s,d+=122192928e5;var h=(1e4*(268435455&d)+f)%4294967296;i[r++]=h>>>24&255,i[r++]=h>>>16&255,i[r++]=h>>>8&255,i[r++]=255&h;var m=d/4294967296*1e4&268435455;i[r++]=m>>>8&255,i[r++]=255&m,i[r++]=m>>>24&15|16,i[r++]=m>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var v=e.node||a,g=0;g<6;++g)i[r+g]=v[g];return t?t:o(i)}var i=e("./lib/rng"),o=e("./lib/bytesToUuid"),s=i(),a=[1|s[0],s[1],s[2],s[3],s[4],s[5]],u=16383&(s[6]<<8|s[7]),c=0,l=0;t.exports=r},{"./lib/bytesToUuid":225,"./lib/rng":226}],228:[function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}var i=e("./lib/rng"),o=e("./lib/bytesToUuid");t.exports=r},{"./lib/bytesToUuid":225,"./lib/rng":226}],229:[function(e,t,n){t.exports={name:"twilio-chat",version:"0.12.0",description:"A library for Twilio IP messaging",main:"lib/index.js",author:"Twilio",license:"MIT",dependencies:{"babel-runtime":"^6.18.0",backoff:"^2.5.0",durational:"^1.1.0",loglevel:"^1.4.1",platform:"^1.3.3",rfc6902:"^1.3.0","twilio-ems-client":"^0.1.5","twilio-notifications":"^0.3.0","twilio-sync":"^0.4.2","twilio-transport":"^0.1.1",twilsock:"^0.2.2",uuid:"^3.0.1"},devDependencies:{async:"^2.1.4","async-test-tools":"^1.0.6","babel-eslint":"^7.1.1","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-transform-async-to-generator":"^6.22.0","babel-plugin-transform-object-assign":"^6.22.0","babel-plugin-transform-runtime":"^6.22.0","babel-preset-es2015":"^6.22.0","babel-runtime":"^6.22.0",babelify:"^7.3.0",browserify:"^14.0.0","browserify-replace":"^0.9.0",chai:"^3.5.0","chai-as-promised":"^6.0.0",cheerio:"^0.22.0",del:"^2.2.2","event-to-promise":"^0.7.0",express:"^4.14.1",gulp:"^3.9.1","gulp-derequire":"^2.1.0","gulp-eslint":"^3.0.1","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.1","gulp-mocha":"^3.0.1","gulp-rename":"^1.2.2","gulp-replace":"^0.5.4","gulp-tap":"^0.1.3","gulp-uglify":"^2.0.1","ink-docstrap":"^1.3.0",isparta:"^4.0.0",jsdoc:"^3.4.3","jsdoc-strip-async-await":"^0.1.0",karma:"^1.4.1","karma-browserify":"^5.1.1","karma-browserstack-launcher":"^1.2.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.2","karma-sinon-ie":"^2.0.0","loglevel-message-prefix":"^2.0.1","mocha.parallel":"^0.14.0",proxyquire:"^1.7.11","run-sequence":"^1.2.2",sinon:"^1.17.7","sinon-as-promised":"^4.0.2","sinon-chai":"^2.8.0",twilio:"^2.11.1","vinyl-buffer":"^1.0.0","vinyl-source-stream":"^1.1.0",watchify:"^3.9.0"},engines:{node:">=6"}}},{}],230:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){try{return new Date(e)}catch(e){return null}}function o(e){switch(e){case"notParticipating":return"known";default:return e}}var s=e("babel-runtime/core-js/object/freeze"),a=r(s),u=e("babel-runtime/core-js/get-iterator"),c=r(u),l=e("babel-runtime/core-js/promise"),d=r(l),f=e("babel-runtime/core-js/object/define-properties"),p=r(f),h=e("babel-runtime/core-js/map"),m=r(h),v=e("babel-runtime/core-js/json/stringify"),g=r(v),y=e("babel-runtime/core-js/object/get-prototype-of"),b=r(y),_=e("babel-runtime/helpers/classCallCheck"),w=r(_),T=e("babel-runtime/helpers/createClass"),C=r(T),k=e("babel-runtime/helpers/possibleConstructorReturn"),E=r(k),S=e("babel-runtime/helpers/inherits"),x=r(S),R=e("events").EventEmitter,A=e("./data/members"),I=e("./member"),j=e("./data/messages"),O=e("./logger"),P=e("./util").isDeepEqual,N=e("./util").UriBuilder,D={attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",name:"friendlyName",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"},M=function(e){function t(e,n,r){(0,w.default)(this,t);var o=(0,E.default)(this,(t.__proto__||(0,b.default)(t)).call(this)),s=n.attributes||{},a=n.createdBy,u=i(n.dateCreated),c=i(n.dateUpdated),l=n.name||n.friendlyName||null,d=void 0!==n.lastConsumedMessageIndex?n.lastConsumedMessageIndex:null,f="known",h=n.type||t.type.PUBLIC,v=n.uniqueName||null,y=n.channel;n.isPrivate&&(h=t.type.PRIVATE);try{(0,g.default)(s)}catch(e){throw new Error("Attributes must be a valid JSON object.")}var _=new m.default,T=new A(o,e.session,e.userInfos,_);T.on("memberJoined",o.emit.bind(o,"memberJoined")),T.on("memberLeft",o.emit.bind(o,"memberLeft")),T.on("memberUpdated",o.emit.bind(o,"memberUpdated")),T.on("memberInfoUpdated",o.emit.bind(o,"memberInfoUpdated"));var C=[],k=new j(o,e.session,C);return k.on("messageAdded",function(e){return o._onMessageAdded(e)}),k.on("messageUpdated",o.emit.bind(o,"messageUpdated")),k.on("messageRemoved",o.emit.bind(o,"messageRemoved")),(0,p.default)(o,{_attributes:{get:function(){return s},set:function(e){return s=e}},_createdBy:{get:function(){return a},set:function(e){return a=e}},_dateCreated:{get:function(){return u},set:function(e){return u=e}},_dateUpdated:{get:function(){return c},set:function(e){return c=e}},_friendlyName:{get:function(){return l},set:function(e){return l=e}},_lastConsumedMessageIndex:{get:function(){return d},set:function(e){return d=e}},_type:{get:function(){return h},set:function(e){return h=e}},_sid:{get:function(){return r},set:function(e){return r=e}},_status:{get:function(){return f},set:function(e){return f=e}},_uniqueName:{get:function(){return v},set:function(e){return v=e}},_entityPromise:{value:null,writable:!0},_subscribePromise:{value:null,writable:!0},_membersEntity:{value:T},_messagesEntity:{value:k},_services:{value:e},_session:{value:e.session},_typingIndicator:{value:e.typingIndicator},_consumptionHorizon:{value:e.consumptionHorizon},_entityName:{value:y,writable:!0},_members:{value:_},_messages:{value:C},attributes:{enumerable:!0,get:function(){return s}},createdBy:{enumerable:!0,get:function(){return a}},dateCreated:{enumerable:!0,get:function(){return u}},dateUpdated:{enumerable:!0,get:function(){return c}},friendlyName:{enumerable:!0,get:function(){return l}},isPrivate:{enumerable:!0,get:function(){return o._type===t.type.PRIVATE}},lastConsumedMessageIndex:{enumerable:!0,get:function(){return d}},sid:{enumerable:!0,get:function(){return r}},status:{enumerable:!0,get:function(){return f}},type:{enumerable:!0,get:function(){return h}},uniqueName:{enumerable:!0,get:function(){return v}}}),o}return(0,x.default)(t,e),(0,C.default)(t,[{key:"_subscribe",value:function(){var e=this;return this._entityPromise?this._entityPromise:(this._entityPromise=this._session.datasync.document({uniqueName:this._entityName,mode:"open"}).then(function(t){return e._entity=t,t.on("updated",function(t){return e._update(t)}),e._update(t.value),e._entity}).catch(function(t){throw e._enityPromise=null,O.error("Failed to get channel object",t),t}),this._entityPromise)}},{key:"_subscribeStreams",value:function(){var e=this;return this._subscribePromise=this._subscribePromise||this._subscribe().then(function(t){var n=t.value.messages,r=t.value.roster;return d.default.all([e._messagesEntity.subscribe(n),e._membersEntity.subscribe(r)])}).then(function(){return e._entity}).catch(function(t){throw e._subscribePromise=null,O.error("Failed to subscribe on channel objects",e.sid,t),t}),this._subscribePromise}},{key:"_fetch",value:function(){return this._session.datasync.document({uniqueName:this._entityName,mode:"open"}).then(function(e){return e.value})}},{key:"_unsubscribe",value:function(){var e=[];return this._entityPromise&&e.push(this._entity.close()),e.push(this._membersEntity.unsubscribe()),e.push(this._messagesEntity.unsubscribe()),this._entityPromise=null,this._subscribePromise=null,d.default.all(e)}},{key:"_setStatus",value:function(e){this._status!==e&&(this._status=e,e===t.status.JOINED?this._subscribeStreams():e===t.status.INVITED?this._subscribe():this._entityPromise&&this._unsubscribe())}},{key:"_update",value:function(e){t._preprocessUpdate(e,this._sid);var n=!1;for(var r in e){var i=D[r];i&&(i===D.status?this._status=o(e.status):i===D.attributes?P(this._attributes,e.attributes)||(this._attributes=e.attributes,n=!0):e[r]instanceof Date?this[i]&&this[i].getTime()===e[r].getTime()||(this["_"+i]=e[r],n=!0):this[i]!==e[r]&&(this["_"+i]=e[r],n=!0))}e.status||e.uniqueName||this._uniqueName&&(this._uniqueName=null,n=!0),n&&this.emit("updated",this)}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,c.default)(this._members.values());!(t=(i=o.next()).done);t=!0){var s=i.value;if(s.identity===e.author){s._endTyping();break}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.emit("messageAdded",e)}},{key:"add",value:function(e){return e&&"string"==typeof e?this._membersEntity.add(e):d.default.reject(new Error("Channel.add requires an <String>identity parameter"))}},{key:"advanceLastConsumedMessageIndex",value:function(e){var t=this;if(parseInt(e)!==e){return d.default.reject(new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter"))}return null!==this.lastConsumedMessageIndex&&e<=this.lastConsumedMessageIndex?d.default.resolve():this._subscribeStreams().then(function(){t._consumptionHorizon.advanceLastConsumedMessageIndexForChannel(t.sid,e)}).then(function(){return t})}},{key:"decline",value:function(){var e=this;return this._session.addCommand("declineInvitation",{channelSid:this._sid}).then(function(){return e})}},{key:"delete",value:function(){var e=this;return this._session.addCommand("destroyChannel",{channelSid:this._sid}).then(function(){return e})}},{key:"getAttributes",value:function(){var e=this;return this._entityPromise?this._subscribe().then(function(){return e.attributes}):this._fetch().then(function(t){return e._update(t),e.attributes})}},{key:"getMessages",value:function(e,t,n){var r=this;return this._subscribeStreams().then(function(){return r._messagesEntity.getMessages(e,t,n)})}},{key:"getMembers",value:function(){var e=this;return this._subscribeStreams().then(function(){return e._membersEntity.getMembers()})}},{key:"getMembersCount",value:function(){var e=this;return this._session.getSessionLinks().then(function(t){return new N(t.publicChannelsUrl).path(e.sid).build()}).then(function(t){return e._services.network.get(t)}).then(function(e){return e.body.members_count})}},{key:"getMessagesCount",value:function(){var e=this;return this._session.getSessionLinks().then(function(t){return new N(t.publicChannelsUrl).path(e.sid).build()}).then(function(t){return e._services.network.get(t)}).then(function(e){return e.body.messages_count})}},{key:"getUnconsumedMessagesCount",value:function(){var e=this;return this._session.getSessionLinks().then(function(t){return new N(t.myChannelsUrl).arg("ChannelSid",e.sid).build()}).then(function(t){return e._services.network.get(t)}).then(function(e){return e.body.channels.length?e.body.channels[0].unread_messages_count||0:d.default.reject(new Error("Channel is not in user channels list"))})}},{key:"invite",value:function(e){return"string"==typeof e&&e.length?this._membersEntity.invite(e):d.default.reject(new Error("Channel.invite requires an <String>identity parameter"))}},{key:"join",value:function(){var e=this;return this._session.addCommand("joinChannel",{channelSid:this._sid}).then(function(){return e})}},{key:"leave",value:function(){var e=this;return this._status!==t.status.JOINED?d.default.resolve(this):this._session.addCommand("leaveChannel",{channelSid:this._sid}).then(function(){return e})}},{key:"removeMember",value:function(e){return e&&("string"==typeof e||e instanceof I)?this._membersEntity.remove("string"==typeof e?e:e.identity):d.default.reject(new Error("Channel.removeMember requires a <String|Member>member parameter."))}},{key:"sendMessage",value:function(e,t){return this._messagesEntity.send(e,t).then(function(e){return e.messageId})}},{key:"setAllMessagesConsumed",value:function(){var e=this;return this._subscribeStreams().then(function(){return e.getMessages(1)}).then(function(t){t.items.length>0&&e.advanceLastConsumedMessageIndex(t.items[0].index)}).then(function(){return e})}},{key:"setNoMessagesConsumed",value:function(){return this.updateLastConsumedMessageIndex(null)}},{key:"typing",value:function(){return this._typingIndicator.send(this._sid)}},{key:"updateAttributes",value:function(e){var t=this;if(!e){return d.default.reject(new Error("Attributes is a required parameter for updateAttributes and it should be valid JSON"))}return e.constructor!==Object?d.default.reject(new Error("Attributes must be a valid JSON object.")):this._session.addCommand("editAttributes",{channelSid:this._sid,attributes:(0,g.default)(e)}).then(function(){return t})}},{key:"updateFriendlyName",value:function(e){var t=this;return this._friendlyName===e?d.default.resolve(this):this._session.addCommand("editFriendlyName",{channelSid:this._sid,friendlyName:e}).then(function(){return t})}},{key:"updateLastConsumedMessageIndex",value:function(e){var t=this;if(null!==e&&parseInt(e)!==e){return d.default.reject(new Error("Channel.updateLastConsumedMessageIndex requires an integral <Number>index parameter"))}return this._subscribeStreams().then(function(){t._consumptionHorizon.updateLastConsumedMessageIndexForChannel(t.sid,e)}).then(function(){return t})}},{key:"updateUniqueName",value:function(e){var t=this;return this._uniqueName===e?d.default.resolve(this):this._session.addCommand("editUniqueName",{channelSid:this._sid,uniqueName:e}).then(function(){return t})}}],[{key:"_preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,g.default)(e.attributes)}catch(n){O.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){O.warn("Retrieved malformed attributes from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){O.warn("Retrieved malformed attributes from the server for channel: "+t),delete e.dateUpdated}}}]),t}(R);M.type={PUBLIC:"public",PRIVATE:"private"},M.status={KNOWN:"known",INVITED:"invited",JOINED:"joined",FAILED:"failed"},(0,a.default)(M.type),(0,a.default)(M.status),t.exports=M},{"./data/members":235,"./data/messages":236,"./logger":240,"./member":241,"./util":251,"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],231:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){try{return JSON.parse(e)}catch(e){f.warning("Failed to parse channel attributes",e)}return{}}function o(e){try{return new Date(e)}catch(e){return null}}var s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=e("./logger"),p=function(){function e(t,n){(0,c.default)(this,e),(0,a.default)(this,{_client:{value:t},_descriptor:{value:n},sid:{value:n.sid,enumerable:!0},channel:{value:n.sid+".channel",enumerable:!0},uniqueName:{value:n.unique_name,enumerable:!0},friendlyName:{value:n.friendly_name,enumerable:!0},attributes:{value:i(n.attributes)},createdBy:{value:n.created_by,enumerable:!0},dateCreated:{value:o(n.date_created),enumerable:!0},dateUpdated:{value:o(n.date_updated),enumerable:!0},messagesCount:{value:n.messages_count,enumerable:!0},membersCount:{value:n.members_count,enumerable:!0},type:{value:n.type,enumerable:!0}})}return(0,d.default)(e,[{key:"getChannel",value:function(){return this._client.getChannelBySid(this.sid)}}]),e}();t.exports=p},{"./logger":240,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],232:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/freeze"),o=r(i),s=e("babel-runtime/core-js/promise"),a=r(s),u=e("babel-runtime/core-js/object/define-properties"),c=r(u),l=e("babel-runtime/core-js/object/get-prototype-of"),d=r(l),f=e("babel-runtime/helpers/classCallCheck"),p=r(f),h=e("babel-runtime/helpers/createClass"),m=r(h),v=e("babel-runtime/helpers/possibleConstructorReturn"),g=r(v),y=e("babel-runtime/helpers/inherits"),b=r(y),_=e("events").EventEmitter,w=e("./logger"),T=e("twilio-notifications"),C=e("twilsock"),k=e("twilio-transport").Transport,E=e("twilio-sync").SyncClient,S=e("./configuration"),x=e("./session"),R=e("./data/channels"),A=e("./data/publicchannels"),I=e("./data/userinfos"),j=e("./services/typingindicator"),O=e("./services/consumptionhorizon"),P=e("./services/network"),N=e("twilio-ems-client").EmsClient,D=e("./../package.json").version,M="A valid Twilio token should be provided",U=function(e){function t(e,n){(0,p.default)(this,t);var r=(0,g.default)(this,(t.__proto__||(0,d.default)(t)).call(this));if(n=n||{},n.logLevel=n.logLevel||"error",n.productId="ip_messaging",!e)throw new Error(M);w.setLevel(n.logLevel);var i=new S(null,n);n.twilsockClient=n.twilsockClient||new C(e,n),n.transport=n.transport||new k(n.twilsockClient,n);var o=n.emsClient=n.emsClient||new N(n);n.notificationsClient=n.notificationsClient||new T(e,n),n.syncClient=n.syncClient||new E(e,n);var s=n.syncClient,a=n.transport,u=n.twilsockClient,l=n.notificationsClient,f=new x(s,a,i),h=f.initialize(e),m=new P(i,f,a),v=new I(f,s,null);v.on("userInfoUpdated",r.emit.bind(r,"userInfoUpdated"));var y=new O(i,f),b=new j(i,a,l,r.getChannelBySid.bind(r)),_=new R({session:f,userInfos:v,typingIndicator:b,consumptionHorizon:y,network:m,config:i}),A=h.then(function(){return _.on("channelAdded",r.emit.bind(r,"channelAdded")),_.on("channelRemoved",r.emit.bind(r,"channelRemoved")),_.on("channelInvited",r.emit.bind(r,"channelInvited")),_.on("channelJoined",r.emit.bind(r,"channelJoined")),_.on("channelLeft",r.emit.bind(r,"channelLeft")),_.on("channelUpdated",r.emit.bind(r,"channelUpdated")),_.on("memberJoined",r.emit.bind(r,"memberJoined")),_.on("memberLeft",r.emit.bind(r,"memberLeft")),_.on("memberUpdated",r.emit.bind(r,"memberUpdated")),_.on("messageAdded",r.emit.bind(r,"messageAdded")),_.on("messageUpdated",r.emit.bind(r,"messageUpdated")),_.on("messageRemoved",r.emit.bind(r,"messageRemoved")),_.on("typingStarted",r.emit.bind(r,"typingStarted")),_.on("typingEnded",r.emit.bind(r,"typingEnded")),_.fetchChannels()}).then(function(){return _});return l.on("transportReady",function(e){if(e)r._connectionState=t.connectionState.CONNECTED,r._session.syncToken().catch(function(e){w.error("Failed to sync session token",e)});else switch(r._twilsock.state){case"rejected":r._connectionState=t.connectionState.DENIED;break;default:r._connectionState=t.connectionState.CONNECTING}r.emit("connectionStateChanged",r._connectionState)}),(0,c.default)(r,{_config:{value:i},_fpaToken:{value:e,writable:!0},_emsClient:{value:o},_channelsPromise:{value:A},_channels:{value:_},_transport:{value:m},_datasync:{value:s},_notifications:{value:l},_session:{value:f},_sessionPromise:{value:h},_initializePromise:{value:null,writable:!0},_twilsock:{value:u},_typingIndicator:{value:b},_userInfos:{value:v},_publicChannels:{value:null,writable:!0},_connectionState:{value:t.connectionState.CONNECTING,writable:!0},userInfo:{enumerable:!0,get:function(){return r._userInfos.myUserInfo}},connectionState:{enumerable:!0,get:function(){return r._connectionState}},reachabilityEnabled:{enumerable:!0,get:function(){return r._session.reachabilityEnabled}}}),r._initializePromise=r._initialize(),r}return(0,b.default)(t,e),(0,m.default)(t,[{key:"_initialize",value:function(){var e=this;return this._emsClient.setToken(this._fpaToken).then(function(t){return e._config.updateToken(t.token)}).then(function(){return e._sessionPromise}).then(function(){return e._notifications.subscribe("twilio.channel.new_message","gcm"),e._notifications.subscribe("twilio.channel.added_to_channel","gcm"),e._notifications.subscribe("twilio.channel.invited_to_channel","gcm"),e._session.getSessionLinks().then(function(e){return e.publicChannelsUrl}).then(function(t){return e._publicChannels=new A(e._config,e,e._transport,t),e._publicChannels})}).then(function(){return e._typingIndicator.initialize()})}},{key:"initialize",value:function(){var e=this;return this._initializePromise.then(function(){return e})}},{key:"shutdown",value:function(){return this._twilsock.disconnect()}},{key:"updateToken",value:function(e){var t=this;if(w.info("updateToken"),!e){var n=new Error(M);return a.default.reject(n)}return e===this._fpaToken?a.default.resolve(this):this._emsClient.setToken(e).then(function(e){if("NEW"===e.status)throw w.error("Can't extend token:",e.reason),new Error("Can't extend token:"+e.reason);return e.token}).then(function(n){return t._twilsock.updateToken(e).then(function(){return t._datasync.updateToken(e)}).then(function(){return t._notifications.updateToken(e)}).then(function(){return t._sessionPromise}).then(function(){return t._session.updateToken(n)}).then(function(){return n})}).then(function(n){return t._config.updateToken(n),t._fpaToken=e,t})}},{key:"getChannelBySid",value:function(e){var t=this;if(!e||"string"!=typeof e){var n=new Error("Client.getChannelBySid requires a <String>channelSid parameter");return a.default.reject(n)}return this._channels.getChannel(e).then(function(n){return n||t._publicChannels.getChannelBySid(e).then(function(e){return t._channels.pushChannel(e)})})}},{key:"getChannelByUniqueName",value:function(e){var t=this;if(!e||"string"!=typeof e){var n=new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");return a.default.reject(n)}return this._publicChannels.getChannelByUniqueName(e).then(function(e){return t._channels.pushChannel(e)})}},{key:"getUserChannels",value:function(e){return this._channelsPromise.then(function(t){return t.getChannels(e)})}},{key:"getPublicChannels",value:function(){return this._publicChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this._channelsPromise.then(function(t){return t.addChannel(e)})}},{key:"setPushRegistrationId",value:function(e,t){this._notification.setPushRegistrationId(e,t||"gcm")}},{key:"putPushNotificationPayload",value:function(e){var t=e.additionalData;switch(t.type){case"twilio.channel.new_message":var n=t.data.channel_id,r=t.data.message_id;this.getChannelBySid(n).then(function(e){return e.getMessages(10,r)})}}}]),t}(_);(0,c.default)(U,{version:{enumerable:!0,value:D}}),U.connectionState={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected",ERROR:"error",DENIED:"denied"},(0,o.default)(U.connectionState),t.exports=U},{"./../package.json":229,"./configuration":233,"./data/channels":234,"./data/publicchannels":237,"./data/userinfos":238,"./logger":240,"./services/consumptionhorizon":244,"./services/network":245,"./services/typingindicator":246,"./session":247,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/freeze":11,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,"twilio-ems-client":182,"twilio-notifications":187,"twilio-sync":198,"twilio-transport":214,twilsock:217}],233:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l="https://aim.twilio.com",d="/v1/typing",f=5,p=10,h="PT5S",m=function(){function e(t,n){var r=this;(0,a.default)(this,e),n=n||{};var i=n.Chat||n.IPMessaging||{},s=i.apiUri||i.typingUri||l;(0,o.default)(this,{_token:{value:t,writable:!0},token:{get:function(){return r._token},enumerable:!0},baseUri:{value:s},baseUrl:{value:s},typingIndicatorUri:{enumerable:!0,value:s+d},typingIndicatorTimeoutDefault:{enumerable:!0,value:1e3*f},httpCacheLifetimeDefault:{enumerable:!0,value:1e3*p},consumptionReportIntervalDefault:{enumerable:!0,value:h},typingIndicatorTimeoutOverride:{enumberable:!0,value:n.typingIndicatorTimeoutOverride},httpCacheLifetimeOverride:{enumberable:!0,value:n.httpCacheLifetimeOverride},consumptionReportIntervalOverride:{enumberable:!0,value:n.consumptionReportIntervalOverride}})}return(0,c.default)(e,[{key:"updateToken",value:function(e){this._token=e}}]),e}();t.exports=m},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],234:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/core-js/json/stringify"),a=r(s),u=e("babel-runtime/core-js/map"),c=r(u),l=e("babel-runtime/core-js/object/define-properties"),d=r(l),f=e("babel-runtime/core-js/object/get-prototype-of"),p=r(f),h=e("babel-runtime/helpers/classCallCheck"),m=r(h),v=e("babel-runtime/helpers/createClass"),g=r(v),y=e("babel-runtime/helpers/possibleConstructorReturn"),b=r(y),_=e("babel-runtime/helpers/inherits"),w=r(_),T=e("events").EventEmitter,C=e("../channel"),k=e("../logger"),E=function(e){function t(e){(0,m.default)(this,t);var n=(0,b.default)(this,(t.__proto__||(0,p.default)(t)).call(this));return(0,d.default)(n,{_services:{value:e},_userInfos:{value:e.userInfos},_typingIndicator:{value:e.typingIndicator},_session:{value:e.session},channels:{enumerable:!0,value:new c.default}}),n}return(0,w.default)(t,e),(0,g.default)(t,[{key:"_getMap",value:function(){var e=this;return this._session.getMyChannelsId().then(function(t){return e._session.datasync.map({uniqueName:t,mode:"open"})})}},{key:"addChannel",value:function(e){var t=this;return this._session.addCommand("createChannel",{friendlyName:e.friendlyName,uniqueName:e.uniqueName,type:e.isPrivate?"private":"public",attributes:(0,a.default)(e.attributes)}).then(function(e){var n=t.channels.get(e.channelSid);if(n)return n._subscribe().then(function(){return n});var r=new C(t._services,{channel:e.channel,channelSid:e.channelSid},e.channelSid);return t.channels.set(r.sid,r),t._registerForEvents(r),r._subscribe().then(function(){return t.emit("channelAdded",r),r})})}},{key:"fetchChannels",value:function(){var e=this;this._session.getMyChannelsId().then(function(t){return e._session.datasync.map({uniqueName:t,mode:"open"})}).then(function(t){t.on("itemAdded",function(t){e._upsertChannel(t.key,t.value)}),t.on("itemRemoved",function(t){var n=e.channels.get(t);n&&("joined"!==n.status&&"invited"!==n.status||(n._setStatus("known"),e.emit("channelLeft",n)),e.channels.delete(t),e.emit("channelRemoved",n))}),t.on("itemUpdated",function(t){e._upsertChannel(t.key,t.value)});var n=[];return t.forEach(function(t){n.push(e._upsertChannel(t.key,t.value))}).then(function(){return o.default.all(n)})}).then(function(){k.debug("Channels list fetched")}).then(function(){return e}).catch(function(e){throw k.error("Failed to get channels list",e),e})}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then(function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then(function(e){return n._wrapPaginator(e,t)})},prevPage:function(){return e.prevPage().then(function(e){return n._wrapPaginator(e,t)})}}})}},{key:"getChannels",value:function(e){var t=this;return this._getMap().then(function(t){return t.getItems(e)}).then(function(e){return t._wrapPaginator(e,function(e){return o.default.all(e.map(function(e){return t._upsertChannel(e.key,e.value)}))})})}},{key:"getChannel",value:function(e){var t=this;return this._getMap().then(function(t){return t.getItems({key:e})}).then(function(e){return e.items.map(function(e){return t._upsertChannel(e.key,e.value)})}).then(function(e){return e.length>0?e[0]:null})}},{key:"pushChannel",value:function(e){var t=e.sid,n={status:"known",type:e.type,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,sid:t},r=this.channels.get(e.sid);return r||(r=new C(this._services,n,t),this.channels.set(t,r)),r}},{key:"_upsertChannel",value:function(e,t){var n=this,r=this.channels.get(e);return r?("joined"===t.status&&"joined"!==r.status?(r._setStatus("joined"),void 0!==t.lastConsumedMessageIndex&&(r._lastConsumedMessageIndex=t.lastConsumedMessageIndex),r._subscribe().then(function(){n.emit("channelJoined",r)})):"invited"===t.status&&"invited"!==r.status?(r._setStatus("invited"),r._subscribe().then(function(){n.emit("channelInvited",r)})):"known"!==t.status||"invited"!==r.status&&"joined"!==r.status?"notParticipating"===t.status&&"private"===t.type?r._subscribe():r._update(t):(r._setStatus("known"),r._update(t),r._subscribe().then(function(){n.emit("channelLeft",r)})),r._subscribe().then(function(){return r})):(r=new C(this._services,t,e),this._registerForEvents(r),this.channels.set(e,r),r._subscribe().then(function(){return"joined"===t.status?(r._setStatus("joined"),n.emit("channelJoined",r)):"invited"===t.status&&(r._setStatus("invited"),n.emit("channelInvited",r)),r.isPrivate&&n.emit("channelAdded",r),r}))}},{key:"_registerForEvents",value:function(e){var t=this;e.on("updated",function(){return t.emit("channelUpdated",e)}),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",this.emit.bind(this,"memberUpdated")),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",this.emit.bind(this,"messageUpdated")),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(T);t.exports=E},{"../channel":230,"../logger":240,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],235:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("babel-runtime/helpers/possibleConstructorReturn"),m=r(h),v=e("babel-runtime/helpers/inherits"),g=r(v),y=e("events").EventEmitter,b=e("../logger").scope("Members"),_=e("../member"),w=function(e){function t(e,n,r,i){(0,d.default)(this,t);var o=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this));return(0,a.default)(o,{_datasync:{value:n.datasync},_userInfos:{value:r},_session:{value:n},_rosterStreamPromise:{writable:!0,value:null},channel:{enumerable:!0,value:e},members:{enumerable:!0,value:i}}),o}return(0,g.default)(t,e),(0,p.default)(t,[{key:"unsubscribe",value:function(){return this._rosterStreamPromise?this._rosterStreamPromise.then(function(e){return e.close()}):o.default.resolve()}},{key:"subscribe",value:function(e){var t=this;return this._rosterStreamPromise=this._rosterStreamPromise||this._datasync.map({uniqueName:e,mode:"open"}).then(function(e){e.on("itemAdded",function(e){t.upsertMember(e.key,e.value).then(function(e){t.emit("memberJoined",e)})}),e.on("itemRemoved",function(e){if(t.members.has(e)){var n=t.members.get(e);t.members.delete(e),t.emit("memberLeft",n)}}),e.on("itemUpdated",function(e){t.upsertMember(e.key,e.value)});var n=[];return e.forEach(function(e){n.push(t.upsertMember(e.key,e.value))}).then(function(){return o.default.all(n)}).then(function(){return e})}).catch(function(e){throw t._rosterStreamPromise=null,b.error("Failed to get roster object for channel",t.channel.sid,e),e})}},{key:"upsertMember",value:function(e,t){var n=this,r=this.members.get(e);return r?(r._update(t),o.default.resolve(r)):this._userInfos.getUserInfo(t.identity,t.userInfo).then(function(i){return r=new _(n.channel,t,e,i),n.members.set(e,r),r.on("updated",function(){return n.emit("memberUpdated",r)}),r.on("userInfoUpdated",function(){return n.emit("memberInfoUpdated",r)}),r})}},{key:"getMembers",value:function(){var e=this;return this._rosterStreamPromise.then(function(){var t=[];return e.members.forEach(function(e){return t.push(e)}),t})}},{key:"add",value:function(e){return this._session.addCommand("addMember",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this._session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"remove",value:function(e){return this._session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}}]),t}(y);t.exports=w},{"../logger":240,"../member":241,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],236:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/number/is-integer"),o=r(i),s=e("babel-runtime/core-js/json/stringify"),a=r(s),u=e("babel-runtime/core-js/promise"),c=r(u),l=e("babel-runtime/core-js/map"),d=r(l),f=e("babel-runtime/core-js/object/define-properties"),p=r(f),h=e("babel-runtime/core-js/object/get-prototype-of"),m=r(h),v=e("babel-runtime/helpers/classCallCheck"),g=r(v),y=e("babel-runtime/helpers/createClass"),b=r(y),_=e("babel-runtime/helpers/possibleConstructorReturn"),w=r(_),T=e("babel-runtime/helpers/inherits"),C=r(T),k=e("events").EventEmitter,E=e("loglevel"),S=e("../message"),x=function(e){function t(e,n,r){(0,g.default)(this,t);var i=(0,w.default)(this,(t.__proto__||(0,m.default)(t)).call(this));return(0,p.default)(i,{_datasync:{value:n.datasync},_eventStreamPromise:{value:null,writable:!0},_sortedMessages:{value:r},_messagesByIndex:{value:new d.default},_session:{value:n},channel:{enumerable:!0,value:e}}),i}return(0,C.default)(t,e),(0,b.default)(t,[{key:"subscribe",value:function(e){var t=this;return this._eventStreamPromise=this._eventStreamPromise||this._datasync.list({uniqueName:e,mode:"open"}).then(function(e){return e.on("itemAdded",function(e){var n=new S(t.channel,e.index,e.value);if(t._messagesByIndex.has(n.index))return void E.debug("Message arrived, but already known and ignored",t.channel.sid,n.index);t._sortedMessages.push(n),t._messagesByIndex.set(n.index,n),n.on("updated",function(){return t.emit("messageUpdated",n)}),t.emit("messageAdded",n)}),e.on("itemRemoved",function(e){var n=t._removeMessageById(e);n&&(t._messagesByIndex.delete(n.index),n.removeAllListeners("updated"),t.emit("messageRemoved",n))}),e.on("itemUpdated",function(e){var n=t._messagesByIndex.get(e.index);n&&n._update(e.value)}),e}).catch(function(e){throw t._eventStreamPromise=null,E.error("Failed to get messages object for channel",t.channel.sid,e),e})}},{key:"unsubscribe",value:function(){return this._eventStreamPromise?this._eventStreamPromise.then(function(e){return e.close()}):c.default.resolve()}},{key:"_removeMessageById",value:function(e){for(var t=void 0,n=0;n<this._sortedMessages.length;n++){if(this._sortedMessages[n].index===e){t=this._sortedMessages.splice(n,1)[0];break}}return t}},{key:"send",value:function(e,t){if(void 0===t)t={};else if(t.constructor!==Object)return c.default.reject(new Error("Attributes must be a valid JSON object"));return this._session.addCommand("sendMessage",{channelSid:this.channel.sid,text:e,attributes:(0,a.default)(t)})}},{key:"getMessages",value:function(e,t,n){return t=(0,o.default)(t)&&t>=0?t:"end",n=n||"backwards",this._getMessages(e,t,n)}},{key:"_wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,o=function(){return t.nextPage().then(function(t){return r._wrapPaginator(e,t,n)})},s=function(){return t.prevPage().then(function(t){return r._wrapPaginator(e,t,n)})};return n(t.items).then(function(e){return{items:e.sort(function(e,t){return e.index-t.index}),hasPrevPage:i?t.hasNextPage:t.hasPrevPage||!1,hasNextPage:i?t.hasPrevPage:t.hasNextPage||!1,prevPage:i?o:s,nextPage:i?s:o}})}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this._messagesByIndex.get(e);if(r)return r;var i=new S(this.channel,e,t);return this._messagesByIndex.set(i.index,i),i.on("updated",function(){return n.emit("messageUpdated",i)}),i}},{key:"_getMessages",value:function(e,t,n){var r=this;t=(0,o.default)(t)&&t>=0?t:"end",e=e||30;var i="backwards"===n?"desc":"asc";return this.subscribe().then(function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:i})}).then(function(e){return r._wrapPaginator(i,e,function(e){return c.default.all(e.map(function(e){return r._upsertMessage(e.index,e.value)}))})})}}]),t}(k);t.exports=x},{"../message":242,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/map":5,"babel-runtime/core-js/number/is-integer":6,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169,loglevel:172}],237:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("../util").UriBuilder,d=e("../restpaginator"),f=e("../channeldescriptor"),p=function(){function e(t,n,r,i){(0,a.default)(this,e),(0,o.default)(this,{_config:{value:t},_client:{value:n},_transport:{value:r},_url:{value:i}})}return(0,c.default)(e,[{key:"getChannels",value:function(e){var t=this;e=e||{};var n=new l(this._url).arg("PageToken",e.pageToken).build();return this._transport.get(n).then(function(e){return e.body}).then(function(e){return new d(e.channels.map(function(e){return new f(t._client,e)}),function(e){return t.getChannels({pageToken:e})},e.meta.prev_token,e.meta.next_token)})}},{key:"getChannelBySid",value:function(e){var t=this,n=new l(this._url).path(e).build();return this._transport.get(n).then(function(e){return e.body}).then(function(e){return new f(t._client,e)})}},{key:"getChannelByUniqueName",value:function(e){var t=this,n=new l(this._url).path(encodeURIComponent(e)).build();return this._transport.get(n).then(function(e){return e.body}).then(function(e){return new f(t._client,e)})}}]),e}();t.exports=p},{"../channeldescriptor":231,"../restpaginator":243,"../util":251,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],238:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/map"),o=r(i),s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("babel-runtime/helpers/possibleConstructorReturn"),m=r(h),v=e("babel-runtime/helpers/inherits"),g=r(v),y=e("events").EventEmitter,b=e("../userinfo"),_=function(e){function t(e,n){(0,d.default)(this,t);var r=(0,m.default)(this,(t.__proto__||(0,c.default)(t)).call(this)),i=new b(null,null,n,e);return i.on("updated",function(){return r.emit("userInfoUpdated",i)}),(0,a.default)(r,{_session:{value:e},_datasync:{value:n},_infos:{value:new o.default},_identity:{value:null,writable:!0},myUserInfo:{enumerable:!0,get:function(){return i}}}),r._session.getUserInfosData().then(function(e){return r._identity=e.identity,i._identity=e.identity,i._entityName=e.userInfo,r._infos.set(e.identity,i),i._ensureFetched()}),r}return(0,g.default)(t,e),(0,p.default)(t,[{key:"getMyUserInfo",value:function(){var e=this;return this._session.getUserInfosData().then(function(t){return e.getUserInfo(t.identity,t.userInfo)})}},{key:"getUserInfo",value:function(e,t){var n=this,r=this._infos.get(e);return r||(r=new b(e,t||null,this._datasync,this._session),this._infos.set(e,r),r.on("updated",function(){return n.emit("userInfoUpdated",r)})),r._ensureFetched()}}]),t}(y);t.exports=_},{"../userinfo":249,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],239:[function(e,t,n){"use strict";var r=e("./client");t.exports=r},{"./client":232}],240:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return[e].concat((0,f.default)(t))}var o=e("babel-runtime/core-js/object/define-properties"),s=r(o),a=e("babel-runtime/helpers/classCallCheck"),u=r(a),c=e("babel-runtime/helpers/createClass"),l=r(c),d=e("babel-runtime/core-js/array/from"),f=r(d),p=e("loglevel"),h=function(){function e(){(0,u.default)(this,e),(0,s.default)(this,{_prefix:{value:"",writable:!0}})}return(0,l.default)(e,[{key:"setLevel",value:function(e){p.setLevel(e)}},{key:"trace",value:function(){p.trace.apply(null,i("Chat T:"+this._prefix,arguments))}},{key:"debug",value:function(){p.debug.apply(null,i("Chat D:"+this._prefix,arguments))}},{key:"info",value:function(){p.info.apply(null,i("Chat I:"+this._prefix,arguments))}},{key:"warn",value:function(){p.warn.apply(null,i("Chat W:"+this._prefix,arguments))}},{key:"error",value:function(){p.error.apply(null,i("Chat E:"+this._prefix,arguments))}}],[{key:"scope",value:function(t){return this._prefix+=" "+t,new e}},{key:"setLevel",value:function(e){p.setLevel(e)}},{key:"trace",value:function(){p.trace.apply(null,i("Chat T:",arguments))}},{key:"debug",value:function(){p.debug.apply(null,i("Chat D:",arguments))}},{key:"info",value:function(){p.info.apply(null,i("Chat I:",arguments))}},{key:"warn",value:function(){p.warn.apply(null,i("Chat W:",arguments))}},{key:"error",value:function(){p.error.apply(null,i("Chat E:",arguments))}}]),e}();t.exports=h},{"babel-runtime/core-js/array/from":1,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,loglevel:172}],241:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/define-properties"),o=r(i),s=e("babel-runtime/core-js/object/get-prototype-of"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=e("babel-runtime/helpers/possibleConstructorReturn"),p=r(f),h=e("babel-runtime/helpers/inherits"),m=r(h),v=e("events").EventEmitter,g=function(e){function t(e,n,r,i){(0,c.default)(this,t);var s=(0,p.default)(this,(t.__proto__||(0,a.default)(t)).call(this)),u=!1,l=null,d=n.identity,f=n.roleSid||null,h=void 0!==n.lastConsumedMessageIndex?n.lastConsumedMessageIndex:null,m=n.lastConsumptionTimestamp?new Date(n.lastConsumptionTimestamp):null;if(!n.identity)throw new Error("Received invalid Member object from server: Missing identity.");return(0,o.default)(s,{_identity:{get:function(){return d},set:function(e){return d=e}},_isTyping:{get:function(){return u},set:function(e){return u=e}},_lastConsumedMessageIndex:{get:function(){return h},set:function(e){return h=e}},_lastConsumptionTimestamp:{get:function(){return m},set:function(e){return m=e}},_roleSid:{get:function(){return f},set:function(e){return f=e}},_typingTimeout:{writable:!0,value:l},channel:{enumerable:!0,value:e},identity:{enumerable:!0,get:function(){return d}},isTyping:{enumerable:!0,get:function(){return u}},lastConsumedMessageIndex:{enumerable:!0,get:function(){return h}},lastConsumptionTimestamp:{enumerable:!0,get:function(){return m}},roleSid:{enumerable:!0,get:function(){return f}},sid:{enumerable:!0,value:r},userInfo:{enumerable:!0,get:function(){return i}}}),i.on("updated",function(){return s.emit("userInfoUpdated",s)}),s}return(0,m.default)(t,e),(0,d.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this._typingTimeout),this._isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this._typingTimeout=setTimeout(function(){return t._endTyping()},e),this}},{key:"_endTyping",value:function(){this._typingTimeout&&(this._isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this._typingTimeout),this._typingTimeout=null)}},{key:"_update",value:function(e){var t=!1;if(e.roleSid&&this._roleSid!==e.roleSid&&(this._roleSid=e.roleSid,t=!0),void 0!==e.lastConsumedMessageIndex&&this._lastConsumedMessageIndex!==e.lastConsumedMessageIndex&&(this._lastConsumedMessageIndex=e.lastConsumedMessageIndex,t=!0),e.lastConsumptionTimestamp){var n=new Date(e.lastConsumptionTimestamp);this._lastConsumptionTimestamp&&this._lastConsumptionTimestamp.getTime()===n.getTime()||(this._lastConsumptionTimestamp=n,t=!0)}t&&this.emit("updated",this)}},{key:"remove",value:function(){return this.channel.removeMember(this)}}]),t}(v);t.exports=g},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],242:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){try{return t?JSON.parse(t):{}}catch(t){return T.warn("Got malformed attributes for the message",e),{}}}var o=e("babel-runtime/core-js/json/stringify"),s=r(o),a=e("babel-runtime/core-js/promise"),u=r(a),c=e("babel-runtime/core-js/object/define-properties"),l=r(c),d=e("babel-runtime/core-js/object/get-prototype-of"),f=r(d),p=e("babel-runtime/helpers/classCallCheck"),h=r(p),m=e("babel-runtime/helpers/createClass"),v=r(m),g=e("babel-runtime/helpers/possibleConstructorReturn"),y=r(g),b=e("babel-runtime/helpers/inherits"),_=r(b),w=e("events").EventEmitter,T=e("./logger"),C=e("./util").isDeepEqual,k=function(e){function t(e,n,r){(0,h.default)(this,t);var o=(0,y.default)(this,(t.__proto__||(0,f.default)(t)).call(this)),s=r.text,a=r.dateUpdated?new Date(r.dateUpdated):null,u=r.lastUpdatedBy?r.lastUpdatedBy:null;return(0,l.default)(o,{_body:{get:function(){return s},set:function(e){return s=e}},_dateUpdated:{get:function(){return a},set:function(e){return a=e}},_lastUpdatedBy:{get:function(){return u},set:function(e){return u=e}},_attributes:{value:i(r.sid,r.attributes),writable:!0},author:{enumerable:!0,value:r.author},body:{enumerable:!0,get:function(){return s}},channel:{enumerable:!0,value:e},dateUpdated:{enumerable:!0,get:function(){return a}},index:{enumerable:!0,value:parseInt(n)},lastUpdatedBy:{enumerable:!0,get:function(){return u}},sid:{enumerable:!0,value:r.sid},timestamp:{enumerable:!0,value:new Date(r.timestamp)},attributes:{enumerable:!0,get:function(){return o._attributes}}}),o}return(0,_.default)(t,e),(0,v.default)(t,[{key:"_update",value:function(e){var t=!1;!e.text&&"string"!=typeof e.text||e.text===this._body||(this._body=e.text,t=!0),e.lastUpdatedBy&&e.lastUpdatedBy!==this._lastUpdatedBy&&(this._lastUpdatedBy=e.lastUpdatedBy,t=!0),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this._dateUpdated&&this._dateUpdated.getTime())&&(this._dateUpdated=new Date(e.dateUpdated),t=!0);var n=i(this.sid,e.attributes);C(this._attributes,n)||(this._attributes=n,t=!0),t&&this.emit("updated",this)}},{key:"remove",value:function(){var e=this;return this.channel._session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()}).then(function(){return e})}},{key:"updateBody",value:function(e){var t=this;if("string"!=typeof e)throw new Error("Body <String> is a required parameter for updateBody");return this.channel._session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:e}).then(function(){return t})}},{key:"updateAttributes",value:function(e){var t=this;return void 0===e?u.default.reject(new Error("Attributes is a required parameter for updateAttributes")):e.constructor!==Object?u.default.reject(new Error("Attributes must be a valid JSON object")):this.channel._session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,s.default)(e)}).then(function(){return t})}}]),t}(w);t.exports=k},{"./logger":240,"./util":251,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,events:169}],243:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=function(){function e(t,n,r,i){(0,c.default)(this,e),(0,a.default)(this,{prevToken:{value:r},nextToken:{value:i},source:{value:n},hasNextPage:{value:!!i,enumerable:!0},hasPrevPage:{value:!!r,enumerable:!0},items:{get:function(){return t},enumerable:!0}})}return(0,d.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.source(this.nextToken):o.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.source(this.prevToken):o.default.reject(new Error("No previous page"))}}]),e}();t.exports=f},{"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],244:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/map"),o=r(i),s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),d=r(l),f=function(){function e(t,n){(0,c.default)(this,e),(0,a.default)(this,{_session:{value:n},_consumptionHorizonReports:{value:new o.default},_consumptionHorizonUpdateTimer:{value:null,writable:!0}})}return(0,d.default)(e,[{key:"_getReportInterval",value:function(){return this._session.getConsumptionReportInterval().then(function(e){return 1e3*e.seconds})}},{key:"_delayedSendConsumptionHorizon",value:function(e){var t=this;null===this._consumptionHorizonUpdateTimer&&(this._consumptionHorizonUpdateTimer=setTimeout(function(){var e=[];t._consumptionHorizonReports.forEach(function(t){return e.push(t)}),e.length>0&&t._session.addCommand("consumptionReport",{report:e}),t._consumptionHorizonUpdateTimer=null,t._consumptionHorizonReports.clear()},e))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;this._consumptionHorizonReports.set(e,{channelSid:e,messageIdx:t}),this._getReportInterval().then(function(e){return n._delayedSendConsumptionHorizon(e)})}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t){var n=this,r=this._consumptionHorizonReports.get(e);r&&r.messageIdx>=t||(this._consumptionHorizonReports.set(e,{channelSid:e,messageIdx:t}),this._getReportInterval().then(function(e){return n._delayedSendConsumptionHorizon(e)}))}}]),e}();t.exports=f},{"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],245:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/helpers/slicedToArray"),a=r(s),u=e("babel-runtime/core-js/get-iterator"),c=r(u),l=e("babel-runtime/core-js/map"),d=r(l),f=e("babel-runtime/core-js/number/is-integer"),p=r(f),h=e("babel-runtime/core-js/object/define-properties"),m=r(h),v=e("babel-runtime/helpers/classCallCheck"),g=r(v),y=e("babel-runtime/helpers/createClass"),b=r(y),_=function(){function e(t,n,r){(0,g.default)(this,e),(0,m.default)(this,{_config:{value:t},_transport:{value:r},_session:{value:n},_cacheLifetime:{value:(0,p.default)(t.httpCacheLifetimeOverride)?t.httpCacheLifetimeOverride:t.httpCacheLifetimeDefault,writable:!0},_cache:{value:new d.default},_timer:{value:null,writable:!0}})}return(0,b.default)(e,[{key:"_isExpired",value:function(e){return!this._cacheLifetime||Date.now()-e>this._cacheLifetime}},{key:"_cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,c.default)(this._cache);!(e=(r=i.next()).done);e=!0){var o=(0,a.default)(r.value,2),s=o[0],u=o[1];this._isExpired(u.timestamp)&&this._cache.delete(s)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}0===this._cache.size&&clearTimeout(this._timer)}},{key:"_pokeTimer",value:function(){var e=this;this._timer=this._timer||setInterval(function(){return e._cleanupCache()},2*this._cacheLifetime)}},{key:"get",value:function(e){var t=this,n=this._cache.get(e);if(n&&!this._isExpired(n.timestamp))return o.default.resolve(n.response);var r={"X-Twilio-Token":this._config.token};return this._transport.get(e,r).then(function(n){return t._cache.set(e,{response:n,timestamp:Date.now()}),t._pokeTimer(),n})}}]),e}();t.exports=_},{"babel-runtime/core-js/get-iterator":2,"babel-runtime/core-js/map":5,"babel-runtime/core-js/number/is-integer":6,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/slicedToArray":26}],246:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/core-js/map"),a=r(s),u=e("babel-runtime/core-js/object/define-properties"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("../logger").scope("TypingIndicator"),m="twilio.ipmsg.typing_indicator",v=function(){function e(t,n,r,i){var o=this;(0,d.default)(this,e),(0,c.default)(this,{_transport:{value:n},_notifications:{value:r},_config:{value:t},_typingTimeout:{value:null,writable:!0},_sentUpdates:{value:new a.default},_getChannel:{value:i},token:{get:function(){return t.token}},typingTimeout:{get:function(){return t.typingIndicatorTimeoutOverride||o._typingTimeout||t.typingIndicatorTimeoutDefault}}})}return(0,p.default)(e,[{key:"initialize",value:function(){var e=this;this._notifications.subscribe(m,"twilsock"),this._notifications.on("message",function(t,n){t===m&&e._handleRemoteTyping(n)})}},{key:"_handleRemoteTyping",value:function(e){var t=this;h.trace("Got new typing indicator ",e),this._getChannel(e.channel_sid).then(function(n){n&&n._members.forEach(function(n){n.identity===e.identity&&n._startTyping(t.typingTimeout)})}).catch(function(e){throw h.error(e),e})}},{key:"send",value:function(e){var t=this._sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?o.default.resolve():(this._sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;h.trace("Sending typing indicator");var n=this._config.typingIndicatorUri,r={"X-Twilio-Token":this.token,"Content-Type":"application/x-www-form-urlencoded"},i="ChannelSid="+e;return this._transport.post(n,r,i).then(function(e){e.body.hasOwnProperty("typing_timeout")&&(t._typingTimeout=1e3*e.body.typing_timeout)}).catch(function(e){throw h.error("Failed to send typing indicator:",e),e})}}]),e}();t.exports=v},{"../logger":240,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22}],247:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/promise"),o=r(i),s=e("babel-runtime/core-js/map"),a=r(s),u=e("babel-runtime/core-js/object/define-properties"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),d=r(l),f=e("babel-runtime/helpers/createClass"),p=r(f),h=e("uuid"),m=e("platform"),v=e("./logger").scope("Session"),g=e("./util/changetracker"),y=e("./sessionerror"),b=e("durational"),_=e("./../package.json").version,w="com.twilio.rtd.ipmsg",T=function(){function e(t,n,r){var i=this;(0,d.default)(this,e);var o="undefined"!=typeof navigator?m.parse(navigator.userAgent):m;(0,c.default)(this,{_endpointPlatform:{value:["js",_,o.os,o.name,o.version].join("|")},_pendingCommands:{value:new a.default},_sessionContextChangeTracker:{value:new g},_sessionStreamPromise:{value:null,writable:!0},_config:{value:r},_token:{value:null,writable:!0},_tokenSynced:{value:!0,writable:!0},identity:{enumerable:!0,get:function(){return i._sessionContextChangeTracker._data.identity}},userInfo:{enumerable:!0,get:function(){return i._sessionContextChangeTracker._data.userInfo}},reachabilityEnabled:{enumerable:!0,get:function(){return i._sessionContextChangeTracker._data.reachabilityEnabled}},datasync:{enumerable:!0,value:t},transport:{value:n}})}return(0,p.default)(e,[{key:"initialize",value:function(e){var t=this;this._token=e,this._tokenSynced=!1;var n={type:"IpMsgSession",apiVersion:"3",endpointPlatform:this._endpointPlatform,token:e};return this._sessionStreamPromise=this.datasync.list({purpose:w,context:n}).then(function(e){return v.info("Session created",e.sid),t._tokenSynced=!0,e.on("itemAdded",function(e){return t._processCommandResponse(e)}),e.on("itemUpdated",function(e){return t._processCommandResponse(e)}),e.on("contextUpdated",function(e){v.info("Session context updated"),v.debug("new session context:",e),t._sessionContextChangeTracker.update(e)}),e}).catch(function(e){throw v.error("Failed to create session",e),e}),this._sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this._processCommand(e,t)}},{key:"_processCommand",value:function(e,t){var n=this,r={request:t};return r.request.action=e,r.commandId=h.v4(),v.info("Adding command: ",e,r.commandId),v.debug("command arguments:",t),new o.default(function(e,t){n._sessionStreamPromise.then(function(i){return n._pendingCommands.set(r.commandId,{resolve:e,reject:t}),i.push(r)}).then(function(){return v.debug("Command accepted by server",r.commandId)}).catch(function(e){n._pendingCommands.delete(r.commandId),v.error("Failed to add a command to the session",e),t(new Error("Can't add command: "+e.description))})})}},{key:"_processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this._pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(200===t.response.status){v.debug("Command succeeded: ",t);var r=this._pendingCommands.get(n).resolve;this._pendingCommands.delete(n),r(t.response)}else{v.error("Command failed: ",t);var i=this._pendingCommands.get(n).reject;this._pendingCommands.delete(n),i(new y(t.response.statusText,t.response.status))}}}},{key:"updateToken",value:function(e){return this._token=e,this._tokenSynced=!1,this.syncToken()}},{key:"syncToken",value:function(){var e=this;return this._tokenSynced?o.default.resolve():this._sessionStreamPromise.then(function(t){return t.getContext().then(function(n){return n.token=e._token,t.updateContext(n)}).then(function(){e._tokenSynced=!0})}).catch(function(e){throw v.error("Couldn't update the token in session context",e),new Error(e)})}},{key:"onKeyUpdated",value:function(e,t){this._sessionContextChangeTracker.addEventHandler("keyAdded",e,t),this._sessionContextChangeTracker.addEventHandler("keyUpdated",e,t)}},{key:"getSessionLinks",value:function(){var e=this;return new o.default(function(t){e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(n){n.hasOwnProperty("links")?t(n.links):e.onKeyUpdated("/links",function(){e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(e){return t(e.links)})})})}).then(function(t){return{publicChannelsUrl:e._config.baseUrl+t.publicChannelsUrl,myChannelsUrl:e._config.baseUrl+t.myChannelsUrl,typingUrl:e._config.baseUrl+t.typingUrl}})}},{key:"getChannelsId",value:function(){var e=this;return new o.default(function(t){e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(n){n.hasOwnProperty("channelsUrl")?t(n.channels):e.onKeyUpdated("/channels",t)})})}},{key:"getMyChannelsId",value:function(){var e=this;return new o.default(function(t){e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(n){n.hasOwnProperty("myChannels")?t(n.myChannels):e.onKeyUpdated("/myChannels",t)})})}},{key:"getUserInfosData",value:function(){var e=this;return new o.default(function(t){function n(e){t({userInfo:e.userInfo,identity:e.identity})}e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(t){t.hasOwnProperty("userInfo")?n(t):e.onKeyUpdated("/userInfo",function(){e._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(e){return n(e)})})})})}},{key:"getConsumptionReportInterval",value:function(){var e=this;return this._sessionStreamPromise.then(function(e){return e.getContext()}).then(function(t){return b.fromString(e._config.consumptionReportIntervalOverride||t.consumptionReportInterval||e._config.consumptionReportIntervalDefault)})}}]),e}();t.exports=T},{"./../package.json":229,"./logger":240,"./sessionerror":248,"./util/changetracker":250,"babel-runtime/core-js/map":5,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,durational:167,platform:174,uuid:224}],248:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/core-js/object/get-prototype-of"),o=r(i),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/possibleConstructorReturn"),c=r(u),l=e("babel-runtime/helpers/inherits"),d=r(l),f=function(e){function t(e,n){(0,a.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,d.default)(t,e),t}(Error);t.exports=f},{"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25}],249:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=e("babel-runtime/regenerator"),o=r(i),s=e("babel-runtime/core-js/json/stringify"),a=r(s),u=e("babel-runtime/helpers/asyncToGenerator"),c=r(u),l=e("babel-runtime/core-js/promise"),d=r(l),f=e("babel-runtime/core-js/object/define-properties"),p=r(f),h=e("babel-runtime/core-js/object/get-prototype-of"),m=r(h),v=e("babel-runtime/helpers/classCallCheck"),g=r(v),y=e("babel-runtime/helpers/createClass"),b=r(y),_=e("babel-runtime/helpers/possibleConstructorReturn"),w=r(_),T=e("babel-runtime/helpers/inherits"),C=r(T),k=e("events").EventEmitter,E=e("./logger").scope("UserInfo"),S=function(e){function t(e,n,r,i){(0,g.default)(this,t);var o=(0,w.default)(this,(t.__proto__||(0,m.default)(t)).call(this));return o.setMaxListeners(0),(0,p.default)(o,{_datasync:{value:r},_session:{value:i},_identity:{value:e,writable:!0},_entityName:{value:n,writable:!0},_attributes:{value:{},writable:!0},_friendlyName:{value:null,writable:!0},_online:{value:null,writable:!0},_notifiable:{value:null,writable:!0},_promiseToFetch:{writable:!0},identity:{enumerable:!0,get:function(){return o._identity}},attributes:{enumerable:!0,get:function(){return o._attributes}},friendlyName:{enumerable:!0,get:function(){return o._friendlyName}},online:{enumerable:!0,get:function(){return o._online}},notifiable:{enumerable:!0,get:function(){return o._notifiable}}}),o}return(0,C.default)(t,e),(0,b.default)(t,[{key:"_update",value:function(e,t){switch(E.debug("UserInfo for",this._identity,"updated:",e,t),e){case"friendlyName":this._friendlyName=t.value;break;case"attributes":try{this._attributes=JSON.parse(t.value)}catch(e){this._attributes={}}break;case"reachability":this._online=t.online,this._notifiable=t.notifiable;break;default:return}this.emit("updated",e)}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this._session.reachabilityEnabled?e.get("reachability").then(t).catch(function(e){E.warn("Failed to get reachability info for ",n._identity,e)}):d.default.resolve()}},{key:"_fetch",value:function(){var e=this;if(!this._entityName)return d.default.resolve(this);var t=function(t){return e._update(t.key,t.value)};return this._promiseToFetch=this._datasync.map({uniqueName:this._entityName,mode:"open"}).then(function(n){return n.on("itemUpdated",t),d.default.all([n.get("friendlyName").then(t),n.get("attributes").then(t),e._updateReachabilityInfo(n,t)])}).then(function(){return E.debug("Fetched for",e.identity),e}).catch(function(t){throw e._promiseToFetch=null,t}),this._promiseToFetch}},{key:"_ensureFetched",value:function(){return this._promiseToFetch||this._fetch()}},{key:"updateAttributes",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.constructor===Object){e.next=2;break}throw new Error("Attributes must be an object.");case 2:return e.next=4,this._session.addCommand("editUserAttributes",{username:this._identity,attributes:(0,a.default)(t)});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateFriendlyName",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("friendlyName must be string or empty.");case 2:return e.next=4,this._session.addCommand("editUserFriendlyName",{username:this._identity,friendlyName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)}));return e}()}]),t}(k);t.exports=S},{"./logger":240,"babel-runtime/core-js/json/stringify":4,"babel-runtime/core-js/object/define-properties":9,"babel-runtime/core-js/object/get-prototype-of":12,"babel-runtime/core-js/promise":15,"babel-runtime/helpers/asyncToGenerator":20,"babel-runtime/helpers/classCallCheck":21,"babel-runtime/helpers/createClass":22,"babel-runtime/helpers/inherits":24,"babel-runtime/helpers/possibleConstructorReturn":25,"babel-runtime/regenerator":28,events:169}],250:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=this;(0,s.default)(this,{_pendingListeners:{value:{}},_data:{value:e||{},writable:!0}}),a.call(this),["keyAdded","keyRemoved","keyUpdated"].forEach(function(e){t._pendingListeners[e]={},t.on(e,function(n,r){(t._pendingListeners[e][n]||[]).forEach(function(e){return e(r)}),t._pendingListeners[e][n]=[]})})}var o=e("babel-runtime/core-js/object/define-properties"),s=r(o),a=e("events").EventEmitter,u=e("util").inherits,c=e("rfc6902");u(i,a),i.prototype._traverse=function(e,t){var n=this;c.createPatch(e,t).forEach(function(e){"add"===e.op?n.emit("keyAdded",e.path,e.value):"replace"===e.op?n.emit("keyUpdated",e.path,e.value):"remove"===e.op&&n.emit("keyRemoved",e.path)})},i.prototype.update=function(e){var t=this._data;this._data=e,this._traverse(t,e)},i.prototype.addEventHandler=function(e,t,n){var r=this._pendingListeners[e][t]||[];r.push(n),this._pendingListeners[e][t]=r},t.exports=i},{"babel-runtime/core-js/object/define-properties":9,events:169,rfc6902:181,util:223}],251:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return 0===u.createPatch(e,t).length}function o(e){(0,a.default)(this,{base:{value:e.replace(/\/$/,"")},paths:{value:[]},args:{value:[]}}),this.arg=function(e,t){return void 0!==t&&this.args.push(e+"="+t),this},this.path=function(e){return this.paths.push(e),this},this.build=function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}var s=e("babel-runtime/core-js/object/define-properties"),a=r(s),u=e("rfc6902");t.exports.isDeepEqual=i,t.exports.UriBuilder=o},{"babel-runtime/core-js/object/define-properties":9,rfc6902:181}]},{},[239])(239)})}).call(t,n(2),n(45).setImmediate)},function(e,t,n){(function(n,r){var i,i,o,s,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/*! twilio-video.js 1.0.0-beta4

The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2015, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes SIP.js under the following license.

    Copyright (c) 2014 Junction Networks, Inc. <http://www.onsip.com>

    License: The MIT License

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

SIP.js contains substantial portions of the JsSIP software under the following
license.

    Copyright (c) 2012-2013 JosÃ© Luis MillÃ¡n - Versatica <http://www.versatica.com>

    License: The MIT License

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    "Software"), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
    LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
    OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
    WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 */
!function(r){var u=function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var c="function"==typeof i&&i;if(!u&&c)return i(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n?n:e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var s="function"==typeof i&&i,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";function r(e,t){return new r.Client(e,t)}var i=e("../package").version;Object.defineProperties(r,{Client:{enumerable:!0,value:e("./client")},getUserMedia:{enumerable:!0,value:e("./webrtc/getusermedia")},LocalMedia:{enumerable:!0,value:e("./media/localmedia")},version:{enumerable:!0,value:i}}),t.exports=r},{"../package":110,"./client":3,"./media/localmedia":8,"./webrtc/getusermedia":59}],2:[function(e,t,n){"use strict";function r(e,t,n,r){var o,s=new Error("Canceled");return new i(function(i,a,u){var c;e(function(e){return u()?Promise.reject(s):(c=t(e),n(c).then(function(e){if(u())throw s;return o=e()}))}).then(function(e){if(u())throw e.disconnect(),s;i(r(c,e))}).catch(function(e){a(e)})},function(){o&&o.cancel()})}var i=e("./util/cancelablepromise");t.exports=r},{"./util/cancelablepromise":48}],3:[function(e,t,n){"use strict";function r(e,t){function n(){var e={configUrl:t.ecsServer+"/v1/Configuration",body:{service:"video",sdk_version:C}};return c.info("Getting ECS configuration"),c.debug("Token:",p.token),c.debug("ECS options:",e),a.getConfiguration(p.token,e).then(function(e){c.info("Got ECS configuration"),c.debug("ECS configuration:",e);var t=T.getOrNull(e,"video.network_traversal_service.ttl");return t=t||d.ICE_SERVERS_DEFAULT_TTL,c.debug("NTS Token TTL:",t),setTimeout(function(){p._ecsPromise=n()},1e3*(t-d.ECS_TIMEOUT)),e},function(e){return c.warn("Failed to get ECS configuration:",e),null})}if(!(this instanceof r))return new r(e,t);if("string"!=typeof e)throw new h.INVALID_TYPE("initialToken","string");v.call(this);try{var i=T.token.getAccountSid(e),o=T.token.getIdentity(e)}catch(e){throw new m.INVALID_ACCESSTOKEN(e.message)}t=Object.assign({ECS:f,environment:d.DEFAULT_ENVIRONMENT,getLocalMedia:g.getLocalMedia,logLevel:d.DEFAULT_LOG_LEVEL,realm:d.DEFAULT_REALM,signaling:_},t),t=Object.assign({ecsServer:d.ECS_SERVER(t.environment,t.realm),wsServer:d.WS_SERVER(t.environment,t.realm,i)},t);var s=d.DEFAULT_ICE_SERVERS(t.environment),a=t.ECS,u=T.buildLogLevels(t.logLevel),c=new b("default",this,u),l=new Map,p=this,y=t.signaling;t.log=c;var w=new y(t.wsServer,i,o,t);Object.defineProperties(this,{_defaultIceServers:{value:s},_getLocalMedia:{value:t.getLocalMedia},_instanceId:{value:++k},_log:{value:c},_options:{value:t},_rooms:{value:l},_signaling:{value:w},_token:{value:e,writable:!0},rooms:{enumerable:!0,get:function(){return new Map(l)}},token:{enumerable:!0,get:function(){return this._token}}}),Object.defineProperty(this,"_ecsPromise",{value:n(),writable:!0}),c.info("Created a new Client"),c.debug("Initial Access Token:",e),c.debug("Options:",t)}function i(e,t){var n=e._signaling.createLocalParticipantSignaling(),r=e._log;return r.debug("Creating a new LocalParticipant:",n),new y(n,t,{log:r})}function o(e,t,n,r){var i=new p(n,r,t),o=e._log;return o.debug("Creating a new Room:",i),e._rooms.set(i.sid,i),r.on("stateChanged",function t(){o.info("Disconnected from Room:",i.toString()),e._rooms.delete(i.sid),r.removeListener("stateChanged",t)}),i}function s(e,t,n){var r=e._log;return r.info("Getting ICE servers"),r.debug("Options:",t),u(e,t).then(function(i){var o={token:e.token,accountSid:T.token.getAccountSid(e.token),identity:T.token.getIdentity(e.token)};return r.info("Got ICE servers"),r.debug("ICE servers:",i),t.iceServers=i,r.debug("Creating a new RoomSignaling"),r.debug("RoomSignaling params:",o),e._signaling.connect(n._signaling,o.token,o.accountSid,o.identity,t)})}function a(e,t,n){var r=e._log;return t.shouldStopLocalMedia=!t.localMedia&&!t.localStream,t.log=r,t.shouldStopLocalMedia?r.info("LocalMedia was not provided, so it will be acquired automatically before connecting to the Room. LocalMedia will be released if connecting to the Room fails or if the Room is disconnected"):(r.info("Getting LocalMedia"),r.debug("Options:",t)),e._getLocalMedia(t).then(function(e){t.shouldStopLocalMedia&&r.info("Got LocalMedia:",e);var i=n(e);return i.catch(function(){t.shouldStopLocalMedia&&(r.info("The automatically acquired LocalMedia will now be stopped"),e.stop())}),i})}function u(e,t){var n=e._log;return t.iceServers?(n.debug("ICE servers:",t.iceServers),Promise.resolve(t.iceServers)):(n.debug("No ICE servers provided, so getting them from ECS"),new w(e._ecsPromise,d.ICE_SERVERS_TIMEOUT_MS).then(function(e){var t=T.getOrNull(e,"video.network_traversal_service");if(!t)throw new Error("network_traversal_service not available");if(t.warning&&n.warn(t.warning),!t.ice_servers)throw new Error("ice_servers not available");return n.info("Got ICE servers"),n.debug("ICE servers:",t.ice_servers),t.ice_servers}).catch(function(t){return n.error("Failed to get ICE servers from ECS:",t.message),n.warn("Returning default ICE servers:",e._defaultIceServers),e._defaultIceServers}))}var c=e("util").inherits,l=e("./cancelableroompromise"),d=e("./util/constants"),f=e("./ecs"),p=e("./room"),h=e("./util/constants").typeErrors,m=e("./util/constants").twilioErrors,v=e("events").EventEmitter,g=e("./media/localmedia"),y=e("./localparticipant"),b=e("./util/log"),_=e("./signaling/v2"),w=e("./util/timeoutpromise"),T=e("./util"),C=e("../package").version,k=0;c(r,v),r.prototype.toString=function(){return"[Client #"+this._instanceId+"]"},r.prototype.connect=function(e){e=Object.assign({to:null},this._options,e);var t=this._log;t.info("Connecting to a Room"),t.debug("Options:",e);var n=l(a.bind(null,this,e),i.bind(null,this),s.bind(null,this,e),o.bind(null,this,e));return n.then(function(e){return t.info("Connected to Room:",e.toString()),t.info("Room name:",e.name),t.debug("Room:",e),e},function(e){n._isCanceled?t.info("Attempt to connect to a Room was canceled"):t.info("Error while connecting to a Room:",e)}),n},r.prototype.setLogLevel=function(e){return this._log.setLevels(T.buildLogLevels(e)),this},r.prototype.updateToken=function(e){var t=this._log;t.info("Updating the Client with a new Access Token"),t.debug("New Access Token:",e);try{return T.token.getAccountSid(e),T.token.getIdentity(e),this._token=e,Promise.resolve(this)}catch(e){throw new m.INVALID_ACCESSTOKEN(e.message)}},t.exports=r},{"../package":110,"./cancelableroompromise":2,"./ecs":4,"./localparticipant":6,"./media/localmedia":8,"./room":18,"./signaling/v2":28,"./util":51,"./util/constants":49,"./util/log":53,"./util/timeoutpromise":55,events:70,util:109}],4:[function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error("<String>token is a required argument.");t=Object.assign({configUrl:s},t);var n={url:t.configUrl,headers:{"X-Twilio-Token":e,"Content-Type":"application/x-www-form-urlencoded"}};return t.body&&(n.body=i(t.body)),o.post(n).then(function(e){return JSON.parse(e)})}function i(e){return Object.keys(e||{}).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}var o=e("./request"),s="https://ecs.us1.twilio.com/v1/Configuration";t.exports.getConfiguration=r},{"./request":17}],5:[function(e,t,n){"use strict";function r(){Object.defineProperties(this,{_eventEmitter:{value:new i}})}var i=e("events").EventEmitter;r.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},r.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)},r.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)},t.exports=r},{events:70}],6:[function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);n.media=t,s.call(this,e,n)}var i=e("./util"),o=e("util").inherits,s=e("./participant");o(r,s),r.prototype.toString=function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"},r.prototype._handleTrackSignalingEvents=function(){function e(e){o.addTrack(e._signaling),n.info("Added a new "+i.trackClass(e,!0)+":",e.id),n.debug(i.trackClass(e,!0)+":",e)}function t(e){o.removeTrack(e._signaling),n.info("Removed a "+i.trackClass(e,!0)+":",e.id),n.debug(i.trackClass(e,!0)+":",e)}var n=this._log;if("disconnected"!==this.state){var r=this.media,o=this._signaling;r.on("trackAdded",e),r.on("trackRemoved",t),r.tracks.forEach(e),o.on("stateChanged",function i(s){n.debug("Transitioned to state:",s),"disconnected"===s&&(n.debug("Removing LocalTrack event listeners"),o.removeListener("stateChanged",i),r.removeListener("trackAdded",e),r.removeListener("trackRemoved",t))})}},t.exports=r},{"./participant":15,"./util":51,util:109}],7:[function(e,t,n){"use strict";function r(e){i.call(this),e=e||{};var t=new Map,n=new Map,r=new Set,o=new Map,s=new Map,u=new Map;return Object.defineProperties(this,{_instanceId:{value:++a},_log:{value:e.log.createLog("media",this)},_trackEventListeners:{value:s},attachments:{enumerable:!0,value:t},audioTracks:{enumerable:!0,value:n},isMuted:{enumerable:!0,get:function(){var e=!0;return n.forEach(function(t){e=e&&!t.isEnabled}),e}},isPaused:{enumerable:!0,get:function(){var e=!0;return u.forEach(function(t){e=e&&!t.isEnabled}),e}},mediaStreams:{enumerable:!0,value:r},tracks:{enumerable:!0,value:o},videoTracks:{enumerable:!0,value:u}}),this._log.info("Created a new Media"),this}var i=e("events").EventEmitter,o=e("util").inherits,s=e("../util"),a=0,u=e("./track"),c=e("./track/videotrack"),l=r.TRACK_ADDED="trackAdded",d=r.TRACK_DIMENSIONS_CHANGED="trackDimensionsChanged",f=r.TRACK_DISABLED="trackDisabled",p=r.TRACK_ENABLED="trackEnabled",h=r.TRACK_REMOVED="trackRemoved",m=r.TRACK_STARTED="trackStarted";o(r,i),r.prototype.toString=function(){return"[Media #"+this._instanceId+"]"},r.prototype._updateMediaStreams=function(){return this.mediaStreams.clear(),this.tracks.forEach(function(e){this.mediaStreams.add(e.mediaStream)},this),this.mediaStreams},r.prototype._addTrack=function(e){return this.tracks.has(e.id)?this:(this.mediaStreams.add(e.mediaStream),this.tracks.set(e.id,e),this._reemitTrackEvents(e),"audio"===e.kind?this.audioTracks.set(e.id,e):this.videoTracks.set(e.id,e),this.emit(l,e),this._log.info("Added "+s.trackClass(e)+":",e.id),this)},r.prototype._reemitTrackEvents=function(e){if(!this._trackEventListeners.has(e)){var t=[[c.DIMENSIONS_CHANGED,d],[u.DISABLED,f],[u.ENABLED,p],[u.STARTED,m]].map(function(t){var n=t[0],r=t[1];return[n,this._reemitTrackEvent(e,n,r)]},this);this._trackEventListeners.set(e,t)}},r.prototype._reemitTrackEvent=function(e,t,n){function r(){i.emit(n,e)}var i=this;return e.on(t,r),r},r.prototype._createTrackElement=function(e){return e.attach()},r.prototype._attachTrack=function(e,t,n){var r=this._createTrackElement(n);return e.appendChild(r),t.set(n,r),this._log.debug("Attached "+n+"to element:",r),this},r.prototype._detachTrack=function(e,t){var n=e.get(t);return n?(t.detach(n),n.parentNode&&n.parentNode.removeChild(n),e.delete(t),this._log.debug("Detached "+t+" from element:",n),this):this},r.prototype._removeTrack=function(e){return this.tracks.has(e.id)?(this.tracks.delete(e.id),("audio"===e.kind?this.audioTracks:this.videoTracks).delete(e.id),this._removeTrackEventListeners(e),this._updateMediaStreams(),this.emit(h,e),this._log.info("Removed a "+s.trackClass(e)+":",e.id),this):this},r.prototype._removeTrackEventListeners=function(e){var t=this._trackEventListeners.get(e)||[];this._trackEventListeners.delete(e),t.forEach(function(t){e.removeListener.apply(e,t)})},r.prototype.attach=function(e){return"string"==typeof e?e=this._selectContainer(e):e||(e=this._createContainer()),this._attach(e)},r.prototype._createContainer=function(){return document.createElement("div")},r.prototype._selectContainer=function(e){var t=document.querySelector(e);if(!t)throw new Error("Selector matched no element: "+e);return t},r.prototype._attach=function(e){if(this.attachments.has(e))return e;var t=new Map,n=this;return this.tracks.forEach(function(r){n._attachTrack(e,t,r)}),this.on(l,function r(i){if(!n.attachments.has(e))return n.removeListener(l,r);n._attachTrack(e,t,i)}),this.on(h,function r(i){if(!n.attachments.has(e))return n.removeListener(h,r);n._detachTrack(t,i)}),this.attachments.set(e,t),e},r.prototype.detach=function(e){var t;return t="string"==typeof e?[this._selectContainer(e)]:e?[e]:this._getAllAttachedContainers(),this._detachContainers(t),e?t[0]:t},r.prototype._detachContainers=function(e){return e.map(this._detachContainer.bind(this))},r.prototype._detachContainer=function(e){if(!this.attachments.has(e))return e;var t=this.attachments.get(e),n=this;return this.attachments.delete(e),t.forEach(function(e,r){n._detachTrack(t,r)}),e},r.prototype._getAllAttachedContainers=function(){var e=[];return this.attachments.forEach(function(t,n){e.push(n)}),e},t.exports=r},{"../util":51,"./track":10,"./track/videotrack":14,events:70,util:109}],8:[function(e,t,n){"use strict";function r(e){return this instanceof r?(e=Object.assign({logLevel:s.DEFAULT_LOG_LEVEL},e),e.log=e.log||new d("media",this,a.buildLogLevels(e.logLevel)),l.call(this,e),this):new r(e)}var i=e("../webrtc/getusermedia"),o=e("util").inherits,s=e("../util/constants"),a=e("../util"),u=e("./track/localaudiotrack"),c=e("./track/localvideotrack"),l=e("./"),d=e("../util/log");r.getLocalMedia=function(e){if(e=e||{},e.localMedia)return Promise.resolve(e.localMedia);var t=new r(e),n=t._log;return e.localStream?(n.info("Adding user-provided local MediaStream"),n.debug("MediaStream:",e.localStream),Promise.resolve(t.addStream(e.localStream))):e.audio===!1&&e.video===!1?(n.info("Neither audio nor video requested, so returning empty LocalMedia"),Promise.resolve(t)):(n.info("Calling getUserMedia:",e),i({audio:null===e.audio||void 0===e.audio||e.audio,video:null===e.video||void 0===e.video||e.video}).then(function(e){return n.info("Call to getUserMedia successful; got MediaStream:",e),n.info("Adding MediaStream to LocalMedia"),t.addStream(e)}).catch(function(e){throw n.warn("Call to getUserMedia failed:",e),e}))},o(r,l),r.prototype.toString=function(){return"[LocalMedia #"+this._instanceId+"]"},r.prototype.setLogLevel=function(e){return this._log.setLevels(a.buildLogLevels(e)),this},r.prototype.addTrack=function(e){return e.mediaStream.getTracks().indexOf(e.mediaStreamTrack)===-1&&(this._log.debug("Adding MediaStreamTrack:",e.mediaStreamTrack),e.mediaStream.addTrack(e.mediaStreamTrack)),l.prototype._addTrack.apply(this,arguments)},r.prototype.addMicrophone=function(e){var t=this,n=null,r=this._log;return e=e||!0,this.audioTracks.forEach(function(e){n=n||e}),n?(r.info("Returning existing LocalAudioTrack for microphone:",n),Promise.resolve(n)):(r.info("Getting microphone"),i({audio:e,video:!1}).then(function(e){var n=e.getAudioTracks(),i=n[0],o=new u(e,i,{log:r});return t._addTrack(o),r.info("Got microphone:",i),o}).catch(function(e){throw r.warn("Error while getting microphone:",e),e}))},r.prototype.removeMicrophone=function(e){var t=null,n=this._log;return this.audioTracks.forEach(function(e){t=t||e}),t?(n.info((e?"Stopping and r":"R")+"emoving microphone:",t),this.removeTrack(t,e)):(n.debug("Cannot remove the microphone because it has not been added"),t)},r.prototype.addCamera=function(e){var t=this,n=null,r=this._log;return e=e||!0,this.videoTracks.forEach(function(e){n=n||e}),n?(r.info("Returning existing LocalVideoTrack for camera:",n),Promise.resolve(n)):i({audio:!1,video:e}).then(function(e){var n=e.getVideoTracks(),i=n[0],o=new c(e,i,{log:r});return t._addTrack(o),r.info("Got camera:",i),o}).catch(function(e){throw r.warn("Error while getting camera:",e),e})},r.prototype.removeCamera=function(e){var t=null,n=this._log;return this.videoTracks.forEach(function(e){t=t||e}),t?(n.info((e?"Stopping and r":"R")+"emoving camera:",t),this.removeTrack(t,e)):(n.debug("Cannot remove the camera because it has not been added"),t)},r.prototype.addStream=function(e){var t=this._log;return e.getAudioTracks().forEach(function(n){var r=new u(e,n,{log:t});this._addTrack(r),t.debug("Added new LocalAudioTrack:",r)},this),e.getVideoTracks().forEach(function(n){var r=new c(e,n,{log:t});this._addTrack(r),t.debug("Added new LocalVideoTrack:",r)},this),t.info("Added MediaStream:",e),this},r.prototype.removeStream=function(e,t){var n=this._log;return n.info((t?"Stopping and r":"R")+"emoving all Tracks associated with local MediaStream:",e),e.getTracks().forEach(function(e){var r=this.tracks.get(e.id);r&&(n.debug((t?"Stopping and r":"R")+"emoving LocalTrack:",r),this.removeTrack(r,t))},this),this},r.prototype.removeTrack=function(e,t){var n=this._log;try{e.mediaStream.removeTrack(e.mediaStreamTrack),n.info("Removed MediaStreamTrack:",e.mediaStreamTrack)}catch(e){n.warn("Cannot remove MediaStreamTrack on Firefox:",e)}return l.prototype._removeTrack.call(this,e),("boolean"!=typeof t||t)&&(e.stop(),n.info("Stopped LocalTrack:",e)),e},r.prototype.mute=function(e){var t=this._log;return t.info((e?"M":"Unm")+"uting LocalMedia by "+(e?"dis":"en")+"abling the LocalAudioTracks"),e="boolean"!=typeof e||e,this.audioTracks.forEach(function(n){t.debug((e?"Dis":"En")+"abling LocalAudioTrack:",n),n.enable(!e)}),this},r.prototype.pause=function(e){var t=this._log;return t.info((e?"P":"Unp")+"ausing LocalMedia by "+(e?"dis":"en")+"abling the LocalVideoTracks"),e="boolean"!=typeof e||e,this.videoTracks.forEach(function(n){t.debug((e?"Dis":"En")+"abling LocalVideoTrack:",n),n.enable(!e)}),this},r.prototype.stop=function(){var e=this._log;return e.info("Stopping the LocalMedia by stopping all LocalTracks"),this.tracks.forEach(function(t){e.debug("Stopping LocalTrack:",t),t.stop()}),this},r.prototype.unmute=function(){return this.mute(!1)},r.prototype.unpause=function(){return this.pause(!1)},t.exports=r},{"../util":51,"../util/constants":49,"../util/log":53,"../webrtc/getusermedia":59,"./":7,"./track/localaudiotrack":11,"./track/localvideotrack":13,util:109}],9:[function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var i=e("util").inherits,o=e("./");i(r,o),r.prototype.toString=function(){return"[AudioTrack #"+this._instanceId+": "+this.id+"]"},r.prototype.attach=o.prototype.attach,r.prototype.detach=o.prototype.detach,t.exports=r},{"./":10,util:109}],10:[function(e,t,n){"use strict";function r(e,t,n,r){i.call(this);var o=!1;Object.defineProperties(this,{_instanceId:{value:++s},_isStarted:{get:function(){return o},set:function(e){o=e}},_log:{value:r.log.createLog("media",this)},_signaling:{value:n},attachments:{value:new Set},id:{enumerable:!0,value:t.id},isEnabled:{enumerable:!0,get:function(){return n.isEnabled}},isStarted:{get:function(){return o}},kind:{enumerable:!0,value:t.kind},mediaStream:{enumerable:!0,value:e},mediaStreamTrack:{enumerable:!0,value:t}}),this._initialize()}var i=e("events").EventEmitter,o=e("util").inherits,s=0;r.DISABLED="disabled",r.ENABLED="enabled";var a=r.STARTED="started";o(r,i),r.prototype._start=function(){this._log.debug("Started"),this._isStarted=!0,this._detachElement(this._dummyEl),this._dummyEl.oncanplay=null,this.emit(a,this)},r.prototype._initialize=function(){var e=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._reemit=function(){e.emit(e.isEnabled?"enabled":"disabled",e)},this._signaling.on("updated",this._reemit),this._attach(this._dummyEl)},r.prototype._end=function(){this._log.debug("Ended"),this._signaling.removeListener("updated",this._reemit),this._detachElement(this._dummyEl),this._dummyEl.oncanplay=null},r.prototype.attach=function(e){return"string"==typeof e?e=this._selectElement(e):e||(e=this._createElement()),this._log.debug("Attempting to attach to element:",e),e=this._attach(e)},r.prototype._attach=function(e){if(this.attachments.has(e))return e;if("undefined"==typeof window||"undefined"==typeof navigator)throw new Error("Can not attach track to page: global.navigator and global.window are required.");var t="undefined"!=typeof webkitMediaStream?webkitMediaStream:MediaStream,n=new t;if(n.addTrack(this.mediaStreamTrack),"function"==typeof navigator.webkitGetUserMedia){var r=window.URL||window.webkitURL;e.src=r.createObjectURL(n)}else"function"==typeof navigator.mozGetUserMedia&&(e.mozSrcObject=n);return e.autoplay=!0,this.attachments.add(e),e},r.prototype._selectElement=function(e){var t=document.querySelector(e);if(!t)throw new Error("Selector matched no element: "+e);return t},r.prototype._createElement=function(){return document.createElement(this.kind)},r.prototype.detach=function(e){var t;return t="string"==typeof e?[this._selectElement(e)]:e?[e]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",t),this._detachElements(t),e?t[0]:t},r.prototype._detachElements=function(e){return e.map(this._detachElement.bind(this))},r.prototype._detachElement=function(e){return this.attachments.has(e)?(e.removeAttribute("src"),this.attachments.delete(e),e):e},r.prototype._getAllAttachedElements=function(){var e=[];return this.attachments.forEach(function(t){e.push(t)}),e},t.exports=r},{events:70,util:109}],11:[function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);s.call(this,i,e,t,n)}var i=e("./audiotrack"),o=e("util").inherits,s=e("./localtrack");o(r,i),r.prototype.toString=function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"},r.prototype.attach=function(e){return e=i.prototype.attach.call(this,e),e.muted=!0,e},r.prototype.disable=s.prototype.disable,r.prototype.enable=s.prototype.enable,r.prototype.stop=s.prototype.stop,t.exports=r},{"./audiotrack":9,"./localtrack":12,util:109}],12:[function(e,t,n){"use strict";function r(e,t,n,r){var o=this,s=new i(n,t);e.call(this,t,n,s,r),this.mediaStreamTrack.addEventListener("ended",function t(){e.prototype._end.call(o),o.mediaStreamTrack.removeEventListener("ended",t)})}var i=e("../../signaling/localtrack");r.prototype.enable=function(e){return e="boolean"!=typeof e||e,this._log.info((e?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=e,this._signaling.enable(e),this},r.prototype.disable=function(){return this.enable(!1)},r.prototype.stop=function(){return this._log.info("Stopping"),this.mediaStreamTrack.stop(),this},t.exports=r},{"../../signaling/localtrack":20}],13:[function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);o.call(this,s,e,t,n)}var i=e("util").inherits,o=e("./localtrack"),s=e("./videotrack");i(r,s),r.prototype.toString=function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"},r.prototype.enable=o.prototype.enable,r.prototype.disable=o.prototype.disable,r.prototype.stop=o.prototype.stop,t.exports=r},{"./localtrack":12,"./videotrack":14,util:109}],14:[function(e,t,n){"use strict";function r(e,t,n,r){return a.call(this,e,t,n,r),Object.defineProperties(this,{dimensions:{enumerable:!0,value:{width:null,height:null}}}),Object.defineProperty(this,"_dimensionsChangedElem",{value:i(this)}),this}function i(e){if("undefined"==typeof document)throw new Error("document is undefined");var t=document.createElement(e.kind);return t.muted=!0,t.onloadedmetadata=function(){o(e,t)&&(e.dimensions.width=t.videoWidth,e.dimensions.height=t.videoHeight)},t.onresize=function(){o(e,t)&&(e.dimensions.width=t.videoWidth,e.dimensions.height=t.videoHeight,e.isStarted&&(e._log.debug("Dimensions changed:",e.dimensions),e.emit(u,e)))},e.attach(t)}function o(e,t){return e.dimensions.width!==t.videoWidth||e.dimensions.height!==t.videoHeight}var s=e("util").inherits,a=e("./"),u=r.DIMENSIONS_CHANGED="dimensionsChanged";s(r,a),r.prototype.toString=function(){return"[VideoTrack #"+this._instanceId+": "+this.id+"]"},r.prototype._start=function(e){return this.dimensions.width=e.videoWidth,this.dimensions.height=e.videoHeight,this._log.debug("Dimensions:",this.dimensions),a.prototype._start.call(this,e)},r.prototype.attach=function(e){return e=a.prototype.attach.call(this,e),e.muted=!0,e},r.prototype.detach=function(){return a.prototype.detach.call(this,this._dimensionsChangedElem),a.prototype.detach.apply(this,arguments)},t.exports=r},{"./":10,util:109}],15:[function(e,t,n){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);a.call(this),t=Object.assign({AudioTrack:o,VideoTrack:s},t),Object.defineProperties(this,{_AudioTrack:{value:t.AudioTrack},_instanceId:{value:++d},_log:{value:t.log.createLog("default",this)},_signaling:{value:e},_VideoTrack:{value:t.VideoTrack},identity:{enumerable:!0,get:function(){return e.identity}},media:{enumerable:!0,value:t.media||new l({log:t.log})},sid:{enumerable:!0,get:function(){return e.sid}},state:{enumerable:!0,get:function(){return e.state}}}),i(this,e),this._handleTrackSignalingEvents();var n=this._log;n.info("Created a new Participant"+(this.identity?": "+this.identity:"")),n.debug("Media:",this.media)}function i(e,t){var n=e._log;if("disconnected"!==e.state){var r=["trackAdded","trackDimensionsChanged","trackDisabled","trackEnabled","trackRemoved","trackStarted"].map(function(t){function n(){var n=[].slice.call(arguments);n.unshift(t),e.emit.apply(e,n)}return e.media.on(t,n),e.media.removeListener.bind(e.media,t,n)});t.on("stateChanged",function i(o){n.debug("Transitioned to state:",o),e.emit(o,e),"disconnected"===o&&(n.debug("Removing Track event reemitters"),t.removeListener("stateChanged",i),r.forEach(function(e){e()}))})}}var o=e("./media/track/audiotrack"),s=e("./media/track/videotrack"),a=e("events").EventEmitter,u=e("util").inherits,c=e("./util"),l=e("./media"),d=0;u(r,a),r.prototype.toString=function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"},r.prototype._handleTrackSignalingEvents=function(){function e(e){e.getMediaStreamTrack().then(function(t){var o=t[0],a=t[1],u="audio"===e.kind?r:s,l=new u(a,o,e,{log:n});i._addTrack(l),n.info("Added a new "+c.trackClass(l)+":",l.id),n.debug(c.trackClass(l)+":",l)})}function t(e){e.getMediaStreamTrack().then(function(){var t=i.tracks.get(e.id);t&&(i._removeTrack(t),n.info("Removed a "+c.trackClass(t)+":",t.id),n.debug(c.trackClass(t)+":",t))})}var n=this._log;if("disconnected"!==this.state){var r=this._AudioTrack,i=this.media,o=this._signaling,s=this._VideoTrack;o.on("trackAdded",e),o.on("trackRemoved",t),o.tracks.forEach(e),o.on("stateChanged",function r(i){"disconnected"===i&&(n.debug("Removing TrackSignaling listeners"),o.removeListener("stateChanged",r),o.removeListener("trackAdded",e),o.removeListener("trackRemoved",t))})}},t.exports=r},{"./media":7,"./media/track/audiotrack":9,"./media/track/videotrack":14,"./util":51,events:70,util:109}],16:[function(e,t,n){"use strict";function r(){i.call(this),Object.defineProperties(this,{_queuedEvents:{value:new Map}})}var i=e("events").EventEmitter;(0,e("util").inherits)(r,i),r.prototype.dequeue=function(e){var t=!0;if(!e)return this._queuedEvents.forEach(function(e,n){t=this.dequeue(n)&&t},this),t;var n=this._queuedEvents.get(e)||[];this._queuedEvents.delete(e);var r=this;return n.reduce(function(t,n){return r.emit.apply(r,[e].concat(n))&&t},t)},r.prototype.queue=function(){var e=[].slice.call(arguments);if(this.emit.apply(this,e))return!0;var t=e[0];return this._queuedEvents.has(t)||this._queuedEvents.set(t,[]),this._queuedEvents.get(t).push(e.slice(1)),!1},t.exports=r},{events:70,util:109}],17:[function(e,t,n){"use strict";function r(e,t){return new Promise(function(n,r){if("string"!=typeof e||!t)throw new Error("<String>method and <Object>params are required args.");var o=new i;o.open(e.toUpperCase(),t.url,!0),o.withCredentials=!!t.withCredentials,o.onreadystatechange=function(){4===o.readyState&&(200<=o.status&&o.status<300?n(o.responseText):r(o.responseText))};for(var s in t.headers)o.setRequestHeader(s,t.headers[s]);o.send(t.body)})}var i=e("xmlhttprequest").XMLHttpRequest;r.get=r.bind(null,"GET"),r.post=r.bind(null,"POST"),t.exports=r},{xmlhttprequest:112}],18:[function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);a.call(this);var i=n.log.createLog("default",this),u=new Map;Object.defineProperties(this,{_log:{value:i},_instanceId:{value:++d},_options:{value:n},_participants:{value:u},_signaling:{value:t},isRecording:{enumerable:!0,get:function(){return t.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:t.name},participants:{enumerable:!0,value:u},sid:{enumerable:!0,value:t.sid},state:{enumerable:!0,get:function(){return t.state}}}),o(this,t.recording),s(this,t),i.info("Created a new Room:",this.name),i.debug("Initial Participants:",Array.from(this._participants.values()))}function i(e,t){var n=e._log,r=new c(t,{log:n});n.info("A new Participant connected:",r),e._participants.set(r.sid,r),e.emit("participantConnected",r);var i=["trackAdded","trackDimensionsChanged","trackDisabled","trackEnabled","trackRemoved","trackStarted"].map(function(t){function n(){var n=[].slice.call(arguments);n.unshift(t),n.push(r),e.emit.apply(e,n)}return r.on(t,n),[t,n]});r.once("disconnected",function(){n.info("Participant disconnected:",r),e._participants.delete(r.sid),i.forEach(function(e){r.removeListener(e[0],e[1])}),e.emit("participantDisconnected",r)})}function o(e,t){t.on("updated",function(){var n=t.isEnabled;e._log.info("Recording "+(n?"started":"stopped")),e.emit("recording"+(n?"Started":"Stopped"))})}function s(e,t){var n=e._log;n.debug("Creating a new Participant for each ParticipantSignaling in the RoomSignaling"),t.participants.forEach(i.bind(null,e)),n.debug("Setting up Participant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),t.on("participantConnected",i.bind(null,e)),t.on("stateChanged",function(r){var i=t.didDisconnectUnexpectedly?new l.SIGNALING_CONNECTION_DISCONNECTED:null;n.info("Transitioned to state:",r),e.emit(r,e,i),"disconnected"===r&&e._options.shouldStopLocalMedia&&(n.info("Room disconnected. We now stop any automatically acquired LocalMedia"),e.localParticipant.media.stop())})}var a=e("events").EventEmitter,u=e("util").inherits,c=e("./participant"),l=e("./util/constants").twilioErrors,d=0;u(r,a),r.prototype.toString=function(){return"[Room #"+this._instanceId+": "+this.sid+"]"},r.prototype.disconnect=function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this},r.prototype.getStats=function(){return this._signaling.getStats()},t.exports=r},{"./participant":15,"./util/constants":49,events:70,util:109}],19:[function(e,t,n){"use strict";function r(){a.call(this,"closed",u)}var i=e("util").inherits,o=e("./participant"),s=e("./room"),a=e("../statemachine"),u={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]};i(r,a),r.prototype._close=function(e){return this.transition("closing",e),this.transition("closed",e),Promise.resolve(this)},r.prototype._connect=function(e,t,n,r,i){e.connect("PA00000000000000000000000000000000",r);var o="RM00000000000000000000000000000000",a=Promise.resolve(new s(e,o,i));return a.cancel=function(){},a},r.prototype._open=function(e){return this.transition("opening",e),this.transition("open",e),Promise.resolve(this)},r.prototype.close=function(){var e=this;return this.bracket("close",function(t){switch(e.state){case"closed":return e;case"open":return e._close(t);default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})},r.prototype.connect=function(e,t,n,r,i){var o=this;return this.bracket("connect",function s(a){switch(o.state){case"closed":return o._open(a).then(s.bind(null,a));case"open":return o.releaseLockCompletely(a),o._connect(e,t,n,r,i);default:throw new Error('Unexpected Signaling state "'+o.state+'"')}})},r.prototype.createLocalParticipantSignaling=function(){return new o},r.prototype.open=function(){var e=this;return this.bracket("open",function(t){switch(e.state){case"closed":return e._open(t);case"open":return e;default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})},t.exports=r},{"../statemachine":39,"./participant":21,"./room":24,util:109}],20:[function(e,t,n){"use strict";function r(e,t){o.call(this,e.id,e.kind,e.enabled),this.setMediaStreamTrack(e,t)}var i=e("util").inherits,o=e("./track");i(r,o),t.exports=r},{"./track":25,util:109}],21:[function(e,t,n){"use strict";function r(){o.call(this,"connecting",s),Object.defineProperties(this,{_identity:{writable:!0,value:null},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}})}var i=e("util").inherits,o=e("../statemachine"),s={connecting:["connected"],connected:["disconnected"],disconnected:[]};i(r,o),r.prototype.addTrack=function(e){return this.tracks.set(e.id,e),this.emit("trackAdded",e),this},r.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)},r.prototype.removeTrack=function(e){var t=this.tracks.delete(e.id);return t&&this.emit("trackRemoved",e),t},r.prototype.connect=function(e,t){return"connecting"===this.state&&(this._sid=e,this._identity=t,this.preempt("connected"),!0)},t.exports=r},{"../statemachine":39,util:109}],22:[function(e,t,n){"use strict";function r(){i.call(this),Object.defineProperties(this,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}})}var i=e("events").EventEmitter;(0,e("util").inherits)(r,i),r.prototype.disable=function(){return this.enable(!1)},r.prototype.enable=function(e){return e="boolean"!=typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},t.exports=r},{events:70,util:109}],23:[function(e,t,n){"use strict";function r(e,t){o.call(this),this.connect(e,t)}var i=e("util").inherits,o=e("./participant");i(r,o),t.exports=r},{"./participant":21,util:109}],24:[function(e,t,n){"use strict";function r(e,t,n,r){r=Object.assign({RecordingSignaling:o},r),s.call(this,"connected",a);var i=r.RecordingSignaling;Object.defineProperties(this,{_options:{value:r},didDisconnectUnexpectedly:{value:!1,writable:!0,enumerable:!0},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:n},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new i},sid:{enumerable:!0,value:t}})}var i=e("util").inherits,o=e("./recording"),s=e("../statemachine"),a={connected:["disconnected"],disconnected:[]};i(r,s),r.prototype._handleUnexpectedDisconnect=function(){return this.didDisconnectUnexpectedly=!0,this.disconnect()},r.prototype.connectParticipant=function(e){var t=this;return"disconnected"!==e.state&&(!this.participants.has(e.sid)&&(this.participants.set(e.sid,e),e.on("stateChanged",function n(r){"disconnected"===r&&(e.removeListener("stateChanged",n),t.participants.delete(e.sid),t.emit("participantDisconnected",e))}),this.emit("participantConnected",e),!0))},r.prototype.disconnect=function(){return"connected"===this.state&&(this.preempt("disconnected"),!0)},t.exports=r},{"../statemachine":39,"./recording":22,util:109}],25:[function(e,t,n){"use strict";function r(e,t,n){i.call(this);var r,o;Object.defineProperties(this,{_isEnabled:{value:n,writable:!0},_mediaStream:{get:function(){return r},set:function(e){r=e,this._mediaStreamDeferred.resolve(r)}},_mediaStreamDeferred:{value:s.defer()},_mediaStreamTrack:{get:function(){return o},set:function(e){o=e,this._mediaStreamTrackDeferred.resolve(o)}},_mediaStreamTrackDeferred:{value:s.defer()},id:{enumerable:!0,value:e},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},kind:{enumerable:!0,value:t},mediaStream:{enumerable:!0,get:function(){return r}},mediaStreamTrack:{enumerable:!0,get:function(){return o}}})}var i=e("events").EventEmitter,o=e("util").inherits,s=e("../util");o(r,i),r.prototype.disable=function(){return this.enable(!1)},r.prototype.enable=function(e){return e="boolean"!=typeof e||e,this.isEnabled!==e&&(this._isEnabled=e,this.emit("updated")),this},r.prototype.getMediaStreamTrack=function(){return Promise.all([this._mediaStreamTrackDeferred.promise,this._mediaStreamDeferred.promise])},r.prototype.setMediaStreamTrack=function(e,t){return this._mediaStream=t,this._mediaStreamTrack=e,this},t.exports=r},{"../util":51,events:70,util:109}],26:[function(e,t,n){"use strict";function r(e,t,n,r,c){c=Object.assign({PeerConnectionManager:o,RoomV2:s,Transport:a},c);var l,d=c.PeerConnectionManager,f=c.RoomV2,p=new d;p.setConfiguration(c);var h=new Set;r.tracks.forEach(function(e){h.add(e.mediaStream)}),h.forEach(p.addMediaStream,p);var m=new Error("Canceled");return new i(function(i,o,s){p.createAndOffer().then(function(){return p.dequeue("description"),new Promise(function(i,o){if(s())return void o(m);l=new(0,c.Transport)(c.to,e,t,r,p,n),l.once("connected",function(e){if(s())return void o(m);var t=e.participant;if(!t)return void o(new Error("Missing LocalParticipant information"));r.connect(t.sid,t.identity),i(new f(r,e,l,p,c))}),l.once("stateChanged",function(e){"disconnected"===e&&(l=null,o(new u.SIGNALING_CONNECTION_DISCONNECTED))})})}).then(function(e){if(s())return p.close(),e.disconnect(),void o(m);i(e)}).catch(function(e){l&&(l.disconnect(),l=null),p.close(),o(e)})},function(){l&&(l.disconnect(),l=null)})}var i=e("../../util/cancelablepromise"),o=e("./peerconnectionmanager"),s=e("./room"),a=e("./transport"),u=e("../../util/constants").twilioErrors;t.exports=r},{"../../util/cancelablepromise":48,"../../util/constants":49,"./peerconnectionmanager":31,"./room":34,"./transport":37}],27:[function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;Object.defineProperties(this,{_filter:{value:new i({getKey:function(e){return e.ufrag},isLessThanOrEqualTo:function(e,t){return e.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}var i=e("../../util/filter");r.prototype.setUfrag=function(e){this._ufrag=e;var t=this._filter.toMap().get(e);return t?t.candidates:[]},r.prototype.update=function(e){e.candidates=e.candidates||[];var t=this._filter.toMap().get(e.ufrag),n=t?t.candidates:[];return this._filter.update(e)&&this._ufrag===e.ufrag?e.candidates.slice(n.length):[]},t.exports=r},{"../../util/filter":50}],28:[function(e,t,n){"use strict";function r(e,t,n,r){var s=d.makeRegistrationSIPURI(t,n);r=Object.assign({createCancelableRoomSignalingPromise:o,registrarServer:i.REGISTRAR_SERVER(t),UA:c.UA},r);var a="debug"===r.logLevel,f=e.startsWith("wss://"),p=r.UA,h=new p({autostart:!1,log:{builtinEnabled:a},extraSupported:["room-signaling","timer"],hackAllowUnregisteredOptionTags:!0,keepAliveInterval:30,mediaHandlerFactory:l.defaultFactory,register:!1,registrarServer:r.registrarServer,traceSip:a,uri:s,wsServers:e,hackWssInTransport:f});u.call(this),Object.defineProperties(this,{_createCancelableRoomSignalingPromise:{value:r.createCancelableRoomSignalingPromise},_options:{value:r},_ua:{value:h}})}var i=e("../../util/constants"),o=e("./cancelableroomsignalingpromise"),s=e("util").inherits,a=e("./localparticipant"),u=e("../"),c=e("../../sip"),l=e("./sipjsmediahandler"),d=e("../../util");s(r,u),r.prototype._close=function(e){return this.transition("closing",e),this._ua.stop(),this._ua.transport.disconnect(),this.transition("closed",e),Promise.resolve(this)},r.prototype._open=function(e){function t(){n._ua.start()}var n=this;return this.transition("opening",e),d.promiseFromEvents(t,this._ua,"connected","disconnected").then(function(){return n.transition("open",e),n},function(){throw n.transition("closed",e),new Error("Open failed")})},r.prototype._connect=function(e,t,n,r,o){o=Object.assign({iceServers:i.DEFAULT_ICE_SERVERS},this._options,o);var s=this._ua;return this._createCancelableRoomSignalingPromise.bind(null,n,t,s,e,o)},r.prototype.createLocalParticipantSignaling=function(){return new a},t.exports=r},{"../":19,"../../sip":38,"../../util":51,"../../util/constants":49,"./cancelableroomsignalingpromise":26,"./localparticipant":29,"./sipjsmediahandler":35,util:109}],29:[function(e,t,n){"use strict";function r(){if(!(this instanceof r))return new r;s.call(this),Object.defineProperties(this,{_revision:{writable:!0,value:1},revision:{enumerable:!0,get:function(){return this._revision}}})}var i=e("./track").getState,o=e("util").inherits,s=e("../participant");o(r,s),r.prototype.update=function(){return this._revision++,this},r.prototype.getState=function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(i)}},t.exports=r},{"../participant":21,"./track":36,util:109}],30:[function(e,t,n){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);d.call(this,"open",v),t=Object.assign(m,t);var n=o(t),i=t.RTCPeerConnection,s=new i(n);Object.defineProperties(this,{_descriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCandidatesRevision:{writable:!0,value:1},_localDescription:{writable:!0,value:null},_localUfrag:{writable:!0,value:null},_offerOptions:{writable:!0,value:t.offerOptions},_peerConnection:{value:s},_remoteCandidates:{writable:!0,value:new c},_RTCIceCandidate:{value:t.RTCIceCandidate},_RTCPeerConnection:{value:t.RTCPeerConnection},_RTCSessionDescription:{value:t.RTCSessionDescription},id:{enumerable:!0,value:e}}),s.addEventListener("icecandidate",this._handleIceCandidateEvent.bind(this)),s.addEventListener("signalingstatechange",this._handleSignalingStateChange.bind(this)),s.addEventListener("track",this._handleTrackEvent.bind(this))}function i(e){if(e.sdp){var t=e.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+\/]+)/m);if(t)return t[1]}return null}function o(e){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},e)}var s=e("../../webrtc/rtcicecandidate"),a=e("../../webrtc/rtcpeerconnection"),u=e("../../webrtc/rtcsessiondescription"),c=e("./icebox"),l=e("util").inherits,d=e("../../../lib/statemachine"),f=e("../../webrtc/getstats"),p=e("../../stats/statsreport"),h=e("../../util/constants").twilioErrors,m={iceServers:[],offerOptions:{offerToReceiveAudio:!0,offerToReceiveVideo:!0},RTCIceCandidate:s,RTCPeerConnection:a,RTCSessionDescription:u},v={open:["closed","updating"],updating:["closed","open"],closed:[]};l(r,d),r.prototype._addIceCandidate=function(e){var t=this._RTCIceCandidate,n=this;return new Promise(function(r,i){n._peerConnection.addIceCandidate(new t(e),r,i)}).then(function(){return n})},r.prototype._addIceCandidates=function(e){var t=this;return Promise.all(e.map(this._addIceCandidate,this)).then(function(){return t})},r.prototype._answer=function(e){var t=this._RTCSessionDescription,n=this;return new Promise(function(r,i){var o=new t(e),s=i.bind(null,new h.MEDIA_CLIENT_REMOTE_DESC_FAILED);n._peerConnection.setRemoteDescription(o,r,s)}).then(function(){var t=i(e);if(t){var r=n._remoteCandidates.setUfrag(t);n._addIceCandidates(r)}return new Promise(function(e,t){var r=t.bind(null,new h.MEDIA_CLIENT_LOCAL_DESC_FAILED);n._peerConnection.createAnswer(e,r)})}).then(function(e){return n._setLocalDescription(e)}).then(function(){return n})},r.prototype._close=function(){return"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),!0)},r.prototype._handleGlare=function(e){var t=this._RTCSessionDescription,n=new t({type:"rollback"}),r=this;return this._setLocalDescription(n).then(function(){return r._answer(e)}).then(function(){return r._offer()})},r.prototype._handleIceCandidateEvent=function(e){e.candidate&&this._localCandidates.push(e.candidate);var t={ice:{candidates:this._localCandidates.slice(),revision:this._localCandidatesRevision++,ufrag:this._localUfrag},id:this.id};e.candidate||(t.ice.complete=!0),this.emit("candidates",t)},r.prototype._handleSignalingStateChange=function(){"closed"===this._peerConnection.signalingState&&"closed"!==this.state&&this.preempt("closed")},r.prototype._handleTrackEvent=function(e){var t=e.track,n=e.streams[0];this.emit("trackAdded",t,n)},r.prototype._offer=function(){var e=this;return new Promise(function(t,n){var r=n.bind(null,new h.MEDIA_CLIENT_LOCAL_DESC_FAILED);e._peerConnection.createOffer(t,r,e._offerOptions)}).then(function(t){return e._setLocalDescription(t)})},r.prototype._setLocalDescription=function(e){var t=this._RTCSessionDescription,n=this;return new Promise(function(r,i){var o=i.bind(null,new h.MEDIA_CLIENT_LOCAL_DESC_FAILED);n._peerConnection.setLocalDescription(new t(e),r,o)}).then(function(){return"rollback"!==e.type&&(n._localDescription=e,n._localCandidates=[],"offer"===e.type&&n._descriptionRevision++,n._localUfrag=i(e),n.emit("description",n.getState())),n})},r.prototype._updateDescription=function(e){switch(e.type){case"answer":case"pranswer":if(e.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve(this);this._descriptionRevision=e.revision;break;case"close":return e.revision<this._descriptionRevision||e.revision===this._descriptionRevision&&"have-local-offer"!==this._peerConnection.signalingState||"closed"===this._peerConnection.signalingState?Promise.resolve(this):this._close();case"create-offer":return e.revision<=this._descriptionRevision||"stable"!==this._peerConnection.signalingState?Promise.resolve(this):(this._descriptionRevision=e.revision,this._offer());case"offer":return e.revision<this._descriptionRevision||e.revision===this._descriptionRevision&&"have-local-offer"!==this._peerConnection.signalingState||"closed"===this._peerConnection.signalingState?Promise.resolve(this):e.revision>=this._descriptionRevision&&"have-local-offer"===this._peerConnection.signalingState?(this._descriptionRevision=e.revision,this._handleGlare(e)):(this._descriptionRevision=e.revision,this._answer(e))}var t=this._RTCSessionDescription,n=this;return new Promise(function(r,i){var o=i.bind(null,new h.MEDIA_CLIENT_REMOTE_DESC_FAILED);n._peerConnection.setRemoteDescription(new t(e),r,o)}).then(function(){var t=i(e);if(t){var r=n._remoteCandidates.setUfrag(t);return n._addIceCandidates(r)}return n})},r.prototype._updateIce=function(e){var t=this._remoteCandidates.update(e);return this._addIceCandidates(t)},r.prototype.addMediaStream=function(e){return this._peerConnection.addStream(e),this},r.prototype.close=function(){return this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState())),this},r.prototype.getRemoteMediaStreams=function(){return this._peerConnection.getRemoteStreams()},r.prototype.getState=function(){if(!this._localDescription)return null;var e={type:this._localDescription.type,revision:this._descriptionRevision};return this._localDescription.sdp&&(e.sdp=this._localDescription.sdp),{description:e,id:this.id}},r.prototype.offer=function(){var e=this;return this.bracket("offering",function(t){return e.transition("updating",t),e._offer().then(function(){return e.tryTransition("open",t),e},function(n){throw e.tryTransition("open",t),n})})},r.prototype.removeMediaStream=function(e){return this._peerConnection.removeStream(e),this},r.prototype.setConfiguration=function(e){return"function"==typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(o(e)),this},r.prototype.update=function(e){var t=this;return this.bracket("updating",function(n){if("closed"===t.state)return Promise.resolve(t);t.transition("updating",n);var r=[];return e.ice&&r.push(t._updateIce(e.ice)),e.description&&r.push(t._updateDescription(e.description)),Promise.all(r).then(function(){return t.tryTransition("open",n),t},function(e){throw t.tryTransition("open",n),e})})},r.prototype.getStats=function(){var e=this;return f(this._peerConnection).then(function(t){return new p(e.id,t)})},t.exports=r},{"../../../lib/statemachine":39,"../../stats/statsreport":46,"../../util/constants":49,"../../webrtc/getstats":58,"../../webrtc/rtcicecandidate":60,"../../webrtc/rtcpeerconnection":63,"../../webrtc/rtcsessiondescription":66,"./icebox":27,util:109}],31:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);s.call(this),e=Object.assign({PeerConnectionV2:o},e),Object.defineProperties(this,{_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:a.defer()},_localMediaStreams:{value:new Set},_localMediaStreamTracks:{value:new Set},_peerConnections:{value:new Map},_PeerConnectionV2:{value:e.PeerConnectionV2}})}var i=e("util").inherits,o=e("./peerconnection"),s=e("../../queueingeventemitter"),a=e("../../util");i(r,s),r.prototype._getConfiguration=function(){return this._configurationDeferred.promise},r.prototype._getOrCreate=function(e,t){var n=this,r=this._peerConnections.get(e);if(!r){r=new(0,this._PeerConnectionV2)(e,t),this._peerConnections.set(r.id,r),r.on("candidates",this.queue.bind(this,"candidates")),r.on("description",this.queue.bind(this,"description")),r.on("trackAdded",this.queue.bind(this,"trackAdded")),r.on("stateChanged",function e(t){"closed"===t&&(r.removeListener("stateChanged",e),n._peerConnections.delete(r.id),n._closedPeerConnectionIds.add(r.id))}),this._localMediaStreams.forEach(r.addMediaStream,r)}return r},r.prototype.addMediaStream=function(e){return this._localMediaStreams.add(e),e.getTracks().forEach(function(e){this._localMediaStreamTracks.add(e)},this),this._peerConnections.forEach(function(t){t.addMediaStream(e)},this),this},r.prototype.close=function(){return this._peerConnections.forEach(function(e){e.close()}),this},r.prototype.createAndOffer=function(){var e=this;return this._getConfiguration().then(function(t){var n;do n=a.makeUUID();while(e._peerConnections.has(n));return e._getOrCreate(n,t)}).then(function(e){return e.offer()}).then(function(){return e})},r.prototype.getRemoteMediaStreams=function(){var e=[];return this._peerConnections.forEach(function(t){e=e.concat(t.getRemoteMediaStreams())}),e},r.prototype.getStates=function(){var e=[];return this._peerConnections.forEach(function(t){var n=t.getState();n&&e.push(n)}),e},r.prototype.removeMediaStream=function(e){var t=this._localMediaStreams.delete(e);return this._peerConnections.forEach(function(t){t.removeMediaStream(e),e.getTracks().forEach(function(e){this._localMediaStreamTracks.delete(e)},this)},this),t},r.prototype.setConfiguration=function(e){return this._configuration&&(this._configurationDeferred=a.defer(),this._peerConnections.forEach(function(t){t.setConfiguration(e)})),this._configuration=e,this._configurationDeferred.resolve(e),this},r.prototype.setMediaStreams=function(e){var t=new Set(this._localMediaStreamTracks.values());this._localMediaStreamTracks.clear(),this._localMediaStreams.forEach(this.removeMediaStream,this),e.forEach(this.addMediaStream,this);var n=this._localMediaStreamTracks,r=!1;return t.size!==n.size?r=!0:t.forEach(function(e){n.has(e)||(r=!0)}),r&&this._peerConnections.forEach(function(e){e.offer()}),this},r.prototype.update=function(e){var t=this;return this._getConfiguration().then(function(n){return Promise.all(e.map(function(e){return t._closedPeerConnectionIds.has(e.id)?null:t._getOrCreate(e.id,n).update(e)}))}).then(function(){return t})},r.prototype.getStats=function(){var e=Array.from(this._peerConnections.values());return Promise.all(e.map(function(e){return e.getStats()}))},t.exports=r},{"../../queueingeventemitter":16,"../../util":51,"./peerconnection":30,util:109}],32:[function(e,t,n){"use strict";function r(){o.call(this),Object.defineProperties(this,{_revision:{value:1,writable:!0}})}var i=e("util").inherits,o=e("../recording");i(r,o),r.prototype.update=function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.enabled))},t.exports=r},{"../recording":22,util:109}],33:[function(e,t,n){"use strict";function r(e,t,n){return this instanceof r?(o.call(this,e.sid,e.identity),n=Object.assign({TrackV2:s},n),Object.defineProperties(this,{_revision:{writable:!0,value:null},_TrackV2:{value:n.TrackV2},_getMediaStreamTrack:{value:t},revision:{enumerable:!0,get:function(){return this._revision}}}),this.update(e)):new r(e,t,n)}var i=e("util").inherits,o=e("../remoteparticipant"),s=e("./track");i(r,o),r.prototype._getOrCreateTrack=function(e){var t=this._TrackV2,n=this.tracks.get(e.id);return n||(n=new t(e),this.addTrack(n)),n},r.prototype.update=function(e){if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var t=new Set;return e.tracks.forEach(function(e){var n=this._getOrCreateTrack(e);n.update(e),t.add(n)},this),this.tracks.forEach(function(e){t.has(e)||this.removeTrack(e)},this),"disconnected"===e.state&&"connected"===this.state&&this.preempt("disconnected"),this},r.prototype.addTrack=function(e){return o.prototype.addTrack.call(this,e),this._getMediaStreamTrack(e.id).then(function(t){var n=t[0],r=t[1];e.setMediaStreamTrack(n,r)}),this},t.exports=r},{"../remoteparticipant":23,"./track":36,util:109}],34:[function(e,t,n){"use strict";function r(e,t,n,a,d){if(!(this instanceof r))return new r(e,t,n,a,d);d=Object.assign({RecordingSignaling:u,RemoteParticipantV2:l},d),c.call(this,e,t.sid,t.name,d),Object.defineProperties(this,{_disconnectedParticipantSids:{value:new Set},_peerConnectionManager:{value:a},_RemoteParticipantV2:{value:d.RemoteParticipantV2},_transport:{value:n},_trackIdToParticipants:{value:new Map},_mediaStreamTrackDeferreds:{value:new Map}}),i(this,e),o(this,a),s(this,n),this._update(t)}function i(e,t){function n(){var e=new Set;t.tracks.forEach(function(t){e.add(t.mediaStream)}),u.setMediaStreams(e)}function r(t){function n(){e._publishNewLocalParticipantState()}t.on("updated",n),i(t),a.set(t,t.removeListener.bind(t,"updated",n))}function i(e){var t=a.get(e);t&&t()}function o(t){r(t),e._publishNewLocalParticipantState(),n()}function s(t){i(t),e._publishNewLocalParticipantState(),n()}var a=new Map,u=e._peerConnectionManager;t.on("trackAdded",o),t.on("trackRemoved",s),t.tracks.forEach(r),e.on("stateChanged",function n(r){"disconnected"===r&&(t.removeListener("trackAdded",o),t.removeListener("trackRemoved",s),e.removeListener("stateChanged",n),t.disconnect())})}function o(e,t){t.on("description",function(t){e._publishPeerConnectionState(t)}),t.dequeue("description"),t.on("candidates",function(t){e._publishPeerConnectionState(t)}),t.dequeue("candidates"),t.on("trackAdded",e._addMediaStreamTrack.bind(e)),t.dequeue("trackAdded"),t.getRemoteMediaStreams().forEach(function(t){t.getTracks().forEach(function(n){e._addMediaStreamTrack(n,t)})})}function s(e,t){t.on("message",e._update.bind(e)),t.on("stateChanged",function n(r){"disconnected"===r&&("connected"===e.state&&e._handleUnexpectedDisconnect(),t.removeListener("stateChanged",n))})}var a=e("util").inherits,u=e("./recording"),c=e("../room"),l=e("./remoteparticipant"),d=e("../../util");a(r,c),r.prototype._deleteMediaStreamTrackDeferred=function(e){return this._mediaStreamTrackDeferreds.delete(e)},r.prototype._getOrCreateMediaStreamTrackDeferred=function(e){var t=this._mediaStreamTrackDeferreds.get(e);return t||(t=d.defer(),this._mediaStreamTrackDeferreds.set(e,t)),t},r.prototype._addMediaStreamTrack=function(e,t){return this._getOrCreateMediaStreamTrackDeferred(e.id).resolve([e,t]),this},r.prototype.disconnect=function(){var e=c.prototype.disconnect.call(this);return e&&this._transport.disconnect(),e},r.prototype._getMediaStreamTrack=function(e){var t=this;return this._getOrCreateMediaStreamTrackDeferred(e).promise.then(function(n){return t._deleteMediaStreamTrackDeferred(e),n})},r.prototype._getOrCreateRemoteParticipant=function(e){var t=this._RemoteParticipantV2,n=this.participants.get(e.sid),r=this;return n||(n=new t(e,this._getMediaStreamTrack.bind(this)),n.on("stateChanged",function e(t){"disconnected"===t&&(n.removeListener("stateChanged",e),r.participants.delete(n.sid),r._disconnectedParticipantSids.add(n.sid))}),this.connectParticipant(n)),n},r.prototype._getState=function(){return{participant:this.localParticipant.getState()}},r.prototype._publishNewLocalParticipantState=function(){this.localParticipant.update(),this._transport.publish(this._getState())},r.prototype._publishPeerConnectionState=function(e){this._transport.publish(Object.assign({peer_connections:[e]},this._getState()))},r.prototype._update=function(e){var t=new Set;return(e.participants||[]).forEach(function(e){if(e.sid!==this.localParticipant.sid&&!this._disconnectedParticipantSids.has(e.sid)){var n=this._getOrCreateRemoteParticipant(e);n.update(e),t.add(n)}},this),e.peer_connections&&this._peerConnectionManager.update(e.peer_connections),e.recording&&this.recording.update(e.recording),this},r.prototype.getStats=function(){return this._peerConnectionManager.getStats()},t.exports=r},{"../../util":51,"../room":24,"./recording":32,"./remoteparticipant":33,util:109}],35:[function(e,t,n){"use strict";function r(e,t){if(!(this instanceof r))return new r(e);Object.defineProperties(this,{createMessage:{enumerable:!0,value:t},peerConnectionManager:{enumerable:!0,value:e}})}function i(e){try{return JSON.parse(e.body)}catch(e){return null}}var o=e("../../sip");r.defaultFactory=function(){},r.defaultFactory.isSupported=function(){return o.WebRTC.isSupported()},r.prototype.close=function(){this.peerConnectionManager.close()},r.prototype.getDescription=function(){var e=Object.assign({peer_connections:this.peerConnectionManager.getStates()},this.createMessage());return Promise.resolve({body:JSON.stringify(e),contentType:"application/room-signaling+json"})},r.prototype.hasDescription=function(){return!0},r.prototype.hold=function(){},r.prototype.isReady=function(){return!0},r.prototype.isMuted=function(){return{audio:!1,video:!1}},r.prototype.mute=function(){},r.prototype.render=function(){},r.prototype.setDescription=function(e){var t=i(e);if(t){var n=t.peer_connections;if(n)return this.peerConnectionManager.update(n)}return Promise.resolve()},r.prototype.unhold=function(){},r.prototype.unmute=function(){},r.prototype.updateIceServers=function(){},t.exports=r},{"../../sip":38}],36:[function(e,t,n){"use strict";function r(e){o.call(this,e.id,e.kind,e.enabled)}var i=e("util").inherits,o=e("../track");i(r,o),r.getState=function(e){return{enabled:e.isEnabled,id:e.id,kind:e.kind}},r.prototype.update=function(e){return this.enable(e.enabled),this},t.exports=r},{"../track":25,util:109}],37:[function(e,t,n){"use strict";function r(e,t,n,o,s,a,c){if(!(this instanceof r))return new r(e,t,n,o,s,a,c);c=Object.assign({SIPJSMediaHandler:f},c),p.call(this,"connecting",v);var l=i(this,e,t,n,o,s,a,c.SIPJSMediaHandler);Object.defineProperties(this,{_session:{value:l},_updatesReceived:{value:[]},_updatesToSend:{value:[]}}),u(this,l,a)}function i(e,t,n,r,i,o,s,a){var u="sip:"+h.makeSIPURI(n,"orchestrator");return s.invite(u,{extraHeaders:[c.headers.X_TWILIO_ACCESSTOKEN+": "+r,"Session-Expires: 120"],media:{stream:{}},mediaHandlerFactory:function(){return new a(o,function(){if("disconnected"===e.state)return{type:"disconnect",version:m};var n={connecting:"connect",syncing:"sync"}[e.state]||"update",r={name:t,participant:i.getState(),type:n,version:m},o=h.getSdpFormat();return"connect"===n&&o&&(r.format=o),r})},onInfo:function(e){this.emit("info",e),e.reply(200)}})}function o(e,t,n){return n=n||0,new Promise(function(r,i){function s(s){switch(Math.floor(s.status_code/100)){case 2:r();break;case 5:if(n<c.PUBLISH_MAX_ATTEMPTS){r(o(e,t,++n));break}break;default:i(s)}}function a(){e.sendRequest("INFO",{body:JSON.stringify(t),extraHeaders:["Content-Type: application/room-signaling+json","Event: room-signaling","Info-Package: room-signaling"],receiveResponse:s})}if(0===n)return void a();setTimeout(a,n*c.PUBLISH_BACKOFF_MS)})}function s(e){return Array.from(e.reduce(function(e,t){var n=e.get(t.id)||t;return!n.description&&t.description?n.description=t.description:n.description&&t.description&&t.description.revision>n.description.revision&&(n.description=t.description),!n.ice&&t.ice?n.ice=t.ice:n.ice&&t.ice&&t.ice.revision>n.ice.revision&&(n.ice=t.ice),e.set(n.id,n),e},new Map).values())}function a(e){return e.reduce(function(e,t){return!e.participant&&t.participant?e.participant=t.participant:e.participant&&t.participant&&t.participant.revision>e.participant.revision&&(e.participant=t.participant),!e.peer_connections&&t.peer_connections?e.peer_connections=s(t.peer_connections):e.peer_connections&&t.peer_connections&&(e.peer_connections=s(e.peer_connections.concat(t.peer_connections))),e},{type:"update",version:m})}function u(e,t,n){function r(){e.disconnect()}function i(t){if(!(t instanceof d.OutgoingRequest)){var n;try{n=JSON.parse(t.body)}catch(e){return}switch(e.state){case"connected":switch(n.type){case"connected":case"synced":case"update":return void e.emit("message",n);case"error":case"disconnected":return void e.disconnect();default:return}case"connecting":switch(n.type){case"connected":return e.emit("connected",n),void e.preempt("connected");case"synced":case"update":return void e._updatesReceived.push(n);case"error":case"disconnected":return void e.disconnect();default:return}case"disconnected":return;case"syncing":switch(n.type){case"connected":case"update":return void e._updatesReceived.push(n);case"synced":return e.emit("message",n),void e.preempt("connected");case"disconnected":case"error":return void e.disconnect();default:return}default:return}}}t.on("info",i),t.once("bye",r),t.once("accepted",i),t.once("failed",r),e.on("stateChanged",function n(o){switch(o){case"connected":t.removeListener("accepted",i),t.removeListener("failed",r);var s=e._updatesToSend.splice(0);return s.length&&e.publish(a(s)),void e._updatesReceived.splice(0).forEach(e.emit.bind(e,"message"));case"disconnected":return t.removeListener("accepted",i),t.removeListener("failed",r),t.removeListener("info",i),t.removeListener("bye",r),void e.removeListener("stateChanged",n);case"syncing":return;default:return}}),n.once("disconnected",r)}var c=e("../../util/constants"),l=e("util").inherits,d=e("../../sip"),f=e("./sipjsmediahandler"),p=e("../../statemachine"),h=e("../../util"),m=1,v={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]};l(r,p),r.prototype.disconnect=function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),this._session.terminate({body:JSON.stringify({type:"disconnect",version:m}),extraHeaders:["Content-Type: application/room-signaling+json"]}),!0)},r.prototype.publish=function(e){switch(e=Object.assign({type:"update",version:m},e),this.state){case"connected":return o(this._session,e),!0;case"connecting":case"syncing":return this._updatesToSend.push(e),!0;case"disconnected":default:return!1}},r.prototype.sync=function(){return"connected"===this.state&&(this.preempt("syncing"),this._session.sendReinvite(),!0)},t.exports=r},{"../../sip":38,"../../statemachine":39,"../../util":51,"../../util/constants":49,"./sipjsmediahandler":35,util:109}],38:[function(e,t,r){(function(n){"use strict";var r=n.window||n,i=e("sip.js/src/Transport"),o=r.WebSocket?r.WebSocket:e("ws"),s=r.addEventListener?r.addEventListener.bind(r):null;t.exports=e("sip.js/src/SIP")({addEventListener:s,console:r.console,Promise:r.Promise,WebSocket:o,timers:r,Transport:i})}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"sip.js/src/SIP":91,"sip.js/src/Transport":100,ws:111}],39:[function(e,t,n){"use strict";function r(e,t){d.call(this);var n=null,r=e;t=c(t),Object.defineProperties(this,{_lock:{get:function(){return n},set:function(e){n=e}},_reachableStates:{value:s(t)},_state:{get:function(){return r},set:function(e){r=e}},_states:{value:t},isLocked:{enumerable:!0,get:function(){return null!==n}},state:{enumerable:!0,get:function(){return r}}})}function i(e,t,n){return e.get(t).has(n)}function o(e){var t=p.defer();return t.name=e,t.depth=0,t}function s(e){return Array.from(e.keys()).reduce(function(t,n){return t.set(n,u(e,n))},new Map)}function u(e,t,n){return n=n||new Set,e.get(t).forEach(function(t){n.has(t)||(n.add(t),u(e,t,n).forEach(n.add,n))}),n}function c(e){var t=new Map;for(var n in e)t.set(n,new Set(e[n]));return t}function l(e,t){return new Error('"'+t+'" cannot be reached from "'+e+'"')}var d=e("events").EventEmitter,f=e("util").inherits,p=e("./util");f(r,d),r.prototype.bracket=function(e,t){function n(e){if(i.hasLock(r)&&i.releaseLockCompletely(r),e)throw e}var r,i=this;return this.takeLock(e).then(function(e){return r=e,t(r)}).then(function(e){return n(),e},n)},r.prototype.hasLock=function(e){return this._lock===e},r.prototype.preempt=function(e,t){if(!i(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');var n;this.isLocked&&(n=this._lock,this._lock=null);var r,o=null;null===t||void 0===t?n&&(r=new Error(n.name+" was preempted")):(n&&(r=new Error(n.name+" was preempted by "+t)),o=this.takeLockSync(t));var s=o?null:this.takeLockSync("preemption");return this.transition(e,o||s),n&&n.reject(r),s&&this.releaseLock(s),o},r.prototype.releaseLock=function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");0===e.depth?(this._lock=null,e.resolve()):e.depth--},r.prototype.releaseLockCompletely=function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");e.depth=0,this._lock=null,e.resolve()},r.prototype.takeLock=function e(t){if("object"===(void 0===t?"undefined":a(t))){var n=t,r=this;return new Promise(function(e){e(r.takeLockSync(n))})}var i=t;if(this.isLocked){var e=this.takeLock.bind(this,i);return this._lock.promise.then(e,e)}return Promise.resolve(this.takeLockSync(i))},r.prototype.takeLockSync=function(e){var t="string"==typeof e?null:e,n=t?t.name:e;if(t&&!this.hasLock(t)||!t&&this.isLocked)throw new Error("Could not take the lock for "+n+" because the lock for "+this._lock.name+" was not released");if(t)return t.depth++,t;var r=o(n);return this._lock=r,r},r.prototype.transition=function(e,t){if(this.isLocked){if(!t)throw new Error("You must provide the key in order to transition");if(!this.hasLock(t))throw new Error("Could not transition using the key for "+t.name+" because "+this._lock.name+" has the lock")}else if(t)throw new Error("Key provided for "+t.name+", but the StateMachine was not locked (possibly due to preemption)");if(!i(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');this._state=e,this.emit("stateChanged",e)},r.prototype.tryTransition=function(e,t){try{this.transition(e,t)}catch(e){return!1}return!0},r.prototype.when=function(e){var t=this;return this.state===e?Promise.resolve(this):i(this._reachableStates,this.state,e)?new Promise(function(n,r){t.on("stateChanged",function o(s){s===e?(t.removeListener("stateChanged",o),n(t)):i(t._reachableStates,s,e)||(t.removeListener("stateChanged",o),r(l(s,e)))})}):Promise.reject(l(this.state,e))},t.exports=r},{"./util":51,events:70,util:109}],40:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t),Object.defineProperties(this,{audioLevel:{value:"number"==typeof t.audioInputLevel?t.audioInputLevel:null,enumerable:!0},jitter:{value:"number"==typeof t.jitter?t.jitter:null,enumerable:!0}})}var i=e("util").inherits,o=e("./localtrackstats");i(r,o),t.exports=r},{"./localtrackstats":41,util:109}],41:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t),Object.defineProperties(this,{direction:{value:"sending",enumerable:!0},bytesSent:{value:"number"==typeof t.bytesSent?t.bytesSent:null,enumerable:!0},packetsSent:{value:"number"==typeof t.packetsSent?t.packetsSent:null,enumerable:!0},roundTripTime:{value:"number"==typeof t.roundTripTime?t.roundTripTime:null,enumerable:!0}})}var i=e("util").inherits,o=e("./trackstats");i(r,o),t.exports=r},{"./trackstats":47,util:109}],42:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t);var n=null;"number"==typeof t.frameWidthInput&&"number"==typeof t.frameHeightInput&&(n={},Object.defineProperties(n,{width:{value:t.frameWidthInput,enumerable:!0},height:{value:t.frameHeightInput,enumerable:!0}}));var r=null;"number"==typeof t.frameWidthSent&&"number"==typeof t.frameHeightSent&&(r={},Object.defineProperties(r,{width:{value:t.frameWidthSent,enumerable:!0},height:{value:t.frameHeightSent,enumerable:!0}})),Object.defineProperties(this,{captureDimensions:{value:n,enumerable:!0},dimensions:{value:r,enumerable:!0},captureFrameRate:{value:"number"==typeof t.frameRateInput?t.frameRateInput:null,enumerable:!0},frameRate:{value:"number"==typeof t.frameRateSent?t.frameRateSent:null,enumerable:!0}})}var i=e("util").inherits,o=e("./localtrackstats");i(r,o),t.exports=r},{"./localtrackstats":41,util:109}],43:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t),Object.defineProperties(this,{audioLevel:{value:"number"==typeof t.audioOutputLevel?t.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"==typeof t.jitter?t.jitter:null,enumerable:!0}})}var i=e("util").inherits,o=e("./remotetrackstats");i(r,o),t.exports=r},{"./remotetrackstats":44,util:109}],44:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t),Object.defineProperties(this,{direction:{value:"receiving",enumerable:!0},bytesReceived:{value:"number"==typeof t.bytesReceived?t.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"==typeof t.packetsReceived?t.packetsReceived:null,enumerable:!0}})}var i=e("util").inherits,o=e("./trackstats");i(r,o),t.exports=r},{"./trackstats":47,util:109}],45:[function(e,t,n){"use strict";function r(e,t){o.call(this,e,t);var n=null;"number"==typeof t.frameWidthReceived&&"number"==typeof t.frameHeightReceived&&(n={},Object.defineProperties(n,{width:{value:t.frameWidthReceived,enumerable:!0},height:{value:t.frameHeightReceived,enumerable:!0}})),Object.defineProperties(this,{dimensions:{value:n,enumerable:!0},frameRate:{value:"number"==typeof t.frameRateReceived?t.frameRateReceived:null,enumerable:!0}})}var i=e("util").inherits,o=e("./remotetrackstats");i(r,o),t.exports=r},{"./remotetrackstats":44,util:109}],46:[function(e,t,n){"use strict";function r(e,t){if("string"!=typeof e)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:e,enumerable:!0},localAudioTrackStats:{value:t.localAudioTrackStats.map(function(e){return new i(e.trackId,e)}),enumerable:!0},localVideoTrackStats:{value:t.localVideoTrackStats.map(function(e){return new o(e.trackId,e)}),enumerable:!0},remoteAudioTrackStats:{value:t.remoteAudioTrackStats.map(function(e){return new s(e.trackId,e)}),enumerable:!0},remoteVideoTrackStats:{value:t.remoteVideoTrackStats.map(function(e){return new a(e.trackId,e)}),enumerable:!0}})}var i=e("./localaudiotrackstats"),o=e("./localvideotrackstats"),s=e("./remoteaudiotrackstats"),a=e("./remotevideotrackstats");t.exports=r},{"./localaudiotrackstats":40,"./localvideotrackstats":42,"./remoteaudiotrackstats":43,"./remotevideotrackstats":45}],47:[function(e,t,n){"use strict";function r(e,t){if("string"!=typeof e)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:e,enumerable:!0},timestamp:{value:t.timestamp,enumerable:!0},ssrc:{value:t.ssrc,enumerable:!0},packetsLost:{value:"number"==typeof t.packetsLost?t.packetsLost:null,enumerable:!0},codec:{value:"string"==typeof t.codecName?t.codecName:null,enumerable:!0}})}t.exports=r},{}],48:[function(e,t,n){"use strict";function r(e,t){var n=this;Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:t}}),Object.defineProperty(this,"_promise",{value:new Promise(function(t,r){e(function(e){n._isCancelable=!1,t(e)},function(e){n._isCancelable=!1,r(e)},function(){return n._isCanceled})})})}r.prototype.cancel=function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this},r.prototype.catch=function(){return this._promise.catch.apply(this._promise,arguments)},r.prototype.then=function(){return this._promise.then.apply(this._promise,arguments)},t.exports=r},{}],49:[function(e,t,n){"use strict";function r(e){return["a","e","i","o","u"].indexOf(e.toLowerCase()[0])>=0?"an":"a"}t.exports.DEFAULT_ENVIRONMENT="prod",t.exports.DEFAULT_REALM="us1",t.exports.DEFAULT_LOG_LEVEL="warn",t.exports.REGISTRAR_SERVER=function(e){return e+".endpoint.twilio.com"},t.exports.WS_SERVER=function(e,t,n){switch(e){case"prod":switch(t){case"us1":return"wss://"+n+".endpoint.twilio.com";default:return"wss://"+n+".endpoint."+t+".twilio.com"}default:return"wss://"+n+".endpoint."+e+"-"+t+".twilio.com"}},t.exports.ECS_SERVER=function(e,t){switch(e){case"prod":return"https://ecs."+t+".twilio.com";default:return"https://ecs."+e+"-"+t+".twilio.com"}},t.exports.ECS_TIMEOUT=60,t.exports.PUBLISH_MAX_ATTEMPTS=5,t.exports.PUBLISH_BACKOFF_MS=10,t.exports.ICE_SERVERS_TIMEOUT_MS=3e3,t.exports.ICE_SERVERS_DEFAULT_TTL=3600,t.exports.DEFAULT_ICE_SERVERS=function(e){switch(e){case"prod":return[{urls:"stun:global.stun.twilio.com:3478?transport=udp"}];default:return[{urls:"stun:global.stun."+e+".twilio.com:3478?transport=udp"}]}},t.exports.headers={X_TWILIO_ACCESSTOKEN:"X-Twilio-AccessToken",X_TWILIO_PARTICIPANTS:"X-Twilio-Participants",X_TWILIO_PARTICIPANTSID:"X-Twilio-ParticipantSid"};var i=e("./twilioerror"),o={SIGNALING:53e3,ROOM:53100,PARTICIPANT:53200,TRACK:53300,MEDIA:53400,CONFIGURATION:53500};t.exports.twilioErrors=[{category:"SIGNALING",errors:["CONNECTION_ERROR","CONNECTION_DISCONNECTED","CONNECTION_TIMEOUT","INVALID_MESSAGE_RECEIVED","INVALID_MESSAGE_SENT"],messages:["Signaling connection error","Signaling connection disconnected","Signaling connection timed out","Client received an invalid signaling message","Client sent an invalid signaling message"]},{category:"ROOM",errors:["INVALID_NAME","NAME_TOO_LONG","INVALID_NAME_CHARS","CREATE_FAILED","CONNECT_FAILED","TOO_MANY_PARTICIPANTS"],messages:["Room name is invalid","Room name is too long","Room name contains invalid characters","Unable to create Room","Unable to connect to Room","Room contains too many Participants"]},{category:"PARTICIPANT",errors:["INVALID_IDENTITY","IDENTITY_TOO_LONG","INVALID_IDENTITY_CHARS","TOO_MANY_TRACKS"],messages:["Participant identity is invalid","Participant identity is too long","Participant identity contains invalid characters","Participant has too many Tracks"]},{category:"TRACK",errors:["INVALID","INVALID_NAME","NAME_TOO_LONG","INVALID_NAME_CHARS"],messages:["Track is invalid","Track name is invalid","Track name is too long","Track name contains invalid characters"]},{category:"MEDIA",errors:["CLIENT_LOCAL_DESC_FAILED","SERVER_LOCAL_DESC_FAILED","CLIENT_REMOTE_DESC_FAILED","SERVER_REMOTE_DESC_FAILED","NO_SUPPORTED_CODEC"],messages:["Client is unable to create or apply a local media description","Server is unable to create or apply a local media description","Client is unable to apply a remote media description","Server is unable to apply a remote media description","No supported codec"]},{category:"CONFIGURATION",errors:["ACQUIRE_FAILED","ACQUIRE_TURN_FAILED"],messages:["Unable to acquire configuration","Unable to acquire TURN credentials"]}].reduce(function(e,t){return t.errors.forEach(function(n,r){e[t.category+"_"+n]=i.bind(null,o[t.category]+r,t.messages[r])}),e},{INVALID_ACCESSTOKEN:i.bind(null,20101)}),t.exports.typeErrors={INVALID_TYPE:function(e,t){return new TypeError(e+" must be "+r(t)+" "+t)},INVALID_VALUE:function(e,t){return new RangeError(e+" must be one of ",t.join(", "))},REQUIRED_ARGUMENT:function(e){return new TypeError(e+" must be specified")}}},{"./twilioerror":57}],50:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=Object.assign({getKey:function(e){return e},getValue:function(e){return e},isLessThanOrEqualTo:function(e,t){return e<=t}},e),Object.defineProperties(this,{_getKey:{value:e.getKey},_getValue:{value:e.getValue},_isLessThanOrEqualTo:{value:e.isLessThanOrEqualTo},_map:{value:new Map}})}r.prototype.toMap=function(){return new Map(this._map)},r.prototype.updateAndFilter=function(e){return e.filter(this.update,this)},r.prototype.update=function(e){var t=this._getKey(e),n=this._getValue(e);return(!this._map.has(t)||!this._isLessThanOrEqualTo(n,this._map.get(t)))&&(this._map.set(t,n),!0)},t.exports=r},{}],51:[function(e,t,n){"use strict";function r(e,t){return encodeURIComponent(t)+"@"+_.REGISTRAR_SERVER(e)}function i(e,t){return r(e,encodeURIComponent(t))}function o(t){var n=e("../sip"),r=n.Grammar.parse(t,"Contact");return r!==-1&&r[0]?r[0].parsed.uri.user:null}function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function u(e,t,n,r){return new Promise(function(i,o){function s(){var e=[].slice.call(arguments);r&&t.removeListener(r,a),i.apply(null,e)}function a(){var e=[].slice.call(arguments);t.removeListener(n,s),o.apply(null,e)}t.once(n,s),r&&t.once(r,a),e()})}function c(e){var t=e.match(/<sip:(.*)@(.*)$/);return t?t[1]:null}function l(e,t){return t.split(".").reduce(function(e,t){return e?e[t]:null},e)}function d(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function f(e,t,n,r){if(!t[r]&&!r.match(/^on[a-z]+$/)){var i;try{i=a(e[r])}catch(e){}"function"===i&&(t[r]=function(){return this[n][r].apply(this[n],arguments)})}}function p(e,t,n){for(var r in e)f(e,t,n,r)}function h(e,t,n){for(var r in e)m(e,t,n,r)}function m(e,t,n,r){if(!(r in t))return r.match(/^on[a-z]+$/)?(Object.defineProperty(t,r,{value:null,writable:!0}),void n.addEventListener(r.slice(2),function(){t.dispatchEvent.apply(t,arguments)})):void Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}})}function v(e,t,n){return t?e.then(function(e){t(e)},function(e){n(e)}):e}function g(e){return"string"==typeof e?{default:e,media:e,signaling:e,webrtc:e}:e}function y(e,t){return t=t?"Local":"",t+(e.kind||"").replace(/\w{1}/,function(e){return e.toUpperCase()})+"Track"}function b(){return"undefined"!=typeof mozRTCPeerConnection?"unified":null}var _=e("./constants"),w=e("./map"),T=e("./token");t.exports.constants=_,t.exports.makeSIPURI=r,t.exports.makeRegistrationSIPURI=i,t.exports.getUser=o,t.exports.makeUUID=s,t.exports.promiseFromEvents=u,t.exports.parseRoomSIDFromContactHeader=c,t.exports.map=w,t.exports.getOrNull=l,t.exports.defer=d,t.exports.token=T,t.exports.delegateMethods=p,t.exports.proxyProperties=h,t.exports.legacyPromise=v,t.exports.buildLogLevels=g,t.exports.trackClass=y,t.exports.getSdpFormat=b},{"../sip":38,"./constants":49,"./map":54,"./token":56}],52:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);s.call(this,e||"low",a)}function i(e,t){return e.transition(t),e}var o=e("util").inherits,s=e("../statemachine"),a={high:["low"],low:["high"]};o(r,s),r.prototype.raise=function(){return i(this,"high")},r.prototype.lower=function(){return i(this,"low")},t.exports=r},{"../statemachine":39,util:109}],53:[function(e,t,n){"use strict";function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);if("string"!=typeof e)throw new c.INVALID_TYPE("moduleName","string");if(!t)throw new c.REQUIRED_ARGUMENT("component");"object"!==(void 0===n?"undefined":a(n))&&(n={}),o(n),Object.defineProperties(this,{_logLevels:{value:n},logLevel:{get:function(){return r.getLevelByName(n[e]||u)}},name:{get:t.toString.bind(t)}})}function i(e){if(!(e in l))throw new c.INVALID_VALUE("level",f)}function o(e){Object.keys(e).forEach(function(t){i(e[t].toUpperCase())})}var s=e("./constants"),u=s.DEFAULT_LOG_LEVEL,c=e("./constants").typeErrors;Object.defineProperties(r,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:[{name:"DEBUG",logFn:console.log},{name:"INFO",logFn:console.info},{name:"WARN",logFn:console.warn},{name:"ERROR",logFn:console.error},{name:"OFF",logFn:function(){}}]}});var l={},d=[],f=r._levels.map(function(e,t){return l[e.name]=!0,d.push(t),e.name});r.getLevelByName=function(e){return isNaN(e)?(e=e.toUpperCase(),i(e),r[e]):parseInt(e,10)},r.prototype.createLog=function(e,t){return new r(e,t,this._logLevels)},r.prototype.setLevels=function(e){return o(e),Object.assign(this._logLevels,e),this},r.prototype.log=function(e,t){var n=r._levels[e];if(!n)throw new c.INVALID_VALUE("logLevel",d);if(this.logLevel<=e){var i=n.name,o=(new Date).toISOString().split("T").concat(["|",i,"in",this.name+":"]);n.logFn.apply(console,o.concat(t))}return this},r.prototype.debug=function(){return this.log(r.DEBUG,[].slice.call(arguments))},r.prototype.info=function(){return this.log(r.INFO,[].slice.call(arguments))},r.prototype.warn=function(){return this.log(r.WARN,[].slice.call(arguments))},r.prototype.error=function(){return this.log(r.ERROR,[].slice.call(arguments))},r.prototype.throw=function(e,t){throw e.clone&&(e=e.clone(t)),this.log(r.ERROR,e),e},t.exports=r},{"./constants":49}],54:[function(e,t,n){"use strict";function r(e,t,n){return e.has(t)||e.set(t,new Set),e.get(t).add(n),e}function i(e,t,n){if(!e.has(t))return e;var r=e.get(t);return r.delete(n),r.size||e.delete(r),e}t.exports.addToMapOfSets=r,t.exports.deleteFromMapOfSets=i},{}],55:[function(e,t,n){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);i.call(this);var n=s.defer(),o=!1,a=new Error("Timed out"),u=null,c=null;Object.defineProperties(this,{_deferred:{value:n},_isTimedOut:{get:function(){return o},set:function(e){o=e}},_timedOut:{value:a},_timeout:{get:function(){return u},set:function(e){u=e}},_timer:{get:function(){return c},set:function(e){c=e}},_promise:{value:n.promise},isTimedOut:{enumerable:!0,get:function(){return o}},timeout:{enumerable:!0,get:function(){return u}}});var l=this;e.then(function(){clearTimeout(l._timer),n.resolve.apply(n.promise,arguments)},function(){clearTimeout(l._timer),n.reject.apply(n.promise,arguments)}),t&&this.start(t)}var i=e("events").EventEmitter,o=e("util").inherits,s=e("./");o(r,i),r.prototype.catch=function(){return this._promise.catch.apply(this._promise,arguments)},r.prototype.start=function(e){if(this._timer)return this;var t=this;return this._timeout=e,this._timer=setTimeout(function(){t._timer&&(t._isTimedOut=!0,t.emit("timedOut",t),t._deferred.reject(t._timedOut))},this.timeout),this},r.prototype.then=function(){return this._promise.then.apply(this._promise,arguments)},t.exports=r},{"./":51,events:70,util:109}],56:[function(e,t,n){(function(e){"use strict";function t(e){var t=e.split(".");if(3!==t.length)throw new Error("Token is invalid or malformed");var n=t[1],i=r(n);return JSON.parse(i)}function r(e){var t=e.length%4;if(t>0){var n=4-t;e+=new Array(n+1).join("=")}return e=e.replace(/-/g,"+").replace(/_/g,"/"),i(e)}function i(t){return new e(t,"base64").toString()}function o(e){return t(e).sub}function s(e){return t(e).grants.identity}n.getAccountSid=o,n.getIdentity=s}).call(this,e("buffer").Buffer)},{buffer:68}],57:[function(e,t,n){"use strict";function r(e){var t=Error.apply(this,[].slice.call(arguments,1));t.name="TwilioError",Object.defineProperty(this,"code",{value:e,enumerable:!0}),Object.getOwnPropertyNames(t).forEach(function(e){Object.defineProperty(this,e,{value:t[e],enumerable:!0})},this)}(0,e("util").inherits)(r,Error),r.prototype.toString=function(){var e=this.message?": "+this.message:"";return this.name+" "+this.code+e},t.exports=r},{util:109}],58:[function(e,t,n){"use strict";function r(e,t){return e&&"function"==typeof e.getStats?i(e,t):Promise.reject(new Error("Given PeerConnection does not support getStats"))}function i(e,t){var n=o(e,"audio","local"),r=o(e,"video","local"),i=o(e,"audio"),a=o(e,"video"),u={localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},c=[].concat(n.map(function(n){return s(e,n,t).then(function(e){e.trackId=n.id,u.localAudioTrackStats.push(e)})}),r.map(function(n){return s(e,n,t).then(function(e){e.trackId=n.id,u.localVideoTrackStats.push(e)})}),i.map(function(n){return s(e,n,t).then(function(e){e.trackId=n.id,u.remoteAudioTrackStats.push(e)})}),a.map(function(n){return s(e,n,t).then(function(e){e.trackId=n.id,u.remoteVideoTrackStats.push(e)})}));return Promise.all(c).then(function(){return u})}function o(e,t,n){return e["local"===n?"getLocalStreams":"getRemoteStreams"]().reduce(function(e,n){var r="audio"===t?"getAudioTracks":"getVideoTracks";return e.concat(n[r]())},[])}function s(e,t,n){return n=n||{},void 0!==n.testForChrome||"undefined"!=typeof webkitRTCPeerConnection?a(e,t):void 0!==n.testForFirefox||"undefined"!=typeof mozRTCPeerConnection?u(e,t):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}function a(e,t){return new Promise(function(n,r){e.getStats(function(e){n(c(e))},t,r)})}function u(e,t){return new Promise(function(n,r){e.getStats(t,function(e){n(l(e))},r)})}function c(e){var t=e.result().reduce(function(e,t){return"ssrc"===t.type?t:e},null),n={};return t&&(n.timestamp=Math.round(Number(t.timestamp)),n=t.names().reduce(function(e,n){switch(n){case"googCodecName":e.codecName=t.stat(n);break;case"googRtt":e.roundTripTime=1e3*Number(t.stat(n));break;case"googJitterReceived":e.jitter=Number(t.stat(n));break;case"googFrameWidthInput":e.frameWidthInput=Number(t.stat(n));break;case"googFrameHeightInput":e.frameHeightInput=Number(t.stat(n));break;case"googFrameWidthSent":e.frameWidthSent=Number(t.stat(n));break;case"googFrameHeightSent":e.frameHeightSent=Number(t.stat(n));break;case"googFrameWidthReceived":e.frameWidthReceived=Number(t.stat(n));break;case"googFrameHeightReceived":e.frameHeightReceived=Number(t.stat(n));break;case"googFrameRateInput":e.frameRateInput=Number(t.stat(n));break;case"googFrameRateSent":e.frameRateSent=Number(t.stat(n));break;case"googFrameRateReceived":e.frameRateReceived=Number(t.stat(n));break;case"ssrc":e[n]=t.stat(n);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":e[n]=Number(t.stat(n))}return e},n)),n}function l(e){function t(e){var t=r,i=n;return r.isRemote&&(t=n,i=r),void 0!==t[e]?t[e]:i[e]}var n=Object.keys(e).reduce(function(t,n){return"inboundrtp"===e[n].type?e[n]:t},null),r=Object.keys(e).reduce(function(t,n){return"outboundrtp"===e[n].type?e[n]:t},null),i={},o=t("timestamp");i.timestamp=Math.round(o);var s=t("ssrc");"string"==typeof s&&(i.ssrc=s);var a=t("bytesSent");"number"==typeof a&&(i.bytesSent=a);var u=t("packetsLost");"number"==typeof u&&(i.packetsLost=u);var c=t("packetsSent");"number"==typeof c&&(i.packetsSent=c);var l=t("mozRtt");"number"==typeof l&&(i.roundTripTime=1e3*l);var d=t("jitter");"number"==typeof d&&(i.jitter=Math.round(1e3*d));var f=t("framerateMean");"number"==typeof f&&(i.frameRateSent=Math.round(f));var p=t("bytesReceived");"number"==typeof p&&(i.bytesReceived=p);var h=t("packetsReceived");"number"==typeof h&&(i.packetsReceived=h);var m=t("framerateMean");return"number"==typeof m&&(i.frameRateReceived=Math.round(m)),i}t.exports=r},{}],59:[function(e,t,n){"use strict";function r(e){return new Promise(function(t,n){i(e||{audio:!0,video:!0},t,n)})}function i(e,t,n){if("undefined"!=typeof window&&"undefined"!=typeof navigator)return void("object"===a(navigator.mediaDevices)&&"function"==typeof navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(t,n):"function"==typeof navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(e,t,n):"function"==typeof navigator.mozGetUserMedia&&navigator.mozGetUserMedia(e,t,n));n(new Error("getUserMedia is not supported"))}t.exports=r},{}],60:[function(e,t,n){"use strict";"undefined"!=typeof mozRTCIceCandidate?t.exports=mozRTCIceCandidate:"undefined"!=typeof RTCIceCandidate&&(t.exports=RTCIceCandidate)},{}],61:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);u.call(this);var t=Object.assign({},e);t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var n=null,i=new webkitRTCPeerConnection(t);Object.defineProperties(this,{_peerConnection:{value:i},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_signalingStateLatch:{value:new l},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:i.localDescription}},onsignalingstatechange:{get:function(){return n},set:function(e){n&&this.removeEventListener("signalingstatechange",n),"function"==typeof e?(n=e,this.addEventListener("signalingstatechange",n)):n=null}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:i.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":i.signalingState}}});var o=this;i.addEventListener("signalingstatechange",function(){o._pendingLocalOffer||o._pendingRemoteOffer||o.dispatchEvent.apply(o,arguments)}),d.proxyProperties(webkitRTCPeerConnection.prototype,this,i),"ontrack"in webkitRTCPeerConnection.prototype||i.addEventListener("addstream",function(e){var t=e.stream;t.addEventListener("addtrack",function(e){var n=e.track,r=new Event("track");r.track=n,r.receiver={track:n},r.streams=[t],o.dispatchEvent(r)}),t.getTracks().forEach(function(e){var n=new Event("track");n.track=e,n.streams=[t],o.dispatchEvent(n)})})}function i(e,t,n){function r(n){t?e._pendingLocalOffer=n:e._pendingRemoteOffer=n}function i(){t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null}var a,u=t?e._pendingLocalOffer:e._pendingRemoteOffer,c=t?e._pendingRemoteOffer:e._pendingLocalOffer,l=t?"have-local-offer":"have-remote-offer",d=t?"setLocalDescription":"setRemoteDescription";if(!t&&c&&"answer"===n.type)a=o(e,n);else if("offer"===n.type){if(e.signalingState!==l&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));u||e._signalingStateLatch.raise();var f=e.signalingState;r(s(n)),a=Promise.resolve(),e.signalingState!==f&&a.then(function(){e.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===n.type&&(e.signalingState!==l?a=Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(i(),a=Promise.resolve(),a.then(function(){e.dispatchEvent(new Event("signalingstatechange"))})));return a||e._peerConnection[d](s(n))}function o(e,t){var n=e._pendingLocalOffer;return e._peerConnection.setLocalDescription(n).then(function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)}).then(function(){e._signalingStateLatch.lower()})}function s(e){return e instanceof a&&e._description?e._description:new RTCSessionDescription(e)}var a=e("../rtcsessiondescription/chrome"),u=e("../../eventtarget"),c=e("util").inherits,l=e("../../util/latch"),d=e("../../util");c(r,u),r.prototype.addIceCandidate=function(e){var t,n=[].slice.call(arguments),r=this;return t="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return r._peerConnection.addIceCandidate(e)}):this._peerConnection.addIceCandidate(e),n.length>1?d.legacyPromise(t,n[1],n[2]):t},r.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},r.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;return this._pendingRemoteOffer&&(e=this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return n._signalingStateLatch.lower(),n._peerConnection.createAnswer()}).then(function(e){return n._pendingRemoteOffer=null,e},function(e){throw n._pendingRemoteOffer=null,e})),e?t.length>1?d.legacyPromise(e,t[0],t[1]):e:this._peerConnection.createAnswer.apply(this._peerConnection,t)},r.prototype.setLocalDescription=function(){var e=[].slice.call(arguments),t=e[0],n=i(this,!0,t);return e.length>1?d.legacyPromise(n,e[1],e[2]):n},r.prototype.setRemoteDescription=function(){var e=[].slice.call(arguments),t=e[0],n=i(this,!1,t);return e.length>1?d.legacyPromise(n,e[1],e[2]):n},d.delegateMethods(webkitRTCPeerConnection.prototype,r.prototype,"_peerConnection"),t.exports=r},{"../../eventtarget":5,"../../util":51,"../../util/latch":52,"../rtcsessiondescription/chrome":64,util:109}],62:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);a.call(this);var t=null,n=new mozRTCPeerConnection(e);Object.defineProperties(this,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:n},_rollingBack:{value:!1,writable:!0},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},localDescription:{enumerable:!0,get:function(){return s(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)}},onsignalingstatechange:{get:function(){return t},set:function(e){t&&this.removeEventListener("signalingstatechange",t),"function"==typeof e?(t=e,this.addEventListener("signalingstatechange",t)):t=null}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.signalingState}}});var i,o=this;n.addEventListener("signalingstatechange",function(){if(!o._rollingBack&&o.signalingState!==i){i=o.signalingState;var e=o.dispatchEvent.apply.bind(o.dispatchEvent,o,arguments);o._isClosed?setTimeout(e):e()}}),l.proxyProperties(mozRTCPeerConnection.prototype,this,n),"ontrack"in mozRTCPeerConnection.prototype||n.addEventListener("addstream",function(e){var t=e.stream;t.getTracks().forEach(function(e){var n=new Event("track");n.track=e,n.streams=[t],o.dispatchEvent(n)})})}function i(e,t,n){var r=t?"setLocalDescription":"setRemoteDescription";return e._rollingBack=!0,e._peerConnection[r](new u({type:"rollback"})).then(n).then(function(t){return e._rollingBack=!1,t},function(t){throw e._rollingBack=!1,t})}function o(e,t,n){if(!e._initiallyNegotiatedDtlsRole&&"offer"!==t.type){var r=t.sdp.match(/a=setup:([a-z]+)/);if(r){var i=r[1];e._initiallyNegotiatedDtlsRole=n?{active:"passive",passive:"active"}[i]:i}}}function s(e,t){return e&&"answer"===e.type&&t&&(e.sdp=e.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+t)),e}var a=e("../../eventtarget"),u=e("../rtcsessiondescription/firefox"),c=e("util").inherits,l=e("../../util");c(r,a),r.prototype.getRemoteStreams=function(){return this._isClosed?[]:this._peerConnection.getRemoteStreams()},r.prototype.removeStream=function(){},r.prototype.addStream=function(e){if(!this._peerConnection.getLocalStreams().some(function(t){return t===e}))return this._peerConnection.addStream(e)},r.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;return e=this._peerConnection.createAnswer().then(function(e){return o(n,e),s(e,n._initiallyNegotiatedDtlsRole),e}),"function"==typeof t[0]?l.legacyPromise(e,t[0],t[1]):e},r.prototype.createOffer=function(){var e,t=[].slice.call(arguments),n=this;if("have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState){var r="have-local-offer"===this.signalingState,o=(t.length>1?t[2]:t[0])||{};e=i(this,r,function(){return n.createOffer(o)})}return e?t.length>1?l.legacyPromise(e,t[0],t[1]):e:this._peerConnection.createOffer.apply(this._peerConnection,t)},r.prototype.setLocalDescription=function(){var e,t=[].slice.call(arguments),n=t[0];return n&&"answer"===n.type&&"have-local-offer"===this.signalingState&&(e=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),e?t.length>1?l.legacyPromise(e,t[1],t[2]):e:this._peerConnection.setLocalDescription.apply(this._peerConnection,t)},r.prototype.setRemoteDescription=function(){var e,t=[].slice.call(arguments),n=t[0],r=this;return n&&"have-remote-offer"===this.signalingState&&("answer"===n.type?e=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===n.type&&(e=i(this,!1,function(){return r._peerConnection.setRemoteDescription(n)}))),e||(e=this._peerConnection.setRemoteDescription(n)),e=e.then(function(){o(r,n,!0)}),t.length>1?l.legacyPromise(e,t[1],t[2]):e},r.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},l.delegateMethods(mozRTCPeerConnection.prototype,r.prototype,"_peerConnection"),t.exports=r},{"../../eventtarget":5,"../../util":51,"../rtcsessiondescription/firefox":65,util:109}],63:[function(e,t,n){"use strict";"undefined"!=typeof webkitRTCPeerConnection?t.exports=e("./chrome"):"undefined"!=typeof mozRTCPeerConnection?t.exports=e("./firefox"):"undefined"!=typeof RTCPeerConnection&&(t.exports=RTCPeerConnection)},{"./chrome":61,"./firefox":62}],64:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);var t=e&&"rollback"===e.type?null:new RTCSessionDescription(e),n=t?null:"rollback",i=e.sdp;Object.defineProperties(this,{_description:{get:function(){return t}},sdp:{enumerable:!0,get:function(){return t?t.sdp:i},set:function(e){if(t)return void(t.sdp=e);i=e}},type:{enumerable:!0,get:function(){return t?t.type:n},set:function(e){if("rollback"===e&&t){var r=t.sdp;t=null,this.sdp=r}else{if(t)return void(t.type=e);if(["offer","answer","pranswer","rollback"].indexOf(e)===-1)return}n=e}}})}t.exports=r},{}],65:[function(e,t,n){"use strict";t.exports=mozRTCSessionDescription},{}],66:[function(e,t,n){"use strict";"undefined"!=typeof webkitRTCPeerConnection?t.exports=e("./chrome"):"undefined"!=typeof mozRTCSessionDescription?t.exports=e("./firefox"):"undefined"!=typeof RTCSessionDescription&&(t.exports=RTCSessionDescription)},{"./chrome":64,"./firefox":65}],67:[function(e,t,n){!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===o||t===l?62:t===s||t===d?63:t<a?-1:t<a+10?t-a+26+26:t<c+26?t-c:t<u+26?t-u+26:void 0}function n(e){function n(e){c[d++]=e}var r,o,s,a,u,c;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var l=e.length;u="="===e.charAt(l-2)?2:"="===e.charAt(l-1)?1:0,c=new i(3*e.length/4-u),s=u>0?e.length-4:e.length;var d=0;for(r=0,o=0;r<s;r+=4,o+=3)a=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===u?(a=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&a)):1===u&&(a=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(a>>8&255),n(255&a)),c}function r(e){function t(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}function n(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var r,i,o,s=e.length%3,a="";for(r=0,o=e.length-s;r<o;r+=3)i=(e[r]<<16)+(e[r+1]<<8)+e[r+2],a+=n(i);switch(s){case 1:i=e[e.length-1],a+=t(i>>2),a+=t(i<<4&63),a+="==";break;case 2:i=(e[e.length-2]<<8)+e[e.length-1],a+=t(i>>10),a+=t(i>>4&63),a+=t(i<<2&63),a+="="}return a}var i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="+".charCodeAt(0),s="/".charCodeAt(0),a="0".charCodeAt(0),u="a".charCodeAt(0),c="A".charCodeAt(0),l="-".charCodeAt(0),d="_".charCodeAt(0);e.toByteArray=n,e.fromByteArray=r}(void 0===n?this.base64js={}:n)},{}],68:[function(e,t,r){(function(t){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
"use strict";function n(){function e(){}try{var t=new Uint8Array(1);return t.foo=function(){return 42},t.constructor=e,42===t.foo()&&t.constructor===e&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function i(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e){return this instanceof o?(o.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof e?s(this,e):"string"==typeof e?a(this,e,arguments.length>1?arguments[1]:"utf8"):u(this,e)):arguments.length>1?new o(e,arguments[1]):new o(e)}function s(e,t){if(e=m(e,t<0?0:0|v(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;n++)e[n]=0;return e}function a(e,t,n){return"string"==typeof n&&""!==n||(n="utf8"),e=m(e,0|y(t,n)),e.write(t,n),e}function u(e,t){if(o.isBuffer(t))return c(e,t);if(K(t))return l(e,t);if(null==t)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(t.buffer instanceof ArrayBuffer)return d(e,t);if(t instanceof ArrayBuffer)return f(e,t)}return t.length?p(e,t):h(e,t)}function c(e,t){var n=0|v(t.length);return e=m(e,n),t.copy(e,0,0,n),e}function l(e,t){var n=0|v(t.length);e=m(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e,t){var n=0|v(t.length);e=m(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e,t){return o.TYPED_ARRAY_SUPPORT?(t.byteLength,e=o._augment(new Uint8Array(t))):e=d(e,new Uint8Array(t)),e}function p(e,t){var n=0|v(t.length);e=m(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e,t){var n,r=0;"Buffer"===t.type&&K(t.data)&&(n=t.data,r=0|v(n.length)),e=m(e,r);for(var i=0;i<r;i+=1)e[i]=255&n[i];return e}function m(e,t){return o.TYPED_ARRAY_SUPPORT?(e=o._augment(new Uint8Array(t)),e.__proto__=o.prototype):(e.length=t,e._isBuffer=!0),0!==t&&t<=o.poolSize>>>1&&(e.parent=J),e}function v(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function g(e,t){if(!(this instanceof g))return new g(e,t);var n=new o(e,t);return delete n.parent,n}function y(e,t){"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"binary":case"raw":case"raws":return n;case"utf8":case"utf-8":return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return W(e).length;default:if(r)return H(e).length;t=(""+t).toLowerCase(),r=!0}}function b(e,t,n){var r=!1;if(t|=0,n=void 0===n||n===1/0?this.length:0|n,e||(e="utf8"),t<0&&(t=0),n>this.length&&(n=this.length),n<=t)return"";for(;;)switch(e){case"hex":return j(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return A(this,t,n);case"binary":return I(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;if(o%2!==0)throw new Error("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;s++){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))throw new Error("Invalid hex string");e[n+s]=a}return s}function w(e,t,n,r){return G(H(t,e.length-n),e,n,r)}function T(e,t,n,r){return G(B(t),e,n,r)}function C(e,t,n,r){return T(e,t,n,r)}function k(e,t,n,r){return G(W(t),e,n,r)}function E(e,t,n,r){return G(V(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?z.fromByteArray(e):z.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var u,c,l,d;switch(a){case 1:o<128&&(s=o);break;case 2:u=e[i+1],128===(192&u)&&(d=(31&o)<<6|63&u,d>127&&(s=d));break;case 3:u=e[i+1],c=e[i+2],128===(192&u)&&128===(192&c)&&(d=(15&o)<<12|(63&u)<<6|63&c,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(d=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l,d>65535&&d<1114112&&(s=d))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return R(r)}function R(e){var t=e.length;if(t<=Q)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Q));return n}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(127&e[i]);return r}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function j(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;o++)i+=q(e[o]);return i}function O(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function P(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,i,s){if(!o.isBuffer(e))throw new TypeError("buffer must be a Buffer instance");if(t>i||t<s)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;i++)e[n+i]=t>>>8*(r?i:3-i)&255}function U(e,t,n,r,i,o){if(t>i||t<o)throw new RangeError("value is out of bounds");if(n+r>e.length)throw new RangeError("index out of range");if(n<0)throw new RangeError("index out of range")}function L(e,t,n,r,i){return i||U(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Y.write(e,t,n,r,23,4),n+4}function F(e,t,n,r,i){return i||U(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Y.write(e,t,n,r,52,8),n+8}function $(e){if(e=X(e).replace(ee,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function X(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;s++){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function B(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function V(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);s++)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function W(e){return z.toByteArray($(e))}function G(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);i++)t[i+n]=e[i];return i}var z=e("base64-js"),Y=e("ieee754"),K=e("isarray");r.Buffer=o,r.SlowBuffer=g,r.INSPECT_MAX_BYTES=50,o.poolSize=8192;var J={};o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:n(),o.TYPED_ARRAY_SUPPORT?(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array):(o.prototype.length=void 0,o.prototype.parent=void 0),o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s&&e[i]===t[i];)++i;return i!==s&&(n=e[i],r=t[i]),n<r?-1:r<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!K(e))throw new TypeError("list argument must be an Array of Buffers.");if(0===e.length)return new o(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var r=new o(t),i=0;for(n=0;n<e.length;n++){var s=e[n];s.copy(r,i),i+=s.length}return r},o.byteLength=y,o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?x(this,0,e):b.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?0:o.compare(this,e)},o.prototype.indexOf=function(e,t){function n(e,t,n){for(var r=-1,i=0;n+i<e.length;i++)if(e[n+i]===t[r===-1?0:i-r]){if(r===-1&&(r=i),i-r+1===t.length)return n+r}else r=-1;return-1}if(t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t>>=0,0===this.length)return-1;if(t>=this.length)return-1;if(t<0&&(t=Math.max(this.length+t,0)),"string"==typeof e)return 0===e.length?-1:String.prototype.indexOf.call(this,e,t);if(o.isBuffer(e))return n(this,e,t);if("number"==typeof e)return o.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,e,t):n(this,[e],t);throw new TypeError("val must be string, number or Buffer")},o.prototype.get=function(e){return this.readUInt8(e)},o.prototype.set=function(e,t){return this.writeUInt8(e,t)},o.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else if(isFinite(t))t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0);else{var i=r;r=t,t=0|n,n=i}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return T(this,e,t,n);case"binary":return C(this,e,t,n);case"base64":return k(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Q=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r;if(o.TYPED_ARRAY_SUPPORT)r=o._augment(this.subarray(e,t));else{var i=t-e;r=new o(i,void 0);for(var s=0;s<i;s++)r[s]=this[s+e]}return r.length&&(r.parent=this.parent||this),r},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},o.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},o.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),Y.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),Y.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),Y.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),Y.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||N(this,e,t,n,Math.pow(2,8*n),0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||N(this,e,t,n,Math.pow(2,8*n),0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=0,s=1,a=e<0?1:0;for(this[t]=255&e;++o<n&&(s*=256);)this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);N(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=e<0?1:0;for(this[t+o]=255&e;--o>=0&&(s*=256);)this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return L(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return L(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;i--)e[i+t]=this[i+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(i=0;i<s;i++)e[i+t]=this[i+n];else e._set(this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),n<t)throw new RangeError("end < start");if(n!==t&&0!==this.length){if(t<0||t>=this.length)throw new RangeError("start out of bounds");if(n<0||n>this.length)throw new RangeError("end out of bounds");var r;if("number"==typeof e)for(r=t;r<n;r++)this[r]=e;else{var i=H(e.toString()),o=i.length;for(r=t;r<n;r++)this[r]=i[r%o]}return this}},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o.TYPED_ARRAY_SUPPORT)return new o(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var Z=o.prototype;o._augment=function(e){return e.constructor=o,e._isBuffer=!0,e._set=e.set,e.get=Z.get,e.set=Z.set,e.write=Z.write,e.toString=Z.toString,e.toLocaleString=Z.toString,e.toJSON=Z.toJSON,e.equals=Z.equals,e.compare=Z.compare,e.indexOf=Z.indexOf,e.copy=Z.copy,e.slice=Z.slice,e.readUIntLE=Z.readUIntLE,e.readUIntBE=Z.readUIntBE,e.readUInt8=Z.readUInt8,e.readUInt16LE=Z.readUInt16LE,e.readUInt16BE=Z.readUInt16BE,e.readUInt32LE=Z.readUInt32LE,e.readUInt32BE=Z.readUInt32BE,e.readIntLE=Z.readIntLE,e.readIntBE=Z.readIntBE,e.readInt8=Z.readInt8,e.readInt16LE=Z.readInt16LE,e.readInt16BE=Z.readInt16BE,e.readInt32LE=Z.readInt32LE,e.readInt32BE=Z.readInt32BE,e.readFloatLE=Z.readFloatLE,e.readFloatBE=Z.readFloatBE,e.readDoubleLE=Z.readDoubleLE,e.readDoubleBE=Z.readDoubleBE,e.writeUInt8=Z.writeUInt8,e.writeUIntLE=Z.writeUIntLE,e.writeUIntBE=Z.writeUIntBE,e.writeUInt16LE=Z.writeUInt16LE,e.writeUInt16BE=Z.writeUInt16BE,e.writeUInt32LE=Z.writeUInt32LE,e.writeUInt32BE=Z.writeUInt32BE,e.writeIntLE=Z.writeIntLE,e.writeIntBE=Z.writeIntBE,e.writeInt8=Z.writeInt8,e.writeInt16LE=Z.writeInt16LE,e.writeInt16BE=Z.writeInt16BE,e.writeInt32LE=Z.writeInt32LE,e.writeInt32BE=Z.writeInt32BE,e.writeFloatLE=Z.writeFloatLE,e.writeFloatBE=Z.writeFloatBE,e.writeDoubleLE=Z.writeDoubleLE,e.writeDoubleBE=Z.writeDoubleBE,e.fill=Z.fill,e.inspect=Z.inspect,e.toArrayBuffer=Z.toArrayBuffer,e};var ee=/[^+\/0-9A-Za-z-_]/g}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":67,ieee754:71,isarray:69}],69:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],70:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function u(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],u(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),a=1;a<r;a++)o[a-1]=arguments[a];n.apply(this,o)}else if(s(n)){for(r=arguments.length,o=new Array(r-1),a=1;a<r;a++)o[a-1]=arguments[a];for(c=n.slice(),r=c.length,a=0;a<r;a++)c[a].apply(this,o)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=u(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.trace)}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){return e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],71:[function(e,t,n){n.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:(p?-1:1)*(1/0);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+d>=1?f/u:f*Math.pow(2,1-d),t*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*u-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=h,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+p]=255&s,p+=h,s/=256,c-=8);e[n+p-h]|=128*m}},{}],72:[function(e,t,n){function r(){if(!a){a=!0;for(var e,t=s.length;t;){e=s,s=[];for(var n=-1;++n<t;)e[n]();t=s.length}a=!1}}function i(){}var o=t.exports={},s=[],a=!1;o.nextTick=function(e){s.push(e),a||setTimeout(r,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=i,o.addListener=i,o.once=i,o.off=i,o.removeListener=i,o.removeAllListeners=i,o.emit=i,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],73:[function(e,t,n){t.exports={_args:[[{raw:"sip.js@github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",scope:null,escapedName:"sip.js",name:"sip.js",rawSpec:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",spec:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",type:"hosted",hosted:{type:"github",ssh:"git@github.com:twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",sshUrl:"git+ssh://git@github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",httpsUrl:"git+https://github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",gitUrl:"git://github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",shortcut:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",directUrl:"https://raw.githubusercontent.com/twilio/SIP.js/420ed46ba6751b32e99950fb6fb84683afb820cc/package.json"}},"/home/travis/build/twilio/twilio-video.js"]],_from:"twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",_id:"sip.js@0.7.5",_inCache:!0,_location:"/sip.js",_phantomChildren:{},_requested:{raw:"sip.js@github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",scope:null,escapedName:"sip.js",name:"sip.js",rawSpec:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",spec:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",type:"hosted",hosted:{type:"github",ssh:"git@github.com:twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",sshUrl:"git+ssh://git@github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",httpsUrl:"git+https://github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",gitUrl:"git://github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",shortcut:"github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",directUrl:"https://raw.githubusercontent.com/twilio/SIP.js/420ed46ba6751b32e99950fb6fb84683afb820cc/package.json"}},_requiredBy:["/"],_resolved:"git://github.com/twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",_shasum:"964da52f1f19b7ad6662d83ad03a3bac705a36dc",_shrinkwrap:null,_spec:"sip.js@github:twilio/SIP.js#420ed46ba6751b32e99950fb6fb84683afb820cc",_where:"/home/travis/build/twilio/twilio-video.js",author:{name:"OnSIP",email:"developer@onsip.com",url:"http://sipjs.com/authors/"},browser:{"./src/environment.js":"./src/environment_browser.js"},bugs:{url:"https://github.com/onsip/SIP.js/issues"},contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],dependencies:{pegjs:"^0.8.0",promiscuous:"^0.6.0",ws:"^1.0.1"},description:"A simple, intuitive, and powerful JavaScript signaling library",devDependencies:{beefy:"^2.1.5",browserify:"^4.1.8",grunt:"~0.4.0","grunt-browserify":"^4.0.1","grunt-cli":"~0.1.6","grunt-contrib-copy":"^0.5.0","grunt-contrib-jasmine":"^1.0.3","grunt-contrib-jshint":">0.5.0","grunt-contrib-uglify":"~0.2.0","grunt-peg":"~1.3.1","grunt-trimtrailingspaces":"^0.4.0"},engines:{node:">=0.12"},gitHead:"420ed46ba6751b32e99950fb6fb84683afb820cc",homepage:"http://sipjs.com",keywords:["sip","websocket","webrtc","library","javascript"],license:"MIT",main:"src/index.js",name:"sip.js",optionalDependencies:{promiscuous:"^0.6.0"},readme:'# SIP.js\n\n[![Build Status](https://travis-ci.org/onsip/SIP.js.png?branch=master)](https://travis-ci.org/onsip/SIP.js)\n\nA JavaScript SIP stack for WebRTC, instant messaging, and more!\n\n\n## Website and Documentation\n\n* [SIPjs.com](http://sipjs.com)\n* [Mailing List](https://groups.google.com/forum/#!forum/sip_js)\n* [Issue Tracking](https://github.com/onsip/sip.js/issues)\n\n\n## Download\n\n* [sipjs.com/download](http://sipjs.com/download/)\n* Bower: `bower install sip.js`\n* npm: `npm install sip.js`\n\n## Authors\n\n### James Criscuolo\n\n* <james@onsip.com>\n\n### Joseph Frazier\n\n* <1212jtraceur@gmail.com>\n* GitHub [@josephfrazier](https://github.com/josephfrazier)\n* Twitter [@josephfrazier_](https://twitter.com/josephfrazier_)\n\n### Eric Green\n\n* <eric.green@onsip.com>\n\n### Will Mitchell\n\n* <wakamoleguy@gmail.com>\n* GitHub [@wakamoleguy](http://github.com/wakamoleguy)\n* Twitter [@wakamoleguy](http://twitter.com/wakamoleguy)\n\n### JsSIP Authors\n\nSIP.js contains substantial portions of the JsSIP software. JsSIP\'s authors at time of fork are listed below. For up to date information about JsSIP, please visit [jssip.net](http://jssip.net)\n\n* JosÃ© Luis MillÃ¡n\n* IÃ±aki Baz Castillo\n* SaÃºl Ibarra CorretgÃ©\n\n## License\n\nSIP.js is released under the [MIT license](http://sipjs.com/license).\n\nSIP.js contains substantial portions of the JsSIP software, under the following license:\n\n~~~\nCopyright (c) 2012-2013 JosÃ© Luis MillÃ¡n - Versatica <http://www.versatica.com>\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n"Software"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\nLIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\nOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\nWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n~~~\n',readmeFilename:"README.md",repository:{type:"git",url:"git+https://github.com/onsip/SIP.js.git"},scripts:{build:"grunt build",postinstall:"cd src/Grammar && mkdir -p dist && pegjs --extra-options-file peg.json src/Grammar.pegjs dist/Grammar.js",repl:"beefy test/repl.js --open",test:"grunt travis --verbose"},title:"SIP.js",version:"0.7.5"}},{}],74:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t,n,r,i){var o=r;if(void 0===r)throw new TypeError("Not enough arguments");if(this.ua=t,this.logger=t.getLogger("sip.clientcontext"),this.method=n,r=t.normalizeTarget(r),!r)throw new TypeError("Invalid target: "+o);i=Object.create(i||Object.prototype),i.extraHeaders=(i.extraHeaders||[]).slice(),this.request=new e.OutgoingRequest(this.method,r,this.ua,i.params,i.extraHeaders),i.body&&(this.body={},this.body.body=i.body,i.contentType&&(this.body.contentType=i.contentType),this.request.body=this.body),this.localIdentity=this.request.from,this.remoteIdentity=this.request.to,this.data={}},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(){return new e.RequestSender(this,this.ua).send(),this},t.prototype.cancel=function(t){t=t||{},t.extraHeaders=(t.extraHeaders||[]).slice();var n=e.Utils.getCancelReason(t.status_code,t.reason_phrase);this.request.cancel(n,t.extraHeaders),this.emit("cancel")},t.prototype.receiveResponse=function(t){var n=e.Utils.getReasonPhrase(t.status_code);switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t,n);break;case/^2[0-9]{2}$/.test(t.status_code):this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("accepted",t,n);break;default:this.ua.applicants[this]&&delete this.ua.applicants[this],this.emit("rejected",t,n),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ClientContext=t}},{}],75:[function(e,t,n){"use strict";t.exports=function(e,t){return{USER_AGENT:e+"/"+t,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",NO_PRACK:"No PRACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},supported:{UNSUPPORTED:"none",SUPPORTED:"supported",REQUIRED:"required"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",PRACK:"PRACK",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},OPTION_TAGS:{"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0}}}},{}],76:[function(e,t,n){"use strict";t.exports=function(e){var t;return t=function(e,t,n){this.dialog=e,this.applicant=t,this.request=n,this.reattempt=!1,this.reattemptTimer=null},t.prototype={send:function(){var t=this,n=new e.RequestSender(this,this.dialog.owner.ua);n.send(),this.request.method===e.C.INVITE&&n.clientTransaction.state!==e.Transactions.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function n(){this.state!==e.Transactions.C.STATUS_ACCEPTED&&this.state!==e.Transactions.C.STATUS_COMPLETED&&this.state!==e.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",n),t.dialog.uac_pending_reply=!1,t.dialog.uas_pending_reply===!1&&t.dialog.owner.onReadyToReinvite())}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n=this;408===t.status_code||481===t.status_code?this.applicant.onDialogError(t):t.method===e.C.INVITE&&491===t.status_code?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=e.Timers.setTimeout(function(){n.applicant.owner.status!==e.Session.C.STATUS_TERMINATED&&(n.reattempt=!0,n.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)}},t}},{}],77:[function(e,t,n){"use strict";t.exports=function(t){var n,r=e("./Dialog/RequestSender")(t),i={STATUS_EARLY:1,STATUS_CONFIRMED:2};n=function(e,n,r,o){var s;if(this.uac_pending_reply=!1,this.uas_pending_reply=!1,!n.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};o=n instanceof t.IncomingResponse?n.status_code<200?i.STATUS_EARLY:i.STATUS_CONFIRMED:o||i.STATUS_CONFIRMED,s=n.parseHeader("contact"),"UAS"===r?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=o,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=s.uri,this.route_set=n.getHeaders("record-route"),this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq):"UAC"===r&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=o,this.invite_seqnum=n.cseq,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.pracked=[],this.remote_uri=n.parseHeader("to").uri,this.remote_target=s.uri,this.route_set=n.getHeaders("record-route").reverse(),this.state!==i.STATUS_EARLY||e.hasOffer||(this.mediaHandler=e.mediaHandlerFactory(e))),this.logger=e.ua.getLogger("sip.dialog",this.id.toString()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===i.STATUS_EARLY?"EARLY":"CONFIRMED")),e.emit("dialog",this)},n.prototype={update:function(e,t){this.state=i.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.route_set=e.getHeaders("record-route").reverse())},terminate:function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.mediaHandler&&this.state!==i.STATUS_CONFIRMED&&this.mediaHandler.peerConnection.close(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(e,n,r){var i,o;return n=(n||[]).slice(),this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),i=e===t.C.CANCEL||e===t.C.ACK?this.invite_seqnum:this.local_seqnum+=1,o=new t.OutgoingRequest(e,this.remote_target,this.owner.ua,{cseq:i,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},n,r),o.dialog=this,o},checkInDialogRequest:function(e){var n=this;if(this.remote_seqnum){if(e.cseq<this.remote_seqnum)return e.method!==t.C.ACK&&e.reply(500),e.cseq===this.invite_seqnum;e.cseq>this.remote_seqnum&&(this.remote_seqnum=e.cseq)}else this.remote_seqnum=e.cseq;switch(e.method){case t.C.INVITE:if(this.uac_pending_reply===!0)e.reply(491);else{if(this.uas_pending_reply===!0){var r=(10*Math.random()|0)+1;return e.reply(500,null,["Retry-After:"+r]),!1}this.uas_pending_reply=!0,e.server_transaction.on("stateChanged",function e(){this.state!==t.Transactions.C.STATUS_ACCEPTED&&this.state!==t.Transactions.C.STATUS_COMPLETED&&this.state!==t.Transactions.C.STATUS_TERMINATED||(this.removeListener("stateChanged",e),n.uas_pending_reply=!1,n.uac_pending_reply===!1&&n.owner.onReadyToReinvite())})}e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===t.Transactions.C.STATUS_ACCEPTED&&(n.remote_target=e.parseHeader("contact").uri)});break;case t.C.NOTIFY:e.hasHeader("contact")&&e.server_transaction.on("stateChanged",function(){this.state===t.Transactions.C.STATUS_COMPLETED&&(n.remote_target=e.parseHeader("contact").uri)})}return!0},sendRequest:function(e,t,n){n=n||{};var i=(n.extraHeaders||[]).slice(),o=null;n.body&&(n.body.body?o=n.body:(o={},o.body=n.body,n.contentType&&(o.contentType=n.contentType)));var s=this.createRequest(t,i,o);return new r(this,e,s).send(),s},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)}},n.C=i,t.Dialog=n}},{"./Dialog/RequestSender":76}],78:[function(e,t,n){"use strict";t.exports=function(e){var t;return t=function(e){this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},t.prototype.authenticate=function(t,n){if(this.algorithm=n.algorithm,this.realm=n.realm,this.nonce=n.nonce,this.opaque=n.opaque,this.stale=n.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(n.qop)if(n.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(n.qop.indexOf("auth-int")>-1))return this.logger.warn('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=t.method,this.uri=t.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},t.prototype.calculateResponse=function(){var t,n;t=e.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+n)):"auth-int"===this.qop?(n=e.calculateMD5(this.method+":"+this.uri+":"+e.calculateMD5(this.body?this.body:"")),this.response=e.calculateMD5(t+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+n)):null===this.qop&&(n=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(t+":"+this.nonce+":"+n))},t.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},t.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},t}},{}],79:[function(e,t,n){"use strict";var r=e("events").EventEmitter;t.exports=function(e){function t(){r.call(this)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.prototype.off=function(t,n){var r="";return r+="SIP.EventEmitter#off is deprecated and may be removed in future SIP.js versions.\n",r+="Please use removeListener or removeAllListeners instead.\n",r+="See here for more details:\n",r+="http://nodejs.org/api/events.html#events_emitter_removelistener_event_listener",e.warn(r),arguments.length<2?this.removeAllListeners.apply(this,arguments):this.removeListener(t,n)},t}},{events:70}],80:[function(e,t,n){"use strict";t.exports={ConfigurationError:function(){var e=function(e,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=e,this.value=t,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=2,this.name="INVALID_STATE_ERROR",this.status=e,this.message="Invalid status: "+e};return e.prototype=new Error,e}(),NotSupportedError:function(){var e=function(e){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=e};return e.prototype=new Error,e}(),GetDescriptionError:function(){var e=function(e){this.code=4,this.name="GET_DESCRIPTION_ERROR",this.message=e};return e.prototype=new Error,e}()}},{}],81:[function(e,t,n){"use strict";var r=e("./Grammar/dist/Grammar");t.exports=function(e){return{parse:function(t,n){var i={startRule:n,SIP:e};try{r.parse(t,i)}catch(e){i.data=-1}return i.data}}}},{"./Grammar/dist/Grammar":82}],82:[function(e,t,n){t.exports=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function t(e,t,n,r,i,o){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=o,this.name="SyntaxError"}function n(e){function n(){return e.substring(y,g)}function r(){return y}function i(t){function n(t,n,r){var i,o;for(i=n;i<r;i++)o=e.charAt(i),"\n"===o?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===o||"\u2028"===o||"\u2029"===o?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return b!==t&&(b>t&&(b=0,_={line:1,column:1,seenCR:!1}),n(_,b,t),b=t),_}function o(e){g<w||(g>w&&(w=g,T=[]),T.push(e))}function s(n,r,o){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function a(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,o,s=new Array(e.length);for(o=0;o<e.length;o++)s[o]=e[o].description;return r=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var u=i(o),c=o<e.length?e.charAt(o):null;return null!==r&&s(r),new t(null!==n?n:a(r,c),r,c,o,u.line,u.column)}function a(e){var t,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=e.charCodeAt(t)-32;return n}function u(t){function n(e){return"[object Array]"===Object.prototype.toString.apply(e)?[]:e}for(var r,i,s=v[t],a=0,c=[],l=s.length,d=[],p=[];;){for(;a<l;)switch(s[a]){case 0:p.push(n(m[s[a+1]])),a+=2;break;case 1:p.push(g),a++;break;case 2:p.pop(),a++;break;case 3:g=p.pop(),a++;break;case 4:p.length-=s[a+1],a+=2;break;case 5:p.splice(-2,1),a++;break;case 6:p[p.length-2].push(p.pop()),a++;break;case 7:p.push(p.splice(p.length-s[a+1],s[a+1])),a+=2;break;case 8:p.pop(),p.push(e.substring(p[p.length-1],g)),a++;break;case 9:d.push(l),c.push(a+3+s[a+1]+s[a+2]),p[p.length-1]?(l=a+3+s[a+1],a+=3):(l=a+3+s[a+1]+s[a+2],a+=3+s[a+1]);break;case 10:d.push(l),c.push(a+3+s[a+1]+s[a+2]),p[p.length-1]===f?(l=a+3+s[a+1],a+=3):(l=a+3+s[a+1]+s[a+2],a+=3+s[a+1]);break;case 11:d.push(l),c.push(a+3+s[a+1]+s[a+2]),p[p.length-1]!==f?(l=a+3+s[a+1],a+=3):(l=a+3+s[a+1]+s[a+2],a+=3+s[a+1]);break;case 12:p[p.length-1]!==f?(d.push(l),c.push(a),l=a+2+s[a+1],a+=2):a+=2+s[a+1];break;case 13:d.push(l),c.push(a+3+s[a+1]+s[a+2]),e.length>g?(l=a+3+s[a+1],a+=3):(l=a+3+s[a+1]+s[a+2],a+=3+s[a+1]);break;case 14:d.push(l),c.push(a+4+s[a+2]+s[a+3]),e.substr(g,m[s[a+1]].length)===m[s[a+1]]?(l=a+4+s[a+2],a+=4):(l=a+4+s[a+2]+s[a+3],a+=4+s[a+2]);break;case 15:d.push(l),c.push(a+4+s[a+2]+s[a+3]),e.substr(g,m[s[a+1]].length).toLowerCase()===m[s[a+1]]?(l=a+4+s[a+2],a+=4):(l=a+4+s[a+2]+s[a+3],a+=4+s[a+2]);break;case 16:d.push(l),c.push(a+4+s[a+2]+s[a+3]),m[s[a+1]].test(e.charAt(g))?(l=a+4+s[a+2],a+=4):(l=a+4+s[a+2]+s[a+3],a+=4+s[a+2]);break;case 17:p.push(e.substr(g,s[a+1])),g+=s[a+1],a+=2;break;case 18:p.push(m[s[a+1]]),g+=m[s[a+1]].length,a+=2;break;case 19:p.push(f),0===C&&o(m[s[a+1]]),a+=2;break;case 20:y=p[p.length-1-s[a+1]],a+=2;break;case 21:y=g,a++;break;case 22:for(r=s.slice(a+4,a+4+s[a+3]),i=0;i<s[a+3];i++)r[i]=p[p.length-1-r[i]];p.splice(p.length-s[a+2],s[a+2],m[s[a+1]].apply(null,r)),a+=4+s[a+3];break;case 23:p.push(u(s[a+1])),a+=2;break;case 24:C++,a++;break;case 25:C--,a++;break;default:throw new Error("Invalid opcode: "+s[a]+".")}if(!(d.length>0))break;l=d.pop(),a=c.pop()}return p[0]}function c(e,t){return[e].concat(t)}var l,d=arguments.length>1?arguments[1]:{},f={},p={Contact:118,Name_Addr_Header:155,Record_Route:175,Request_Response:81,SIP_URI:45,Subscription_State:185,Supported:190,Require:181,Via:193,absoluteURI:84,Call_ID:117,Content_Disposition:129,Content_Length:134,Content_Type:135,CSeq:145,displayName:121,Event:148,From:150,host:52,Max_Forwards:153,Min_SE:212,Proxy_Authenticate:156,quoted_string:40,Refer_To:177,Replaces:178,Session_Expires:209,stun_URI:216,To:191,turn_URI:223,uuid:226,WWW_Authenticate:208,challenge:157},h=118,m=["\r\n",{type:"literal",value:"\r\n",description:'"\\r\\n"'},/^[0-9]/,{type:"class",value:"[0-9]",description:"[0-9]"},/^[a-zA-Z]/,{type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},/^[0-9a-fA-F]/,{type:"class",value:"[0-9a-fA-F]",description:"[0-9a-fA-F]"},/^[\0-\xFF]/,{type:"class",value:"[\\0-\\xFF]",description:"[\\0-\\xFF]"},/^["]/,{type:"class",value:'["]',description:'["]'}," ",{type:"literal",value:" ",description:'" "'},"\t",{type:"literal",value:"\t",description:'"\\t"'},/^[a-zA-Z0-9]/,{type:"class",value:"[a-zA-Z0-9]",description:"[a-zA-Z0-9]"},";",{type:"literal",value:";",description:'";"'},"/",{type:"literal",value:"/",description:'"/"'},"?",{type:"literal",value:"?",description:'"?"'},":",{type:"literal",value:":",description:'":"'},"@",{type:"literal",value:"@",description:'"@"'},"&",{type:"literal",value:"&",description:'"&"'},"=",{type:"literal",value:"=",description:'"="'},"+",{type:"literal",value:"+",description:'"+"'},"$",{type:"literal",value:"$",description:'"$"'},",",{type:"literal",value:",",description:'","'},"-",{type:"literal",value:"-",description:'"-"'},"_",{type:"literal",value:"_",description:'"_"'},".",{type:"literal",value:".",description:'"."'},"!",{type:"literal",value:"!",description:'"!"'},"~",{type:"literal",value:"~",description:'"~"'},"*",{type:"literal",value:"*",description:'"*"'},"'",{type:"literal",value:"'",description:'"\'"'},"(",{type:"literal",value:"(",description:'"("'},")",{type:"literal",value:")",description:'")"'},f,"%",{type:"literal",value:"%",description:'"%"'},null,[],function(){return" "},function(){return":"},/^[!-~]/,{type:"class",value:"[!-~]",description:"[!-~]"},/^[\x80-\uFFFF]/,{type:"class",value:"[\\x80-\\uFFFF]",description:"[\\x80-\\uFFFF]"},/^[\x80-\xBF]/,{type:"class",value:"[\\x80-\\xBF]",description:"[\\x80-\\xBF]"},/^[a-f]/,{type:"class",value:"[a-f]",description:"[a-f]"},"`",{type:"literal",value:"`",description:'"`"'},"<",{type:"literal",value:"<",description:'"<"'},">",{type:"literal",value:">",description:'">"'},"\\",{type:"literal",value:"\\",description:'"\\\\"'},"[",{type:"literal",value:"[",description:'"["'},"]",{type:"literal",value:"]",description:'"]"'},"{",{type:"literal",value:"{",description:'"{"'},"}",{type:"literal",value:"}",description:'"}"'},function(){return"*"},function(){return"/"},function(){return"="},function(){return"("},function(){return")"},function(){return">"},function(){return"<"},function(){return","},function(){return";"},function(){return":"},function(){return'"'},/^[!-']/,{type:"class",value:"[!-']",description:"[!-']"},/^[*-[]/,{type:"class",value:"[*-[]",description:"[*-[]"},/^[\]-~]/,{type:"class",value:"[\\]-~]",description:"[\\]-~]"},function(e){return e},/^[#-[]/,{type:"class",value:"[#-[]",description:"[#-[]"},/^[\0-\t]/,{type:"class",value:"[\\0-\\t]",description:"[\\0-\\t]"},/^[\x0B-\f]/,{type:"class",value:"[\\x0B-\\f]",description:"[\\x0B-\\f]"},/^[\x0E-]/,{type:"class",value:"[\\x0E-]",description:"[\\x0E-]"},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port},function(){d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params,"SIP_URI"===d.startRule&&(d.data=d.data.uri)},"sips",{type:"literal",value:"sips",description:'"sips"'},"sip",{type:"literal",value:"sip",description:'"sip"'},function(e){d.data.scheme=e},function(){d.data.user=decodeURIComponent(n().slice(0,-1))},function(){d.data.password=n()},function(){return d.data.host=n(),d.data.host},function(){return d.data.host_type="domain",n()},/^[a-zA-Z0-9_\-]/,{type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},/^[a-zA-Z0-9\-]/,{type:"class",value:"[a-zA-Z0-9\\-]",description:"[a-zA-Z0-9\\-]"},function(){return d.data.host_type="IPv6",n()},"::",{type:"literal",value:"::",description:'"::"'},function(){return d.data.host_type="IPv6",n()},function(){return d.data.host_type="IPv4",n()},"25",{type:"literal",value:"25",description:'"25"'},/^[0-5]/,{type:"class",value:"[0-5]",description:"[0-5]"},"2",{type:"literal",value:"2",description:'"2"'},/^[0-4]/,{type:"class",value:"[0-4]",description:"[0-4]"},"1",{type:"literal",value:"1",description:'"1"'},/^[1-9]/,{type:"class",value:"[1-9]",description:"[1-9]"},function(e){return e=parseInt(e.join("")),d.data.port=e,e},"transport=",{type:"literal",value:"transport=",description:'"transport="'},"udp",{type:"literal",value:"udp",description:'"udp"'},"tcp",{type:"literal",value:"tcp",description:'"tcp"'},"sctp",{type:"literal",value:"sctp",description:'"sctp"'},"tls",{type:"literal",value:"tls",description:'"tls"'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.transport=e.toLowerCase()},"user=",{type:"literal",value:"user=",description:'"user="'},"phone",{type:"literal",value:"phone",description:'"phone"'},"ip",{type:"literal",value:"ip",description:'"ip"'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.user=e.toLowerCase()},"method=",{type:"literal",value:"method=",description:'"method="'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.method=e},"ttl=",{type:"literal",value:"ttl=",description:'"ttl="'},function(e){d.data.params||(d.data.params={}),d.data.params.ttl=e},"maddr=",{type:"literal",value:"maddr=",description:'"maddr="'},function(e){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.maddr=e},"lr",{type:"literal",value:"lr",description:'"lr"'},function(){d.data.uri_params||(d.data.uri_params={}),d.data.uri_params.lr=void 0},function(e,t){d.data.uri_params||(d.data.uri_params={}),t=null===t?void 0:t[1],d.data.uri_params[e.toLowerCase()]=t&&t.toLowerCase()},function(e,t){e=e.join("").toLowerCase(),t=t.join(""),d.data.uri_headers||(d.data.uri_headers={}),d.data.uri_headers[e]?d.data.uri_headers[e].push(t):d.data.uri_headers[e]=[t]},function(){"Refer_To"===d.startRule&&(d.data.uri=new d.SIP.URI(d.data.scheme,d.data.user,d.data.host,d.data.port,d.data.uri_params,d.data.uri_headers),delete d.data.scheme,delete d.data.user,delete d.data.host,delete d.data.host_type,delete d.data.port,delete d.data.uri_params)},"//",{type:"literal",value:"//",description:'"//"'},function(){d.data.scheme=n()},{type:"literal",value:"SIP",description:'"SIP"'},function(){d.data.sip_version=n()},"INVITE",{type:"literal",value:"INVITE",description:'"INVITE"'},"ACK",{type:"literal",value:"ACK",description:'"ACK"'},"VXACH",{type:"literal",value:"VXACH",description:'"VXACH"'},"OPTIONS",{type:"literal",value:"OPTIONS",description:'"OPTIONS"'},"BYE",{type:"literal",value:"BYE",description:'"BYE"'},"CANCEL",{type:"literal",value:"CANCEL",description:'"CANCEL"'},"REGISTER",{type:"literal",value:"REGISTER",description:'"REGISTER"'},"SUBSCRIBE",{type:"literal",value:"SUBSCRIBE",description:'"SUBSCRIBE"'},"NOTIFY",{type:"literal",value:"NOTIFY",description:'"NOTIFY"'},"REFER",{type:"literal",value:"REFER",description:'"REFER"'},function(){return d.data.method=n(),d.data.method},function(e){d.data.status_code=parseInt(e.join(""))},function(){d.data.reason_phrase=n()},function(){d.data=n()},function(){var e,t;for(t=d.data.multi_header.length,e=0;e<t;e++)if(null===d.data.multi_header[e].parsed){d.data=null;break}null!==d.data?d.data=d.data.multi_header:d.data=-1},function(){var e;d.data.multi_header||(d.data.multi_header=[]);try{e=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(t){e=null}d.data.multi_header.push({position:g,offset:r(),parsed:e})},function(e){e=n().trim(),'"'===e[0]&&(e=e.substring(1,e.length-1)),d.data.displayName=e},"q",{type:"literal",value:"q",description:'"q"'},function(e){d.data.params||(d.data.params={}),d.data.params.q=e},"expires",{type:"literal",value:"expires",description:'"expires"'},function(e){d.data.params||(d.data.params={}),d.data.params.expires=e},function(e){return parseInt(e.join(""))},"0",{type:"literal",value:"0",description:'"0"'},function(){return parseFloat(n())},function(e,t){d.data.params||(d.data.params={}),t=null===t?void 0:t[1],d.data.params[e.toLowerCase()]=t},"render",{type:"literal",value:"render",description:'"render"'},"session",{type:"literal",value:"session",description:'"session"'},"icon",{type:"literal",value:"icon",description:'"icon"'},"alert",{type:"literal",value:"alert",description:'"alert"'},function(){"Content_Disposition"===d.startRule&&(d.data.type=n().toLowerCase())},"handling",{type:"literal",value:"handling",description:'"handling"'},"optional",{type:"literal",value:"optional",description:'"optional"'},"required",{type:"literal",value:"required",description:'"required"'},function(e){d.data=parseInt(e.join(""))},function(){d.data=n()},"text",{type:"literal",value:"text",description:'"text"'},"image",{type:"literal",value:"image",description:'"image"'},"audio",{type:"literal",value:"audio",description:'"audio"'},"video",{type:"literal",value:"video",description:'"video"'},"application",{type:"literal",value:"application",description:'"application"'},"message",{type:"literal",value:"message",description:'"message"'},"multipart",{type:"literal",value:"multipart",description:'"multipart"'},"x-",{type:"literal",value:"x-",description:'"x-"'},function(e){d.data.value=parseInt(e.join(""))},function(e){d.data=e},function(e){d.data.event=e.toLowerCase()},function(){var e=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),e&&d.data.setParam("tag",e)},"tag",{type:"literal",value:"tag",description:'"tag"'},function(e){d.data.tag=e},function(e){d.data=parseInt(e.join(""))},function(e){d.data=e},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},"digest",{type:"literal",value:"Digest",description:'"Digest"'},"realm",{type:"literal",value:"realm",description:'"realm"'},function(e){d.data.realm=e},"domain",{type:"literal",value:"domain",description:'"domain"'},"nonce",{type:"literal",value:"nonce",description:'"nonce"'},function(e){d.data.nonce=e},"opaque",{type:"literal",value:"opaque",description:'"opaque"'},function(e){d.data.opaque=e},"stale",{type:"literal",value:"stale",description:'"stale"'},"true",{type:"literal",value:"true",description:'"true"'},function(){d.data.stale=!0},"false",{type:"literal",value:"false",description:'"false"'},function(){d.data.stale=!1},"algorithm",{type:"literal",value:"algorithm",description:'"algorithm"'},"md5",{type:"literal",value:"MD5",description:'"MD5"'},"md5-sess",{type:"literal",value:"MD5-sess",description:'"MD5-sess"'},function(e){d.data.algorithm=e.toUpperCase()},"qop",{type:"literal",value:"qop",description:'"qop"'},"auth-int",{type:"literal",value:"auth-int",description:'"auth-int"'},"auth",{type:"literal",value:"auth",description:'"auth"'},function(e){d.data.qop||(d.data.qop=[]),d.data.qop.push(e.toLowerCase())},function(e){d.data.value=parseInt(e.join(""))},function(){var e,t;for(t=d.data.multi_header.length,e=0;e<t;e++)if(null===d.data.multi_header[e].parsed){d.data=null;break}null!==d.data?d.data=d.data.multi_header:d.data=-1},function(){var e;d.data.multi_header||(d.data.multi_header=[]);try{e=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),delete d.data.uri,delete d.data.displayName,delete d.data.params}catch(t){e=null}d.data.multi_header.push({position:g,offset:r(),parsed:e})},function(){d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params)},function(){d.data.replaces_from_tag&&d.data.replaces_to_tag||(d.data=-1)},function(){d.data={call_id:d.data}},"from-tag",{type:"literal",value:"from-tag",description:'"from-tag"'},function(e){d.data.replaces_from_tag=e},"to-tag",{type:"literal",value:"to-tag",description:'"to-tag"'},function(e){d.data.replaces_to_tag=e},"early-only",{type:"literal",value:"early-only",description:'"early-only"'},function(){d.data.early_only=!0},function(e){return e},function(e,t){return c(e,t)},function(e){"Require"===d.startRule&&(d.data=e||[])},function(e){d.data.value=parseInt(e.join(""))},"active",{type:"literal",value:"active",description:'"active"'},"pending",{type:"literal",value:"pending",description:'"pending"'},"terminated",{type:"literal",value:"terminated",description:'"terminated"'},function(){d.data.state=n()},"reason",{type:"literal",value:"reason",description:'"reason"'},function(e){void 0!==e&&(d.data.reason=e)},function(e){void 0!==e&&(d.data.expires=e)},"retry_after",{type:"literal",value:"retry_after",description:'"retry_after"'},function(e){void 0!==e&&(d.data.retry_after=e)},"deactivated",{type:"literal",value:"deactivated",description:'"deactivated"'},"probation",{type:"literal",value:"probation",description:'"probation"'},"rejected",{type:"literal",value:"rejected",description:'"rejected"'},"timeout",{type:"literal",value:"timeout",description:'"timeout"'},"giveup",{type:"literal",value:"giveup",description:'"giveup"'},"noresource",{type:"literal",value:"noresource",description:'"noresource"'},"invariant",{type:"literal",value:"invariant",description:'"invariant"'},function(e){"Supported"===d.startRule&&(d.data=e||[])},function(){var e=d.data.tag;d.data=new d.SIP.NameAddrHeader(d.data.uri,d.data.displayName,d.data.params),e&&d.data.setParam("tag",e)},"ttl",{type:"literal",value:"ttl",description:'"ttl"'},function(e){d.data.ttl=e},"maddr",{type:"literal",value:"maddr",description:'"maddr"'},function(e){d.data.maddr=e},"received",{type:"literal",value:"received",description:'"received"'},function(e){d.data.received=e},"branch",{type:"literal",value:"branch",description:'"branch"'},function(e){d.data.branch=e},"rport",{type:"literal",value:"rport",description:'"rport"'},function(){"undefined"!=typeof response_port&&(d.data.rport=response_port.join(""))},function(e){d.data.protocol=e},{type:"literal",value:"UDP",description:'"UDP"'},{type:"literal",value:"TCP",description:'"TCP"'},{type:"literal",value:"TLS",description:'"TLS"'},{type:"literal",value:"SCTP",description:'"SCTP"'},function(e){d.data.transport=e},function(){d.data.host=n()},function(e){d.data.port=parseInt(e.join(""))},function(e){return parseInt(e.join(""))},function(e){"Session_Expires"===d.startRule&&(d.data.deltaSeconds=e)},"refresher",{type:"literal",value:"refresher",description:'"refresher"'},"uas",{type:"literal",value:"uas",description:'"uas"'},"uac",{type:"literal",value:"uac",description:'"uac"'},function(e){"Session_Expires"===d.startRule&&(d.data.refresher=e)},function(e){"Min_SE"===d.startRule&&(d.data=e)},"stuns",{type:"literal",value:"stuns",description:'"stuns"'},"stun",{type:"literal",value:"stun",description:'"stun"'},function(e){d.data.scheme=e},function(e){d.data.host=e},"?transport=",{type:"literal",value:"?transport=",description:'"?transport="'},"turns",{type:"literal",value:"turns",description:'"turns"'},"turn",{type:"literal",value:"turn",description:'"turn"'},function(){d.data.transport=transport},function(){d.data=n()}],v=[a('. ""2 3!'),a('0"""1!3#'),a('0$""1!3%'),a('0&""1!3\''),a("7'*# \"7("),a('0(""1!3)'),a('0*""1!3+'),a('.,""2,3-'),a('..""2.3/'),a('00""1!31'),a('.2""2233*Â ".4""2435*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('7)*# "7,'),a('.F""2F3G*} ".H""2H3I*q ".J""2J3K*e ".L""2L3M*Y ".N""2N3O*M ".P""2P3Q*A ".R""2R3S*5 ".T""2T3U*) ".V""2V3W'),a('!!.Y""2Y3Z+7$7#+-%7#+#%\'#%$## X$"# X"# X+! (%'),a('!! \\7$,#&7$"+-$7 +#%\'"%$"# X"# X*# " [+@$ \\7$+&$,#&7$""" X+\'%4"6]" %$"# X"# X'),a('7.*# " ['),a('! \\7\'*# "7(,)&7\'*# "7("+A$.8""2839+1%7/+\'%4#6^# %$## X$"# X"# X'),a('!! \\72+&$,#&72""" X+o$ \\! \\7.,#&7."+-$72+#%\'"%$"# X"# X,@&! \\7.,#&7."+-$72+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('0_""1!3`*# "73'),a('0a""1!3b'),a('0c""1!3d'),a('7!*) "0e""1!3f'),a('! \\7)*Â ".F""2F3G*Â ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+Â$,Â&7)*Â ".F""2F3G*Â ".J""2J3K*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),a('! \\7)*Â ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O+Â$,Â&7)*Â ".F""2F3G*} ".L""2L3M*q ".Y""2Y3Z*e ".P""2P3Q*Y ".H""2H3I*M ".@""2@3A*A ".g""2g3h*5 ".R""2R3S*) ".N""2N3O""" X+! (%'),a('.T""2T3U*Ã£ ".V""2V3W*Ã ".i""2i3j*Ã ".k""2k3l*Â¿ ".:""2:3;*Â³ ".D""2D3E*Â§ ".2""2233*Â ".8""2839*Â ".m""2m3n*Â "7&*} ".4""2435*q ".o""2o3p*e ".q""2q3r*Y ".6""2637*M ".>""2>3?*A ".s""2s3t*5 ".u""2u3v*) "7\'*# "7('),a('! \\7)*Ä« ".F""2F3G*Ä ".J""2J3K*Ä ".L""2L3M*Ä ".Y""2Y3Z*Ã» ".P""2P3Q*Ã¯ ".H""2H3I*Ã£ ".@""2@3A*Ã ".g""2g3h*Ã ".R""2R3S*Â¿ ".N""2N3O*Â³ ".T""2T3U*Â§ ".V""2V3W*Â ".i""2i3j*Â ".k""2k3l*Â ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v+Ä´$,Ä±&7)*Ä« ".F""2F3G*Ä ".J""2J3K*Ä ".L""2L3M*Ä ".Y""2Y3Z*Ã» ".P""2P3Q*Ã¯ ".H""2H3I*Ã£ ".@""2@3A*Ã ".g""2g3h*Ã ".R""2R3S*Â¿ ".N""2N3O*Â³ ".T""2T3U*Â§ ".V""2V3W*Â ".i""2i3j*Â ".k""2k3l*Â ".8""2839*w ".m""2m3n*k "7&*e ".4""2435*Y ".o""2o3p*M ".q""2q3r*A ".6""2637*5 ".s""2s3t*) ".u""2u3v""" X+! (%'),a('!7/+A$.P""2P3Q+1%7/+\'%4#6w# %$## X$"# X"# X'),a('!7/+A$.4""2435+1%7/+\'%4#6x# %$## X$"# X"# X'),a('!7/+A$.>""2>3?+1%7/+\'%4#6y# %$## X$"# X"# X'),a('!7/+A$.T""2T3U+1%7/+\'%4#6z# %$## X$"# X"# X'),a('!7/+A$.V""2V3W+1%7/+\'%4#6{# %$## X$"# X"# X'),a('!.k""2k3l+1$7/+\'%4"6|" %$"# X"# X'),a('!7/+7$.i""2i3j+\'%4"6}" %$"# X"# X'),a('!7/+A$.D""2D3E+1%7/+\'%4#6~# %$## X$"# X"# X'),a('!7/+A$.2""2233+1%7/+\'%4#6# %$## X$"# X"# X'),a('!7/+A$.8""2839+1%7/+\'%4#6Â# %$## X$"# X"# X'),a('!7/+1$7&+\'%4"6Â" %$"# X"# X'),a('!7&+1$7/+\'%4"6Â" %$"# X"# X'),a('!7=+W$ \\7G*) "7K*# "7F,/&7G*) "7K*# "7F"+-%7>+#%\'#%$## X$"# X"# X'),a('0Â""1!3Â*A "0Â""1!3Â*5 "0Â""1!3Â*) "73*# "7.'),a('!!7/+U$7&+K% \\7J*# "7K,)&7J*# "7K"+-%7&+#%\'$%$$# X$## X$"# X"# X+! (%'),a('!7/+`$7&+V%! \\7J*# "7K,)&7J*# "7K"+! (%+2%7&+(%4$6Â$!!%$$# X$## X$"# X"# X'),a('7.*G ".L""2L3M*; "0Â""1!3Â*/ "0Â""1!3Â*# "73'),a('!.m""2m3n+K$0Â""1!3Â*5 "0Â""1!3Â*) "0Â""1!3Â+#%\'"%$"# X"# X'),a('!7N+Q$.8""2839+A%7O*# " [+1%7S+\'%4$6Â$ %$$# X$## X$"# X"# X'),a('!7N+k$.8""2839+[%7O*# " [+K%7S+A%7_+7%7l*# " [+\'%4&6Â& %$&# X$%# X$$# X$## X$"# X"# X'),a('!/Â""1$3Â*) "/Â""1#3Â+\' 4!6Â!! %'),a('!7P+b$!.8""2839+-$7R+#%\'"%$"# X"# X*# " [+7%.:""2:3;+\'%4#6Â# %$## X$"# X"# X'),a(' \\7+*) "7-*# "7Q+2$,/&7+*) "7-*# "7Q""" X'),a('.<""2<3=*q ".>""2>3?*e ".@""2@3A*Y ".B""2B3C*M ".D""2D3E*A ".2""2233*5 ".6""2637*) ".4""2435'),a('! \\7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E,e&7+*_ "7-*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E"+& 4!6Â! %'),a('!7T+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6Â! %'),a('! \\!7V+3$.J""2J3K+#%\'"%$"# X"# X,>&!7V+3$.J""2J3K+#%\'"%$"# X"# X"+G$7W+=%.J""2J3K*# " [+\'%4#6Â# %$## X$"# X"# X'),a(' \\0Â""1!3Â+,$,)&0Â""1!3Â""" X'),a('!0$""1!3%+A$ \\0Â""1!3Â,)&0Â""1!3Â"+#%\'"%$"# X"# X'),a('!.o""2o3p+A$7Y+7%.q""2q3r+\'%4#6Â # %$## X$"# X"# X'),a('!!7Z+Â¿$.8""2839+Â¯%7Z+Â¥%.8""2839+Â%7Z+Â%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'-%$-# X$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*à ¸ "!.Â¡""2Â¡3Â¢+Â¯$7Z+Â¥%.8""2839+Â%7Z+Â%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\',%$,# X$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Þ "!.Â¡""2Â¡3Â¢+Â$7Z+Â%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ü "!.Â¡""2Â¡3Â¢+{$7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ú "!.Â¡""2Â¡3Â¢+a$7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'&%$&# X$%# X$$# X$## X$"# X"# X*Ù "!.Â¡""2Â¡3Â¢+G$7Z+=%.8""2839+-%7[+#%\'$%$$# X$## X$"# X"# X*Ø "!.Â¡""2Â¡3Â¢+-$7[+#%\'"%$"# X"# X*×¬ "!.Â¡""2Â¡3Â¢+-$7Z+#%\'"%$"# X"# X*× "!7Z+Â¥$.Â¡""2Â¡3Â¢+Â%7Z+Â%.8""2839+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'+%$+# X$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ô¸ "!7Z+Â¶$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%.Â¡""2Â¡3Â¢+{%7Z+q%.8""2839+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\'*%$*# X$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ò "!7Z+Ã$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+q%.Â¡""2Â¡3Â¢+a%7Z+W%.8""2839+G%7Z+=%.8""2839+-%7[+#%\')%$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ï "!7Z+Ã$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â­%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+W%.Â¡""2Â¡3Â¢+G%7Z+=%.8""2839+-%7[+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Ì "!7Z+Ã©$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â¾%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.Â¡""2Â¡3Â¢+-%7[+#%\'\'%$\'# X$&# X$%# X$$# X$## X$"# X"# X*É "!7Z+Ä$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Ã©%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â¾%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+h%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+=%.Â¡""2Â¡3Â¢+-%7Z+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X*Å "!7Z+Äµ$!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Ä%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Ã%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â´%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+Â%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+^%!.8""2839+-$7Z+#%\'"%$"# X"# X*# " [+3%.Â¡""2Â¡3Â¢+#%\'(%$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X+& 4!6Â£! %'),a('!7#+S$7#*# " [+C%7#*# " [+3%7#*# " [+#%\'$%$$# X$## X$"# X"# X'),a('!7Z+=$.8""2839+-%7Z+#%\'#%$## X$"# X"# X*# "7\\'),a('!7]+u$.J""2J3K+e%7]+[%.J""2J3K+K%7]+A%.J""2J3K+1%7]+\'%4\'6Â¤\' %$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!.Â¥""2Â¥3Â¦+3$0Â§""1!3Â¨+#%\'"%$"# X"# X*Â  "!.Â©""2Â©3Âª+=$0Â«""1!3Â¬+-%7!+#%\'#%$## X$"# X"# X*o "!.Â­""2Â­3Â®+7$7!+-%7!+#%\'#%$## X$"# X"# X*D "!0Â¯""1!3Â°+-$7!+#%\'"%$"# X"# X*# "7!'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6Â±!! %'),a(' \\!.2""2233+-$7`+#%\'"%$"# X"# X,>&!.2""2233+-$7`+#%\'"%$"# X"# X"'),a('7a*A "7b*; "7c*5 "7d*/ "7e*) "7f*# "7g'),a('!/Â²""1*3Â³+b$/Â´""1#3Âµ*G "/Â¶""1#3Â·*; "/Â¸""1$3Â¹*/ "/Âº""1#3Â»*# "76+(%4"6Â¼"! %$"# X"# X'),a('!/Â½""1%3Â¾+J$/Â¿""1%3Ã*/ "/Ã""1"3Ã*# "76+(%4"6Ã"! %$"# X"# X'),a('!/Ã""1\'3Ã+2$7Â+(%4"6Ã"! %$"# X"# X'),a('!/Ã""1$3Ã+2$7Ã¯+(%4"6Ã"! %$"# X"# X'),a('!/Ã""1&3Ã+2$7T+(%4"6Ã"! %$"# X"# X'),a('!/Ã""1"3Ã+R$!.>""2>3?+-$76+#%\'"%$"# X"# X*# " [+\'%4"6Ã" %$"# X"# X'),a('!7h+T$!.>""2>3?+-$7i+#%\'"%$"# X"# X*# " [+)%4"6Ã""! %$"# X"# X'),a('! \\7j+&$,#&7j""" X+! (%'),a('! \\7j+&$,#&7j""" X+! (%'),a('7k*) "7+*# "7-'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".8""2839*A ".<""2<3=*5 ".@""2@3A*) ".B""2B3C'),a('!.6""2637+u$7m+k% \\!.<""2<3=+-$7m+#%\'"%$"# X"# X,>&!.<""2<3=+-$7m+#%\'"%$"# X"# X"+#%\'#%$## X$"# X"# X'),a('!7n+C$.>""2>3?+3%7o+)%4#6Ã#"" %$## X$"# X"# X'),a(' \\7p*) "7+*# "7-+2$,/&7p*) "7+*# "7-""" X'),a(' \\7p*) "7+*# "7-,/&7p*) "7+*# "7-"'),a('.o""2o3p*e ".q""2q3r*Y ".4""2435*M ".6""2637*A ".8""2839*5 ".@""2@3A*) ".B""2B3C'),a('7Â*# "7r'),a("!7Â+K$7'+A%7s+7%7'+-%7Â+#%'%%$%# X$$# X$## X$\"# X\"# X"),a('7M*# "7t'),a('!7+G$.8""2839+7%7u*# "7x+\'%4#6Ã# %$## X$"# X"# X'),a('!7v*# "7w+N$!.6""2637+-$7Â+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!.Ã""2Ã3Ã+=$7Â+3%7w*# " [+#%\'#%$## X$"# X"# X'),a('!.4""2435+-$7{+#%\'"%$"# X"# X'),a('!7z+5$ \\7y,#&7y"+#%\'"%$"# X"# X'),a('7**) "7+*# "7-'),a('7+*Â "7-*Â ".2""2233*} ".6""2637*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7|+k$ \\!.4""2435+-$7|+#%\'"%$"# X"# X,>&!.4""2435+-$7|+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7~,#&7~"+k$ \\!.2""2233+-$7}+#%\'"%$"# X"# X,>&!.2""2233+-$7}+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a(' \\7~,#&7~"'),a('7+*w "7-*q ".8""2839*e ".:""2:3;*Y ".<""2<3=*M ".>""2>3?*A ".@""2@3A*5 ".B""2B3C*) ".D""2D3E'),a('!7"+Â$ \\7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K,M&7"*G "7!*A ".@""2@3A*5 ".F""2F3G*) ".J""2J3K"+\'%4"6Ã" %$"# X"# X'),a('7Â*# "7Â'),a('!!7O+3$.:""2:3;+#%\'"%$"# X"# X*# " [+-$7S+#%\'"%$"# X"# X*# " ['),a(' \\7+*Â "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A+Â$,Â&7+*Â "7-*} ".B""2B3C*q ".D""2D3E*e ".2""2233*Y ".8""2839*M ".:""2:3;*A ".<""2<3=*5 ".>""2>3?*) ".@""2@3A""" X'),a(' \\7y,#&7y"'),a('!/Â""1#3Ã+y$.4""2435+i% \\7!+&$,#&7!""" X+P%.J""2J3K+@% \\7!+&$,#&7!""" X+\'%4%6Ã% %$%# X$$# X$## X$"# X"# X'),a('.Ã""2Ã3Ã'),a('.Ã""2Ã3Ã'),a('.Ã""2Ã3Ã'),a('.Ã""2Ã3Ã'),a('.Ã ""2Ã 3Ã¡'),a('.Ã¢""2Ã¢3Ã£'),a('.Ã¤""2Ã¤3Ã¥'),a('.Ã¦""2Ã¦3Ã§'),a('.Ã¨""2Ã¨3Ã©'),a('.Ãª""2Ãª3Ã«'),a('!7Â*S "7Â*M "7Â*G "7Â*A "7Â*; "7Â*5 "7Â*/ "7Â*) "7Â*# "76+& 4!6Ã¬! %'),a("!7Â+K$7'+A%7Â+7%7'+-%7Â+#%'%%$%# X$$# X$## X$\"# X\"# X"),a("!7Â+' 4!6Ã­!! %"),a('!7!+7$7!+-%7!+#%\'#%$## X$"# X"# X'),a('! \\7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7(,G&7**A "7+*; "7-*5 "73*/ "74*) "7\'*# "7("+& 4!6Ã®! %'),a('!7Âµ+_$ \\!7A+-$7Âµ+#%\'"%$"# X"# X,8&!7A+-$7Âµ+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!79+R$!.:""2:3;+-$79+#%\'"%$"# X"# X*# " [+\'%4"6Ã¯" %$"# X"# X'),a('!7:*j "!7Â+_$ \\!7A+-$7Â+#%\'"%$"# X"# X,8&!7A+-$7Â+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+& 4!6Ã°! %'),a('!7L*# "7Â+c$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+\'%4"6Ã±" %$"# X"# X'),a('!7Â*# " [+A$7@+7%7M+-%7?+#%\'$%$$# X$## X$"# X"# X'),a('!!76+_$ \\!7.+-$76+#%\'"%$"# X"# X,8&!7.+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X*# "7H+\' 4!6Ã²!! %'),a('7Â*) "7Â*# "7Â'),a('!/Ã³""1!3Ã´+<$7<+2%7Â+(%4#6Ãµ#! %$## X$"# X"# X'),a('!/Ã¶""1\'3Ã·+<$7<+2%7Â+(%4#6Ã¸#! %$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ã¹!! %'),a('!.Ãº""2Ãº3Ã»+x$!.J""2J3K+S$7!*# " [+C%7!*# " [+3%7!*# " [+#%\'$%$$# X$## X$"# X"# X*# " [+\'%4"6Ã¼" %$"# X"# X'),a('!76+N$!7<+-$7Â +#%\'"%$"# X"# X*# " [+)%4"6Ã½""! %$"# X"# X'),a('76*) "7T*# "7H'),a('!7Â¢+_$ \\!7B+-$7Â£+#%\'"%$"# X"# X,8&!7B+-$7Â£+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/Ã¾""1&3Ã¿*G "/Ä""1\'3Ä*; "/Ä""1$3Ä*/ "/Ä""1%3Ä*# "76+& 4!6Ä! %'),a('7Â¤*# "7Â'),a('!/Ä""1(3Ä+O$7<+E%/Ä""1(3Ä*/ "/Ä""1(3Ä*# "76+#%\'#%$## X$"# X"# X'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ä!! %'),a("!7Â¨+& 4!6Ä! %"),a('!7Â©+s$7;+i%7Â®+_% \\!7B+-$7Â¯+#%\'"%$"# X"# X,8&!7B+-$7Â¯+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7Âª*# "7Â«'),a('/Ä""1$3Ä*S "/Ä""1%3Ä*G "/Ä""1%3Ä*; "/Ä""1%3Ä*/ "/Ä""1+3Ä*# "7Â¬'),a('/Ä""1\'3Ä*/ "/Ä""1)3Ä*# "7Â¬'),a('76*# "7Â­'),a('!/Ä""1"3Ä+-$76+#%\'"%$"# X"# X'),a('7Â¬*# "76'),a('!76+7$7<+-%7Â°+#%\'#%$## X$"# X"# X'),a('76*# "7H'),a('!7Â²+7$7.+-%7Â+#%\'#%$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ä!! %'),a("!7Â+' 4!6Ä !! %"),a('!7Âµ+d$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+(%4"6Ä¡"!!%$"# X"# X'),a('!!77+k$ \\!.J""2J3K+-$77+#%\'"%$"# X"# X,>&!.J""2J3K+-$77+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+! (%'),a('!7L*# "7Â+c$ \\!7B+-$7Â·+#%\'"%$"# X"# X,8&!7B+-$7Â·+#%\'"%$"# X"# X"+\'%4"6Ä¢" %$"# X"# X'),a('7Â¸*# "7Â'),a('!/Ä£""1#3Ä¤+<$7<+2%76+(%4#6Ä¥#! %$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Ä¦!! %'),a("!7Â+' 4!6Ä§!! %"),a('! \\7Â,#&7Â"+Â$7@+w%7M+m%7?+c% \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+\'%4%6Ä¨% %$%# X$$# X$## X$"# X"# X'),a("7Â½"),a('!/Ä©""1&3Äª+s$7.+i%7Ã+_% \\!7A+-$7Ã+#%\'"%$"# X"# X,8&!7A+-$7Ã+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X*# "7Â¾'),a('!76+s$7.+i%7Â¿+_% \\!7A+-$7Â¿+#%\'"%$"# X"# X,8&!7A+-$7Â¿+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('!76+=$7<+3%76*# "7H+#%\'#%$## X$"# X"# X'),a('7Ã*G "7Ã*A "7Ã*; "7Ã*5 "7Ã*/ "7Ã*) "7Ã*# "7Â¿'),a('!/Ä«""1%3Ä¬+7$7<+-%7Ã+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6Ä­!! %"),a('!/Ä®""1&3Ä¯+Â¥$7<+Â%7D+Â%7Ã+Â% \\! \\7\'+&$,#&7\'""" X+-$7Ã+#%\'"%$"# X"# X,G&! \\7\'+&$,#&7\'""" X+-$7Ã+#%\'"%$"# X"# X"+-%7E+#%\'&%$&# X$%# X$$# X$## X$"# X"# X'),a('7t*# "7w'),a('!/Ä°""1%3Ä±+7$7<+-%7Ã+#%\'#%$## X$"# X"# X'),a("!7I+' 4!6Ä²!! %"),a('!/Ä³""1&3Ä´+<$7<+2%7I+(%4#6Äµ#! %$## X$"# X"# X'),a('!/Ä¶""1%3Ä·+_$7<+U%!/Ä¸""1$3Ä¹+& 4!6Äº! %*4 "!/Ä»""1%3Ä¼+& 4!6Ä½! %+#%\'#%$## X$"# X"# X'),a('!/Ä¾""1)3Ä¿+T$7<+J%/Å""1#3Å*/ "/Å""1(3Å*# "76+(%4#6Å#! %$## X$"# X"# X'),a('!/Å""1#3Å+Â$7<+Â%7D+Â%!7Ã+k$ \\!.D""2D3E+-$7Ã+#%\'"%$"# X"# X,>&!.D""2D3E+-$7Ã+#%\'"%$"# X"# X"+#%\'"%$"# X"# X+-%7E+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/Å""1(3Å*/ "/Å""1$3Å*# "76+\' 4!6Å!! %'),a('!76+_$ \\!7A+-$76+#%\'"%$"# X"# X,8&!7A+-$76+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7Ã+K$7.+A%7Ã+7%7.+-%7Â+#%\'%%$%# X$$# X$## X$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Å!! %'),a('!7Ã+c$ \\!7A+-$7Ã+#%\'"%$"# X"# X,8&!7A+-$7Ã+#%\'"%$"# X"# X"+\'%4"6Å" %$"# X"# X'),a('!7Â+c$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+\'%4"6Å" %$"# X"# X'),a('!7L*T "7Â*N "!7@*# " [+=$7t+3%7?*# " [+#%\'#%$## X$"# X"# X+c$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+\'%4"6Å" %$"# X"# X'),a('!7Ã+c$ \\!7B+-$7Ã+#%\'"%$"# X"# X,8&!7B+-$7Ã+#%\'"%$"# X"# X"+\'%4"6Å" %$"# X"# X'),a("!7Â+& 4!6Å! %"),a('!/Å""1(3Å+<$7<+2%76+(%4#6Å#! %$## X$"# X"# X*j "!/Å""1&3Å+<$7<+2%76+(%4#6Å#! %$## X$"# X"# X*: "!/Å""1*3Å+& 4!6Å! %*# "7Â'),a('!!76+o$ \\!7A+2$76+(%4"6Å"! %$"# X"# X,=&!7A+2$76+(%4"6Å"! %$"# X"# X"+)%4"6Å""! %$"# X"# X*# " [+\' 4!6Å!! %'),a('!7Ã+_$ \\!7A+-$7Ã+#%\'"%$"# X"# X,8&!7A+-$7Ã+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7Â+_$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('! \\7!+&$,#&7!""" X+\' 4!6Å!! %'),a('!7Ã+_$ \\!7B+-$7Ã+#%\'"%$"# X"# X,8&!7B+-$7Ã+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!/Å""1&3Å *; "/Å¡""1\'3Å¢*/ "/Å£""1*3Å¤*# "76+& 4!6Å¥! %'),a('!/Å¦""1&3Å§+<$7<+2%7Ã+(%4#6Å¨#! %$## X$"# X"# X*Â "!/Ã¶""1\'3Ã·+<$7<+2%7Â+(%4#6Å©#! %$## X$"# X"# X*S "!/Åª""1+3Å«+<$7<+2%7Â+(%4#6Å¬#! %$## X$"# X"# X*# "7Â'),a('/Å­""1+3Å®*k "/Å¯""1)3Å°*_ "/Å±""1(3Å²*S "/Å³""1\'3Å´*G "/Åµ""1&3Å¶*; "/Å·""1*3Å¸*/ "/Å¹""1)3Åº*# "76'),a('71*# " ['),a('!!76+o$ \\!7A+2$76+(%4"6Å"! %$"# X"# X,=&!7A+2$76+(%4"6Å"! %$"# X"# X"+)%4"6Å""! %$"# X"# X*# " [+\' 4!6Å»!! %'),a('!7L*# "7Â+c$ \\!7B+-$7Ã +#%\'"%$"# X"# X,8&!7B+-$7Ã +#%\'"%$"# X"# X"+\'%4"6Å¼" %$"# X"# X'),a('7Â¸*# "7Â'),a('!7Ã¢+_$ \\!7A+-$7Ã¢+#%\'"%$"# X"# X,8&!7A+-$7Ã¢+#%\'"%$"# X"# X"+#%\'"%$"# X"# X'),a('!7Ã©+s$7.+i%7Ã¬+_% \\!7B+-$7Ã£+#%\'"%$"# X"# X,8&!7B+-$7Ã£+#%\'"%$"# X"# X"+#%\'$%$$# X$## X$"# X"# X'),a('7Ã¤*; "7Ã¥*5 "7Ã¦*/ "7Ã§*) "7Ã¨*# "7Â'),a('!/Å½""1#3Å¾+<$7<+2%7Ã¯+(%4#6Å¿#! %$## X$"# X"# X'),a('!/Æ""1%3Æ+<$7<+2%7T+(%4#6Æ#! %$## X$"# X"# X'),a('!/Æ""1(3Æ+B$7<+8%7\\*# "7Y+(%4#6Æ#! %$## X$"# X"# X'),a('!/Æ""1&3Æ+<$7<+2%76+(%4#6Æ#! %$## X$"# X"# X'),a('!/Æ""1%3Æ+T$!7<+5$ \\7!,#&7!"+#%\'"%$"# X"# X*# " [+\'%4"6Æ" %$"# X"# X'),a('!7Ãª+K$7;+A%76+7%7;+-%7Ã«+#%\'%%$%# X$$# X$## X$"# X"# X'),a('!/Â""1#3Ã*# "76+\' 4!6Æ!! %'),a('!/Â´""1#3Æ*G "/Â¶""1#3Æ*; "/Âº""1#3Æ*/ "/Â¸""1$3Æ*# "76+\' 4!6Æ!! %'),a('!7Ã­+H$!7C+-$7Ã®+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7U*) "7\\*# "7X+& 4!6Æ! %'),a('!!7!*# " [+c$7!*# " [+S%7!*# " [+C%7!*# " [+3%7!*# " [+#%\'%%$%# X$$# X$## X$"# X"# X+\' 4!6Æ!! %'),a('!!7!+C$7!*# " [+3%7!*# " [+#%\'#%$## X$"# X"# X+\' 4!6Æ!! %'),a("7Â½"),a('!7Â+d$ \\!7B+-$7Ã²+#%\'"%$"# X"# X,8&!7B+-$7Ã²+#%\'"%$"# X"# X"+(%4"6Æ"!!%$"# X"# X'),a('7Ã³*# "7Â'),a('!.Æ""2Æ3Æ+N$7<+D%.Æ""2Æ3Æ*) ".Æ""2Æ3Æ+(%4#6Æ#! %$## X$"# X"# X'),a('!7Â+d$ \\!7B+-$7Â+#%\'"%$"# X"# X,8&!7B+-$7Â+#%\'"%$"# X"# X"+(%4"6Æ"!!%$"# X"# X'),a('!76+7$70+-%7Ã¶+#%\'#%$## X$"# X"# X'),a(' \\72*) "74*# "7.,/&72*) "74*# "7."'),a(' \\7%,#&7%"'),a('!7Ã¹+=$.8""2839+-%7Ãº+#%\'#%$## X$"# X"# X'),a('!/Æ""1%3Æ*) "/Æ ""1$3Æ¡+\' 4!6Æ¢!! %'),a('!7Ã»+N$!.8""2839+-$7^+#%\'"%$"# X"# X*# " [+#%\'"%$"# X"# X'),a('!7\\*) "7X*# "7Â+\' 4!6Æ£!! %'),a('! \\7Ã½*) "7-*# "7Ã¾,/&7Ã½*) "7-*# "7Ã¾"+! (%'),a('7"*S "7!*M ".F""2F3G*A ".J""2J3K*5 ".H""2H3I*) ".N""2N3O'),a('.L""2L3M*Â ".B""2B3C*Â ".<""2<3=*} ".R""2R3S*q ".T""2T3U*e ".V""2V3W*Y ".P""2P3Q*M ".@""2@3A*A ".D""2D3E*5 ".2""2233*) ".>""2>3?'),a('!7Ä+h$.8""2839+X%7Ãº+N%!.Æ¤""2Æ¤3Æ¥+-$7Ã«+#%\'"%$"# X"# X*# " [+#%\'$%$$# X$## X$"# X"# X'),a('!/Æ¦""1%3Æ§*) "/Æ¨""1$3Æ©+\' 4!6Æ¢!! %'),a('!7Ã«+Q$/Â´""1#3Âµ*7 "/Â¶""1#3Â·*+ " \\7+,#&7+"+\'%4"6Æª" %$"# X"# X'),a('!7Ä+Â$.F""2F3G+%7Ä+u%.F""2F3G+e%7Ä+[%.F""2F3G+K%7Ä+A%.F""2F3G+1%7Ä+\'%4)6Æ«) %$)# X$(# X$\'# X$&# X$%# X$$# X$## X$"# X"# X'),a('!7#+A$7#+7%7#+-%7#+#%\'$%$$# X$## X$"# X"# X'),a('!7Ä+-$7Ä+#%\'"%$"# X"# X'),a('!7Ä+7$7Ä+-%7Ä+#%\'#%$## X$"# X"# X')],g=0,y=0,b=0,_={line:1,column:1,seenCR:!1},w=0,T=[],C=0;if("startRule"in d){if(!(d.startRule in p))throw new Error("Can't start parsing from rule \""+d.startRule+'".');h=p[d.startRule]}if(d.data={},l=u(h),l!==f&&g===e.length)return l;throw l!==f&&g<e.length&&o({type:"end",description:"end of input"}),s(null,T,w)}return e(t,Error),{SyntaxError:t,parse:n}}()},{}],83:[function(e,t,n){"use strict";t.exports=function(e){e=e;var t={AllBrowsers:{maskDtls:function(e){return e&&(e=e.replace(/ UDP\/TLS\/RTP\/SAVP/gim," RTP/SAVP")),e},unmaskDtls:function(e){return e.replace(/ RTP\/SAVP/gim," UDP/TLS/RTP/SAVP")}},Firefox:{isFirefox:function(){return"undefined"!=typeof mozRTCPeerConnection},cannotHandleExtraWhitespace:function(e){return this.isFirefox()&&e&&(e=e.replace(/ \r\n/g,"\r\n")),e},hasMissingCLineInSDP:function(e){var t,n;if(e.indexOf("c=")>e.indexOf("m=")){n=e.match(/m=.*\r\n.*/g);for(var r=0;r<n.length;r++)n[r].toString().search(/i=.*/)>=0?(t=e.indexOf(n[r].toString())+n[r].toString().length,"c="!==e.substr(t,2)&&(e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))):n[r].toString().search(/c=.*/)<0&&(t=e.indexOf(n[r].toString().match(/.*/))+n[r].toString().match(/.*/).toString().length,e=e.substr(0,t)+"\r\nc=IN IP4 0.0.0.0"+e.substr(t))}return e}},Chrome:{needsExplicitlyInactiveSDP:function(e){var n,r;return t.Firefox.isFirefox()&&(r=e.indexOf("m=video 0"),r!==-1)?(n=e.substr(r),n=n.replace(/\r\nc=IN IP4.*\r\n$/,"\r\nc=IN IP4 0.0.0.0\r\na=inactive\r\n"),e.substr(0,r)+n):e},getsConfusedAboutGUM:function(e){e.mediaHandler&&e.mediaHandler.close()}}};return t}},{}],84:[function(e,t,n){"use strict";var r={error:0,warn:1,log:2,debug:3};t.exports=function(e){function t(e,t,n){this.logger=e,this.category=t,this.label=n}var n=function(){var e,t=2,n=!0,i=null;this.loggers={},e=this.getLogger("sip.loggerfactory"),Object.defineProperties(this,{builtinEnabled:{get:function(){return n},set:function(t){"boolean"==typeof t?n=t:e.error('invalid "builtinEnabled" parameter value: '+JSON.stringify(t))}},level:{get:function(){return t},set:function(n){n>=0&&n<=3?t=n:n>3?t=3:r.hasOwnProperty(n)?t=r[n]:e.error('invalid "level" parameter value: '+JSON.stringify(n))}},connector:{get:function(){return i},set:function(t){null===t||""===t||void 0===t?i=null:"function"==typeof t?i=t:e.error('invalid "connector" parameter value: '+JSON.stringify(t))}}})};return n.prototype.print=function(t,n,r,i){if("string"==typeof i){var o=[new Date,n];r&&o.push(r),i=o.concat(i).join(" | ")}t.call(e,i)},Object.keys(r).forEach(function(i){t.prototype[i]=function(e){this.logger[i](this.category,this.label,e)},n.prototype[i]=function(t,n,o){this.level>=r[i]&&(this.builtinEnabled&&this.print(e[i],t,n,o),this.connector&&this.connector(i,t,n,o))}}),n.prototype.getLogger=function(e,n){var r;return n&&3===this.level?new t(this,e,n):this.loggers[e]?this.loggers[e]:(r=new t(this,e),this.loggers[e]=r,r)},n}},{}],85:[function(e,t,n){"use strict";t.exports=function(e){var t=function(e,t){e=e,t=t};return t.prototype=Object.create(e.prototype,{isReady:{value:function(){}},close:{value:function(){}},getDescription:{value:function(e){e=e}},hasDescription:{value:function(e){e=e}},setDescription:{value:function(e){e=e}}}),t}},{}],86:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t,n,r){var i;if(!(t&&t instanceof e.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=t,this.parameters={};for(i in r)this.setParam(i,r[i]);Object.defineProperties(this,{friendlyName:{get:function(){return this.displayName||t.aor}},displayName:{get:function(){return n},set:function(e){n=0===e?"0":e}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString())},getParam:e.URI.prototype.getParam,hasParam:e.URI.prototype.hasParam,deleteParam:e.URI.prototype.deleteParam,clearParams:e.URI.prototype.clearParams,clone:function(){return new t(this.uri.clone(),this.displayName,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var e,t;e=this.displayName||0===this.displayName?'"'+this.displayName+'" ':"",e+="<"+this.uri.toString()+">";for(t in this.parameters)e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]);return e}},t.parse=function(t){return t=e.Grammar.parse(t,"Name_Addr_Header"),t!==-1?t:void 0},e.NameAddrHeader=t}},{}],87:[function(e,t,n){"use strict";t.exports=function(e){function t(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(i=e.indexOf("\r\n",n),i===-1)return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function n(t,n,r,i){var o,s,a,u,c=n.indexOf(":",r),l=n.substring(r,c).trim(),d=n.substring(c+1,i).trim();switch(l.toLowerCase()){case"via":case"v":t.addHeader("via",d),1===t.getHeaders("via").length?(u=t.parseHeader("Via"),u&&(t.via=u,t.via_branch=u.branch)):u=0;break;case"from":case"f":t.setHeader("from",d),u=t.parseHeader("from"),u&&(t.from=u,t.from_tag=u.getParam("tag"));break;case"to":case"t":t.setHeader("to",d),u=t.parseHeader("to"),u&&(t.to=u,t.to_tag=u.getParam("tag"));break;case"record-route":if(u=e.Grammar.parse(d,"Record_Route"),u===-1){u=void 0;break}for(a=u.length,s=0;s<a;s++)o=u[s],t.addHeader("record-route",d.substring(o.position,o.offset)),t.headers["Record-Route"][t.getHeaders("record-route").length-1].parsed=o.parsed;break;case"call-id":case"i":t.setHeader("call-id",d),u=t.parseHeader("call-id"),u&&(t.call_id=d);break;case"contact":case"m":if(u=e.Grammar.parse(d,"Contact"),u===-1){u=void 0;break}for(a=u.length,s=0;s<a;s++)o=u[s],t.addHeader("contact",d.substring(o.position,o.offset)),t.headers.Contact[t.getHeaders("contact").length-1].parsed=o.parsed;break;case"content-length":case"l":t.setHeader("content-length",d),u=t.parseHeader("content-length");break;case"content-type":case"c":t.setHeader("content-type",d),u=t.parseHeader("content-type");break;case"cseq":t.setHeader("cseq",d),u=t.parseHeader("cseq"),u&&(t.cseq=u.value),t instanceof e.IncomingResponse&&(t.method=u.method);break;case"max-forwards":t.setHeader("max-forwards",d),u=t.parseHeader("max-forwards");break;case"www-authenticate":t.setHeader("www-authenticate",d),u=t.parseHeader("www-authenticate");break;case"proxy-authenticate":t.setHeader("proxy-authenticate",d),u=t.parseHeader("proxy-authenticate");break;case"refer-to":case"r":t.setHeader("refer-to",d),u=t.parseHeader("refer-to"),u&&(t.refer_to=u);break;default:t.setHeader(l,d),u=0}return void 0!==u||{error:'error parsing header "'+l+'"'}}var r;r={},r.parseMessage=function(r,i){var o,s,a,u,c,l=0,d=r.indexOf("\r\n"),f=i.getLogger("sip.parser");if(d===-1)return void f.warn("no CRLF found, not a SIP message, discarded");if(s=r.substring(0,d),c=e.Grammar.parse(s,"Request_Response"),c===-1)return void f.warn('error parsing first line of SIP message: "'+s+'"');for(c.status_code?(o=new e.IncomingResponse(i),o.status_code=c.status_code,o.reason_phrase=c.reason_phrase):(o=new e.IncomingRequest(i),o.method=c.method,o.ruri=c.uri),o.data=r,l=d+2;;){if(d=t(r,l),d===-2){u=l+2;break}if(d===-1)return void f.error("malformed message");if(c=n(o,r,l,d),c!==!0)return void f.error(c.error);l=d+2}return o.hasHeader("content-length")?(a=o.getHeader("content-length"),o.body=r.substr(u,a)):o.body=r.substring(u),o},e.Parser=r}},{}],88:[function(e,t,n){var r=90;t.exports=function(e){function t(e){var t=e.parseHeader("Supported")||[],n=e.parseHeader("Session-Expires")||{};return t.indexOf("timer")>=0&&n.deltaSeconds<r}function n(t,n,r,i){t.sessionTimerState=t.sessionTimerState||{},e.clearTimeout(t.sessionTimerState.timeout);var o="string"==typeof n;o&&(n=r(n,i));var s=n.parseHeader("Session-Expires");if(!s)return void(t.sessionTimerState=null);var a=s.deltaSeconds,u=o===("uas"===s.refresher);t.sessionTimerState={interval:a,isRefresher:u};var c=1e3*a,l=this;if(u)t.sessionTimerState.timeout=e.setInterval(function(){t.owner.ua.dialogs[t.id.toString()]||!1?t.sendRequest(l,"UPDATE",{extraHeaders:["Session-Expires: "+a]}):e.clearInterval(t.sessionTimerState.timeout)},c/2);else{var d=Math.min(32e3,c/3);t.sessionTimerState.timeout=e.setTimeout(function(){},c-d)}}function i(e){}function o(e){}function s(){}function a(){}return{localMinSE:r,hasSmallMinSE:t,updateState:n,receiveResponse:i,onDialogError:o,onRequestTimeout:s,onTransportError:a}}},{}],89:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t){var n={},r=1;this.registrar=t.configuration.registrarServer,this.expires=t.configuration.registerExpires,this.contact=t.contact.toString(),r&&(this.contact+=";reg-id="+r,this.contact+=';+sip.instance="<urn:uuid:'+t.configuration.instanceId+'>"'),this.call_id=e.Utils.createRandomToken(22),this.cseq=80,this.to_uri=t.configuration.uri,n.to_uri=this.to_uri,n.to_displayName=t.configuration.displayName,n.call_id=this.call_id,n.cseq=this.cseq,e.Utils.augment(this,e.ClientContext,[t,"REGISTER",this.registrar,{params:n}]),this.registrationTimer=null,this.registrationExpiredTimer=null,this.registered=!1,this.logger=t.getLogger("sip.registercontext")},t.prototype={register:function(t){var n,r=this;this.options=t||{},n=(this.options.extraHeaders||[]).slice(),n.push("Contact: "+this.contact+";expires="+this.expires),n.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(t){var n,i,o,s=t.getHeaders("contact").length;if(t.cseq===this.cseq)switch(null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):if(this.emit("accepted",t),t.hasHeader("expires")&&(i=t.getHeader("expires")),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),!s){this.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(;s--;){if(n=t.parseHeader("contact",s),n.uri.user===this.ua.contact.uri.user){i=n.getParam("expires");break}n=null}if(!n){this.logger.warn("no Contact header pointing to us, response ignored");break}i||(i=this.expires),this.registrationTimer=e.Timers.setTimeout(function(){r.registrationTimer=null,r.register(r.options)},1e3*i-3e3),this.registrationExpiredTimer=e.Timers.setTimeout(function(){r.logger.warn("registration expired"),r.registered&&r.unregistered(null,e.C.causes.EXPIRES)},1e3*i),n.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=e.URI.parse(n.getParam("temp-gruu").replace(/"/g,""))),n.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=e.URI.parse(n.getParam("pub-gruu").replace(/"/g,""))),this.registered=!0,this.emit("registered",t||null);break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(this.expires=t.getHeader("min-expires"),this.register(this.options)):(this.logger.warn("423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,e.C.causes.SIP_FAILURE_CODE));break;default:o=e.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,o)}},this.onRequestTimeout=function(){this.registrationFailure(null,e.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,e.C.causes.CONNECTION_ERROR)},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()},registrationFailure:function(e,t){this.emit("failed",e||null,t||null)},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.registered&&this.unregistered(null,e.C.causes.CONNECTION_ERROR)},onTransportConnected:function(){this.register(this.options)},close:function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registered_before=this.registered,this.unregister(e)},unregister:function(t){var n;if(t=t||{},!this.registered&&!t.all)return void this.logger.warn("already unregistered");n=(t.extraHeaders||[]).slice(),this.registered=!1,null!==this.registrationTimer&&(e.Timers.clearTimeout(this.registrationTimer),this.registrationTimer=null),t.all?(n.push("Contact: *"),n.push("Expires: 0")):n.push("Contact: "+this.contact+";expires=0"),this.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",t);break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",t),null!==this.registrationExpiredTimer&&(e.Timers.clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=null),this.unregistered(t);break;default:n=e.Utils.sipErrorCause(t.status_code),this.unregistered(t,n)}},this.onRequestTimeout=function(){},this.onTransportError=function(){},this.cseq++,this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=n,this.send()},unregistered:function(e,t){this.registered=!1,this.emit("unregistered",e||null,t||null)}},e.RegisterContext=t}},{}],90:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t,n){this.logger=n.getLogger("sip.requestsender"),this.ua=n,this.applicant=t,this.method=t.request.method,this.request=t.request,this.credentials=null,this.challenged=!1,this.staled=!1,n.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()},t.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}return this.clientTransaction.send(),this.clientTransaction},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(t){var n,r,i,o=t.status_code;if(401===o||407===o){if(401===t.status_code?(r=t.parseHeader("www-authenticate"),i="authorization"):(r=t.parseHeader("proxy-authenticate"),i="proxy-authorization"),!r)return this.logger.warn(t.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(t);if(!this.challenged||!this.staled&&r.stale===!0){if(this.credentials||(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(t);this.challenged=!0,r.stale&&(this.staled=!0),t.method===e.C.REGISTER?n=this.applicant.cseq+=1:this.request.dialog?n=this.request.dialog.local_seqnum+=1:(n=this.request.cseq+1,this.request.cseq=n),this.request.setHeader("cseq",n+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(t)}else this.applicant.receiveResponse(t)}},e.RequestSender=t}},{}],91:[function(e,t,n){"use strict";t.exports=function(t){var n=e("../package.json"),r=Object.defineProperties({},{version:{get:function(){return n.version}},name:{get:function(){return n.title}}});return e("./Utils")(r,t),r.LoggerFactory=e("./LoggerFactory")(t.console),r.EventEmitter=e("./EventEmitter")(t.console),r.C=e("./Constants")(r.name,r.version),r.Exceptions=e("./Exceptions"),r.Timers=e("./Timers")(t.timers),r.Transport=t.Transport(r,t.WebSocket),e("./Parser")(r),e("./SIPMessage")(r),e("./URI")(r),e("./NameAddrHeader")(r),e("./Transactions")(r),e("./Dialogs")(r),e("./RequestSender")(r),e("./RegisterContext")(r),r.MediaHandler=e("./MediaHandler")(r.EventEmitter),e("./ClientContext")(r),e("./ServerContext")(r),e("./Session")(r,t),e("./Subscription")(r),r.WebRTC=e("./WebRTC")(r,t),e("./UA")(r,t),r.Hacks=e("./Hacks")(r),e("./SanityCheck")(r),r.DigestAuthentication=e("./DigestAuthentication")(r.Utils),r.Grammar=e("./Grammar")(r),r}},{"../package.json":73,"./ClientContext":74,"./Constants":75,"./Dialogs":77,"./DigestAuthentication":78,"./EventEmitter":79,"./Exceptions":80,"./Grammar":81,"./Hacks":83,"./LoggerFactory":84,"./MediaHandler":85,"./NameAddrHeader":86,"./Parser":87,"./RegisterContext":89,"./RequestSender":90,"./SIPMessage":92,"./SanityCheck":93,"./ServerContext":94,"./Session":95,"./Subscription":97,"./Timers":98,"./Transactions":99,"./UA":101,"./URI":102,"./Utils":103,"./WebRTC":104}],92:[function(e,t,n){"use strict";t.exports=function(e){function t(t){var n=t.ua.configuration.hackAllowUnregisteredOptionTags,r=[],i={};return t.method===e.C.REGISTER?r.push("path","gruu"):t.method===e.C.INVITE&&(t.ua.contact.pub_gruu||t.ua.contact.temp_gruu)&&r.push("gruu"),t.ua.configuration.rel100===e.C.supported.SUPPORTED&&r.push("100rel"),t.ua.configuration.replaces===e.C.supported.SUPPORTED&&r.push("replaces"),r.push("outbound"),r=r.concat(t.ua.configuration.extraSupported),r=r.filter(function(t){var r=e.C.OPTION_TAGS[t],o=!i[t];return i[t]=!0,(r||n)&&o}),"Supported: "+r.join(", ")+"\r\n"}var n,r,i,o;n=function(t,n,r,i,o,s){var a,u,c,l,d,f;if(i=i||{},!t||!n||!r)return null;this.logger=r.getLogger("sip.sipmessage"),this.ua=r,this.headers={},this.method=t,this.ruri=n,this.body=s,this.extraHeaders=(o||[]).slice(),this.statusCode=i.status_code,this.reasonPhrase=i.reason_phrase,i.route_set?this.setHeader("route",i.route_set):r.configuration.usePreloadedRoute&&this.setHeader("route",r.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),d=i.to_uri||n,a=i.to_displayName||0===i.to_displayName?'"'+i.to_displayName+'" ':"",a+="<"+(d&&d.toRaw?d.toRaw():d)+">",a+=i.to_tag?";tag="+i.to_tag:"",this.to=new e.NameAddrHeader.parse(a),this.setHeader("to",a),f=i.from_uri||r.configuration.uri,u=i.from_displayName||0===i.from_displayName?'"'+i.from_displayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",u+="<"+(f&&f.toRaw?f.toRaw():f)+">;tag=",u+=i.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(u),this.setHeader("from",u),c=i.call_id||r.configuration.sipjsId+e.Utils.createRandomToken(15),this.call_id=c,this.setHeader("call-id",c),l=i.cseq||Math.floor(1e4*Math.random()),this.cseq=l,this.setHeader("cseq",l+" "+t)},n.prototype={setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){var n,r,i=this.extraHeaders.length,o=this.headers[e.Utils.headerize(t)];if(o){if(o[0])return o[0]}else for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(o=this.extraHeaders[r],n.test(o))return o.substring(o.indexOf(":")+1).trim()},getHeaders:function(t){var n,r,i,o=this.headers[e.Utils.headerize(t)],s=[];if(o){for(r=o.length,n=0;n<r;n++)s.push(o[n]);return s}for(r=this.extraHeaders.length,i=new RegExp("^\\s*"+t+"\\s*:","i"),n=0;n<r;n++)o=this.extraHeaders[n],i.test(o)&&s.push(o.substring(o.indexOf(":")+1).trim());return s},hasHeader:function(t){var n,r,i=this.extraHeaders.length;if(this.headers[e.Utils.headerize(t)])return!0;for(n=new RegExp("^\\s*"+t+"\\s*:","i"),r=0;r<i;r++)if(n.test(this.extraHeaders[r]))return!0;return!1},toString:function(){var n,r,i,o="";o+=this.method+" "+(this.ruri.toRaw?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n";for(n in this.headers)for(r=this.headers[n].length,i=0;i<r;i++)o+=n+": "+this.headers[n][i]+"\r\n";for(r=this.extraHeaders.length,i=0;i<r;i++)o+=this.extraHeaders[i].trim()+"\r\n";return o+=t(this),o+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(r=e.Utils.str_utf8_length(this.body),o+="Content-Length: "+r+"\r\n\r\n",o+=this.body):this.body.body&&this.body.contentType?(r=e.Utils.str_utf8_length(this.body.body),o+="Content-Type: "+this.body.contentType+"\r\n",o+="Content-Length: "+r+"\r\n\r\n",o+=this.body.body):o+="Content-Length: 0\r\n\r\n":o+="Content-Length: 0\r\n\r\n",o}},r=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},r.prototype={addHeader:function(t,n){var r={raw:n};t=e.Utils.headerize(t),this.headers[t]?this.headers[t].push(r):this.headers[t]=[r]},getHeader:function(t){var n=this.headers[e.Utils.headerize(t)];if(n)return n[0]?n[0].raw:void 0},getHeaders:function(t){var n,r,i=this.headers[e.Utils.headerize(t)],o=[];if(!i)return[];for(r=i.length,n=0;n<r;n++)o.push(i[n].raw);return o},hasHeader:function(t){return!!this.headers[e.Utils.headerize(t)]},parseHeader:function(t,n){var r,i,o;return t=e.Utils.headerize(t),n=n||0,this.headers[t]?n>=this.headers[t].length?void this.logger.log('not so many "'+t+'" headers present'):(r=this.headers[t][n],i=r.raw,r.parsed?r.parsed:(o=e.Grammar.parse(i,t.replace(/-/g,"_")),o===-1?(this.headers[t].splice(n,1),void this.logger.warn('error parsing "'+t+'" header field with value "'+i+'"')):(r.parsed=o,o))):void this.logger.log('header "'+t+'" not present')},s:function(e,t){return this.parseHeader(e,t)},setHeader:function(t,n){var r={raw:n};this.headers[e.Utils.headerize(t)]=[r]},toString:function(){return this.data}},i=function(e){this.logger=e.getLogger("sip.sipmessage"),this.ua=e,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},i.prototype=new r,i.prototype.reply=function(n,r,i,o,s,a){var u,c,l,d,f,p=this.getHeader("To"),h=0,m=0;if(f=e.Utils.buildStatusLine(n,r),i=(i||[]).slice(),this.method===e.C.INVITE&&n>100&&n<=200)for(u=this.getHeaders("record-route"),l=u.length,h;h<l;h++)f+="Record-Route: "+u[h]+"\r\n";for(c=this.getHeaders("via"),l=c.length,m;m<l;m++)f+="Via: "+c[m]+"\r\n";for(!this.to_tag&&n>100?p+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.to_tag),f+="To: "+p+"\r\n",f+="From: "+this.getHeader("From")+"\r\n",f+="Call-ID: "+this.call_id+"\r\n",f+="CSeq: "+this.cseq+" "+this.method+"\r\n",l=i.length,d=0;d<l;d++)f+=i[d].trim()+"\r\n";return f+=t(this),f+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",o?"string"==typeof o?(l=e.Utils.str_utf8_length(o),f+="Content-Type: application/sdp\r\n",f+="Content-Length: "+l+"\r\n\r\n",f+=o):o.body&&o.contentType?(l=e.Utils.str_utf8_length(o.body),f+="Content-Type: "+o.contentType+"\r\n",f+="Content-Length: "+l+"\r\n\r\n",f+=o.body):f+="Content-Length: 0\r\n\r\n":f+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(n,f).then(s,a),f},i.prototype.reply_sl=function(t,n){var r,i,o=0,s=this.getHeaders("via"),a=s.length;for(i=e.Utils.buildStatusLine(t,n),o;o<a;o++)i+="Via: "+s[o]+"\r\n";r=this.getHeader("To"),!this.to_tag&&t>100?r+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag),i+="To: "+r+"\r\n",i+="From: "+this.getHeader("From")+"\r\n",i+="Call-ID: "+this.call_id+"\r\n",i+="CSeq: "+this.cseq+" "+this.method+"\r\n",i+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",i+="Content-Length: 0\r\n\r\n",this.transport.send(i)},o=function(e){this.logger=e.getLogger("sip.sipmessage"),this.headers={},this.status_code=null,this.reason_phrase=null},o.prototype=new r,e.OutgoingRequest=n,e.IncomingRequest=i,e.IncomingResponse=o}},{}],93:[function(e,t,n){"use strict";t.exports=function(e){function t(t){var n,r=e.Utils.buildStatusLine(t),i=d.getHeaders("via"),o=i.length,s=0;for(s;s<o;s++)r+="Via: "+i[s]+"\r\n";n=d.getHeader("To"),d.to_tag||(n+=";tag="+e.Utils.newTag()),r+="To: "+n+"\r\n",r+="From: "+d.getHeader("From")+"\r\n",r+="Call-ID: "+d.call_id+"\r\n",r+="CSeq: "+d.cseq+" "+d.method+"\r\n",r+="\r\n",p.send(r)}function n(){if(!d.ruri||"sip"!==d.ruri.scheme)return t(416),!1}function r(){if(!d.to_tag&&d.call_id.substr(0,5)===f.configuration.sipjsId)return t(482),!1}function i(){if(e.Utils.str_utf8_length(d.body)<d.getHeader("content-length"))return t(400),!1}function o(){var n,r,i=d.from_tag,o=d.call_id,s=d.cseq;if(!d.to_tag)if(d.method===e.C.INVITE){if(n=f.transactions.ist[d.via_branch])return;for(r in f.transactions.ist)if(n=f.transactions.ist[r],n.request.from_tag===i&&n.request.call_id===o&&n.request.cseq===s)return t(482),!1}else{if(n=f.transactions.nist[d.via_branch])return;for(r in f.transactions.nist)if(n=f.transactions.nist[r],n.request.from_tag===i&&n.request.call_id===o&&n.request.cseq===s)return t(482),!1}}function s(){if(d.getHeaders("via").length>1)return l.warn("More than one Via header field present in the response. Dropping the response"),!1}function a(){if(e.Utils.str_utf8_length(d.body)<d.getHeader("content-length"))return l.warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1}function u(){for(var e=["from","to","call_id","cseq","via"],t=e.length;t--;)if(!d.hasHeader(e[t]))return l.warn("Missing mandatory header field : "+e[t]+". Dropping the response"),!1}var c,l,d,f,p,h=[],m=[],v=[];h.push(n),h.push(r),h.push(i),h.push(o),m.push(s),m.push(a),v.push(u),c=function(t,n,r){var i,o;for(d=t,f=n,p=r,l=f.getLogger("sip.sanitycheck"),i=v.length;i--;)if(o=v[i](d),o===!1)return!1;if(d instanceof e.IncomingRequest){for(i=h.length;i--;)if(o=h[i](d),o===!1)return!1}else if(d instanceof e.IncomingResponse)for(i=m.length;i--;)if(o=m[i](d),o===!1)return!1;return!0},e.sanityCheck=c}},{}],94:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t,n){this.ua=t,this.logger=t.getLogger("sip.servercontext"),this.request=n,n.method===e.C.INVITE?this.transaction=new e.Transactions.InviteServerTransaction(n,t):this.transaction=new e.Transactions.NonInviteServerTransaction(n,t),n.body&&(this.body=n.body),n.hasHeader("Content-Type")&&(this.contentType=n.getHeader("Content-Type")),this.method=n.method,this.data={},this.localIdentity=n.to,this.remoteIdentity=n.from},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.progress=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=180),e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=200),e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return e=Object.create(e||Object.prototype),e.statusCode||(e.statusCode=480),e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(t){t=t||{};var n,r=t.statusCode||100,i=t.minCode||100,o=t.maxCode||699,s=e.Utils.getReasonPhrase(r,t.reasonPhrase),a=t.extraHeaders||[],u=t.body,c=t.events||[];if(r<i||r>o)throw new TypeError("Invalid statusCode: "+r);return n=this.request.reply(r,s,a,u),c.forEach(function(e){this.emit(e,n,s)},this),this},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR)},e.ServerContext=t}},{}],95:[function(e,t,n){"use strict";t.exports=function(t,n){var r,i,o,s=e("./Session/DTMF")(t),a=e("./RFC4028")(t.Timers),u={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_PRACK:6,STATUS_WAITING_FOR_ACK:7,STATUS_CANCELED:8,STATUS_TERMINATED:9,STATUS_ANSWERED_WAITING_FOR_PRACK:10,STATUS_EARLY_MEDIA:11,STATUS_CONFIRMED:12};r=function(e){this.status=u.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.mediaHandlerFactory=e||t.WebRTC.MediaHandler.defaultFactory,this.hasOffer=!1,this.hasAnswer=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,rel1xxTimer:null,prackTimer:null},this.startTime=null,this.endTime=null,this.tones=null,this.local_hold=!1,this.remote_hold=!1,this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(e){var t=0,n=this.actions.length;for(t;t<n;t++)if(this.actions[t].name===e)return!0;return!1},shift:function(){return this.actions.shift()},push:function(e){this.actions.push({name:e})},pop:function(e){var t=0,n=this.actions.length;for(t;t<n;t++)this.actions[t].name===e&&(this.actions.splice(t,1),n--,t--)}},this.early_sdp=null,this.rel100=t.C.supported.UNSUPPORTED},r.prototype={dtmf:function(e,n){var r,i=[],o=this;if(n=n||{},void 0===e)throw new TypeError("Not enough arguments");if(this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_WAITING_FOR_ACK)throw new t.Exceptions.InvalidStateError(this.status);if("string"!=typeof e&&"number"!=typeof e||!e.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);for(e=e.toString().split("");e.length>0;)i.push(new s(this,e.shift(),n));if(this.tones)return this.tones=this.tones.concat(i),this;var a=function e(){var i,s;if(o.status===u.STATUS_TERMINATED||!o.tones||0===o.tones.length)return o.tones=null,this;i=o.tones.shift(),","===r?s=2e3:(i.on("failed",function(){o.tones=null}),i.send(n),s=i.duration+i.interToneGap),t.Timers.setTimeout(e,s)};return this.tones=i,a(),this},bye:function(e){e=Object.create(e||Object.prototype);var n=e.statusCode;if(this.status===u.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;if(this.logger.log("terminating Session"),n&&(n<200||n>=700))throw new TypeError("Invalid statusCode: "+n);return e.receiveResponse=function(){},this.sendRequest(t.C.BYE,e).terminated()},refer:function(e,n){n=n||{};var r=(n.extraHeaders||[]).slice(),i=e instanceof t.InviteServerContext||e instanceof t.InviteClientContext,o=e;if(void 0===e)throw new TypeError("Not enough arguments");if(this.status!==u.STATUS_CONFIRMED)throw new t.Exceptions.InvalidStateError(this.status);if(i)e='"'+e.remoteIdentity.friendlyName+'" <'+e.dialog.remote_target.toString()+"?Replaces="+e.dialog.id.call_id+"%3Bto-tag%3D"+e.dialog.id.remote_tag+"%3Bfrom-tag%3D"+e.dialog.id.local_tag+">";else{try{e=t.Grammar.parse(e,"Refer_To").uri||e}catch(t){this.logger.debug(".refer() cannot parse Refer_To from",e),this.logger.debug("...falling through to normalizeTarget()")}if(e=this.ua.normalizeTarget(e),!e)throw new TypeError("Invalid target: "+o)}return r.push("Contact: "+this.contact),r.push("Allow: "+t.UA.C.ALLOWED_METHODS.toString()),r.push("Refer-To: "+e),this.sendRequest(t.C.REFER,{extraHeaders:r,body:n.body,receiveResponse:function(t){/^2[0-9]{2}$/.test(t.status_code)&&(i||e.scheme&&e.scheme.match("^sips?$"))&&this.terminate()}.bind(this)}),this},followRefer:function(e){return function(e,r){var i=r.parseHeader("refer-to"),o=i.uri;if(!o.scheme.match("^sips?$")){var s=o.toString();return void("function"==typeof n.open?n.open(s):this.logger.warn("referred to non-SIP URI but `open` isn't in the environment: "+s))}var a=[],u=o.getHeader("Replaces");void 0!==u&&a.push("Replaces: "+decodeURIComponent(u)),o.clearHeaders();var c=this.mediaHandler.getReferMedia,l=c?c.call(this.mediaHandler):this.mediaHint;t.Hacks.Chrome.getsConfusedAboutGUM(this);var d=this.ua.invite(o,{media:l,params:{to_displayName:i.friendlyName},extraHeaders:a});e.call(this,r,d),this.terminate()}.bind(this,e)},sendRequest:function(e,n){n=n||{};var r=this,i=new t.OutgoingRequest(e,this.dialog.remote_target,this.ua,{cseq:n.cseq||(this.dialog.local_seqnum+=1),call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set,statusCode:n.statusCode,reasonPhrase:n.reasonPhrase},n.extraHeaders||[],n.body);return new t.RequestSender({request:i,onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},receiveResponse:n.receiveResponse||function(e){r.receiveNonInviteResponse(e)}},this.ua).send(),this.emit(e.toLowerCase(),i),this},close:function(){var e;if(this.status===u.STATUS_TERMINATED)return this;this.logger.log("closing INVITE session "+this.id),this.mediaHandler&&this.mediaHandler.close();for(e in this.timers)t.Timers.clearTimeout(this.timers[e]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(e in this.earlyDialogs)this.earlyDialogs[e].terminate(),delete this.earlyDialogs[e];return this.status=u.STATUS_TERMINATED,delete this.ua.sessions[this.id],this},createDialog:function(e,n,r){var i,o,s=e["UAS"===n?"to_tag":"from_tag"],a=e["UAS"===n?"from_tag":"to_tag"],u=e.call_id+s+a;if(o=this.earlyDialogs[u],r)return!!o||(o=new t.Dialog(this,e,n,t.Dialog.C.STATUS_EARLY),o.error?(this.logger.error(o.error),this.failed(e,t.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[u]=o,!0));if(o){o.update(e,n),this.dialog=o,delete this.earlyDialogs[u];for(var c in this.earlyDialogs)this.earlyDialogs[c].terminate(),delete this.earlyDialogs[c];return!0}return i=new t.Dialog(this,e,n),i.error?(this.logger.error(i.error),this.failed(e,t.C.causes.INTERNAL_ERROR),!1):(this.to_tag=e.to_tag,this.dialog=i,!0)},isReadyToReinvite:function(){return this.mediaHandler.isReady()&&!this.dialog.uac_pending_reply&&!this.dialog.uas_pending_reply},mute:function(e){var t=this.mediaHandler.mute(e);t&&this.onmute(t)},unmute:function(e){var t=this.mediaHandler.unmute(e);t&&this.onunmute(t)},hold:function(){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new t.Exceptions.InvalidStateError(this.status);if(this.mediaHandler.hold(),!this.isReadyToReinvite())return void(this.pending_actions.isPending("unhold")?this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")||this.pending_actions.push("hold"));this.local_hold!==!0&&(this.onhold("local"),this.sendReinvite())},unhold:function(e){if(this.status!==u.STATUS_WAITING_FOR_ACK&&this.status!==u.STATUS_CONFIRMED)throw new t.Exceptions.InvalidStateError(this.status);if(this.mediaHandler.unhold(),!this.isReadyToReinvite())return void(this.pending_actions.isPending("hold")?this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")||this.pending_actions.push("unhold"));this.local_hold!==!1&&(this.onunhold("local"),this.sendReinvite(e))},isOnHold:function(){return{local:this.local_hold,remote:this.remote_hold}},receiveReinvite:function(e){var n=this;if(!this.mediaHandler.hasDescription(e))return this.logger.warn("invalid Content-Type"),void e.reply(415);this.mediaHandler.setDescription(e).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(t){var r=["Contact: "+n.contact];e.reply(200,null,r,t,function(){n.status=u.STATUS_WAITING_FOR_ACK,n.setInvite2xxTimer(e,t),n.setACKTimer(),n.remote_hold&&!n.mediaHandler.remote_hold?n.onunhold("remote"):!n.remote_hold&&n.mediaHandler.remote_hold&&n.onhold("remote")})}).catch(function(r){var i;r instanceof t.Exceptions.GetDescriptionError?i=500:(n.logger.error(r),i=488),e.reply(i)})},sendReinvite:function(e){e=e||{};var n,r=this,i=(e.extraHeaders||[]).slice(),o=e.eventHandlers||{};o.succeeded&&(n=o.succeeded),this.reinviteSucceeded=function(){t.Timers.clearTimeout(r.timers.ackTimer),t.Timers.clearTimeout(r.timers.invite2xxTimer),r.status=u.STATUS_CONFIRMED,n&&n.apply(this,arguments)},o.failed?this.reinviteFailed=o.failed:this.reinviteFailed=function(){},i.push("Contact: "+this.contact),i.push("Allow: "+t.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=this.receiveReinviteResponse,this.mediaHandler.getDescription(r.mediaHint).then(function(e){r.dialog.sendRequest(r,t.C.INVITE,{extraHeaders:i,body:e})},function(){r.isReadyToReinvite()&&r.onReadyToReinvite(),r.reinviteFailed()})},receiveRequest:function(e){switch(e.method){case t.C.BYE:e.reply(200),this.status===u.STATUS_CONFIRMED&&(this.emit("bye",e),this.terminated(e,t.C.causes.BYE));break;case t.C.INVITE:this.status===u.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case t.C.INFO:if(this.status===u.STATUS_1XX_RECEIVED||this.status===u.STATUS_WAITING_FOR_PRACK||this.status===u.STATUS_WAITING_FOR_ACK||this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK||this.status===u.STATUS_EARLY_MEDIA||this.status===u.STATUS_CONFIRMED||this.dialog){if(this.onInfo)return this.onInfo(e);var n,r,i,o=e.getHeader("content-type"),a=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,c=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;o&&(o.match(/^application\/dtmf-relay/i)?(e.body&&(n=e.body.split("\r\n",2),2===n.length&&(a.test(n[0])&&(r=n[0].replace(a,"$2")),c.test(n[1])&&(i=parseInt(n[1].replace(c,"$2"),10)))),new s(this,r,{duration:i}).init_incoming(e)):e.reply(415,null,["Accept: application/dtmf-relay"]))}break;case t.C.REFER:if(this.status===u.STATUS_CONFIRMED){this.logger.log("REFER received");var l,d=this.listeners("refer").length;d?(e.reply(202,"Accepted"),l="SIP/2.0 100 Trying",this.sendRequest(t.C.NOTIFY,{extraHeaders:["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],body:l,receiveResponse:function(){}}),this.emit("refer",e)):e.reply(603,"Declined")}break;case t.C.NOTIFY:e.reply(200,"OK"),this.emit("notify",e)}},receiveReinviteResponse:function(e){var n=this;if(this.status!==u.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(this.status=u.STATUS_CONFIRMED,this.sendRequest(t.C.ACK,{cseq:e.cseq}),!this.mediaHandler.hasDescription(e)){this.reinviteFailed();break}this.mediaHandler.setDescription(e).then(function(){n.reinviteSucceeded()},function(){n.reinviteFailed()});break;default:this.reinviteFailed()}},acceptAndTerminate:function(e,n,r){var i=[];return n&&i.push("Reason: "+t.Utils.getReasonHeaderValue(n,r)),(this.dialog||this.createDialog(e,"UAC"))&&(this.sendRequest(t.C.ACK,{cseq:e.cseq}),this.sendRequest(t.C.BYE,{extraHeaders:i})),this},setInvite2xxTimer:function(e,n){var r=this,i=t.Timers.T1;this.timers.invite2xxTimer=t.Timers.setTimeout(function o(){if(r.status===u.STATUS_WAITING_FOR_ACK){r.logger.log("no ACK received, attempting to retransmit OK");var s=["Contact: "+r.contact];e.reply(200,null,s,n),i=Math.min(2*i,t.Timers.T2),r.timers.invite2xxTimer=t.Timers.setTimeout(o,i)}},i)},setACKTimer:function(){var e=this;this.timers.ackTimer=t.Timers.setTimeout(function(){e.status===u.STATUS_WAITING_FOR_ACK&&(e.logger.log("no ACK received for an extended period of time, terminating the call"),t.Timers.clearTimeout(e.timers.invite2xxTimer),e.sendRequest(t.C.BYE),e.terminated(null,t.C.causes.NO_ACK))},t.Timers.TIMER_H)},onReadyToReinvite:function(){var e=this.pending_actions.shift();e&&this[e.name]&&this[e.name]()},onTransportError:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,t.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,t.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,t.C.causes.REQUEST_TIMEOUT),this.terminated(null,t.C.causes.REQUEST_TIMEOUT))},onDialogError:function(e){this.status===u.STATUS_CONFIRMED?this.terminated(e,t.C.causes.DIALOG_ERROR):this.status!==u.STATUS_TERMINATED&&(this.failed(e,t.C.causes.DIALOG_ERROR),this.terminated(e,t.C.causes.DIALOG_ERROR))},onhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!0,this.emit("hold",{originator:e})},onunhold:function(e){this["local"===e?"local_hold":"remote_hold"]=!1,this.emit("unhold",{originator:e})},onmute:function(e){this.emit("muted",{audio:e.audio,video:e.video})},onunmute:function(e){this.emit("unmuted",{audio:e.audio,video:e.video})},failed:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.emit("failed",e||null,t||null),this)},rejected:function(e,t){return this.emit("rejected",e||null,t||null),this},canceled:function(){return this.emit("cancel"),this},accepted:function(e,n){return n=t.Utils.getReasonPhrase(e&&e.status_code,n),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),e&&a.updateState(this.dialog,e,t.Parser.parseMessage,this.ua),this.emit("accepted",e,n),this},terminated:function(e,t){return this.status===u.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e||null,t||null),this)},connecting:function(e){return this.emit("connecting",{request:e}),this}},r.desugar=function(e){return n.HTMLMediaElement&&e instanceof n.HTMLMediaElement&&(e={media:{constraints:{audio:!0,video:"VIDEO"===e.tagName},render:{remote:e}}}),e||{}},r.C=u,t.Session=r,i=function(e,n){function r(e,t){n.hasHeader(e)&&n.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(s.rel100=t)}function i(){var e={extraHeaders:["Contact: "+s.contact]};s.rel100!==t.C.supported.REQUIRED&&s.progress(e),s.status=u.STATUS_WAITING_FOR_ANSWER,s.timers.userNoAnswerTimer=t.Timers.setTimeout(function(){n.reply(408),s.failed(n,t.C.causes.NO_ANSWER),s.terminated(n,t.C.causes.NO_ANSWER)},s.ua.configuration.noAnswerTimeout),o&&(s.timers.expiresTimer=t.Timers.setTimeout(function(){s.status===u.STATUS_WAITING_FOR_ANSWER&&(n.reply(487),s.failed(n,t.C.causes.EXPIRES),s.terminated(n,t.C.causes.EXPIRES))},o)),s.emit("invite",n)}var o,s=this,c=n.getHeader("Content-Type"),l=n.parseHeader("Content-Disposition");if(t.Utils.augment(this,t.ServerContext,[e,n]),t.Utils.augment(this,t.Session,[e.configuration.mediaHandlerFactory]),this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}),!l&&!this.mediaHandler.hasDescription(n)||l&&"render"===l.type)this.renderbody=n.body,this.rendertype=c;else if(!this.mediaHandler.hasDescription(n)&&l&&"session"===l.type)return void n.reply(415);return a.hasSmallMinSE(n)?void n.reply(422,null,["Min-SE: "+a.localMinSE]):(this.status=u.STATUS_INVITE_RECEIVED,this.from_tag=n.from_tag,this.id=n.call_id+this.from_tag,this.request=n,this.contact=this.ua.contact.toString(),this.receiveNonInviteResponse=function(){},this.logger=e.getLogger("sip.inviteservercontext",this.id),this.ua.sessions[this.id]=this,n.hasHeader("expires")&&(o=1e3*n.getHeader("expires")),r("require",t.C.supported.REQUIRED),r("supported",t.C.supported.SUPPORTED),n.to_tag=t.Utils.newTag(),this.createDialog(n,"UAS",!0)?(this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),void(!this.mediaHandler.hasDescription(n)||this.renderbody?t.Timers.setTimeout(i,0):(this.hasOffer=!0,this.mediaHandler.setDescription(n).then(i,function(e){s.logger.warn("invalid description"),s.logger.warn(e),n.reply(488)})))):void n.reply(500,"Missing Contact header field"))},i.prototype={reject:function(e){if(this.status===u.STATUS_TERMINATED)throw new t.Exceptions.InvalidStateError(this.status);return this.logger.log("rejecting RTCSession"),t.ServerContext.prototype.reject.call(this,e),this.terminated()},terminate:function(e){e=e||{};var n,r=(e.extraHeaders||[]).slice(),i=e.body,o=this;return this.status===u.STATUS_WAITING_FOR_ACK&&this.request.server_transaction.state!==t.Transactions.C.STATUS_TERMINATED?(n=this.dialog,this.receiveRequest=function(e){e.method===t.C.ACK&&(this.sendRequest(t.C.BYE,{extraHeaders:r,body:i}),n.terminate())},this.request.server_transaction.on("stateChanged",function(){this.state===t.Transactions.C.STATUS_TERMINATED&&this.dialog&&(this.request=new t.OutgoingRequest(t.C.BYE,this.dialog.remote_target,this.ua,{cseq:this.dialog.local_seqnum+=1,call_id:this.dialog.id.call_id,from_uri:this.dialog.local_uri,from_tag:this.dialog.id.local_tag,to_uri:this.dialog.remote_uri,to_tag:this.dialog.id.remote_tag,route_set:this.dialog.route_set},r,i),new t.RequestSender({request:this.request,onRequestTimeout:function(){o.onRequestTimeout()},onTransportError:function(){o.onTransportError()},receiveResponse:function(){}},this.ua).send(),n.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=n,this.ua.dialogs[n.id.toString()]=n):this.status===u.STATUS_CONFIRMED?this.bye(e):this.reject(e),this},progress:function(e){function n(){s=e.statusCode||183,this.status=u.STATUS_WAITING_FOR_PRACK,c.push("Contact: "+this.contact),c.push("Require: 100rel"),c.push("RSeq: "+Math.floor(1e4*Math.random())),this.mediaHint=e.media,this.mediaHandler.getDescription(e.media).then(function(e){if(!this.isCanceled&&this.status!==u.STATUS_TERMINATED){this.early_sdp=e.body,this[this.hasOffer?"hasAnswer":"hasOffer"]=!0;var n=t.Timers.T1;this.timers.rel1xxTimer=t.Timers.setTimeout(function r(){this.request.reply(s,null,c,e),n*=2,this.timers.rel1xxTimer=t.Timers.setTimeout(r.bind(this),n)}.bind(this),n),this.timers.prackTimer=t.Timers.setTimeout(function(){this.status===u.STATUS_WAITING_FOR_PRACK&&(this.logger.log("no PRACK received, rejecting the call"),t.Timers.clearTimeout(this.timers.rel1xxTimer),this.request.reply(504),this.terminated(null,t.C.causes.NO_PRACK))}.bind(this),64*t.Timers.T1),o=this.request.reply(s,a,c,e),this.emit("progress",o,a)}}.bind(this),function(){this.request.reply(480),this.failed(null,t.C.causes.WEBRTC_ERROR),this.terminated(null,t.C.causes.WEBRTC_ERROR)}.bind(this))}function r(){o=this.request.reply(s,a,c,f),this.emit("progress",o,a)}e=e||{};var i,o,s=e.statusCode||180,a=e.reasonPhrase,c=(e.extraHeaders||[]).slice(),l=e.stunServers||null,d=e.turnServers||null,f=e.body;if(s<100||s>199)throw new TypeError("Invalid statusCode: "+s);if(this.isCanceled||this.status===u.STATUS_TERMINATED)return this;if(l||d){if(l){if(i=t.UA.configuration_check.optional.stunServers(l),!i)throw new TypeError("Invalid stunServers: "+l);this.stunServers=i}if(d){if(i=t.UA.configuration_check.optional.turnServers(d),!i)throw new TypeError("Invalid turnServers: "+d);this.turnServers=i}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return 100!==e.statusCode&&(this.rel100===t.C.supported.REQUIRED||this.rel100===t.C.supported.SUPPORTED&&e.rel100||this.rel100===t.C.supported.SUPPORTED&&this.ua.configuration.rel100===t.C.supported.REQUIRED)?n.apply(this):r.apply(this),this},accept:function(e){e=Object.create(r.desugar(e)),t.Utils.optionsOverride(e,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=e.media,this.onInfo=e.onInfo;var n,i=this,o=this.request,s=(e.extraHeaders||[]).slice(),a=e.stunServers||null,c=e.turnServers||null,l=function(e){var n,r=function(){i.status=u.STATUS_WAITING_FOR_ACK,i.setInvite2xxTimer(o,e),i.setACKTimer()},a=function(){i.failed(null,t.C.causes.CONNECTION_ERROR),i.terminated(null,t.C.causes.CONNECTION_ERROR)};i.mediaHandler.render(),s.push("Contact: "+i.contact),s.push("Allow: "+t.UA.C.ALLOWED_METHODS.toString());var c=o.parseHeader("Supported")||[],l=o.parseHeader("Session-Expires")||{},d=l.deltaSeconds;if(d){var f=l.refresher||"uas";s.push("Session-Expires: "+d+";"+f),("uac"===f||c.indexOf("timer")>=0)&&s.push("Require: timer")}i.hasOffer?i.hasAnswer=!0:i.hasOffer=!0,n=o.reply(200,null,s,e,r,a),i.status!==u.STATUS_TERMINATED&&i.accepted(n,t.Utils.getReasonPhrase(200))},d=function(){i.status!==u.STATUS_TERMINATED&&(i.request.reply(480),i.failed(null,t.C.causes.WEBRTC_ERROR),i.terminated(null,t.C.causes.WEBRTC_ERROR))};if(this.status===u.STATUS_WAITING_FOR_PRACK)return this.status=u.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===u.STATUS_WAITING_FOR_ANSWER)this.status=u.STATUS_ANSWERED;else if(this.status!==u.STATUS_EARLY_MEDIA)throw new t.Exceptions.InvalidStateError(this.status);if((a||c)&&this.status!==u.STATUS_EARLY_MEDIA&&this.status!==u.STATUS_ANSWERED_WAITING_FOR_PRACK){if(a){if(n=t.UA.configuration_check.optional.stunServers(a),!n)throw new TypeError("Invalid stunServers: "+a);this.stunServers=n}if(c){if(n=t.UA.configuration_check.optional.turnServers(c),!n)throw new TypeError("Invalid turnServers: "+c);this.turnServers=n}this.mediaHandler.updateIceServers({stunServers:this.stunServers,turnServers:this.turnServers})}return this.createDialog(o,"UAS")?(t.Timers.clearTimeout(this.timers.userNoAnswerTimer),this.status===u.STATUS_EARLY_MEDIA?l({}):this.mediaHandler.getDescription(i.mediaHint).then(l,d),this):(o.reply(500,"Missing Contact header field"),this)},receiveRequest:function(e){function n(){var n;t.Timers.clearTimeout(this.timers.ackTimer),t.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.unmute(),n=e.getHeader("Content-Type"),this.mediaHandler.hasDescription(e)||(this.renderbody=e.body,this.rendertype=n),this.emit("confirmed",e)}switch(e.method){case t.C.CANCEL:this.status!==u.STATUS_WAITING_FOR_ANSWER&&this.status!==u.STATUS_WAITING_FOR_PRACK&&this.status!==u.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==u.STATUS_EARLY_MEDIA&&this.status!==u.STATUS_ANSWERED||(this.status=u.STATUS_CANCELED,this.request.reply(487),this.canceled(e),this.rejected(e,t.C.causes.CANCELED),this.failed(e,t.C.causes.CANCELED),this.terminated(e,t.C.causes.CANCELED));break;case t.C.ACK:this.status===u.STATUS_WAITING_FOR_ACK&&(this.hasAnswer?n.apply(this):this.mediaHandler.hasDescription(e)?(this.hasAnswer=!0,this.mediaHandler.setDescription(e).then(n.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,t.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):this.early_sdp?n.apply(this):(this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,t.C.causes.BAD_MEDIA_DESCRIPTION)));break;case t.C.PRACK:this.status===u.STATUS_WAITING_FOR_PRACK||this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(t.Timers.clearTimeout(this.timers.rel1xxTimer),t.Timers.clearTimeout(this.timers.prackTimer),e.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA,this.mute()):this.mediaHandler.hasDescription(e)?(this.hasAnswer=!0,this.mediaHandler.setDescription(e).then(function(){t.Timers.clearTimeout(this.timers.rel1xxTimer),t.Timers.clearTimeout(this.timers.prackTimer),e.reply(200),this.status===u.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.STATUS_EARLY_MEDIA,this.accept()),this.status=u.STATUS_EARLY_MEDIA,this.mute()}.bind(this),function(n){this.logger.warn(n),this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,t.C.causes.BAD_MEDIA_DESCRIPTION)}.bind(this))):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,t.C.causes.BAD_MEDIA_DESCRIPTION)):this.status===u.STATUS_EARLY_MEDIA&&e.reply(200);break;default:r.prototype.receiveRequest.apply(this,[e])}},onTransportError:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,t.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,t.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,t.C.causes.REQUEST_TIMEOUT),this.terminated(null,t.C.causes.REQUEST_TIMEOUT))}},t.InviteServerContext=i,o=function(e,n,i){i=Object.create(r.desugar(i)),i.params=Object.create(i.params||Object.prototype);var o,s=(i.extraHeaders||[]).slice(),a=i.stunServers||null,c=i.turnServers||null,l=i.mediaHandlerFactory||e.configuration.mediaHandlerFactory,d=l.isSupported;if(d&&!d())throw new t.Exceptions.NotSupportedError("Media not supported");if(this.RTCConstraints=i.RTCConstraints||{},this.inviteWithoutSdp=i.inviteWithoutSdp||!1,this.anonymous=i.anonymous||!1,this.renderbody=i.renderbody||null,this.rendertype=i.rendertype||"text/plain",i.params.from_tag=this.from_tag,this.contact=e.contact.toString({anonymous:this.anonymous,outbound:this.anonymous?!e.contact.temp_gruu:!e.contact.pub_gruu}),this.anonymous&&(i.params.from_displayName="Anonymous",i.params.from_uri="sip:anonymous@anonymous.invalid",s.push("P-Preferred-Identity: "+e.configuration.uri.toString()),s.push("Privacy: id")),s.push("Contact: "+this.contact),s.push("Allow: "+t.UA.C.ALLOWED_METHODS.toString()),this.inviteWithoutSdp&&this.renderbody&&(s.push("Content-Type: "+this.rendertype),s.push("Content-Disposition: render;handling=optional")),e.configuration.rel100===t.C.supported.REQUIRED&&s.push("Require: 100rel"),e.configuration.replaces===t.C.supported.REQUIRED&&s.push("Require: replaces"),i.extraHeaders=s,t.Utils.augment(this,t.ClientContext,[e,t.C.INVITE,n,i]),t.Utils.augment(this,t.Session,[l]),this.status!==u.STATUS_NULL)throw new t.Exceptions.InvalidStateError(this.status);if(this.from_tag=t.Utils.newTag(),this.isCanceled=!1,this.received_100=!1,this.method=t.C.INVITE,this.receiveNonInviteResponse=this.receiveResponse,this.receiveResponse=this.receiveInviteResponse,this.logger=e.getLogger("sip.inviteclientcontext"),a){if(o=t.UA.configuration_check.optional.stunServers(a),!o)throw new TypeError("Invalid stunServers: "+a);this.stunServers=o}if(c){if(o=t.UA.configuration_check.optional.turnServers(c),!o)throw new TypeError("Invalid turnServers: "+c);this.turnServers=o}e.applicants[this]=this,this.id=this.request.call_id+this.from_tag,this.mediaHandler=this.mediaHandlerFactory(this,{RTCConstraints:this.RTCConstraints,stunServers:this.stunServers,turnServers:this.turnServers}),this.mediaHandler&&this.mediaHandler.getRemoteStreams&&(this.getRemoteStreams=this.mediaHandler.getRemoteStreams.bind(this.mediaHandler),this.getLocalStreams=this.mediaHandler.getLocalStreams.bind(this.mediaHandler)),t.Utils.optionsOverride(i,"media","mediaConstraints",!0,this.logger,this.ua.configuration.media),this.mediaHint=i.media,this.onInfo=i.onInfo},o.prototype={invite:function(){var e=this;return this.ua.sessions[this.id]=this,this.inviteWithoutSdp?(this.request.body=e.renderbody,this.status=u.STATUS_INVITE_SENT,this.send()):this.mediaHandler.getDescription(e.mediaHint).then(function(t){e.isCanceled||e.status===u.STATUS_TERMINATED||(e.hasOffer=!0,e.request.body=t,e.status=u.STATUS_INVITE_SENT,e.send())},function(){e.status!==u.STATUS_TERMINATED&&(e.failed(null,t.C.causes.WEBRTC_ERROR),e.terminated(null,t.C.causes.WEBRTC_ERROR))}),this},receiveInviteResponse:function(e){var n,r=this,i=e.call_id+e.from_tag+e.to_tag,o=[],s={};if(this.status!==u.STATUS_TERMINATED&&e.method===t.C.INVITE){if(this.dialog&&e.status_code>=200&&e.status_code<=299){if(i!==this.dialog.id.toString()){if(!this.createDialog(e,"UAC",!0))return;return this.earlyDialogs[i].sendRequest(this,t.C.ACK,{body:t.Utils.generateFakeSDP(e.body)}),this.earlyDialogs[i].sendRequest(this,t.C.BYE),void(this.status!==u.STATUS_CONFIRMED&&(this.failed(e,t.C.causes.WEBRTC_ERROR),this.terminated(e,t.C.causes.WEBRTC_ERROR)))}if(this.status===u.STATUS_CONFIRMED)return void this.sendRequest(t.C.ACK,{cseq:e.cseq});if(!this.hasAnswer)return}if(this.dialog&&e.status_code<200){if(this.dialog.pracked.indexOf(e.getHeader("rseq"))!==-1||this.dialog.pracked[this.dialog.pracked.length-1]>=e.getHeader("rseq")&&this.dialog.pracked.length>0)return;if(!this.earlyDialogs[i]&&!this.createDialog(e,"UAC",!0))return;if(this.earlyDialogs[i].pracked.indexOf(e.getHeader("rseq"))!==-1||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=e.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;return o.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[i].pracked.push(e.getHeader("rseq")),void this.earlyDialogs[i].sendRequest(this,t.C.PRACK,{extraHeaders:o,body:t.Utils.generateFakeSDP(e.body)})}if(this.isCanceled)return void(e.status_code>=100&&e.status_code<200?(this.request.cancel(this.cancelReason,o),this.canceled(null)):e.status_code>=200&&e.status_code<299?(this.acceptAndTerminate(e),this.emit("bye",this.request)):e.status_code>=300&&(n=t.C.REASON_PHRASE[e.status_code]||t.C.causes.CANCELED,this.rejected(e,n),this.failed(e,n),this.terminated(e,n)));switch(!0){case/^100$/.test(e.status_code):this.received_100=!0,this.emit("progress",e);break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){this.logger.warn("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this.createDialog(e,"UAC",!0))break;if(this.status=u.STATUS_1XX_RECEIVED,e.hasHeader("require")&&e.getHeader("require").indexOf("100rel")!==-1){if(this.dialog||!this.earlyDialogs[i])break;if(this.earlyDialogs[i].pracked.indexOf(e.getHeader("rseq"))!==-1||this.earlyDialogs[i].pracked[this.earlyDialogs[i].pracked.length-1]>=e.getHeader("rseq")&&this.earlyDialogs[i].pracked.length>0)return;if(this.mediaHandler.hasDescription(e))if(this.hasOffer){if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,this.dialog.pracked.push(e.getHeader("rseq")),this.mediaHandler.setDescription(e).then(function(){o.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),r.sendRequest(t.C.PRACK,{extraHeaders:o,receiveResponse:function(){}}),r.status=u.STATUS_EARLY_MEDIA,r.mute(),r.emit("progress",e)},function(n){r.logger.warn(n),r.acceptAndTerminate(e,488,"Not Acceptable Here"),r.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var a=this.earlyDialogs[i],c=a.mediaHandler;a.pracked.push(e.getHeader("rseq")),c.setDescription(e).then(c.getDescription.bind(c,r.mediaHint)).then(function(n){o.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),a.sendRequest(r,t.C.PRACK,{extraHeaders:o,body:n}),r.status=u.STATUS_EARLY_MEDIA,r.emit("progress",e)}).catch(function(n){if(n instanceof t.Exceptions.GetDescriptionError){if(a.pracked.push(e.getHeader("rseq")),r.status===u.STATUS_TERMINATED)return;r.failed(null,t.C.causes.WEBRTC_ERROR),r.terminated(null,t.C.causes.WEBRTC_ERROR)}else a.pracked.splice(a.pracked.indexOf(e.getHeader("rseq")),1),r.logger.warn("invalid description"),r.logger.warn(n)})}else o.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[i].pracked.push(e.getHeader("rseq")),this.earlyDialogs[i].sendRequest(this,t.C.PRACK,{extraHeaders:o}),this.emit("progress",e)}else this.emit("progress",e);break;case/^2[0-9]{2}$/.test(e.status_code):if(this.request.cseq+" "+this.request.method!==e.getHeader("cseq"))break;if(this.status===u.STATUS_EARLY_MEDIA&&this.dialog){this.status=u.STATUS_CONFIRMED,this.unmute(),s={},this.renderbody&&(o.push("Content-Type: "+this.rendertype),s.extraHeaders=o,s.body=this.renderbody),s.cseq=e.cseq,this.sendRequest(t.C.ACK,s),this.accepted(e);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer)this.renderbody&&(o.push("Content-Type: "+r.rendertype),s.extraHeaders=o,s.body=this.renderbody),this.sendRequest(t.C.ACK,s);else{if(!this.mediaHandler.hasDescription(e)){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,this.mediaHandler.setDescription(e).then(function(){var n={};r.status=u.STATUS_CONFIRMED,r.unmute(),r.renderbody&&(o.push("Content-Type: "+r.rendertype),n.extraHeaders=o,n.body=r.renderbody),n.cseq=e.cseq,r.sendRequest(t.C.ACK,n),r.accepted(e)},function(n){r.logger.warn(n),r.acceptAndTerminate(e,488,"Not Acceptable Here"),r.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[i]&&this.earlyDialogs[i].mediaHandler.localMedia){if(this.hasOffer=!0,this.hasAnswer=!0,this.mediaHandler=this.earlyDialogs[i].mediaHandler,!this.createDialog(e,"UAC"))break;this.status=u.STATUS_CONFIRMED,this.sendRequest(t.C.ACK,{cseq:e.cseq}),this.unmute(),this.accepted(e)}else{if(!this.mediaHandler.hasDescription(e)){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,t.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasOffer=!0,this.mediaHandler.setDescription(e).then(this.mediaHandler.getDescription.bind(this.mediaHandler,this.mediaHint)).then(function(n){r.isCanceled||r.status===u.STATUS_TERMINATED||(r.status=u.STATUS_CONFIRMED,r.hasAnswer=!0,r.unmute(),r.sendRequest(t.C.ACK,{body:n,cseq:e.cseq}),r.accepted(e))}).catch(function(n){n instanceof t.Exceptions.GetDescriptionError?r.logger.warn("there was a problem"):(r.logger.warn("invalid description"),r.logger.warn(n),e.reply(488))})}break;default:n=t.Utils.sipErrorCause(e.status_code),this.rejected(e,n),this.failed(e,n),this.terminated(e,n)}}},cancel:function(e){if(e=e||{},e.extraHeaders=(e.extraHeaders||[]).slice(),this.status===u.STATUS_TERMINATED||this.status===u.STATUS_CONFIRMED)throw new t.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession");var n=t.Utils.getCancelReason(e.status_code,e.reason_phrase);return this.status===u.STATUS_NULL||this.status===u.STATUS_INVITE_SENT&&!this.received_100?(this.isCanceled=!0,this.cancelReason=n):this.status!==u.STATUS_INVITE_SENT&&this.status!==u.STATUS_1XX_RECEIVED&&this.status!==u.STATUS_EARLY_MEDIA||this.request.cancel(n,e.extraHeaders),this.canceled()},terminate:function(e){return this.status===u.STATUS_TERMINATED?this:(this.status===u.STATUS_WAITING_FOR_ACK||this.status===u.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},receiveRequest:function(e){return e.method,t.C.CANCEL,e.method===t.C.ACK&&this.status===u.STATUS_WAITING_FOR_ACK&&(t.Timers.clearTimeout(this.timers.ackTimer),t.Timers.clearTimeout(this.timers.invite2xxTimer),this.status=u.STATUS_CONFIRMED,this.unmute(),this.accepted()),r.prototype.receiveRequest.apply(this,[e])},onTransportError:function(){this.status!==u.STATUS_CONFIRMED&&this.status!==u.STATUS_TERMINATED&&this.failed(null,t.C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){this.status===u.STATUS_CONFIRMED?this.terminated(null,t.C.causes.REQUEST_TIMEOUT):this.status!==u.STATUS_TERMINATED&&(this.failed(null,t.C.causes.REQUEST_TIMEOUT),this.terminated(null,t.C.causes.REQUEST_TIMEOUT))}},t.InviteClientContext=o}},{"./RFC4028":88,"./Session/DTMF":96}],96:[function(e,t,n){"use strict";t.exports=function(e){var t,n={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return t=function(n,r,i){var o,s;if(void 0===r)throw new TypeError("Not enough arguments");if(this.logger=n.ua.getLogger("sip.invitecontext.dtmf",n.id),this.owner=n,this.direction=null,i=i||{},o=i.duration||null,s=i.interToneGap||null,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);if(this.tone=r,o&&!e.Utils.isDecimal(o))throw new TypeError("Invalid tone duration: "+o);if(o?o<t.C.MIN_DURATION?(this.logger.warn('"duration" value is lower than the minimum allowed, setting it to '+t.C.MIN_DURATION+" milliseconds"),o=t.C.MIN_DURATION):o>t.C.MAX_DURATION?(this.logger.warn('"duration" value is greater than the maximum allowed, setting it to '+t.C.MAX_DURATION+" milliseconds"),o=t.C.MAX_DURATION):o=Math.abs(o):o=t.C.DEFAULT_DURATION,this.duration=o,s&&!e.Utils.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);s?s<t.C.MIN_INTER_TONE_GAP?(this.logger.warn('"interToneGap" value is lower than the minimum allowed, setting it to '+t.C.MIN_INTER_TONE_GAP+" milliseconds"),s=t.C.MIN_INTER_TONE_GAP):s=Math.abs(s):s=t.C.DEFAULT_INTER_TONE_GAP,this.interToneGap=s},t.prototype=Object.create(e.EventEmitter.prototype),t.prototype.send=function(t){var n,r={};if(this.direction="outgoing",this.owner.status!==e.Session.C.STATUS_CONFIRMED&&this.owner.status!==e.Session.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.owner.status);t=t||{},n=t.extraHeaders?t.extraHeaders.slice():[],r.contentType="application/dtmf-relay",r.body="Signal= "+this.tone+"\r\n",r.body+="Duration= "+this.duration,this.request=this.owner.dialog.sendRequest(this,e.C.INFO,{extraHeaders:n,body:r}),this.owner.emit("dtmf",this.request,this)},t.prototype.receiveResponse=function(t){var n;switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("succeeded",{originator:"remote",response:t});break;default:n=e.Utils.sipErrorCause(t.status_code),this.emit("failed",t,n)}},t.prototype.onRequestTimeout=function(){this.emit("failed",null,e.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",null,e.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(t){this.emit("failed",t,e.C.causes.DIALOG_ERROR),this.owner.onDialogError(t)},t.prototype.init_incoming=function(e){this.direction="incoming",this.request=e,e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.C=n,t}},{}],97:[function(e,t,n){"use strict";t.exports=function(e){e.Subscription=function(t,n,r,i){if(i=Object.create(i||Object.prototype),this.extraHeaders=i.extraHeaders=(i.extraHeaders||[]).slice(),this.id=null,this.state="init",!r)throw new TypeError("Event necessary to create a subscription.");this.event=r,"number"!=typeof i.expires?(t.logger.warn("expires must be a number. Using default of 3600."),this.expires=3600):this.expires=i.expires,i.extraHeaders.push("Event: "+this.event),i.extraHeaders.push("Expires: "+this.expires),i.body&&(this.body=i.body),this.contact=t.contact.toString(),i.extraHeaders.push("Contact: "+this.contact),i.extraHeaders.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),e.Utils.augment(this,e.ClientContext,[t,e.C.SUBSCRIBE,n,i]),this.logger=t.getLogger("sip.subscription"),this.dialog=null,this.timers={N:null,sub_duration:null},this.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604]},e.Subscription.prototype={subscribe:function(){var t=this;return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(t.timer_fire.bind(t),e.Timers.TIMER_N),this.send(),this.state="notify_wait",this)},refresh:function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog.sendRequest(this,e.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},receiveResponse:function(t){var n,r=this,i=e.Utils.getReasonPhrase(t.status_code);"notify_wait"===this.state&&t.status_code>=300||"notify_wait"!==this.state&&this.errorCodes.indexOf(t.status_code)!==-1?this.failed(t,null):/^2[0-9]{2}$/.test(t.status_code)&&(n=t.getHeader("Expires"),e.Timers.clearTimeout(this.timers.N),this.createConfirmedDialog(t,"UAC")&&(this.id=this.dialog.id.toString(),this.ua.subscriptions[this.id]=this,this.emit("accepted",t,i)),n&&n<=this.expires?(this.expires=n,this.timers.sub_duration=e.Timers.setTimeout(r.refresh.bind(r),900*n)):n?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(t,e.C.INVALID_EXPIRES_HEADER)):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(t,e.C.EXPIRES_HEADER_MISSING)))},unsubscribe:function(){var t=[],n=this;this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+e.UA.C.ALLOWED_METHODS.toString()),this.receiveResponse=function(){},this.dialog.sendRequest(this,this.method,{extraHeaders:t,body:this.body}),e.Timers.clearTimeout(this.timers.sub_duration),e.Timers.clearTimeout(this.timers.N),this.timers.N=e.Timers.setTimeout(n.timer_fire.bind(n),e.Timers.TIMER_N)},timer_fire:function(){"terminated"===this.state?(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]):"pending"===this.state||"notify_wait"===this.state?this.close():this.refresh()},close:function(){"notify_wait"!==this.state&&"terminated"!==this.state&&this.unsubscribe()},createConfirmedDialog:function(t,n){var r;return this.terminateDialog(),r=new e.Dialog(this,t,n),!r.error&&(this.dialog=r,!0)},terminateDialog:function(){this.dialog&&(delete this.ua.subscriptions[this.id],this.dialog.terminate(),delete this.dialog)},receiveRequest:function(t){function n(){r.expires&&(e.Timers.clearTimeout(i.timers.sub_duration),r.expires=Math.min(i.expires,Math.max(r.expires,0)),i.timers.sub_duration=e.Timers.setTimeout(i.refresh.bind(i),900*r.expires))}var r,i=this;if(!this.matchEvent(t))return void t.reply(489);if(r=t.parseHeader("Subscription-State"),t.reply(200,e.C.REASON_200),e.Timers.clearTimeout(this.timers.N),this.emit("notify",{request:t}),"terminated"===this.state)return void("terminated"===r.state&&(this.terminateDialog(),e.Timers.clearTimeout(this.timers.N),e.Timers.clearTimeout(this.timers.sub_duration),delete this.ua.subscriptions[this.id]));switch(r.state){case"active":this.state="active",n();break;case"pending":"notify_wait"===this.state&&n(),this.state="pending";break;case"terminated":if(e.Timers.clearTimeout(this.timers.sub_duration),r.reason)switch(this.logger.log("terminating subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(r.params&&r.params["retry-after"]?this.timers.sub_duration=e.Timers.setTimeout(i.subscribe.bind(i),r.params["retry-after"]):this.subscribe());case"rejected":case"noresource":case"invariant":}this.close()}},failed:function(e,t){return this.close(),this.emit("failed",e,t),this},onDialogError:function(t){this.failed(t,e.C.causes.DIALOG_ERROR)},matchEvent:function(e){var t;return e.hasHeader("Event")?e.hasHeader("Subscription-State")?(t=e.parseHeader("event").event,this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)):(this.logger.warn("missing Subscription-State header"),!1):(this.logger.warn("missing Event header"),!1)}}}},{}],98:[function(e,t,n){"use strict";var r=500,i=5e3;t.exports=function(e){var t={T1:r,T2:4e3,T4:i,TIMER_B:64*r,TIMER_D:0*r,TIMER_F:64*r,TIMER_H:64*r,TIMER_I:0*r,TIMER_J:0*r,TIMER_K:0*i,TIMER_L:64*r,TIMER_M:64*r,TIMER_N:64*r,PROVISIONAL_RESPONSE_INTERVAL:6e4};return["setTimeout","clearTimeout","setInterval","clearInterval"].forEach(function(n){t[n]=function(){return e[n].apply(e,arguments)}}),t}},{}],99:[function(e,t,n){"use strict";t.exports=function(e){function t(e,t,n){var r;return r="SIP/2.0/"+(e.ua.configuration.hackViaTcp?"TCP":t.server.scheme),r+=" "+e.ua.configuration.viaHost+";branch="+n,e.ua.configuration.forceRport&&(r+=";rport"),r}var n={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},r=function(e,r,i){var o;this.type=n.NON_INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),o=t(e,i,this.id),this.request.setHeader("via",o),this.request_sender.ua.newTransaction(this)};r.prototype=Object.create(e.EventEmitter.prototype),r.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},r.prototype.send=function(){var t=this;this.stateChanged(n.STATUS_TRYING),this.F=e.Timers.setTimeout(t.timer_F.bind(t),e.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},r.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting non-INVITE client transaction "+this.id),e.Timers.clearTimeout(this.F),e.Timers.clearTimeout(this.K),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},r.prototype.timer_F=function(){this.logger.log("Timer F expired for non-INVITE client transaction "+this.id),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},r.prototype.timer_K=function(){this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},r.prototype.receiveResponse=function(t){var r=this,i=t.status_code;if(i<200)switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_PROCEEDING),this.request_sender.receiveResponse(t)}else switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),e.Timers.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=e.Timers.setTimeout(r.timer_K.bind(r),e.Timers.TIMER_K);break;case n.STATUS_COMPLETED:}};var i=function(e,r,i){var o,s=this;this.type=n.INVITE_CLIENT,this.transport=i,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=r,this.logger=e.ua.getLogger("sip.transaction.ict",this.id),o=t(e,i,this.id),this.request.setHeader("via",o),this.request_sender.ua.newTransaction(this),this.request.cancel=function(e,t){t=(t||[]).slice();for(var n=t.length,r=null,i=0;i<n;i++)r=(r||"")+t[i].trim()+"\r\n";s.cancel_request(s,e,r)}};i.prototype=Object.create(e.EventEmitter.prototype),i.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},i.prototype.send=function(){var t=this;this.stateChanged(n.STATUS_CALLING),this.B=e.Timers.setTimeout(t.timer_B.bind(t),e.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},i.prototype.onTransportError=function(){this.logger.log("transport error occurred, deleting INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),e.Timers.clearTimeout(this.D),e.Timers.clearTimeout(this.M),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==n.STATUS_ACCEPTED&&this.request_sender.onTransportError()},i.prototype.timer_M=function(){this.logger.log("Timer M expired for INVITE client transaction "+this.id),this.state===n.STATUS_ACCEPTED&&(e.Timers.clearTimeout(this.B),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},i.prototype.timer_B=function(){this.logger.log("Timer B expired for INVITE client transaction "+this.id),this.state===n.STATUS_CALLING&&(this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},i.prototype.timer_D=function(){this.logger.log("Timer D expired for INVITE client transaction "+this.id),e.Timers.clearTimeout(this.B),this.stateChanged(n.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},i.prototype.sendACK=function(t){var n=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="Content-Length: 0\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=e.Timers.setTimeout(n.timer_D.bind(n),e.Timers.TIMER_D),this.transport.send(this.ack)},i.prototype.cancel_request=function(t,r,i){var o=t.request;this.cancel=e.C.CANCEL+" "+o.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+o.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+o.headers.Route.toString()+"\r\n"),this.cancel+="To: "+o.headers.To.toString()+"\r\n",this.cancel+="From: "+o.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+o.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+o.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",r&&(this.cancel+="Reason: "+r+"\r\n"),i&&(this.cancel+=i),this.cancel+="Content-Length: 0\r\n\r\n",this.state===n.STATUS_PROCEEDING&&this.transport.send(this.cancel)},i.prototype.receiveResponse=function(t){var r=this,i=t.status_code;if(i>=100&&i<=199)switch(this.state){case n.STATUS_CALLING:this.stateChanged(n.STATUS_PROCEEDING),this.request_sender.receiveResponse(t),this.cancel&&this.transport.send(this.cancel);break;case n.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(i>=200&&i<=299)switch(this.state){case n.STATUS_CALLING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_ACCEPTED),this.M=e.Timers.setTimeout(r.timer_M.bind(r),e.Timers.TIMER_M),this.request_sender.receiveResponse(t);break;case n.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(i>=300&&i<=699)switch(this.state){case n.STATUS_CALLING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),this.sendACK(t),this.request_sender.receiveResponse(t);break;case n.STATUS_COMPLETED:this.sendACK(t)}};var o=function(e,n,r){var i;this.transport=r,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=n,this.logger=e.ua.getLogger("sip.transaction.nict",this.id),i=t(e,r,this.id),this.request.setHeader("via",i)};o.prototype=Object.create(e.EventEmitter.prototype),o.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},o.prototype.onTransportError=function(){this.logger.log("transport error occurred, for an ACK client transaction "+this.id),this.request_sender.onTransportError()};var s=function(e,t){this.type=n.NON_INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.nist",this.id),this.state=n.STATUS_TRYING,t.newTransaction(this)};s.prototype=Object.create(e.EventEmitter.prototype),s.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},s.prototype.timer_J=function(){this.logger.log("Timer J expired for non-INVITE server transaction "+this.id),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},s.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting non-INVITE server transaction "+this.id),e.Timers.clearTimeout(this.J),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},s.prototype.receiveResponse=function(t,r){var i=this,o=e.Utils.defer();if(100===t)switch(this.state){case n.STATUS_TRYING:this.stateChanged(n.STATUS_PROCEEDING),this.transport.send(r)||this.onTransportError();break;case n.STATUS_PROCEEDING:this.last_response=r,this.transport.send(r)?o.resolve():(this.onTransportError(),o.reject())}else if(t>=200&&t<=699)switch(this.state){case n.STATUS_TRYING:case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_COMPLETED),this.last_response=r,this.J=e.Timers.setTimeout(i.timer_J.bind(i),e.Timers.TIMER_J),this.transport.send(r)?o.resolve():(this.onTransportError(),o.reject());break;case n.STATUS_COMPLETED:}return o.promise};var a=function(e,t){this.type=n.INVITE_SERVER,this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=t,this.last_response="",e.server_transaction=this,this.logger=t.getLogger("sip.transaction.ist",this.id),this.state=n.STATUS_PROCEEDING,t.newTransaction(this),this.resendProvisionalTimer=null,e.reply(100)};a.prototype=Object.create(e.EventEmitter.prototype),a.prototype.stateChanged=function(e){this.state=e,this.emit("stateChanged")},a.prototype.timer_H=function(){this.logger.log("Timer H expired for INVITE server transaction "+this.id),this.state===n.STATUS_COMPLETED&&this.logger.warn("transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_I=function(){this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this)},a.prototype.timer_L=function(){this.logger.log("Timer L expired for INVITE server transaction "+this.id),this.state===n.STATUS_ACCEPTED&&(this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,this.logger.log("transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),e.Timers.clearTimeout(this.L),e.Timers.clearTimeout(this.H),e.Timers.clearTimeout(this.I),this.stateChanged(n.STATUS_TERMINATED),this.ua.destroyTransaction(this))},a.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},a.prototype.receiveResponse=function(t,r){var i=this,o=e.Utils.defer();if(t>=100&&t<=199)switch(this.state){case n.STATUS_PROCEEDING:this.transport.send(r)||this.onTransportError(),this.last_response=r}if(t>100&&t<=199&&this.state===n.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=e.Timers.setInterval(i.resend_provisional.bind(i),e.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(t>=200&&t<=299)switch(this.state){case n.STATUS_PROCEEDING:this.stateChanged(n.STATUS_ACCEPTED),this.last_response=r,this.L=e.Timers.setTimeout(i.timer_L.bind(i),e.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case n.STATUS_ACCEPTED:this.transport.send(r)?o.resolve():(this.onTransportError(),o.reject())}else if(t>=300&&t<=699)switch(this.state){case n.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(e.Timers.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(r)?(this.stateChanged(n.STATUS_COMPLETED),this.H=e.Timers.setTimeout(i.timer_H.bind(i),e.Timers.TIMER_H),o.resolve()):(this.onTransportError(),o.reject())}return o.promise};var u=function(t,r){var i;switch(r.method){case e.C.INVITE:if(i=t.transactions.ist[r.via_branch]){switch(i.state){case n.STATUS_PROCEEDING:i.transport.send(i.last_response);break;case n.STATUS_ACCEPTED:}return!0}break;case e.C.ACK:if(i=t.transactions.ist[r.via_branch],!i)return!1;if(i.state===n.STATUS_ACCEPTED)return!1;if(i.state===n.STATUS_COMPLETED)return i.stateChanged(n.STATUS_CONFIRMED),i.I=e.Timers.setTimeout(i.timer_I.bind(i),e.Timers.TIMER_I),!0;break;case e.C.CANCEL:return i=t.transactions.ist[r.via_branch],i?(r.reply_sl(200),i.state!==n.STATUS_PROCEEDING):(r.reply_sl(481),!0);default:if(i=t.transactions.nist[r.via_branch]){switch(i.state){case n.STATUS_TRYING:break;case n.STATUS_PROCEEDING:case n.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}};e.Transactions={C:n,checkTransaction:u,NonInviteClientTransaction:r,InviteClientTransaction:i,AckClientTransaction:o,NonInviteServerTransaction:s,InviteServerTransaction:a}}},{}],100:[function(e,t,n){"use strict";t.exports=function(e,t){function n(e){var t=.8*e;return 1e3*(Math.random()*(e-t)+t)}var r,i={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};return r=function(e,t){this.logger=e.getLogger("sip.transport"),this.ua=e,this.ws=null,this.server=t,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.keepAliveInterval=e.configuration.keepAliveInterval,this.keepAliveTimeout=null,this.keepAliveTimer=null,this.ua.transport=this,this.connect()},r.prototype={send:function(e){var n=e.toString();return this.ws&&this.ws.readyState===t.OPEN?(this.ua.configuration.traceSip===!0&&this.logger.log("sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),!0):(this.logger.warn("unable to send message, WebSocket is not open"),!1)},sendKeepAlive:function(){if(!this.keepAliveTimeout)return this.keepAliveTimeout=e.Timers.setTimeout(function(){this.ua.emit("keepAliveTimeout")}.bind(this),1e4),this.send("\r\n\r\n")},startSendingKeepAlives:function(){this.keepAliveInterval&&!this.keepAliveTimer&&(this.keepAliveTimer=e.Timers.setTimeout(function(){this.sendKeepAlive(),this.keepAliveTimer=null,this.startSendingKeepAlives()}.bind(this),n(this.keepAliveInterval)))},stopSendingKeepAlives:function(){e.Timers.clearTimeout(this.keepAliveTimer),e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimer=null,this.keepAliveTimeout=null},disconnect:function(){this.ws&&(e.Timers.clearTimeout(this.reconnectTimer),this.stopSendingKeepAlives(),this.closed=!0,this.logger.log("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===t.OPEN||this.ws.readyState===t.CONNECTING))return this.logger.log("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),this.logger.log("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new t(this.server.ws_uri,"sip")}catch(e){this.logger.warn("error connecting to WebSocket "+this.server.ws_uri+": "+e)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(t){e.onClose(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onerror=function(t){e.onError(t)}},onOpen:function(){this.connected=!0,this.logger.log("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(e.Timers.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this),this.startSendingKeepAlives()},onClose:function(e){var t=this.connected;this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,this.stopSendingKeepAlives(),this.reconnection_attempts>0?(this.logger.log("Reconnection attempt "+this.reconnection_attempts+" failed (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.reconnect()):(this.connected=!1,this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),e.wasClean===!1&&this.logger.warn("WebSocket abrupt disconnection"),t===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reconnect()):this.ua.onTransportError(this))},onMessage:function(t){var n,r,i=t.data;if("\r\n"===i)return e.Timers.clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=null,void(this.ua.configuration.traceSip===!0&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof i){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}this.ua.configuration.traceSip===!0&&this.logger.log("received WebSocket binary message:\n\n"+i+"\n")}else this.ua.configuration.traceSip===!0&&this.logger.log("received WebSocket text message:\n\n"+i+"\n");if(n=e.Parser.parseMessage(i,this.ua),n&&!(this.ua.status===e.UA.C.STATUS_USER_CLOSED&&n instanceof e.IncomingRequest)&&e.sanityCheck(n,this.ua,this))if(n instanceof e.IncomingRequest)n.transport=this,this.ua.receiveRequest(n);else if(n instanceof e.IncomingResponse)switch(n.method){case e.C.INVITE:r=this.ua.transactions.ict[n.via_branch],r&&r.receiveResponse(n);break;case e.C.ACK:break;default:r=this.ua.transactions.nict[n.via_branch],r&&r.receiveResponse(n)}},onError:function(e){this.logger.warn("WebSocket connection error: "+JSON.stringify(e))},reconnect:function(){var t=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.wsServerMaxReconnection?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):1===this.reconnection_attempts?(this.logger.log("Connection to WebSocket "+this.server.ws_uri+" severed, attempting first reconnect"),t.connect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=e.Timers.setTimeout(function(){t.connect(),t.reconnectTimer=null},1e3*this.ua.configuration.wsServerReconnectionTimeout))}},r.C=i,r}},{}],101:[function(e,t,r){(function(e){"use strict";t.exports=function(t,n){function r(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return t.Utils.Promise.resolve()}),e}var i,o={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10};i=function(r){function i(e){return s.emit.bind(s,e)}var s=this;o.ACCEPTED_BODY_TYPES=o.ACCEPTED_BODY_TYPES.toString(),this.log=new t.LoggerFactory,this.logger=this.getLogger("sip.ua"),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.data={},this.sessions={},this.subscriptions={},this.transport=null,this.contact=null,this.status=o.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var e,t=["nist","nict","ist","ict"],n=0;for(e in t)n+=Object.keys(this.transactions[t[e]]).length;return n}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===r?r={}:("string"==typeof r||r instanceof String)&&(r={uri:r}),r.log&&(r.log.hasOwnProperty("builtinEnabled")&&(this.log.builtinEnabled=r.log.builtinEnabled),r.log.hasOwnProperty("level")&&(this.log.level=r.log.level),r.log.hasOwnProperty("connector")&&(this.log.connector=r.log.connector));try{this.loadConfig(r)}catch(e){throw this.status=o.STATUS_NOT_READY,this.error=o.CONFIGURATION_ERROR,e}this.registerContext=new t.RegisterContext(this),this.registerContext.on("failed",i("registrationFailed")),this.registerContext.on("registered",i("registered")),this.registerContext.on("unregistered",i("unregistered")),this.configuration.autostart&&this.start(),"function"==typeof n.addEventListener&&(e.chrome&&e.chrome.app&&e.chrome.app.runtime||n.addEventListener("unload",this.stop.bind(this)))},i.prototype=Object.create(t.EventEmitter.prototype),i.prototype.register=function(e){return this.configuration.register=!0,this.registerContext.register(e),this},i.prototype.unregister=function(e){this.configuration.register=!1;var t=this.registerContext;return this.afterConnected(t.unregister.bind(t,e)),this},i.prototype.isRegistered=function(){return this.registerContext.registered},i.prototype.isConnected=function(){return!!this.transport&&this.transport.connected},i.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},i.prototype.invite=function(e,n){var r=new t.InviteClientContext(this,e,n);return this.afterConnected(r.invite.bind(r)),r},i.prototype.subscribe=function(e,n,r){var i=new t.Subscription(this,e,n,r);return this.afterConnected(i.subscribe.bind(i)),i},i.prototype.message=function(e,n,r){if(void 0===n)throw new TypeError("Not enough arguments");return r=Object.create(r||Object.prototype),r.contentType||(r.contentType="text/plain"),r.body=n,this.request(t.C.MESSAGE,e,r)},i.prototype.request=function(e,n,r){var i=new t.ClientContext(this,e,n,r);return this.afterConnected(i.send.bind(i)),i},i.prototype.stop=function(){function e(){0===s.nistTransactionsCount&&0===s.nictTransactionsCount&&(s.removeListener("transactionDestroyed",e),s.transport.disconnect())}var n,r,i,s=this;if(this.logger.log("user requested closure..."),this.status===o.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;t.Timers.clearTimeout(this.transportRecoveryTimer),this.logger.log("closing registerContext"),this.registerContext.close();for(n in this.sessions)this.logger.log("closing session "+n),this.sessions[n].terminate();for(r in this.subscriptions)this.logger.log("unsubscribing from subscription "+r),this.subscriptions[r].close();for(i in this.applicants)this.applicants[i].close();return this.status=o.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount?this.transport.disconnect():this.on("transactionDestroyed",e),this},i.prototype.start=function(){var e;return this.logger.log("user requested startup..."),this.status===o.STATUS_INIT?(e=this.getNextWsServer(),this.status=o.STATUS_STARTING,new t.Transport(this,e)):this.status===o.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=o.STATUS_READY,this.transport.connect()):this.status===o.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===o.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect"),this},i.prototype.normalizeTarget=function(e){return t.Utils.normalizeTarget(e,this.configuration.hostportParams)},i.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},i.prototype.getCredentials=function(e){var t,n;return t=e.ruri.host,this.cache.credentials[t]&&this.cache.credentials[t][e.ruri]&&(n=this.cache.credentials[t][e.ruri],n.method=e.method),n},i.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},i.prototype.onTransportClosed=function(e){var n,r,i,o=["nict","ict","nist","ist"];for(e.server.status=t.Transport.C.STATUS_DISCONNECTED,this.logger.log("connection state set to "+t.Transport.C.STATUS_DISCONNECTED),i=o.length,n=0;n<i;n++)for(r in this.transactions[o[n]])this.transactions[o[n]][r].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},i.prototype.onTransportError=function(e){var n;this.logger.log("transport "+e.server.ws_uri+" failed | connection state set to "+t.Transport.C.STATUS_ERROR),e.server.status=t.Transport.C.STATUS_ERROR,this.emit("disconnected",{transport:e}),this.status!==o.STATUS_USER_CLOSED&&(n=this.getNextWsServer(),n?new t.Transport(this,n):(this.closeSessionsOnTransportError(),this.error&&this.error===o.NETWORK_ERROR||(this.status=o.STATUS_NOT_READY,this.error=o.NETWORK_ERROR),this.recoverTransport()))},i.prototype.onTransportConnected=function(e){this.transport=e,this.transportRecoverAttempts=0,e.server.status=t.Transport.C.STATUS_READY,this.logger.log("connection state set to "+t.Transport.C.STATUS_READY),this.status!==o.STATUS_USER_CLOSED&&(this.status=o.STATUS_READY,this.error=null,this.configuration.register&&this.configuration.authenticationFactory.initialize().then(function(){this.registerContext.onTransportConnected()}.bind(this)),this.emit("connected",{transport:e}))},i.prototype.onTransportConnecting=function(e,t){this.emit("connecting",{transport:e,attempts:t})},i.prototype.newTransaction=function(e){this.transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})},i.prototype.destroyTransaction=function(e){delete this.transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})},i.prototype.receiveRequest=function(e){function n(t){return t&&t.user===e.ruri.user}var r,i,s,a,u,c=e.method,l=this;if(!(n(this.configuration.uri)||n(this.contact.uri)||n(this.contact.pub_gruu)||n(this.contact.temp_gruu)))return this.logger.warn("Request-URI does not point to us"),void(e.method!==t.C.ACK&&e.reply_sl(404));if(e.ruri.scheme===t.C.SIPS)return void e.reply_sl(416);if(!t.Transactions.checkTransaction(this,e))if(c===t.C.OPTIONS?(new t.Transactions.NonInviteServerTransaction(e,this),e.reply(200,null,["Allow: "+t.UA.C.ALLOWED_METHODS.toString(),"Accept: "+o.ACCEPTED_BODY_TYPES])):c===t.C.MESSAGE?(s=new t.ServerContext(this,e),s.body=e.body,s.content_type=e.getHeader("Content-Type")||"text/plain",e.reply(200,null),this.emit("message",s)):c!==t.C.INVITE&&c!==t.C.ACK&&new t.ServerContext(this,e),e.to_tag)r=this.findDialog(e),r?(c===t.C.INVITE&&new t.Transactions.InviteServerTransaction(e,this),r.receiveRequest(e)):c===t.C.NOTIFY?(i=this.findSession(e),i?i.receiveRequest(e):(this.logger.warn("received NOTIFY request for a non existent session"),e.reply(481,"Subscription does not exist"))):c!==t.C.ACK&&e.reply(481);else switch(c){case t.C.INVITE:if(a=this.configuration.replaces!==t.C.supported.UNSUPPORTED&&e.parseHeader("replaces")){if(u=this.dialogs[a.call_id+a.replaces_to_tag+a.replaces_from_tag],!u)return void e.reply_sl(481,null);if(u.owner.status===t.Session.C.STATUS_TERMINATED)return void e.reply_sl(603,null);if(u.state===t.Dialog.C.STATUS_CONFIRMED&&a.early_only)return void e.reply_sl(486,null)}var d=this.configuration.mediaHandlerFactory.isSupported;!d||d()?(i=new t.InviteServerContext(this,e),i.replacee=u&&u.owner,i.on("invite",function(){l.emit("invite",this)})):(this.logger.warn("INVITE received but WebRTC is not supported"),e.reply(488));break;case t.C.BYE:e.reply(481);break;case t.C.CANCEL:i=this.findSession(e),i?i.receiveRequest(e):this.logger.warn("received CANCEL request for a non existent session");break;case t.C.ACK:break;case t.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(e.reply(200,null),l.emit("notify",{request:e})):e.reply(481,"Subscription does not exist");break;default:e.reply(405)}},i.prototype.findSession=function(e){return this.sessions[e.call_id+e.from_tag]||this.sessions[e.call_id+e.to_tag]||null},i.prototype.findDialog=function(e){return this.dialogs[e.call_id+e.from_tag+e.to_tag]||this.dialogs[e.call_id+e.to_tag+e.from_tag]||null},i.prototype.getNextWsServer=function(){var e,n,r,i=[];for(n=this.configuration.wsServers.length,e=0;e<n;e++)r=this.configuration.wsServers[e],r.status!==t.Transport.C.STATUS_ERROR&&(0===i.length?i.push(r):r.weight>i[0].weight?i=[r]:r.weight===i[0].weight&&i.push(r));return e=Math.floor(Math.random()*i.length),i[e]},i.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registerContext.onTransportClosed()},i.prototype.recoverTransport=function(e){var n,r,i,o,s,a;for(e=e||this,s=e.transportRecoverAttempts,r=e.configuration.wsServers.length,n=0;n<r;n++)e.configuration.wsServers[n].status=0;a=e.getNextWsServer(),i=Math.floor(Math.random()*Math.pow(2,s)+1),o=i*e.configuration.connectionRecoveryMinInterval,o>e.configuration.connectionRecoveryMaxInterval&&(this.logger.log("time for next connection attempt exceeds connectionRecoveryMaxInterval, resetting counter"),o=e.configuration.connectionRecoveryMinInterval,s=0),this.logger.log("next connection attempt in "+o+" seconds"),this.transportRecoveryTimer=t.Timers.setTimeout(function(){e.transportRecoverAttempts=s+1,new t.Transport(e,a)},1e3*o)},i.prototype.loadConfig=function(e){function n(t,n){var r=t.replace(/([a-z][A-Z])/g,function(e){return e[0]+"_"+e[1].toLowerCase()});if(t!==r){var i=e.hasOwnProperty(t);e.hasOwnProperty(r)&&(n.warn(r+" is deprecated, please use "+t),i&&n.warn(t+" overriding "+r)),e[t]=i?e[t]:e[r]}}var o,s,a,u,c,l={viaHost:t.Utils.createRandomToken(12)+".invalid",uri:new t.URI("sip","anonymous."+t.Utils.createRandomToken(6),"anonymous.invalid",null,null),wsServers:[{scheme:"WSS",sip_uri:"<sip:edge.sip.onsip.com;transport=ws;lr>",status:0,weight:0,ws_uri:"wss://edge.sip.onsip.com"}],password:null,registerExpires:600,register:!0,registrarServer:null,wsServerMaxReconnection:3,wsServerReconnectionTimeout:4,connectionRecoveryMinInterval:2,connectionRecoveryMaxInterval:30,keepAliveInterval:0,extraSupported:[],usePreloadedRoute:!1,userAgentString:t.C.USER_AGENT,iceCheckingTimeout:5e3,noAnswerTimeout:60,stunServers:["stun:stun.l.google.com:19302"],turnServers:[],traceSip:!1,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,hackCleanJitsiSdpImageattr:!1,hackStripTcp:!1,contactTransport:"ws",forceRport:!1,autostart:!0,rel100:t.C.supported.UNSUPPORTED,replaces:t.C.supported.UNSUPPORTED,mediaHandlerFactory:t.WebRTC.MediaHandler.defaultFactory,authenticationFactory:r(function(e){return new t.DigestAuthentication(e)}),allowLegacyNotifications:!1};for(o in i.configuration_check.mandatory){if(n(o,this.logger),!e.hasOwnProperty(o))throw new t.Exceptions.ConfigurationError(o);if(s=e[o],a=i.configuration_check.mandatory[o](s),void 0===a)throw new t.Exceptions.ConfigurationError(o,s);l[o]=a}t.Utils.optionsOverride(e,"rel100","reliable",!0,this.logger,t.C.supported.UNSUPPORTED);var d=["stunServers","turnServers"];for(o in i.configuration_check.optional)if(n(o,this.logger),e.hasOwnProperty(o)){if(s=e[o],s instanceof Array&&0===s.length&&d.indexOf(o)<0)continue;if(null===s||""===s||void 0===s)continue;if("number"==typeof s&&isNaN(s))continue;if(a=i.configuration_check.optional[o](s),void 0===a)throw new t.Exceptions.ConfigurationError(o,s);l[o]=a}if(l.connectionRecoveryMaxInterval<l.connectionRecoveryMinInterval)throw new t.Exceptions.ConfigurationError("connectionRecoveryMaxInterval",l.connectionRecoveryMaxInterval);0===l.displayName&&(l.displayName="0"),l.instanceId||(l.instanceId=t.Utils.newUUID()),l.sipjsId=t.Utils.createRandomToken(5),u=l.uri.clone(),u.user=null,l.hostportParams=u.toRaw().replace(/^sip:/i,""),l.authorizationUser||(l.authorizationUser=l.uri.user),l.registrarServer||(c=l.uri.clone(),c.user=null,l.registrarServer=c),l.noAnswerTimeout=1e3*l.noAnswerTimeout,l.hackIpInContact&&("boolean"==typeof l.hackIpInContact?l.viaHost=t.Utils.getRandomTestNetIP():"string"==typeof l.hackIpInContact&&(l.viaHost=l.hackIpInContact)),l.hackWssInTransport&&(l.contactTransport="wss"),this.contact={pub_gruu:null,temp_gruu:null,uri:new t.URI("sip",t.Utils.createRandomToken(8),l.viaHost,null,{transport:l.contactTransport}),toString:function(e){e=e||{};var t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport="+l.contactTransport).toString():(this.pub_gruu||this.uri).toString(),n&&(r+=";ob"),r+=">"}},t.Utils.optionsOverride(l,"media","mediaConstraints",!0,this.logger);for(o in l)i.configuration_skeleton[o].value=l[o];Object.defineProperties(this.configuration,i.configuration_skeleton);for(o in l)i.configuration_skeleton[o].value="";this.logger.log("configuration parameters after validation:");for(o in l)switch(o){case"uri":case"registrarServer":case"mediaHandlerFactory":this.logger.log("Â· "+o+": "+l[o]);break;case"password":this.logger.log("Â· "+o+": NOT SHOWN");break;default:this.logger.log("Â· "+o+": "+JSON.stringify(l[o]))}},i.configuration_skeleton=function(){var e,t,n={},r=["sipjsId","hostportParams","uri","wsServers","authorizationUser","connectionRecoveryMaxInterval","connectionRecoveryMinInterval","keepAliveInterval","extraSupported","displayName","hackViaTcp","hackIpInContact","hackWssInTransport","hackAllowUnregisteredOptionTags","hackCleanJitsiSdpImageattr","hackStripTcp","contactTransport","forceRport","iceCheckingTimeout","instanceId","noAnswerTimeout","password","registerExpires","registrarServer","reliable","rel100","replaces","userAgentString","autostart","stunServers","traceSip","turnServers","usePreloadedRoute","wsServerMaxReconnection","wsServerReconnectionTimeout","mediaHandlerFactory","media","mediaConstraints","authenticationFactory","allowLegacyNotifications","via_core_value","viaHost"];for(e in r)t=r[e],n[t]={value:"",writable:!1,configurable:!1};return n.register={value:"",writable:!0,configurable:!1},n}(),i.configuration_check={mandatory:{},optional:{uri:function(e){var n;return/^sip:/i.test(e)||(e=t.C.SIP+":"+e),n=t.URI.parse(e),n&&n.user?n:void 0},wsServers:function(e){var n,r,i;if("string"==typeof e)e=[{ws_uri:e}];else{if(!(e instanceof Array))return;for(r=e.length,n=0;n<r;n++)"string"==typeof e[n]&&(e[n]={ws_uri:e[n]})}if(0===e.length)return!1;for(r=e.length,n=0;n<r;n++){if(!e[n].ws_uri)return;if(e[n].weight&&!Number(e[n].weight))return;if(i=t.Grammar.parse(e[n].ws_uri,"absoluteURI"),i===-1)return;if(["wss","ws","udp"].indexOf(i.scheme)<0)return;e[n].sip_uri="<sip:"+i.host+(i.port?":"+i.port:"")+";transport="+i.scheme.replace(/^wss$/i,"ws")+";lr>",e[n].weight||(e[n].weight=0),e[n].status=0,e[n].scheme=i.scheme.toUpperCase()}return e},authorizationUser:function(e){return t.Grammar.parse('"'+e+'"',"quoted_string")===-1?void 0:e},connectionRecoveryMaxInterval:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},connectionRecoveryMinInterval:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},displayName:function(e){return t.Grammar.parse('"'+e+'"',"displayName")===-1?void 0:e},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e?e:"string"==typeof e&&t.Grammar.parse(e,"host")!==-1?e:void 0},iceCheckingTimeout:function(e){if(t.Utils.isDecimal(e))return Math.max(500,e)},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},hackCleanJitsiSdpImageattr:function(e){if("boolean"==typeof e)return e},hackStripTcp:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},forceRport:function(e){if("boolean"==typeof e)return e},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),t.Grammar.parse(e,"uuid")===-1?void 0:e},keepAliveInterval:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},extraSupported:function(e){var t,n;if(e instanceof Array){for(n=e.length,t=0;t<n;t++)if("string"!=typeof e[t])return;return e}},noAnswerTimeout:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},password:function(e){return String(e)},rel100:function(e){return e===t.C.supported.REQUIRED?t.C.supported.REQUIRED:e===t.C.supported.SUPPORTED?t.C.supported.SUPPORTED:t.C.supported.UNSUPPORTED},replaces:function(e){return e===t.C.supported.REQUIRED?t.C.supported.REQUIRED:e===t.C.supported.SUPPORTED?t.C.supported.SUPPORTED:t.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerExpires:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},registrarServer:function(e){var n;if("string"==typeof e)return/^sip:/i.test(e)||(e=t.C.SIP+":"+e),n=t.URI.parse(e),n?n.user?void 0:n:void 0},stunServers:function(e){var n,r,i;if("string"==typeof e)e=[e];else if(!(e instanceof Array))return;for(r=e.length,n=0;n<r;n++){if(i=e[n],/^stuns?:/.test(i)||(i="stun:"+i),t.Grammar.parse(i,"stun_URI")===-1)return;e[n]=i}return e},traceSip:function(e){if("boolean"==typeof e)return e},turnServers:function(e){var n,r,i,o,s,a;for(e instanceof Array||(e=[e]),i=e.length,n=0;n<i;n++){if(o=e[n],o.server&&(o.urls=[o.server]),!o.urls||!o.username||!o.password)return;for(o.urls instanceof Array?s=o.urls.length:(o.urls=[o.urls],s=1),r=0;r<s;r++)if(a=o.urls[r],/^turns?:/.test(a)||(a="turn:"+a),t.Grammar.parse(a,"turn_URI")===-1)return}return e},userAgentString:function(e){if("string"==typeof e)return e},usePreloadedRoute:function(e){if("boolean"==typeof e)return e},wsServerMaxReconnection:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},wsServerReconnectionTimeout:function(e){var n;if(t.Utils.isDecimal(e)&&(n=Number(e),n>0))return n},autostart:function(e){if("boolean"==typeof e)return e},mediaHandlerFactory:function(e){if(e instanceof Function){var n=function(){function n(e){if(r[e].length>1){var n="getDescription"===e;r[e]=t.Utils.promisify(r,e,n)}}var r=e.apply(this,arguments);return n("getDescription"),n("setDescription"),r};return n.isSupported=e.isSupported,n}},authenticationFactory:r,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e}}},i.C=o,t.UA=i}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],102:[function(e,t,n){"use strict";t.exports=function(e){var t;t=function(t,n,r,i,o,s){var a,u,c,l;if(!r)throw new TypeError('missing or invalid "host" parameter');t=t||e.C.SIP,this.parameters={},this.headers={};for(a in o)this.setParam(a,o[a]);for(u in s)this.setHeader(u,s[u]);c={scheme:t,user:n,host:r,port:i},l={scheme:t.toLowerCase(),user:n,host:r.toLowerCase(),port:i},Object.defineProperties(this,{_normal:{get:function(){return l}},_raw:{get:function(){return c}},scheme:{get:function(){return l.scheme},set:function(e){c.scheme=e,l.scheme=e.toLowerCase()}},user:{get:function(){return l.user},set:function(e){l.user=c.user=e}},host:{get:function(){return l.host},set:function(e){c.host=e,l.host=e.toLowerCase()}},aor:{get:function(){return l.user+"@"+l.host}},port:{get:function(){return l.port},set:function(e){l.port=c.port=0===e?e:parseInt(e,10)||null}}})},t.prototype={setParam:function(e,t){e&&(this.parameters[e.toLowerCase()]=void 0===t||null===t?null:t.toString().toLowerCase())},getParam:function(e){if(e)return this.parameters[e.toLowerCase()]},hasParam:function(e){if(e)return this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1},deleteParam:function(e){var t;if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e))return t=this.parameters[e],delete this.parameters[e],t},clearParams:function(){this.parameters={}},setHeader:function(t,n){this.headers[e.Utils.headerize(t)]=n instanceof Array?n:[n]},getHeader:function(t){if(t)return this.headers[e.Utils.headerize(t)]},hasHeader:function(t){if(t)return this.headers.hasOwnProperty(e.Utils.headerize(t))&&!0||!1},deleteHeader:function(t){var n;if(t=e.Utils.headerize(t),this.headers.hasOwnProperty(t))return n=this.headers[t],delete this.headers[t],n},clearHeaders:function(){this.headers={}},clone:function(){return new t(this._raw.scheme,this._raw.user,this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toRaw:function(){return this._toString(this._raw)},toString:function(){return this._toString(this._normal)},_toString:function(t){var n,r,i,o,s=[];o=t.scheme+":",t.scheme.toLowerCase().match("^sips?$")||(o+="//"),t.user&&(o+=e.Utils.escapeUser(t.user)+"@"),o+=t.host,(t.port||0===t.port)&&(o+=":"+t.port);for(r in this.parameters)o+=";"+r,null!==this.parameters[r]&&(o+="="+this.parameters[r]);for(n in this.headers)for(i in this.headers[n])s.push(n+"="+this.headers[n][i]);return s.length>0&&(o+="?"+s.join("&")),o}},t.parse=function(t){return t=e.Grammar.parse(t,"SIP_URI"),t!==-1?t:void 0},e.URI=t}},{}],103:[function(e,t,n){"use strict";t.exports=function(e,t){var n;n={Promise:t.Promise,defer:function(){var e={};return e.promise=new n.Promise(function(t,n){e.resolve=t,e.reject=n}),e},promisify:function(e,t,r){var i=e[t];return function(t,o,s){return new n.Promise(function(n,o){var s=[t,n,o];r&&(s=[n,o,t]),i.apply(e,s)}).then(o,s)}},augment:function(e,t,n,r){var i,o;o=t.prototype;for(i in o)(r||void 0===e[i])&&(e[i]=o[i]);t.apply(e,n)},optionsOverride:function(e,t,n,r,i,o){r&&e[n]&&i.warn(n+" is deprecated, please use "+t+" instead"),e[t]&&e[n]&&i.warn(t+" overriding "+n),e[t]=e[t]||e[n]||o},str_utf8_length:function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},generateFakeSDP:function(e){if(e){var t=e.indexOf("o="),n=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,n)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,t){var n,r,i="";for(t=t||32,n=0;n<e;n++)r=Math.random()*t|0,i+=r.toString(t);return i},newTag:function(){return e.Utils.createRandomToken(e.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},hostType:function(t){if(t)return t=e.Grammar.parse(t,"host"),t!==-1?t.host_type:void 0},normalizeTarget:function(t,n){var r,i,o,s;if(t){if(t instanceof e.URI)return t;if("string"==typeof t){switch(i=t.split("@"),i.length){case 1:if(!n)return;o=t,s=n;break;case 2:o=i[0],s=i[1];break;default:o=i.slice(0,i.length-1).join("@"),s=i[i.length-1]}return o=o.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(o)&&(o=o.replace(/[\-\.\(\)]/g,"")),t=e.C.SIP+":"+e.Utils.escapeUser(o)+"@"+s,(r=e.URI.parse(t))?r:void 0}}else;},escapeUser:function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var t,n={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),i="",o=r.length;for(t=0;t<o;t++)0!==t&&(i+="-"),i+=r[t].charAt(0).toUpperCase()+r[t].substring(1);return n[i]&&(i=n[i]),i},sipErrorCause:function(t){var n;for(n in e.C.SIP_ERROR_CAUSES)if(e.C.SIP_ERROR_CAUSES[n].indexOf(t)!==-1)return e.C.causes[n];return e.C.causes.SIP_FAILURE_CODE},getReasonPhrase:function(t,n){return n||e.C.REASON_PHRASE[t]||""},getReasonHeaderValue:function(t,n){return n=e.Utils.getReasonPhrase(t,n),"SIP ;cause="+t+' ;text="'+n+'"'},getCancelReason:function(t,n){if(t&&t<200||t>699)throw new TypeError("Invalid status_code: "+t);if(t)return e.Utils.getReasonHeaderValue(t,n)},buildStatusLine:function(e,t){if(e=e||null,t=t||null,!e||e<100||e>699)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);return t=n.getReasonPhrase(e,t),"SIP/2.0 "+e+" "+t+"\r\n"},getRandomTestNetIP:function(){function e(e,t){return Math.floor(Math.random()*(t-e+1)+e)}return"192.0.2."+e(1,254)},calculateMD5:function(e){function t(e,t){return e<<t|e>>>32-t}function n(e,t){var n,r,i,o,s;return i=2147483648&e,o=2147483648&t,n=1073741824&e,r=1073741824&t,s=(1073741823&e)+(1073741823&t),n&r?2147483648^s^i^o:n|r?1073741824&s?3221225472^s^i^o:1073741824^s^i^o:s^i^o}function r(e,t,n){return e&t|~e&n}function i(e,t,n){return e&n|t&~n}function o(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function a(e,i,o,s,a,u,c){return e=n(e,n(n(r(i,o,s),a),c)),n(t(e,u),i)}function u(e,r,o,s,a,u,c){return e=n(e,n(n(i(r,o,s),a),c)),n(t(e,u),r)}function c(e,r,i,s,a,u,c){return e=n(e,n(n(o(r,i,s),a),c)),n(t(e,u),r)}function l(e,r,i,o,a,u,c){return e=n(e,n(n(s(r,i,o),a),c)),n(t(e,u),r)}function d(e){for(var t,n=e.length,r=n+8,i=(r-r%64)/64,o=16*(i+1),s=Array(o-1),a=0,u=0;u<n;)t=(u-u%4)/4,a=u%4*8,s[t]=s[t]|e.charCodeAt(u)<<a,u++;return t=(u-u%4)/4,a=u%4*8,s[t]=s[t]|128<<a,s[o-2]=n<<3,s[o-1]=n>>>29,s}function f(e){var t,n,r="",i="";for(n=0;n<=3;n++)t=e>>>8*n&255,i="0"+t.toString(16),r+=i.substr(i.length-2,2);return r}function p(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t}var h,m,v,g,y,b,_,w,T,C=[],k=7,E=12,S=17,x=22,R=5,A=9,I=14,j=20,O=4,P=11,N=16,D=23,M=6,U=10,L=15,F=21;for(e=p(e),C=d(e),b=1732584193,_=4023233417,w=2562383102,T=271733878,h=0;h<C.length;h+=16)m=b,v=_,g=w,y=T,b=a(b,_,w,T,C[h+0],k,3614090360),T=a(T,b,_,w,C[h+1],E,3905402710),w=a(w,T,b,_,C[h+2],S,606105819),_=a(_,w,T,b,C[h+3],x,3250441966),b=a(b,_,w,T,C[h+4],k,4118548399),T=a(T,b,_,w,C[h+5],E,1200080426),w=a(w,T,b,_,C[h+6],S,2821735955),_=a(_,w,T,b,C[h+7],x,4249261313),b=a(b,_,w,T,C[h+8],k,1770035416),T=a(T,b,_,w,C[h+9],E,2336552879),w=a(w,T,b,_,C[h+10],S,4294925233),_=a(_,w,T,b,C[h+11],x,2304563134),b=a(b,_,w,T,C[h+12],k,1804603682),T=a(T,b,_,w,C[h+13],E,4254626195),w=a(w,T,b,_,C[h+14],S,2792965006),_=a(_,w,T,b,C[h+15],x,1236535329),b=u(b,_,w,T,C[h+1],R,4129170786),T=u(T,b,_,w,C[h+6],A,3225465664),w=u(w,T,b,_,C[h+11],I,643717713),_=u(_,w,T,b,C[h+0],j,3921069994),b=u(b,_,w,T,C[h+5],R,3593408605),T=u(T,b,_,w,C[h+10],A,38016083),w=u(w,T,b,_,C[h+15],I,3634488961),_=u(_,w,T,b,C[h+4],j,3889429448),b=u(b,_,w,T,C[h+9],R,568446438),T=u(T,b,_,w,C[h+14],A,3275163606),w=u(w,T,b,_,C[h+3],I,4107603335),_=u(_,w,T,b,C[h+8],j,1163531501),b=u(b,_,w,T,C[h+13],R,2850285829),T=u(T,b,_,w,C[h+2],A,4243563512),w=u(w,T,b,_,C[h+7],I,1735328473),_=u(_,w,T,b,C[h+12],j,2368359562),b=c(b,_,w,T,C[h+5],O,4294588738),T=c(T,b,_,w,C[h+8],P,2272392833),w=c(w,T,b,_,C[h+11],N,1839030562),_=c(_,w,T,b,C[h+14],D,4259657740),b=c(b,_,w,T,C[h+1],O,2763975236),T=c(T,b,_,w,C[h+4],P,1272893353),w=c(w,T,b,_,C[h+7],N,4139469664),_=c(_,w,T,b,C[h+10],D,3200236656),b=c(b,_,w,T,C[h+13],O,681279174),T=c(T,b,_,w,C[h+0],P,3936430074),w=c(w,T,b,_,C[h+3],N,3572445317),_=c(_,w,T,b,C[h+6],D,76029189),b=c(b,_,w,T,C[h+9],O,3654602809),T=c(T,b,_,w,C[h+12],P,3873151461),w=c(w,T,b,_,C[h+15],N,530742520),_=c(_,w,T,b,C[h+2],D,3299628645),b=l(b,_,w,T,C[h+0],M,4096336452),T=l(T,b,_,w,C[h+7],U,1126891415),w=l(w,T,b,_,C[h+14],L,2878612391),_=l(_,w,T,b,C[h+5],F,4237533241),b=l(b,_,w,T,C[h+12],M,1700485571),T=l(T,b,_,w,C[h+3],U,2399980690),w=l(w,T,b,_,C[h+10],L,4293915773),_=l(_,w,T,b,C[h+1],F,2240044497),b=l(b,_,w,T,C[h+8],M,1873313359),T=l(T,b,_,w,C[h+15],U,4264355552),w=l(w,T,b,_,C[h+6],L,2734768916),_=l(_,w,T,b,C[h+13],F,1309151649),b=l(b,_,w,T,C[h+4],M,4149444226),T=l(T,b,_,w,C[h+11],U,3174756917),w=l(w,T,b,_,C[h+2],L,718787259),_=l(_,w,T,b,C[h+9],F,3951481745),b=n(b,m),_=n(_,v),w=n(w,g),T=n(T,y);return(f(b)+f(_)+f(w)+f(T)).toLowerCase()}},e.Utils=n}},{}],104:[function(e,t,n){"use strict";t.exports=function(t,n){var r;r={},r.MediaHandler=e("./WebRTC/MediaHandler")(t),r.MediaStreamManager=e("./WebRTC/MediaStreamManager")(t,n);var i;return r.isSupported=function(){return void 0!==i?i:(r.MediaStream=n.MediaStream,r.getUserMedia=n.getUserMedia,r.RTCPeerConnection=n.RTCPeerConnection,r.RTCSessionDescription=n.RTCSessionDescription,r.RTCPeerConnection&&r.RTCSessionDescription?(r.getUserMedia&&(r.getUserMedia=t.Utils.promisify(n,"getUserMedia")),i=!0):i=!1,i)},r}},{"./WebRTC/MediaHandler":105,"./WebRTC/MediaStreamManager":106}],105:[function(e,t,n){"use strict";t.exports=function(e){var t=function(t,n){function r(e,t){e.mediaStreamManager.on&&e.mediaStreamManager.on(t,function(){e.emit.apply(e,[t].concat(Array.prototype.slice.call(arguments)))})}n=n||{},this.logger=t.ua.getLogger("sip.invitecontext.mediahandler",t.id),this.session=t,this.localMedia=null,this.ready=!0,this.mediaStreamManager=n.mediaStreamManager||new e.WebRTC.MediaStreamManager(this.logger),this.audioMuted=!1,this.videoMuted=!1,this.local_hold=!1,this.remote_hold=!1;var i=this.prepareIceServers(n.stunServers,n.turnServers);this.RTCConstraints=n.RTCConstraints||{},this.initPeerConnection(i),r(this,"userMediaRequest"),r(this,"userMedia"),r(this,"userMediaFailed")};return t.defaultFactory=function(e,n){return new t(e,n)},t.defaultFactory.isSupported=function(){return e.WebRTC.isSupported()},t.prototype=Object.create(e.MediaHandler.prototype,{isReady:{writable:!0,value:function(){return this.ready}},close:{writable:!0,value:function(){this.logger.log("closing PeerConnection"),this._remoteStreams=[],this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.close(),this.localMedia&&this.mediaStreamManager.release(this.localMedia))}},getDescription:{writable:!0,value:function(t){var n=this,r=n.mediaStreamManager.acquire;r.length>1&&(r=e.Utils.promisify(this.mediaStreamManager,"acquire",!0)),t=t||{},t.dataChannel===!0&&(t.dataChannel={}),this.mediaHint=t;var i;return n.localMedia?(n.logger.log("already have local media"),i=e.Utils.Promise.resolve(n.localMedia)):(n.logger.log("acquiring local media"),i=r.call(n.mediaStreamManager,t).then(function(e){return n.logger.log("acquired local media streams"),n.localMedia=e,n.session.connecting(),e},function(e){throw n.logger.error("unable to acquire streams"),n.logger.error(e),n.session.connecting(),e}).then(this.addStreams.bind(this))),i.then(function(){return n.hasOffer("remote")?n.peerConnection.ondatachannel=function(e){n.dataChannel=e.channel,n.emit("dataChannel",n.dataChannel)}:t.dataChannel&&n.peerConnection.createDataChannel&&(n.dataChannel=n.peerConnection.createDataChannel("sipjs",t.dataChannel),n.emit("dataChannel",n.dataChannel)),n.render(),n.createOfferOrAnswer(n.RTCConstraints)}).then(function(t){return t=e.Hacks.Firefox.hasMissingCLineInSDP(t),n.local_hold&&(/a=(sendrecv|sendonly|recvonly|inactive)/.test(t)?(t=t.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),t=t.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):t=t.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n")),{body:t,contentType:"application/sdp"}})}},hasDescription:{writeable:!0,value:function(e){return"application/sdp"===e.getHeader("Content-Type")&&!!e.body}},setDescription:{writable:!0,value:function(t){var n=t.body;this.remote_hold=/a=(sendonly|inactive)/.test(n),n=e.Hacks.Firefox.cannotHandleExtraWhitespace(n),n=e.Hacks.AllBrowsers.maskDtls(n);var r={type:this.hasOffer("local")?"answer":"offer",sdp:n};this.emit("setDescription",r);var i=new e.WebRTC.RTCSessionDescription(r);return e.Utils.promisify(this.peerConnection,"setRemoteDescription")(i)}},getReferMedia:{writable:!0,value:function(){function e(e,t){return t[e]().length>0}function t(t){return this.getLocalStreams().some(e.bind(null,t))&&this.getRemoteStreams().some(e.bind(null,t))}return{constraints:{audio:t.call(this,"getAudioTracks"),video:t.call(this,"getVideoTracks")}}}},updateIceServers:{writeable:!0,value:function(e){var t=this.prepareIceServers(e.stunServers,e.turnServers);this.RTCConstraints=e.RTCConstraints||this.RTCConstraints,this.initPeerConnection(t)}},isMuted:{writable:!0,value:function(){return{audio:this.audioMuted,video:this.videoMuted}}},mute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0};var t=!1,n=!1;return e.audio&&!this.audioMuted&&(t=!0,this.audioMuted=!0,this.toggleMuteAudio(!0)),e.video&&!this.videoMuted&&(n=!0,this.videoMuted=!0,this.toggleMuteVideo(!0)),t||n?{audio:t,video:n}:void 0}}},unmute:{writable:!0,value:function(e){if(0!==this.getLocalStreams().length){e=e||{audio:this.getLocalStreams()[0].getAudioTracks().length>0,video:this.getLocalStreams()[0].getVideoTracks().length>0};var t=!1,n=!1;return e.audio&&this.audioMuted&&(t=!0,this.audioMuted=!1,this.toggleMuteAudio(!1)),e.video&&this.videoMuted&&(n=!0,this.videoMuted=!1,this.toggleMuteVideo(!1)),t||n?{audio:t,video:n}:void 0}}},hold:{writable:!0,value:function(){this.local_hold=!0,this.toggleMuteAudio(!0),this.toggleMuteVideo(!0)}},unhold:{writable:!0,value:function(){this.local_hold=!1,this.audioMuted||this.toggleMuteAudio(!1),this.videoMuted||this.toggleMuteVideo(!1)}},getLocalStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getLocalStreams returning []"),[]):e.getLocalStreams&&e.getLocalStreams()||e.localStreams||[]}},getRemoteStreams:{writable:!0,value:function(){var e=this.peerConnection;return e&&"closed"===e.signalingState?(this.logger.warn("peerConnection is closed, getRemoteStreams returning this._remoteStreams"),this._remoteStreams):e.getRemoteStreams&&e.getRemoteStreams()||e.remoteStreams||[]}},render:{writable:!0,value:function(t){if(t=t||this.mediaHint&&this.mediaHint.render,!t)return!1;var n={local:"getLocalStreams",remote:"getRemoteStreams"};Object.keys(n).forEach(function(r){var i=n[r],o=this[i]();e.WebRTC.MediaStreamManager.render(o,t[r])}.bind(this))}},hasOffer:{writable:!0,value:function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t}},prepareIceServers:{writable:!0,value:function(e,t){var n=[],r=this.session.ua.configuration;return e=e||r.stunServers,t=t||r.turnServers,[].concat(e).forEach(function(e){n.push({urls:e})}),[].concat(t).forEach(function(e){n.push({urls:e.urls,username:e.username,credential:e.password})}),n}},initPeerConnection:{writable:!0,value:function(t){var n=this,r=this.session.ua.configuration;this.onIceCompleted=e.Utils.defer(),this.onIceCompleted.promise.then(function(t){n.emit("iceGatheringComplete",t),n.iceCheckingTimer&&(e.Timers.clearTimeout(n.iceCheckingTimer),n.iceCheckingTimer=null)}),this.peerConnection&&this.peerConnection.close(),this.peerConnection=new e.WebRTC.RTCPeerConnection({iceServers:t}),this._remoteStreams=[],this.peerConnection.onaddstream=function(e){n.logger.log("stream added: "+e.stream.id),n._remoteStreams.push(e.stream),n.render(),n.emit("addStream",e)},this.peerConnection.onremovestream=function(e){n.logger.log("stream removed: "+e.stream.id)},this.startIceCheckingTimer=function(){n.iceCheckingTimer||(n.iceCheckingTimer=e.Timers.setTimeout(function(){n.logger.log("RTCIceChecking Timeout Triggered after "+r.iceCheckingTimeout+" milliseconds"),n.onIceCompleted.resolve(this)}.bind(this.peerConnection),r.iceCheckingTimeout))},this.peerConnection.onicecandidate=function(e){n.emit("iceCandidate",e),e.candidate?(n.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())),n.startIceCheckingTimer()):n.onIceCompleted.resolve(this)},this.peerConnection.onicegatheringstatechange=function(){n.logger.log("RTCIceGatheringState changed: "+this.iceGatheringState),"gathering"===this.iceGatheringState&&n.emit("iceGathering",this),"complete"===this.iceGatheringState&&n.onIceCompleted.resolve(this)},this.peerConnection.oniceconnectionstatechange=function(){var e;switch("checking"===this.iceConnectionState&&n.startIceCheckingTimer(),this.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void n.logger.warn("Unknown iceConnection state:",this.iceConnectionState)}n.emit(e,this)},this.peerConnection.onstatechange=function(){n.logger.log('PeerConnection state changed to "'+this.readyState+'"')}}},createOfferOrAnswer:{writable:!0,value:function(t){var n,r=this,i=r.peerConnection;return r.ready=!1,n=r.hasOffer("remote")?"createAnswer":"createOffer",e.Utils.promisify(i,n,!0)(t).then(e.Utils.promisify(i,"setLocalDescription")).then(function(){var t=e.Utils.defer();return"complete"===i.iceConnectionState||"completed"===i.iceConnectionState?t.resolve():r.onIceCompleted.promise.then(t.resolve),t.promise}).then(function(){var t=i.localDescription.sdp;t=e.Hacks.Chrome.needsExplicitlyInactiveSDP(t),t=e.Hacks.AllBrowsers.unmaskDtls(t);var o={type:"createOffer"===n?"offer":"answer",sdp:t};return r.emit("getDescription",o),r.session.ua.configuration.hackStripTcp&&(o.sdp=o.sdp.replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,"")),r.ready=!0,o.sdp}).catch(function(t){throw r.logger.error(t),r.ready=!0,new e.Exceptions.GetDescriptionError(t)})}},addStreams:{writable:!0,value:function(t){try{t=[].concat(t),t.forEach(function(e){this.peerConnection.addStream(e)},this)}catch(t){return this.logger.error("error adding stream"),this.logger.error(t),e.Utils.Promise.reject(t)}return e.Utils.Promise.resolve()}},toggleMuteHelper:{writable:!0,value:function(e,t){this.getLocalStreams().forEach(function(n){n[e]().forEach(function(e){e.enabled=!t})})}},toggleMuteAudio:{writable:!0,value:function(e){this.toggleMuteHelper("getAudioTracks",e)}},toggleMuteVideo:{writable:!0,value:function(e){this.toggleMuteHelper("getVideoTracks",e)}}}),t}},{}],106:[function(e,t,n){"use strict";t.exports=function(e,t){var n=function(t,n){if(!e.WebRTC.isSupported())throw new e.Exceptions.NotSupportedError("Media not supported");this.mediaHint=n||{constraints:{audio:!0,video:!0}},this.acquisitions={}};return n.streamId=function(e){return e.getAudioTracks().concat(e.getVideoTracks()).map(function(e){return e.id}).join("")},n.render=function(n,r){function i(e,t){e.srcObject=t}function o(t){t.ensurePlayingIntervalId=e.Timers.setInterval(function(){t.paused&&t.srcObject?t.play():e.Timers.clearInterval(t.ensurePlayingIntervalId)},100)}function s(e,n,r){var s=e[r%e.length];"function"==typeof s&&(s=s()),(t.attachMediaStream||i)(s,n),o(s)}if(!r)return!1;if(Array.isArray(r)&&!r.length)throw new TypeError("elements must not be empty");r=[].concat(r),[].concat(n).forEach(s.bind(null,r))},n.prototype=Object.create(e.EventEmitter.prototype,{acquire:{writable:!0,value:function(t){t=Object.keys(t||{}).length?t:this.mediaHint;var r=function(t,r){return r=[].concat(r),r.forEach(function(e){var r=n.streamId(e);this.acquisitions[r]=!!t},this),e.Utils.Promise.resolve(r)}.bind(this);if(t.stream)return r(!0,t.stream);var i=t.constraints||this.mediaHint&&this.mediaHint.constraints||{audio:!0,video:!0},o=e.Utils.defer();return e.Timers.setTimeout(function(){this.emit("userMediaRequest",i);var t=function(e,t){var n=Array.prototype.slice.call(arguments,2),r=[e].concat(n);return this.emit.apply(this,r),t.apply(null,n)}.bind(this);i.audio||i.video?o.resolve(e.WebRTC.getUserMedia(i).then(t.bind(this,"userMedia",r.bind(null,!1)),t.bind(this,"userMediaFailed",function(e){throw e}))):o.resolve([])}.bind(this),0),o.promise}},release:{writable:!0,value:function(e){e=[].concat(e),e.forEach(function(e){var t=n.streamId(e);this.acquisitions[t]===!1&&e.getTracks().forEach(function(e){e.stop()}),delete this.acquisitions[t]},this)}}}),n}},{}],107:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],108:[function(e,t,n){t.exports=function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],109:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(t)?n.showHidden=t:t&&r._extend(n,t),T(n.showHidden)&&(n.showHidden=!1),T(n.depth)&&(n.depth=2),T(n.colors)&&(n.colors=!1),T(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),c(n,e,n.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function u(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,t,n){if(e.customInspect&&t&&x(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return _(i)||(i=c(e,i,n)),i}var o=l(e,t);if(o)return o;var s=Object.keys(t),a=u(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),S(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return d(t);if(0===s.length){if(x(t)){var v=t.name?": "+t.name:"";return e.stylize("[Function"+v+"]","special")}if(C(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(E(t))return e.stylize(Date.prototype.toString.call(t),"date");if(S(t))return d(t)}var g="",y=!1,b=["{","}"];if(m(t)&&(y=!0,b=["[","]"]),x(t)){g=" [Function"+(t.name?": "+t.name:"")+"]"}if(C(t)&&(g=" "+RegExp.prototype.toString.call(t)),E(t)&&(g=" "+Date.prototype.toUTCString.call(t)),S(t)&&(g=" "+d(t)),0===s.length&&(!y||0==t.length))return b[0]+g+b[1];if(n<0)return C(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=y?f(e,t,n,a,s):s.map(function(r){return p(e,t,n,a,r,y)}),e.seen.pop(),h(w,g,b)}function l(e,t){if(T(t))return e.stylize("undefined","undefined");if(_(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return b(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)I(t,String(s))?o.push(p(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))}),o}function p(e,t,n,r,i,o){var s,a,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=g(n)?c(e,u.value,null):c(e,u.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),T(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function m(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function g(e){return null===e}function y(e){return null==e}function b(e){return"number"==typeof e}function _(e){return"string"==typeof e}function w(e){return"symbol"===(void 0===e?"undefined":a(e))}function T(e){return void 0===e}function C(e){return k(e)&&"[object RegExp]"===A(e)}function k(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function E(e){return k(e)&&"[object Date]"===A(e)}function S(e){return k(e)&&("[object Error]"===A(e)||e instanceof Error)}function x(e){return"function"==typeof e}function R(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":a(e))||void 0===e}function A(e){return Object.prototype.toString.call(e)}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var j=/%[sdj%]/g;r.format=function(e){if(!_(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(j,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])s+=g(a)||!k(a)?" "+a:" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation,s=!0}return e.apply(this,arguments)}if(T(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var O,P={};r.debuglog=function(e){if(T(O)&&(O=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!P[e])if(new RegExp("\\b"+e+"\\b","i").test(O)){t.pid;P[e]=function(){r.format.apply(r,arguments)}}else P[e]=function(){};return P[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=m,r.isBoolean=v,r.isNull=g,r.isNullOrUndefined=y,r.isNumber=b,r.isString=_,r.isSymbol=w,r.isUndefined=T,r.isRegExp=C,r.isObject=k,r.isDate=E,r.isError=S,r.isFunction=x,r.isPrimitive=R,r.isBuffer=e("./support/isBuffer");r.log=function(){},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!k(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":108,_process:72,inherits:107}],110:[function(e,t,n){t.exports={name:"twilio-video",title:"Twilio Video",description:"Twilio Video JavaScript library",version:"1.0.0-beta4",homepage:"https://twilio.com",author:"Mark Andrus Roberts <mroberts@twilio.com>",contributors:["Ryan Rowland <rrowland@twilio.com>","Manjesh Malavalli <mmalavalli@twilio.com>"],keywords:["twilio","webrtc","library","javascript","video","rooms"],repository:{type:"git",url:"https://github.com/twilio/twilio-video.js.git"},devDependencies:{browserify:"^9.0.3",cheerio:"^0.18.0",chromedriver:"^2.26.1",eslint:"^2.12.0","ink-docstrap":"^1.3.0",istanbul:"^0.4.5",jsdoc:"^3.4.3",mocha:"^2.2.5","mock-browser":"^0.91.34","npm-run-all":"^4.0.0",phantom:"^2.1.14","release-tool":"^0.2.2",requirejs:"^2.2.0",rimraf:"^2.5.4","selenium-webdriver":"^3.0.1",sinon:"^1.17.7",twilio:"^2.11.1","uglify-js":"^2.7.5","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0"},engines:{node:">=0.12"},license:"BSD-3-Clause",main:"./lib/index.js",scripts:{lint:"eslint ./lib","test:unit":"mocha ./test/unit/index.js","test:integration":"mocha ./test/integration/index.js","test:integration:travis":"node ./scripts/integration.js","test:umd":"mocha ./test/umd/index.js","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules && npm install","test:framework:angular:test":"node ./scripts/framework.js twilio-video-angular","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:meteor:install":"cd ./test/framework/twilio-video-meteor && rimraf ./node_modules && npm install","test:framework:meteor:test":"node ./scripts/framework.js twilio-video-meteor","test:framework:meteor:run":"mocha ./test/framework/twilio-video-meteor.js","test:framework:meteor":"npm-run-all test:framework:meteor:*","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules && npm install","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework":"npm-run-all test:framework:angular test:framework:meteor test:framework:react",test:"npm-run-all test:unit test:integration","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":'uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments "/^! twilio-video.js/"',"build:test:webrtc":"browserify ./test/webrtc/index.js -o ./test/dist/webrtc.js",build:"npm-run-all clean lint docs cover test:integration build:js build:min.js test:umd","build:travis":"npm-run-all clean lint docs cover test:integration:travis build:js build:min.js test:umd test:framework",docs:"node ./scripts/docs.js ./dist/docs",clean:"rimraf ./coverage ./dist ./test/dist/webrtc.js",cover:"istanbul cover _mocha -- ./test/unit/index.js"},dependencies:{"sip.js":"twilio/SIP.js.git#420ed46ba6751b32e99950fb6fb84683afb820cc",ws:"^1.0.1",xmlhttprequest:"^1.8.0"},browser:{ws:"./src/ws.js",xmlhttprequest:"./src/xmlhttprequest.js"}}},{}],111:[function(e,t,n){t.exports=WebSocket},{}],112:[function(e,t,n){n.XMLHttpRequest=XMLHttpRequest},{}]},{},[1]),c=u(1);o=[],s=function(){return c}.apply(t,o),void 0!==s&&(e.exports=s)}("undefined"!=typeof window?window:void 0!==n?n:this)}).call(t,n(2),n(38).Buffer)},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function o(e){var t,n,i,o,s,a,u=e.length;s=r(e),a=new d(3*u/4-s),i=s>0?u-4:u;var c=0;for(t=0,n=0;t<i;t+=4,n+=3)o=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],a[c++]=o>>16&255,a[c++]=o>>8&255,a[c++]=255&o;return 2===s?(o=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,a[c++]=255&o):1===s&&(o=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,a[c++]=o>>8&255,a[c++]=255&o),a}function s(e){return c[e>>18&63]+c[e>>12&63]+c[e>>6&63]+c[63&e]}function a(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(s(r));return i.join("")}function u(e){for(var t,n=e.length,r=n%3,i="",o=[],s=16383,u=0,l=n-r;u<l;u+=s)o.push(a(e,u,u+s>l?l:u+s));return 1===r?(t=e[n-1],i+=c[t>>2],i+=c[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=c[t>>10],i+=c[t>>4&63],i+=c[t<<2&63],i+="="),o.push(i),o.join("")}t.byteLength=i,t.toByteArray=o,t.fromByteArray=u;for(var c=[],l=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,h=f.length;p<h;++p)c[p]=f[p],l[f.charCodeAt(p)]=p;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},,function(e,t,n){"use strict";(function(e){function r(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function i(){return s.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return s.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=s.prototype):(null===e&&(e=new s(t)),e.length=t),e}function s(e,t,n){if(!(s.TYPED_ARRAY_SUPPORT||this instanceof s))return new s(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return a(this,e,t,n)}function a(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?p(e,t,n,r):"string"==typeof t?d(e,t,n):h(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t,n,r){return u(t),t<=0?o(e,t):void 0!==n?"string"==typeof r?o(e,t).fill(n,r):o(e,t).fill(n):o(e,t)}function l(e,t){if(u(t),e=o(e,t<0?0:0|m(t)),!s.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!s.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,n);e=o(e,r);var i=e.write(t,n);return i!==r&&(e=e.slice(0,i)),e}function f(e,t){var n=t.length<0?0:0|m(t.length);e=o(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),s.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=s.prototype):e=f(e,t),e}function h(e,t){if(s.isBuffer(t)){var n=0|m(t.length);return e=o(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||K(t.length)?o(e,0):f(e,t);if("Buffer"===t.type&&Z(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),s.alloc(+e)}function g(e,t){if(s.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(r)return V(e).length;t=(""+t).toLowerCase(),r=!0}}function y(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return j(this,t,n);case"latin1":case"binary":return O(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function _(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:w(e,t,n,r,i);if("number"==typeof t)return t&=255,s.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,n,r,i){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,u=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}var c;if(i){var l=-1;for(c=n;c<a;c++)if(o(e,c)===o(t,l===-1?0:c-l)){if(l===-1&&(l=c),c-l+1===u)return l*s}else l!==-1&&(c-=c-l),l=-1}else for(n+u>a&&(n=a-u),c=n;c>=0;c--){for(var d=!0,f=0;f<u;f++)if(o(e,c+f)!==o(t,f)){d=!1;break}if(d)return c}return-1}function T(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function C(e,t,n,r){return Y(V(t,e.length-n),e,n,r)}function k(e,t,n,r){return Y(W(t),e,n,r)}function E(e,t,n,r){return k(e,t,n,r)}function S(e,t,n,r){return Y(z(t),e,n,r)}function x(e,t,n,r){return Y(G(t,e.length-n),e,n,r)}function R(e,t,n){return 0===t&&n===e.length?J.fromByteArray(e):J.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(i+a<=n){var u,c,l,d;switch(a){case 1:o<128&&(s=o);break;case 2:u=e[i+1],128===(192&u)&&(d=(31&o)<<6|63&u,d>127&&(s=d));break;case 3:u=e[i+1],c=e[i+2],128===(192&u)&&128===(192&c)&&(d=(15&o)<<12|(63&u)<<6|63&c,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:u=e[i+1],c=e[i+2],l=e[i+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(d=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l,d>65535&&d<1114112&&(s=d))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return I(r)}function I(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=ee));return n}function j(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function O(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function P(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=B(e[o]);return i}function N(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,r,i,o){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function U(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function F(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function $(e,t,n,r,i){return i||F(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Q.write(e,t,n,r,23,4),n+4}function X(e,t,n,r,i){return i||F(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Q.write(e,t,n,r,52,8),n+8}function q(e){if(e=H(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function W(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function G(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function z(e){return J.toByteArray(q(e))}function Y(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function K(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var J=n(36),Q=n(40),Z=n(41);t.Buffer=s,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50,s.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:r(),t.kMaxLength=i(),s.poolSize=8192,s._augment=function(e){return e.__proto__=s.prototype,e},s.from=function(e,t,n){return a(null,e,t,n)},s.TYPED_ARRAY_SUPPORT&&(s.prototype.__proto__=Uint8Array.prototype,s.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&s[Symbol.species]===s&&Object.defineProperty(s,Symbol.species,{value:null,configurable:!0})),s.alloc=function(e,t,n){return c(null,e,t,n)},s.allocUnsafe=function(e){return l(null,e)},s.allocUnsafeSlow=function(e){return l(null,e)},s.isBuffer=function(e){return!(null==e||!e._isBuffer)},s.compare=function(e,t){if(!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},s.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):y.apply(this,arguments)},s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},s.prototype.compare=function(e,t,n,r,i){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,a=n-t,u=Math.min(o,a),c=this.slice(r,i),l=e.slice(t,n),d=0;d<u;++d)if(c[d]!==l[d]){o=c[d],a=l[d];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},s.prototype.indexOf=function(e,t,n){return _(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return _(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return E(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r;if(s.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=s.prototype;else{var i=t-e;r=new s(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},s.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},s.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},s.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},s.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},s.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},s.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),Q.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),Q.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),Q.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),Q.read(this,e,!1,52,8)},s.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){M(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},s.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){M(this,e,t,n,Math.pow(2,8*n)-1,0)}var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},s.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,255,0),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,65535,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,4294967295,0),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);M(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,1,127,-128),s.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,2,32767,-32768),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),s.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||M(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),s.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},s.prototype.writeFloatLE=function(e,t,n){return $(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return $(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return X(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return X(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!s.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var o;if("number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=s.isBuffer(e)?e:V(new s(e,r).toString()),u=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%u]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(t,n(2))},,function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,d=n?i-1:0,f=n?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:(p?-1:1)*(1/0);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,h=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+d>=1?f/u:f*Math.pow(2,1-d),t*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(t*u-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+p]=255&a,p+=h,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+p]=255&s,p+=h,s/=256,c-=8);e[n+p-h]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},,function(e,t,n){var r,i;!function(n,o){"use strict";"object"==typeof e&&"object"==typeof e.exports?e.exports=o(n,document):(r=[],i=function(){return o(n,document)}.apply(t,r),void 0!==i&&(e.exports=i))}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(){var e,n,r,i=navigator.userAgent,o=navigator.appName,s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10),u=!1,c=!1,l=!1,d=!1;return navigator.appVersion.indexOf("Windows NT")!==-1&&navigator.appVersion.indexOf("rv:11")!==-1?(u=!0,o="IE",s="11"):(n=i.indexOf("MSIE"))!==-1?(u=!0,o="IE",s=i.substring(n+5)):(n=i.indexOf("Chrome"))!==-1?(l=!0,o="Chrome",s=i.substring(n+7)):(n=i.indexOf("Safari"))!==-1?(d=!0,o="Safari",s=i.substring(n+7),(n=i.indexOf("Version"))!==-1&&(s=i.substring(n+8))):(n=i.indexOf("Firefox"))!==-1?(c=!0,o="Firefox",s=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(o=i.substring(e,n),s=i.substring(n+1),o.toLowerCase()===o.toUpperCase()&&(o=navigator.appName)),(r=s.indexOf(";"))!==-1&&(s=s.substring(0,r)),(r=s.indexOf(" "))!==-1&&(s=s.substring(0,r)),a=parseInt(""+s,10),isNaN(a)&&(s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),{name:o,version:a,isIE:u,isFirefox:c,isChrome:l,isSafari:d,isIos:/(iPad|iPhone|iPod)/g.test(navigator.platform),isIphone:/(iPhone|iPod)/g.test(navigator.userAgent),isTouch:"ontouchstart"in t.documentElement}}function r(e,t){var n=e.media;if("video"===e.type)switch(t){case"video/webm":return!(!n.canPlayType||!n.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/no/,""));case"video/mp4":return!(!n.canPlayType||!n.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""));case"video/ogg":return!(!n.canPlayType||!n.canPlayType('video/ogg; codecs="theora"').replace(/no/,""))}else if("audio"===e.type)switch(t){case"audio/mpeg":return!(!n.canPlayType||!n.canPlayType("audio/mpeg;").replace(/no/,""));case"audio/ogg":return!(!n.canPlayType||!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));case"audio/wav":return!(!n.canPlayType||!n.canPlayType('audio/wav; codecs="1"').replace(/no/,""))}return!1}function i(e){if(!t.querySelectorAll('script[src="'+e+'"]').length){var n=t.createElement("script");n.src=e;var r=t.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)}}function o(e,t){return Array.prototype.indexOf&&e.indexOf(t)!==-1}function s(e,t,n){return e.replace(new RegExp(t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),n)}function a(e,t){e.length||(e=[e]);for(var n=e.length-1;n>=0;n--){var r=n>0?t.cloneNode(!0):t,i=e[n],o=i.parentNode,s=i.nextSibling;return r.appendChild(i),s?o.insertBefore(r,s):o.appendChild(r),r}}function u(e){e&&e.parentNode.removeChild(e)}function c(e,t){e.insertBefore(t,e.firstChild)}function l(e,t){for(var n in t)e.setAttribute(n,N.boolean(t[n])&&t[n]?"":t[n])}function d(e,n,r){var i=t.createElement(e);l(i,r),c(n,i)}function f(e){return e.replace(".","")}function p(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=r+(n?" "+t:"")}}function h(e,t){return!!e&&(e.classList?e.classList.contains(t):new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className))}function m(e,n){var r=Element.prototype;return(r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(e){return[].indexOf.call(t.querySelectorAll(e),this)!==-1}).call(e,n)}function v(e,t,n,r,i){y(e,t,function(t){n&&n.apply(e,[t]),r.apply(e,[t])},i)}function g(e,t,n,r,i){var o=t.split(" ");if(N.boolean(i)||(i=!1),e instanceof NodeList)for(var s=0;s<e.length;s++)e[s]instanceof Node&&g(e[s],arguments[1],arguments[2],arguments[3]);else for(var a=0;a<o.length;a++)e[r?"addEventListener":"removeEventListener"](o[a],n,i)}function y(e,t,n,r){e&&g(e,t,n,!0,r)}function b(e,t,n,r){if(e&&t){N.boolean(n)||(n=!1);var i=new CustomEvent(t,{bubbles:n,detail:r});e.dispatchEvent(i)}}function _(e,t){if(e)return t=N.boolean(t)?t:!e.getAttribute("aria-pressed"),e.setAttribute("aria-pressed",t),t}function w(e,t){return 0===e||0===t||isNaN(e)||isNaN(t)?0:(e/t*100).toFixed(2)}function T(){var e=arguments;if(e.length){if(1===e.length)return e[0];for(var t=Array.prototype.shift.call(e),n=e.length,r=0;r<n;r++){var i=e[r];for(var o in i)i[o]&&i[o].constructor&&i[o].constructor===Object?(t[o]=t[o]||{},T(t[o],i[o])):t[o]=i[o]}return t}}function C(e){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;return e.match(t)?RegExp.$2:e}function k(e){var t=/^.*(vimeo.com\/|video\/)(\d+).*/;return e.match(t)?RegExp.$2:e}function E(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",element:null,prefix:""},n="webkit o moz ms khtml".split(" ");if(N.undefined(t.cancelFullScreen))for(var r=0,i=n.length;r<i;r++){if(e.prefix=n[r],!N.undefined(t[e.prefix+"CancelFullScreen"])){e.supportsFullScreen=!0;break}if(!N.undefined(t.msExitFullscreen)&&t.msFullscreenEnabled){e.prefix="ms",e.supportsFullScreen=!0;break}}else e.supportsFullScreen=!0;return e.supportsFullScreen&&(e.fullScreenEventName="ms"===e.prefix?"MSFullscreenChange":e.prefix+"fullscreenchange",e.isFullScreen=function(e){switch(N.undefined(e)&&(e=t.body),this.prefix){case"":return t.fullscreenElement===e;case"moz":return t.mozFullScreenElement===e;default:return t[this.prefix+"FullscreenElement"]===e}},e.requestFullScreen=function(e){return N.undefined(e)&&(e=t.body),""===this.prefix?e.requestFullScreen():e[this.prefix+("ms"===this.prefix?"RequestFullscreen":"RequestFullScreen")]()},e.cancelFullScreen=function(){return""===this.prefix?t.cancelFullScreen():t[this.prefix+("ms"===this.prefix?"ExitFullscreen":"CancelFullScreen")]()},e.element=function(){return""===this.prefix?t.fullscreenElement:t[this.prefix+"FullscreenElement"]}),e}function S(g,S){function A(e,t,n,r){b(e,t,n,T({},r,{plyr:Be}))}function M(t,n){S.debug&&e.console&&(n=Array.prototype.slice.call(n),N.string(S.logPrefix)&&S.logPrefix.length&&n.unshift(S.logPrefix))}function U(){return{url:S.iconUrl,absolute:0===S.iconUrl.indexOf("http")||Ve.browser.isIE}}function L(){var e=[],t=U(),n=(t.absolute?"":t.url)+"#"+S.iconPrefix;return o(S.controls,"play-large")&&e.push('<button type="button" data-plyr="play" class="plyr__play-large">','<svg><use xlink:href="'+n+'-play" /></svg>','<span class="plyr__sr-only">'+S.i18n.play+"</span>","</button>"),e.push('<div class="plyr__controls">'),o(S.controls,"restart")&&e.push('<button type="button" data-plyr="restart">','<svg><use xlink:href="'+n+'-restart" /></svg>','<span class="plyr__sr-only">'+S.i18n.restart+"</span>","</button>"),o(S.controls,"rewind")&&e.push('<button type="button" data-plyr="rewind">','<svg><use xlink:href="'+n+'-rewind" /></svg>','<span class="plyr__sr-only">'+S.i18n.rewind+"</span>","</button>"),o(S.controls,"play")&&e.push('<button type="button" data-plyr="play">','<svg><use xlink:href="'+n+'-play" /></svg>','<span class="plyr__sr-only">'+S.i18n.play+"</span>","</button>",'<button type="button" data-plyr="pause">','<svg><use xlink:href="'+n+'-pause" /></svg>','<span class="plyr__sr-only">'+S.i18n.pause+"</span>","</button>"),o(S.controls,"fast-forward")&&e.push('<button type="button" data-plyr="fast-forward">','<svg><use xlink:href="'+n+'-fast-forward" /></svg>','<span class="plyr__sr-only">'+S.i18n.forward+"</span>","</button>"),o(S.controls,"progress")&&(e.push('<span class="plyr__progress">','<label for="seek{id}" class="plyr__sr-only">Seek</label>','<input id="seek{id}" class="plyr__progress--seek" type="range" min="0" max="100" step="0.1" value="0" data-plyr="seek">','<progress class="plyr__progress--played" max="100" value="0" role="presentation"></progress>','<progress class="plyr__progress--buffer" max="100" value="0">',"<span>0</span>% "+S.i18n.buffered,"</progress>"),S.tooltips.seek&&e.push('<span class="plyr__tooltip">00:00</span>'),e.push("</span>")),o(S.controls,"current-time")&&e.push('<span class="plyr__time">','<span class="plyr__sr-only">'+S.i18n.currentTime+"</span>",'<span class="plyr__time--current">00:00</span>',"</span>"),o(S.controls,"duration")&&e.push('<span class="plyr__time">','<span class="plyr__sr-only">'+S.i18n.duration+"</span>",'<span class="plyr__time--duration">00:00</span>',"</span>"),o(S.controls,"mute")&&e.push('<button type="button" data-plyr="mute">','<svg class="icon--muted"><use xlink:href="'+n+'-muted" /></svg>','<svg><use xlink:href="'+n+'-volume" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleMute+"</span>","</button>"),o(S.controls,"volume")&&e.push('<span class="plyr__volume">','<label for="volume{id}" class="plyr__sr-only">'+S.i18n.volume+"</label>",'<input id="volume{id}" class="plyr__volume--input" type="range" min="'+S.volumeMin+'" max="'+S.volumeMax+'" value="'+S.volume+'" data-plyr="volume">','<progress class="plyr__volume--display" max="'+S.volumeMax+'" value="'+S.volumeMin+'" role="presentation"></progress>',"</span>"),o(S.controls,"captions")&&e.push('<button type="button" data-plyr="captions">','<svg class="icon--captions-on"><use xlink:href="'+n+'-captions-on" /></svg>','<svg><use xlink:href="'+n+'-captions-off" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleCaptions+"</span>","</button>"),o(S.controls,"fullscreen")&&e.push('<button type="button" data-plyr="fullscreen">','<svg class="icon--exit-fullscreen"><use xlink:href="'+n+'-exit-fullscreen" /></svg>','<svg><use xlink:href="'+n+'-enter-fullscreen" /></svg>','<span class="plyr__sr-only">'+S.i18n.toggleFullscreen+"</span>","</button>"),e.push("</div>"),e.join("")}function F(){if(Ve.supported.full&&("audio"!==Ve.type||S.fullscreen.allowAudio)&&S.fullscreen.enabled){var e=j.supportsFullScreen;e||S.fullscreen.fallback&&!W()?(ze((e?"Native":"Fallback")+" fullscreen enabled"),p(Ve.container,S.classes.fullscreen.enabled,!0)):ze("Fullscreen not supported and fallback disabled"),Ve.buttons&&Ve.buttons.fullscreen&&_(Ve.buttons.fullscreen,!1),G()}}function $(){if("video"===Ve.type){V(S.selectors.captions)||Ve.videoContainer.insertAdjacentHTML("afterbegin",'<div class="'+f(S.selectors.captions)+'"></div>'),Ve.usingTextTracks=!1,Ve.media.textTracks&&(Ve.usingTextTracks=!0);for(var e,t="",n=Ve.media.childNodes,r=0;r<n.length;r++)"track"===n[r].nodeName.toLowerCase()&&(e=n[r].kind,"captions"!==e&&"subtitles"!==e||(t=n[r].getAttribute("src")));if(Ve.captionExists=!0,""===t?(Ve.captionExists=!1,ze("No caption track found")):ze("Caption track found; URI: "+t),Ve.captionExists){for(var i=Ve.media.textTracks,o=0;o<i.length;o++)i[o].mode="hidden";if(H(Ve),(Ve.browser.isIE&&Ve.browser.version>=10||Ve.browser.isFirefox&&Ve.browser.version>=31)&&(ze("Detected browser with known TextTrack issues - using manual fallback"),Ve.usingTextTracks=!1),Ve.usingTextTracks){ze("TextTracks supported");for(var s=0;s<i.length;s++){var a=i[s];"captions"!==a.kind&&"subtitles"!==a.kind||y(a,"cuechange",function(){this.activeCues[0]&&"text"in this.activeCues[0]?X(this.activeCues[0].getCueAsHTML()):X()})}}else if(ze("TextTracks not supported so rendering captions manually"),Ve.currentCaption="",Ve.captions=[],""!==t){var u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===u.readyState)if(200===u.status){var e,t=[],n=u.responseText,r="\r\n";n.indexOf(r+r)===-1&&(r=n.indexOf("\r\r")!==-1?"\r":"\n"),t=n.split(r+r);for(var i=0;i<t.length;i++){e=t[i],Ve.captions[i]=[];var o=e.split(r),s=0;o[s].indexOf(":")===-1&&(s=1),Ve.captions[i]=[o[s],o[s+1]]}Ve.captions.shift(),ze("Successfully loaded the caption file via AJAX")}else Ye(S.logPrefix+"There was a problem loading the caption file via AJAX")},u.open("get",t,!0),u.send()}}else p(Ve.container,S.classes.captions.enabled)}}function X(e){var n=V(S.selectors.captions),r=t.createElement("span");n.innerHTML="",N.undefined(e)&&(e=""),N.string(e)?r.innerHTML=e.trim():r.appendChild(e),n.appendChild(r);n.offsetHeight}function q(e){function t(e,t){var n=[];n=e.split(" --> ");for(var r=0;r<n.length;r++)n[r]=n[r].replace(/(\d+:\d+:\d+\.\d+).*/,"$1");return i(n[t])}function n(e){return t(e,0)}function r(e){return t(e,1)}function i(e){if(null===e||void 0===e)return 0;var t=[],n=[];return t=e.split(","),n=t[0].split(":"),Math.floor(60*n[0]*60)+Math.floor(60*n[1])+Math.floor(n[2])}if(!Ve.usingTextTracks&&"video"===Ve.type&&Ve.supported.full&&(Ve.subcount=0,e=N.number(e)?e:Ve.media.currentTime,Ve.captions[Ve.subcount])){for(;r(Ve.captions[Ve.subcount][0])<e.toFixed(1);)if(Ve.subcount++,Ve.subcount>Ve.captions.length-1){Ve.subcount=Ve.captions.length-1;break}Ve.media.currentTime.toFixed(1)>=n(Ve.captions[Ve.subcount][0])&&Ve.media.currentTime.toFixed(1)<=r(Ve.captions[Ve.subcount][0])?(Ve.currentCaption=Ve.captions[Ve.subcount][1],X(Ve.currentCaption)):X()}}function H(){if(Ve.buttons.captions){p(Ve.container,S.classes.captions.enabled,!0);var e=Ve.storage.captionsEnabled;N.boolean(e)||(e=S.captions.defaultActive),e&&(p(Ve.container,S.classes.captions.active,!0),_(Ve.buttons.captions,!0))}}function B(e){return Ve.container.querySelectorAll(e)}function V(e){return B(e)[0]}function W(){try{return e.self!==e.top}catch(e){return!0}}function G(){function e(e){9===e.which&&Ve.isFullscreen&&(e.target!==r||e.shiftKey?e.target===n&&e.shiftKey&&(e.preventDefault(),r.focus()):(e.preventDefault(),n.focus()))}var t=B("input:not([disabled]), button:not([disabled])"),n=t[0],r=t[t.length-1];y(Ve.container,"keydown",e)}function z(e,t){if(N.string(t))d(e,Ve.media,{src:t});else if(t.constructor===Array)for(var n=t.length-1;n>=0;n--)d(e,Ve.media,t[n])}function Y(){if(S.loadSprite){var e=U();e.absolute?(ze("AJAX loading absolute SVG sprite"+(Ve.browser.isIE?" (due to IE)":"")),x(e.url,"sprite-plyr")):ze("Sprite will be used as external resource directly")}var n=S.html;ze("Injecting custom controls"),n||(n=L()),n=s(n,"{seektime}",S.seekTime),n=s(n,"{id}",Math.floor(1e4*Math.random()));var r;if(N.string(S.selectors.controls.container)&&(r=t.querySelector(S.selectors.controls.container)),N.htmlElement(r)||(r=Ve.container),r.insertAdjacentHTML("beforeend",n),S.tooltips.controls)for(var i=B([S.selectors.controls.wrapper," ",S.selectors.labels," .",S.classes.hidden].join("")),o=i.length-1;o>=0;o--){var a=i[o];p(a,S.classes.hidden,!1),p(a,S.classes.tooltip,!0)}}function K(){try{return Ve.controls=V(S.selectors.controls.wrapper),Ve.buttons={},Ve.buttons.seek=V(S.selectors.buttons.seek),Ve.buttons.play=B(S.selectors.buttons.play),Ve.buttons.pause=V(S.selectors.buttons.pause),Ve.buttons.restart=V(S.selectors.buttons.restart),Ve.buttons.rewind=V(S.selectors.buttons.rewind),Ve.buttons.forward=V(S.selectors.buttons.forward),Ve.buttons.fullscreen=V(S.selectors.buttons.fullscreen),Ve.buttons.mute=V(S.selectors.buttons.mute),Ve.buttons.captions=V(S.selectors.buttons.captions),Ve.progress={},Ve.progress.container=V(S.selectors.progress.container),Ve.progress.buffer={},Ve.progress.buffer.bar=V(S.selectors.progress.buffer),Ve.progress.buffer.text=Ve.progress.buffer.bar&&Ve.progress.buffer.bar.getElementsByTagName("span")[0],Ve.progress.played=V(S.selectors.progress.played),Ve.progress.tooltip=Ve.progress.container&&Ve.progress.container.querySelector("."+S.classes.tooltip),Ve.volume={},Ve.volume.input=V(S.selectors.volume.input),Ve.volume.display=V(S.selectors.volume.display),Ve.duration=V(S.selectors.duration),Ve.currentTime=V(S.selectors.currentTime),Ve.seekTime=B(S.selectors.seekTime),!0}catch(e){return Ye("It looks like there is a problem with your controls HTML"),Q(!0),!1}}function J(){p(Ve.container,S.selectors.container.replace(".",""),Ve.supported.full)}function Q(e){e&&o(S.types.html5,Ve.type)?Ve.media.setAttribute("controls",""):Ve.media.removeAttribute("controls")}function Z(e){var t=S.i18n.play;if(N.string(S.title)&&S.title.length&&(t+=", "+S.title,Ve.container.setAttribute("aria-label",S.title)),Ve.supported.full&&Ve.buttons.play)for(var n=Ve.buttons.play.length-1;n>=0;n--)Ve.buttons.play[n].setAttribute("aria-label",t);N.htmlElement(e)&&e.setAttribute("title",S.i18n.frameTitle.replace("{title}",S.title))}function ee(){var t=null;Ve.storage={},D.supported&&S.storage.enabled&&(e.localStorage.removeItem("plyr-volume"),t=e.localStorage.getItem(S.storage.key),t&&(/^\d+(\.\d+)?$/.test(t)?te({volume:parseFloat(t)}):Ve.storage=JSON.parse(t)))}function te(t){D.supported&&S.storage.enabled&&(T(Ve.storage,t),e.localStorage.setItem(S.storage.key,JSON.stringify(Ve.storage)))}function ne(){if(!Ve.media)return void Ye("No media element found!");if(Ve.supported.full&&(p(Ve.container,S.classes.type.replace("{0}",Ve.type),!0),o(S.types.embed,Ve.type)&&p(Ve.container,S.classes.type.replace("{0}","video"),!0),p(Ve.container,S.classes.stopped,S.autoplay),p(Ve.ontainer,S.classes.isIos,Ve.browser.isIos),p(Ve.container,S.classes.isTouch,Ve.browser.isTouch),"video"===Ve.type)){var e=t.createElement("div");e.setAttribute("class",S.classes.videoWrapper),a(Ve.media,e),Ve.videoContainer=e}o(S.types.embed,Ve.type)&&re()}function re(){var n,r=t.createElement("div"),o=Ve.type+"-"+Math.floor(1e4*Math.random());switch(Ve.type){case"youtube":n=C(Ve.embedId);break;case"vimeo":n=k(Ve.embedId);break;default:n=Ve.embedId}for(var s=B('[id^="'+Ve.type+'-"]'),a=s.length-1;a>=0;a--)u(s[a]);if(p(Ve.media,S.classes.videoWrapper,!0),p(Ve.media,S.classes.embedWrapper,!0),"youtube"===Ve.type)Ve.media.appendChild(r),r.setAttribute("id",o),N.object(e.YT)?oe(n,r):(i(S.urls.youtube.api),e.onYouTubeReadyCallbacks=e.onYouTubeReadyCallbacks||[],e.onYouTubeReadyCallbacks.push(function(){oe(n,r)}),e.onYouTubeIframeAPIReady=function(){e.onYouTubeReadyCallbacks.forEach(function(e){e()})});else if("vimeo"===Ve.type)if(Ve.supported.full?Ve.media.appendChild(r):r=Ve.media,r.setAttribute("id",o),N.object(e.Vimeo))se(n,r);else{i(S.urls.vimeo.api);var c=e.setInterval(function(){N.object(e.Vimeo)&&(e.clearInterval(c),se(n,r))},50)}else if("soundcloud"===Ve.type){var d=t.createElement("iframe");d.loaded=!1,y(d,"load",function(){d.loaded=!0}),l(d,{src:"https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/"+n,id:o}),r.appendChild(d),Ve.media.appendChild(r),e.SC||i(S.urls.soundcloud.api);var f=e.setInterval(function(){e.SC&&d.loaded&&(e.clearInterval(f),ae.call(d))},50)}}function ie(){Ve.supported.full&&(qe(),He()),Z(V("iframe"))}function oe(t,n){Ve.embed=new e.YT.Player(n.id,{videoId:t,playerVars:{autoplay:S.autoplay?1:0,controls:Ve.supported.full?0:1,rel:0,showinfo:0,iv_load_policy:3,cc_load_policy:S.captions.defaultActive?1:0,cc_lang_pref:"en",wmode:"transparent",modestbranding:1,disablekb:1,origin:"*"},events:{onError:function(e){A(Ve.container,"error",!0,{code:e.data,embed:e.target})},onReady:function(t){var n=t.target;Ve.media.play=function(){n.playVideo(),Ve.media.paused=!1},Ve.media.pause=function(){n.pauseVideo(),Ve.media.paused=!0},Ve.media.stop=function(){n.stopVideo(),Ve.media.paused=!0},Ve.media.duration=n.getDuration(),Ve.media.paused=!0,Ve.media.currentTime=0,Ve.media.muted=n.isMuted(),S.title=n.getVideoData().title,Ve.supported.full&&Ve.media.querySelector("iframe").setAttribute("tabindex","-1"),ie(),A(Ve.media,"timeupdate"),A(Ve.media,"durationchange"),e.clearInterval(We.buffering),We.buffering=e.setInterval(function(){Ve.media.buffered=n.getVideoLoadedFraction(),(null===Ve.media.lastBuffered||Ve.media.lastBuffered<Ve.media.buffered)&&A(Ve.media,"progress"),Ve.media.lastBuffered=Ve.media.buffered,1===Ve.media.buffered&&(e.clearInterval(We.buffering),A(Ve.media,"canplaythrough"))},200)},onStateChange:function(t){var n=t.target;switch(e.clearInterval(We.playing),t.data){case 0:Ve.media.paused=!0,A(Ve.media,"ended");break;case 1:Ve.media.paused=!1,Ve.media.seeking&&A(Ve.media,"seeked"),Ve.media.seeking=!1,A(Ve.media,"play"),A(Ve.media,"playing"),We.playing=e.setInterval(function(){Ve.media.currentTime=n.getCurrentTime(),A(Ve.media,"timeupdate")},100),Ve.media.duration!==n.getDuration()&&(Ve.media.duration=n.getDuration(),A(Ve.media,"durationchange"));break;case 2:Ve.media.paused=!0,A(Ve.media,"pause")}A(Ve.container,"statechange",!1,{code:t.data})}}})}function se(t,n){Ve.embed=new e.Vimeo.Player(n,{id:parseInt(t),loop:S.loop,autoplay:S.autoplay,byline:!1,portrait:!1,title:!1}),Ve.media.play=function(){Ve.embed.play(),Ve.media.paused=!1},Ve.media.pause=function(){Ve.embed.pause(),Ve.media.paused=!0},Ve.media.stop=function(){Ve.embed.stop(),Ve.media.paused=!0},Ve.media.paused=!0,Ve.media.currentTime=0,ie(),Ve.embed.getCurrentTime().then(function(e){Ve.media.currentTime=e,A(Ve.media,"timeupdate")}),Ve.embed.getDuration().then(function(e){Ve.media.duration=e,A(Ve.media,"durationchange")}),Ve.embed.on("loaded",function(){N.htmlElement(Ve.embed.element)&&Ve.supported.full&&Ve.embed.element.setAttribute("tabindex","-1")}),Ve.embed.on("play",function(){Ve.media.paused=!1,A(Ve.media,"play"),A(Ve.media,"playing")}),Ve.embed.on("pause",function(){Ve.media.paused=!0,A(Ve.media,"pause")}),Ve.embed.on("timeupdate",function(e){Ve.media.seeking=!1,Ve.media.currentTime=e.seconds,A(Ve.media,"timeupdate")}),Ve.embed.on("progress",function(e){Ve.media.buffered=e.percent,A(Ve.media,"progress"),1===parseInt(e.percent)&&A(Ve.media,"canplaythrough")}),Ve.embed.on("seeked",function(){Ve.media.seeking=!1,A(Ve.media,"seeked"),A(Ve.media,"play")}),Ve.embed.on("ended",function(){Ve.media.paused=!0,A(Ve.media,"ended")})}function ae(){Ve.embed=e.SC.Widget(this),Ve.embed.bind(e.SC.Widget.Events.READY,function(){Ve.media.play=function(){Ve.embed.play(),Ve.media.paused=!1},Ve.media.pause=function(){Ve.embed.pause(),Ve.media.paused=!0},Ve.media.stop=function(){Ve.embed.seekTo(0),Ve.embed.pause(),Ve.media.paused=!0},Ve.media.paused=!0,Ve.media.currentTime=0,Ve.embed.getDuration(function(e){Ve.media.duration=e/1e3,ie()}),Ve.embed.getPosition(function(e){Ve.media.currentTime=e,A(Ve.media,"timeupdate")}),Ve.embed.bind(e.SC.Widget.Events.PLAY,function(){Ve.media.paused=!1,A(Ve.media,"play"),A(Ve.media,"playing")}),Ve.embed.bind(e.SC.Widget.Events.PAUSE,function(){Ve.media.paused=!0,A(Ve.media,"pause")}),Ve.embed.bind(e.SC.Widget.Events.PLAY_PROGRESS,function(e){Ve.media.seeking=!1,Ve.media.currentTime=e.currentPosition/1e3,A(Ve.media,"timeupdate")}),Ve.embed.bind(e.SC.Widget.Events.LOAD_PROGRESS,function(e){Ve.media.buffered=e.loadProgress,A(Ve.media,"progress"),1===parseInt(e.loadProgress)&&A(Ve.media,"canplaythrough")}),Ve.embed.bind(e.SC.Widget.Events.FINISH,function(){Ve.media.paused=!0,A(Ve.media,"ended")})})}function ue(){"play"in Ve.media&&Ve.media.play()}function ce(){"pause"in Ve.media&&Ve.media.pause()}function le(e){return N.boolean(e)||(e=Ve.media.paused),e?ue():ce(),e}function de(e){N.number(e)||(e=S.seekTime),pe(Ve.media.currentTime-e)}function fe(e){N.number(e)||(e=S.seekTime),pe(Ve.media.currentTime+e)}function pe(e){var t=0,n=Ve.media.paused,r=he();N.number(e)?t=e:N.object(e)&&o(["input","change"],e.type)&&(t=e.target.value/e.target.max*r),t<0?t=0:t>r&&(t=r),je(t);try{Ve.media.currentTime=t.toFixed(4)}catch(e){}if(o(S.types.embed,Ve.type)){switch(Ve.type){case"youtube":Ve.embed.seekTo(t);break;case"vimeo":Ve.embed.setCurrentTime(t.toFixed(0));break;case"soundcloud":Ve.embed.seekTo(1e3*t)}n&&ce(),A(Ve.media,"timeupdate"),Ve.media.seeking=!0,A(Ve.media,"seeking")}ze("Seeking to "+Ve.media.currentTime+" seconds"),q(t)}function he(){var e=parseInt(S.duration),t=0;return null===Ve.media.duration||isNaN(Ve.media.duration)||(t=Ve.media.duration),isNaN(e)?t:e}function me(){p(Ve.container,S.classes.playing,!Ve.media.paused),p(Ve.container,S.classes.stopped,Ve.media.paused),Pe(Ve.media.paused)}function ve(){O={x:e.pageXOffset||0,y:e.pageYOffset||0}}function ge(){e.scrollTo(O.x,O.y)}function ye(e){var n=j.supportsFullScreen;if(n){if(!e||e.type!==j.fullScreenEventName)return j.isFullScreen(Ve.container)?j.cancelFullScreen():(ve(),j.requestFullScreen(Ve.container)),void(Ve.isFullscreen=j.isFullScreen(Ve.container));Ve.isFullscreen=j.isFullScreen(Ve.container)}else Ve.isFullscreen=!Ve.isFullscreen,t.body.style.overflow=Ve.isFullscreen?"hidden":"";p(Ve.container,S.classes.fullscreen.active,Ve.isFullscreen),G(Ve.isFullscreen),Ve.buttons&&Ve.buttons.fullscreen&&_(Ve.buttons.fullscreen,Ve.isFullscreen),A(Ve.container,Ve.isFullscreen?"enterfullscreen":"exitfullscreen",!0),!Ve.isFullscreen&&n&&ge()}function be(e){if(N.boolean(e)||(e=!Ve.media.muted),_(Ve.buttons.mute,e),Ve.media.muted=e,0===Ve.media.volume&&_e(S.volume),o(S.types.embed,Ve.type)){switch(Ve.type){case"youtube":Ve.embed[Ve.media.muted?"mute":"unMute"]();break;case"vimeo":case"soundcloud":Ve.embed.setVolume(Ve.media.muted?0:parseFloat(S.volume/S.volumeMax))}A(Ve.media,"volumechange")}}function _e(e){var t=S.volumeMax,n=S.volumeMin;if(N.undefined(e)&&(e=Ve.storage.volume),(null===e||isNaN(e))&&(e=S.volume),e>t&&(e=t),e<n&&(e=n),Ve.media.volume=parseFloat(e/t),Ve.volume.display&&(Ve.volume.display.value=e),o(S.types.embed,Ve.type)){switch(Ve.type){case"youtube":Ve.embed.setVolume(100*Ve.media.volume);break;case"vimeo":case"soundcloud":Ve.embed.setVolume(Ve.media.volume)}A(Ve.media,"volumechange")}0===e?Ve.media.muted=!0:Ve.media.muted&&e>0&&be()}function we(e){var t=Ve.media.muted?0:Ve.media.volume*S.volumeMax;N.number(e)||(e=S.volumeStep),_e(t+e)}function Te(e){var t=Ve.media.muted?0:Ve.media.volume*S.volumeMax;N.number(e)||(e=S.volumeStep),_e(t-e)}function Ce(){var e=Ve.media.muted?0:Ve.media.volume*S.volumeMax;Ve.supported.full&&(Ve.volume.input&&(Ve.volume.input.value=e),Ve.volume.display&&(Ve.volume.display.value=e)),te({volume:e}),p(Ve.container,S.classes.muted,0===e),Ve.supported.full&&Ve.buttons.mute&&_(Ve.buttons.mute,0===e)}function ke(e){Ve.supported.full&&Ve.buttons.captions&&(N.boolean(e)||(e=Ve.container.className.indexOf(S.classes.captions.active)===-1),Ve.captionsEnabled=e,_(Ve.buttons.captions,Ve.captionsEnabled),p(Ve.container,S.classes.captions.active,Ve.captionsEnabled),A(Ve.container,Ve.captionsEnabled?"captionsenabled":"captionsdisabled",!0),te({captionsEnabled:Ve.captionsEnabled}))}function Ee(e){var t="waiting"===e.type;clearTimeout(We.loading),We.loading=setTimeout(function(){p(Ve.container,S.classes.loading,t),Pe(t)},t?250:0)}function Se(e){if(Ve.supported.full){var t=Ve.progress.played,n=0,r=he();if(e)switch(e.type){case"timeupdate":case"seeking":if(Ve.controls.pressed)return;n=w(Ve.media.currentTime,r),"timeupdate"===e.type&&Ve.buttons.seek&&(Ve.buttons.seek.value=n);break;case"playing":case"progress":t=Ve.progress.buffer,n=function(){var e=Ve.media.buffered;return e&&e.length?w(e.end(0),r):N.number(e)?100*e:0}()}xe(t,n)}}function xe(e,t){if(Ve.supported.full){if(N.undefined(t)&&(t=0),N.undefined(e)){if(!Ve.progress||!Ve.progress.buffer)return;e=Ve.progress.buffer}N.htmlElement(e)?e.value=t:e&&(e.bar&&(e.bar.value=t),e.text&&(e.text.innerHTML=t))}}function Re(e,t){if(t){isNaN(e)&&(e=0),Ve.secs=parseInt(e%60),Ve.mins=parseInt(e/60%60),Ve.hours=parseInt(e/60/60%60);var n=parseInt(he()/60/60%60)>0;Ve.secs=("0"+Ve.secs).slice(-2),Ve.mins=("0"+Ve.mins).slice(-2),t.innerHTML=(n?Ve.hours+":":"")+Ve.mins+":"+Ve.secs}}function Ae(){if(Ve.supported.full){var e=he()||0;!Ve.duration&&S.displayDuration&&Ve.media.paused&&Re(e,Ve.currentTime),Ve.duration&&Re(e,Ve.duration),Oe()}}function Ie(e){Re(Ve.media.currentTime,Ve.currentTime),e&&"timeupdate"===e.type&&Ve.media.seeking||Se(e)}function je(e){N.number(e)||(e=0);var t=he(),n=w(e,t);Ve.progress&&Ve.progress.played&&(Ve.progress.played.value=n),Ve.buttons&&Ve.buttons.seek&&(Ve.buttons.seek.value=n)}function Oe(e){var t=he();if(S.tooltips.seek&&Ve.progress.container&&0!==t){var n=Ve.progress.container.getBoundingClientRect(),r=0,i=S.classes.tooltip+"--visible";if(e)r=100/n.width*(e.pageX-n.left);else{if(!h(Ve.progress.tooltip,i))return;r=Ve.progress.tooltip.style.left.replace("%","")}r<0?r=0:r>100&&(r=100),Re(t/100*r,Ve.progress.tooltip),Ve.progress.tooltip.style.left=r+"%",e&&o(["mouseenter","mouseleave"],e.type)&&p(Ve.progress.tooltip,i,"mouseenter"===e.type)}}function Pe(t){if(S.hideControls&&"audio"!==Ve.type){var n=0,r=!1,i=t,s=h(Ve.container,S.classes.loading);if(N.boolean(t)||(t&&t.type?(r="enterfullscreen"===t.type,i=o(["mousemove","touchstart","mouseenter","focus"],t.type),o(["mousemove","touchmove"],t.type)&&(n=2e3),"focus"===t.type&&(n=3e3)):i=h(Ve.container,S.classes.hideControls)),e.clearTimeout(We.hover),i||Ve.media.paused||s){if(p(Ve.container,S.classes.hideControls,!1),Ve.media.paused||s)return;Ve.browser.isTouch&&(n=3e3)}i&&Ve.media.paused||(We.hover=e.setTimeout(function(){(!Ve.controls.pressed&&!Ve.controls.hover||r)&&p(Ve.container,S.classes.hideControls,!0)},n))}}function Ne(e){if(!N.undefined(e))return void De(e);var t;switch(Ve.type){case"youtube":t=Ve.embed.getVideoUrl();break;case"vimeo":Ve.embed.getVideoUrl.then(function(e){t=e});break;case"soundcloud":Ve.embed.getCurrentSound(function(e){t=e.permalink_url});break;default:t=Ve.media.currentSrc}return t||""}function De(e){function n(){if(Ve.embed=null,u(Ve.media),"video"===Ve.type&&Ve.videoContainer&&u(Ve.videoContainer),Ve.container&&Ve.container.removeAttribute("class"),"type"in e&&(Ve.type=e.type,"video"===Ve.type)){var n=e.sources[0];"type"in n&&o(S.types.embed,n.type)&&(Ve.type=n.type)}switch(Ve.supported=R(Ve.type),Ve.type){case"video":Ve.media=t.createElement("video");break;case"audio":Ve.media=t.createElement("audio");break;case"youtube":case"vimeo":case"soundcloud":Ve.media=t.createElement("div"),Ve.embedId=e.sources[0].src}c(Ve.container,Ve.media),N.boolean(e.autoplay)&&(S.autoplay=e.autoplay),o(S.types.html5,Ve.type)&&(S.crossorigin&&Ve.media.setAttribute("crossorigin",""),S.autoplay&&Ve.media.setAttribute("autoplay",""),"poster"in e&&Ve.media.setAttribute("poster",e.poster),S.loop&&Ve.media.setAttribute("loop","")),p(Ve.container,S.classes.fullscreen.active,Ve.isFullscreen),p(Ve.container,S.classes.captions.active,Ve.captionsEnabled),J(),o(S.types.html5,Ve.type)&&z("source",e.sources),ne(),o(S.types.html5,Ve.type)&&("tracks"in e&&z("track",e.tracks),Ve.media.load()),(o(S.types.html5,Ve.type)||o(S.types.embed,Ve.type)&&!Ve.supported.full)&&(qe(),He()),S.title=e.title,Z()}if(!(N.object(e)&&"sources"in e&&e.sources.length))return void Ye("Invalid source format");p(Ve.container,S.classes.ready,!1),ce(),je(),xe(),Fe(),$e(n,!1)}function Me(e){"video"===Ve.type&&Ve.media.setAttribute("poster",e)}function Ue(){function n(){var e=le(),t=Ve.buttons[e?"play":"pause"],n=Ve.buttons[e?"pause":"play"];if(n=n&&n.length>1?n[n.length-1]:n[0]){var r=h(t,S.classes.tabFocus);setTimeout(function(){n.focus(),r&&(p(t,S.classes.tabFocus,!1),p(n,S.classes.tabFocus,!0))},100)}}function r(){var e=t.activeElement;return e=e&&e!==t.body?t.querySelector(":focus"):null}function i(e){return e.keyCode?e.keyCode:e.which}function s(e){for(var t in Ve.buttons){var n=Ve.buttons[t];if(N.nodeList(n))for(var r=0;r<n.length;r++)p(n[r],S.classes.tabFocus,n[r]===e);else p(n,S.classes.tabFocus,n===e)}}function a(e){function t(){var e=Ve.media.duration;N.number(e)&&pe(e/10*(n-48))}var n=i(e),r="keydown"===e.type,s=r&&n===c;if(N.number(n))if(r){var a=[48,49,50,51,52,53,54,56,57,32,75,38,40,77,39,37,70,67];switch(o(a,n)&&(e.preventDefault(),e.stopPropagation()),n){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:s||t();break;case 32:case 75:s||le();break;case 38:we();break;case 40:Te();break;case 77:s||be();break;case 39:fe();break;case 37:de();break;case 70:ye();break;case 67:s||ke()}!j.supportsFullScreen&&Ve.isFullscreen&&27===n&&ye(),c=n}else c=null}var u=Ve.browser.isIE?"change":"input";if(S.keyboardShorcuts.focused){var c=null;S.keyboardShorcuts.global&&y(e,"keydown keyup",function(e){var t=i(e),n=r(),s=[48,49,50,51,52,53,54,56,57,75,77,70,67];1!==I().length||!o(s,t)||N.htmlElement(n)&&m(n,S.selectors.editable)||a(e)}),y(Ve.container,"keydown keyup",a)}y(e,"keyup",function(e){var t=i(e),n=r();9===t&&s(n)}),y(t.body,"click",function(){p(V("."+S.classes.tabFocus),S.classes.tabFocus,!1)});for(var l in Ve.buttons){var d=Ve.buttons[l];y(d,"blur",function(){p(d,"tab-focus",!1)})}v(Ve.buttons.play,"click",S.listeners.play,n),v(Ve.buttons.pause,"click",S.listeners.pause,n),v(Ve.buttons.restart,"click",S.listeners.restart,pe),v(Ve.buttons.rewind,"click",S.listeners.rewind,de),v(Ve.buttons.forward,"click",S.listeners.forward,fe),v(Ve.buttons.seek,u,S.listeners.seek,pe),v(Ve.volume.input,u,S.listeners.volume,function(){_e(Ve.volume.input.value)}),v(Ve.buttons.mute,"click",S.listeners.mute,be),v(Ve.buttons.fullscreen,"click",S.listeners.fullscreen,ye),j.supportsFullScreen&&y(t,j.fullScreenEventName,ye),y(Ve.buttons.captions,"click",ke),y(Ve.progress.container,"mouseenter mouseleave mousemove",Oe),S.hideControls&&(y(Ve.container,"mouseenter mouseleave mousemove touchstart touchend touchcancel touchmove enterfullscreen",Pe),y(Ve.controls,"mouseenter mouseleave",function(e){Ve.controls.hover="mouseenter"===e.type}),y(Ve.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){Ve.controls.pressed=o(["mousedown","touchstart"],e.type)}),y(Ve.controls,"focus blur",Pe,!0)),y(Ve.volume.input,"wheel",function(e){e.preventDefault();var t=e.webkitDirectionInvertedFromDevice,n=S.volumeStep/5;(e.deltaY<0||e.deltaX>0)&&(t?Te(n):we(n)),(e.deltaY>0||e.deltaX<0)&&(t?we(n):Te(n))})}function Le(){if(y(Ve.media,"timeupdate seeking",Ie),y(Ve.media,"timeupdate",q),y(Ve.media,"durationchange loadedmetadata",Ae),y(Ve.media,"ended",function(){"video"===Ve.type&&S.showPosterOnEnd&&("video"===Ve.type&&X(),pe(),Ve.media.load())}),y(Ve.media,"progress playing",Se),y(Ve.media,"volumechange",Ce),y(Ve.media,"play pause ended",me),y(Ve.media,"waiting canplay seeked",Ee),S.clickToPlay&&"audio"!==Ve.type){var e=V("."+S.classes.videoWrapper);if(!e)return;e.style.cursor="pointer",y(e,"click",function(){S.hideControls&&Ve.browser.isTouch&&!Ve.media.paused||(Ve.media.paused?ue():Ve.media.ended?(pe(),ue()):ce())})}S.disableContextMenu&&y(Ve.media,"contextmenu",function(e){e.preventDefault()}),y(Ve.media,S.events.concat(["keyup","keydown"]).join(" "),function(e){A(Ve.container,e.type,!0)})}function Fe(){if(o(S.types.html5,Ve.type)){for(var e=Ve.media.querySelectorAll("source"),t=0;t<e.length;t++)u(e[t]);Ve.media.setAttribute("src","https://cdn.selz.com/plyr/blank.mp4"),Ve.media.load(),ze("Cancelled network requests")}}function $e(n,r){function i(){clearTimeout(We.cleanUp),N.boolean(r)||(r=!0),N.function(n)&&n.call(Ge),r&&(Ve.init=!1,Ve.container.parentNode.replaceChild(Ge,Ve.container),t.body.style.overflow="",A(Ge,"destroyed",!0))}if(!Ve.init)return null;switch(Ve.type){case"youtube":e.clearInterval(We.buffering),e.clearInterval(We.playing),Ve.embed.destroy(),i();break;case"vimeo":Ve.embed.unload().then(i),We.cleanUp=e.setTimeout(i,200);break;case"video":case"audio":Q(!0),i()}}function Xe(){if(Ve.init)return null;if(j=E(),Ve.browser=n(),N.htmlElement(Ve.media)){ee();var e=g.tagName.toLowerCase();"div"===e?(Ve.type=g.getAttribute("data-type"),Ve.embedId=g.getAttribute("data-video-id"),g.removeAttribute("data-type"),g.removeAttribute("data-video-id")):(Ve.type=e,S.crossorigin=null!==g.getAttribute("crossorigin"),S.autoplay=S.autoplay||null!==g.getAttribute("autoplay"),S.loop=S.loop||null!==g.getAttribute("loop")),Ve.supported=R(Ve.type),Ve.supported.basic&&(Ve.container=a(g,t.createElement("div")),Ve.container.setAttribute("tabindex",0),J(),ze(Ve.browser.name+" "+Ve.browser.version),ne(),(o(S.types.html5,Ve.type)||o(S.types.embed,Ve.type)&&!Ve.supported.full)&&(qe(),He(),Z()),Ve.init=!0)}}function qe(){if(!Ve.supported.full)return Ye("Basic support only",Ve.type),u(V(S.selectors.controls.wrapper)),u(V(S.selectors.buttons.play)),void Q(!0);var e=!B(S.selectors.controls.wrapper).length;e&&Y(),K()&&(e&&Ue(),Le(),Q(),F(),$(),_e(),Ce(),Ie(),me())}function He(){e.setTimeout(function(){A(Ve.media,"ready")},0),p(Ve.media,P.classes.setup,!0),p(Ve.container,S.classes.ready,!0),Ve.media.plyr=Be,S.autoplay&&ue()}var Be,Ve=this,We={};Ve.media=g;var Ge=g.cloneNode(!0),ze=function(){M("log",arguments)},Ye=function(){M("warn",arguments)};return ze("Config",S),Be={getOriginal:function(){return Ge},getContainer:function(){return Ve.container},getEmbed:function(){return Ve.embed},getMedia:function(){return Ve.media},getType:function(){return Ve.type},getDuration:he,getCurrentTime:function(){return Ve.media.currentTime},getVolume:function(){return Ve.media.volume},isMuted:function(){return Ve.media.muted},isReady:function(){return h(Ve.container,S.classes.ready)},isLoading:function(){return h(Ve.container,S.classes.loading)},isPaused:function(){return Ve.media.paused},on:function(e,t){return y(Ve.container,e,t),this},play:ue,pause:ce,stop:function(){ce(),pe()},restart:pe,rewind:de,forward:fe,seek:pe,source:Ne,poster:Me,setVolume:_e,togglePlay:le,toggleMute:be,toggleCaptions:ke,toggleFullscreen:ye,toggleControls:Pe,isFullscreen:function(){return Ve.isFullscreen||!1},support:function(e){return r(Ve,e)},destroy:$e},Xe(),Ve.init?Be:null}function x(e,n){var r=new XMLHttpRequest;if(!N.string(n)||!N.htmlElement(t.querySelector("#"+n))){var i=t.createElement("div");i.setAttribute("hidden",""),N.string(n)&&i.setAttribute("id",n),t.body.insertBefore(i,t.body.childNodes[0]),"withCredentials"in r&&(r.open("GET",e,!0),r.onload=function(){i.innerHTML=r.responseText},r.send())}}function R(e){var r=n(),i=r.isIE&&r.version<=9,o=r.isIos,s=r.isIphone,a=!!t.createElement("audio").canPlayType,u=!!t.createElement("video").canPlayType,c=!1,l=!1;switch(e){case"video":c=u,l=c&&!i&&!s;break;case"audio":c=a,l=c&&!i;break;case"vimeo":c=!0,l=!i&&!o;break;case"youtube":c=!0,l=!i&&!o,o&&!s&&r.version>=10&&(l=!0);break;case"soundcloud":c=!0,l=!i&&!s;break;default:c=a&&u,l=c&&!i}return{basic:c,full:l}}function A(e,n){function r(e,t){h(t,P.classes.hook)||i.push({target:e,media:t})}var i=[],o=[],s=[P.selectors.html5,P.selectors.embed].join(",");if(N.string(e)?e=t.querySelectorAll(e):N.htmlElement(e)?e=[e]:N.nodeList(e)||N.array(e)||N.string(e)||(N.undefined(n)&&N.object(e)&&(n=e),e=t.querySelectorAll(s)),N.nodeList(e)&&(e=Array.prototype.slice.call(e)),!R().basic||!e.length)return!1;for(var a=0;a<e.length;a++){var u=e[a],c=u.querySelectorAll(s);if(c.length)for(var l=0;l<c.length;l++)r(u,c[l]);else m(u,s)&&r(u,u)}return i.forEach(function(e){var t=e.target,r=e.media;var i={};try{i=JSON.parse(t.getAttribute("data-plyr"))}catch(e){}var s=T({},P,n,i);if(!s.enabled)return null;var a=new S(r,s);if(N.object(a)){if(s.debug){var u=s.events.concat(["setup","statechange","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled"]);y(a.getContainer(),u.join(" "),function(e){})}b(a.getContainer(),"setup",!0,{plyr:a}),o.push(a)}}),o}function I(e){if(N.string(e)?e=t.querySelector(e):N.undefined(e)&&(e=t.body),N.htmlElement(e)){var n=e.querySelectorAll("."+P.classes.setup),r=[];return Array.prototype.slice.call(n).forEach(function(e){N.object(e.plyr)&&r.push(e.plyr)}),r}return[]}var j,O={x:0,y:0},P={enabled:!0,debug:!1,autoplay:!1,loop:!1,seekTime:10,volume:10,volumeMin:0,volumeMax:10,volumeStep:1,duration:null,displayDuration:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/2.0.11/plyr.svg",clickToPlay:!0,hideControls:!0,showPosterOnEnd:!1,disableContextMenu:!0,keyboardShorcuts:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},selectors:{html5:"video, audio",embed:"[data-type]",editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{seek:'[data-plyr="seek"]',play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',forward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',fullscreen:'[data-plyr="fullscreen"]'},volume:{input:'[data-plyr="volume"]',display:".plyr__volume--display"},progress:{container:".plyr__progress",buffer:".plyr__progress--buffer",played:".plyr__progress--played"},captions:".plyr__captions",currentTime:".plyr__time--current",duration:".plyr__time--duration"},classes:{setup:"plyr--setup",ready:"plyr--ready",videoWrapper:"plyr__video-wrapper",embedWrapper:"plyr__video-embed",type:"plyr--{0}",stopped:"plyr--stopped",playing:"plyr--playing",muted:"plyr--muted",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",active:"plyr--fullscreen-active"},tabFocus:"tab-focus"},captions:{defaultActive:!1},fullscreen:{enabled:!0,fallback:!0,allowAudio:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","fullscreen"],i18n:{restart:"Restart",rewind:"Rewind {seektime} secs",play:"Play",pause:"Pause",forward:"Forward {seektime} secs",played:"played",buffered:"buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",toggleMute:"Toggle Mute",toggleCaptions:"Toggle Captions",toggleFullscreen:"Toggle Fullscreen",frameTitle:"Player for {title}"},types:{embed:["youtube","vimeo","soundcloud"],html5:["video","audio"]},urls:{vimeo:{api:"https://player.vimeo.com/api/player.js"},youtube:{api:"https://www.youtube.com/iframe_api"},soundcloud:{api:"https://w.soundcloud.com/player/api.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,forward:null,mute:null,volume:null,captions:null,fullscreen:null},events:["ready","ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied"],logPrefix:"[Plyr]"},N={object:function(e){return null!==e&&"object"==typeof e},array:function(e){return null!==e&&"object"==typeof e&&e.constructor===Array},number:function(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)},string:function(e){return null!==e&&("string"==typeof e||"object"==typeof e&&e.constructor===String)},boolean:function(e){return null!==e&&"boolean"==typeof e},nodeList:function(e){return null!==e&&e instanceof NodeList},htmlElement:function(e){return null!==e&&e instanceof HTMLElement},function:function(e){return null!==e&&"function"==typeof e},undefined:function(e){return null!==e&&void 0===e}},D={supported:function(){if(!("localStorage"in e))return!1;try{e.localStorage.setItem("___test","OK");var t=e.localStorage.getItem("___test");return e.localStorage.removeItem("___test"),"OK"===t}catch(e){return!1}return!1}()};return{setup:A,supported:R,loadSprite:x,get:I}}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}()},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return m[h]=r,p(h),h++}function i(e){delete m[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function s(e){if(v)setTimeout(s,0,e);else{var t=m[e];if(t){v=!0;try{o(t)}finally{i(e),v=!1}}}}function a(){p=function(e){t.nextTick(function(){s(e)})}}function u(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function c(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&s(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),p=function(n){e.postMessage(t+n,"*")}}function l(){var e=new MessageChannel;e.port1.onmessage=function(e){s(e.data)},p=function(t){e.port2.postMessage(t)}}function d(){var e=g.documentElement;p=function(t){var n=g.createElement("script");n.onreadystatechange=function(){s(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function f(){p=function(e){setTimeout(s,0,e)}}if(!e.setImmediate){var p,h=1,m={},v=!1,g=e.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(e);y=y&&y.setTimeout?y:e,"[object process]"==={}.toString.call(e.process)?a():u()?c():e.MessageChannel?l():g&&"onreadystatechange"in g.createElement("script")?d():f(),y.setImmediate=r,y.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(2),n(4))},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(44),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},,,function(e,t,n){n(5),e.exports=n(12)}]);